E/*
indotyre = 1.0.0 (cordovaz)
trial1 = 1.0,1 (io.cordova.trial1)
trial2 = 1.0.1 (io.cordova.trial2)
trial3 = 1.0.1 (io.cordova.trial3)
*/

// Dom7
var $$ = Dom7;

// Framework7 App main instance
var myApp  = new Framework7({
    root: '#app', // App root element
    pushState:false,
    id: 'io.framework7.testapp', // App bundle ID
    name: 'Easy Sales Pro', // App name
    theme: 'auto', // Automatic theme detection


    // App root data
    data: function () {
        return {
            user: {
                firstName: 'John',
                lastName: 'Doe',
            },
        };
    },
    // App root methodsE
    methods: {
        helloWorld: function () {
            myApp.dialog.alert('Hello World!');
        },
    },
    // App routes
    routes: routes,
});

// Init/Create main view
var mainView = myApp.views.create('.view-main', {
    url: '/'
});

//CORDOVA CLEAN


//GLOBAL VARIABLE
var jumlahListRencanaKunjungan ="";

var tanggalKunjungan = "";
var jumlahBelumKunjungan = "";
var jumlahSudahKunjungan = "";

var namaToko ="";
var alamatToko ="";

var kodeToko ="";

var latGlobal ="";
var lngGlobal ="";

var KODEVERSI = "1.0.18";
var VERSIMANUAL = "1.0.18.1";
var Calendar = tui.Calendar;

var urlZoomInOutGambar = {};

function addslashes(str) {
  return (str + '').replace(/[\\"']/g, '\\$&').replace(/\u0000/g, '\\0');
}

//var ipTujuan = "http://localhost:280/kerja/bond.php";

/*var ip = "192.168.1.8:280";
var ipTujuan = "http://"+ip+"/kerja/bond.php";
var ipGambar = "http://"+ip+"/kerja/gambar_karyawan/";
var iconCar = "http://"+ip+"/kerja/kerja/www/img/icon_car_map.png";


var ipUpload = "http://"+ip+"/kerja/upload.php";
var ipUploadTokoPelanggan = `http://`+ip+`/kerja/upload_toko_pelanggan.php`;
var ipUploadKtpPelanggan = `http://`+ip+`/kerja/upload_ktp_pelanggan.php`;
var ipUploadNpwpPelanggan = `http://`+ip+`/kerja/upload_npwp_pelanggan.php`;
var ipUploadKunjungan = `http://`+ip+`/kerja/upload_kunjungan.php`;
var ipUploadRencanaKunjungan = `http://`+ip+`/kerja/upload_rencana_kunjungan.php`;
var ipUploadPricelist = `http://`+ip+`/kerja/upload_pricelist.php`;
var ipUploadTdPemasanganBan = `http://`+ip+`/kerja/upload_td_pemasangan_ban.php`;
var ipUploadPemantauanBan = `http://`+ip+`/kerja/upload_pemantauan_ban.php`;
var ipUploadTdPemantauanBan = `http://`+ip+`/kerja/upload_td_pemantauan_ban.php`;

var ipUploadDesktopGambarPricelist = `http://${ip}/kerja/upload_desktop_gambar_pricelist.php`;

var ipGambarTokoPelanggan = `http://`+ip+`/kerja/gambar_pelanggan/toko/`;
var ipGambarKtpPelanggan = `http://`+ip+`/kerja/gambar_pelanggan/ktp/`;
var ipGambarNpwpPelanggan = `http://`+ip+`/kerja/gambar_pelanggan/npwp/`;
var ipGambarKunjungan = `http://`+ip+`/kerja/gambar_kunjungan/`;
var ipGambarRencanaKunjungan = `http://`+ip+`/kerja/gambar_rencana_kunjungan/`;
var ipGambarPricelist = `http://`+ip+`/kerja/gambar_barang/`;
var ipGambarPemantauanBan = `http://`+ip+`/kerja/gambar_td_pemantauan_ban/`;
var ipGambarTmPemantauanBan = `http://`+ip+`/kerja/gambar_pemantauan_ban/`;
var ipGambarTdPemasanganBan = `http://`+ip+`/kerja/gambar_td_pemasangan_ban/`;*/

/*var ip = "192.168.1.14/kerja";
var ipTujuan = "http://"+ip+"/bond.php";
var ipGambar = "http://"+ip+"/gambar_karyawan/";
var ipIconGambar = "http://"+ip+"/gambar_icon/";
var iconCar = "http://"+ip+"/kerja/www/img/icon_car_map.png";
var noPict = "http://"+ip+"/kerja/www/img/no_pict.jpg";
var noProfilePict = "http://"+ip+"/kerja/www/img/default-profile.png";
var imgFolder = "http://"+ip+"/kerja/www/img/";


var ipUpload = "http://"+ip+"/upload.php";
var ipUploadTokoPelanggan = `http://`+ip+`/upload_toko_pelanggan.php`;
var ipUploadKtpPelanggan = `http://`+ip+`/upload_ktp_pelanggan.php`;
var ipUploadNpwpPelanggan = `http://`+ip+`/upload_npwp_pelanggan.php`;
var ipUploadKunjungan = `http://`+ip+`/upload_kunjungan.php`;
var ipUploadRencanaKunjungan = `http://`+ip+`/upload_rencana_kunjungan.php`;
var ipUploadPricelist = `http://`+ip+`/upload_pricelist.php`;
var ipUploadAbsensi = `http://`+ip+`/upload_absensi.php`;
var ipUploadTdPemasanganBan = `http://`+ip+`/upload_td_pemasangan_ban.php`;
var ipUploadPemantauanBan = `http://`+ip+`/upload_pemantauan_ban.php`;
var ipUploadTdPemantauanBan = `http://`+ip+`/upload_td_pemantauan_ban.php`;
var ipUploadFotoNomorPlat = `http://`+ip+`/upload_nomor_plat.php`;
var ipUploadFotoOdometer = `http://`+ip+`/upload_odometer.php`;
var ipUploadFotoNotaPengeluaran = `http://`+ip+`/upload_nota_pengeluaran.php`;


var ipUploadDesktopGambarPricelist = `http://${ip}/upload_desktop_gambar_pricelist.php`;

var ipGambarTokoPelanggan = `http://`+ip+`/gambar_pelanggan/toko/`;
var ipGambarKtpPelanggan = `http://`+ip+`/gambar_pelanggan/ktp/`;
var ipGambarNpwpPelanggan = `http://`+ip+`/gambar_pelanggan/npwp/`;
var ipGambarKunjungan = `http://`+ip+`/gambar_kunjungan/`;
var ipGambarRencanaKunjungan = `http://`+ip+`/gambar_rencana_kunjungan/`;
var ipGambarPricelist = `http://`+ip+`/gambar_barang/`;
var ipGambarPemantauanBan = `http://`+ip+`/gambar_td_pemantauan_ban/`;
var ipGambarTmPemantauanBan = `http://`+ip+`/gambar_pemantauan_ban/`;
var ipGambarTdPemasanganBan = `http://`+ip+`/gambar_td_pemasangan_ban/`;
var ipGambarAbsensi = `http://`+ip+`/gambar_absensi/`;
var ipGambarPengeluaran = `http://`+ip+`/gambar_pengeluaran/`;*/


var ip = "indotyre.co.id/internal";
var ipGambar = `https://`+ip+`/bond/gambar_karyawan/`;
var ipIconGambar = "http://"+ip+"/bond/gambar_icon/";
var ipTujuan = `https://`+ip+`/bond/bond_online.php`;
var iconCar = "https://"+ip+"/img/icon_car_map.png";
var noPict = "https://"+ip+"/img/no_pict.jpg";
var noProfilePict = "https://"+ip+"/img/default-profile.png";
var imgFolder = "https://"+ip+"/img/";


var ipUpload = `http://`+ip+`/bond/upload_online.php`;
var ipUploadTokoPelanggan = `http://`+ip+`/bond/upload_toko_pelanggan.php`;
var ipUploadKtpPelanggan = `http://`+ip+`/bond/upload_ktp_pelanggan.php`;
var ipUploadNpwpPelanggan = `http://`+ip+`/bond/upload_npwp_pelanggan.php`;
var ipUploadKunjungan = `http://`+ip+`/bond/upload_kunjungan.php`;
var ipUploadRencanaKunjungan = `http://`+ip+`/bond/upload_rencana_kunjungan.php`;
var ipUploadPricelist = `http://`+ip+`/bond/upload_pricelist.php`;
var ipUploadAbsensi = `http://`+ip+`/bond/upload_absensi.php`;
var ipUploadTdPemasanganBan = `http://`+ip+`/bond/upload_td_pemasangan_ban.php`;
var ipUploadPemantauanBan = `http://`+ip+`/bond/upload_pemantauan_ban.php`;
var ipUploadTdPemantauanBan = `http://`+ip+`/bond/upload_td_pemantauan_ban.php`;
var ipUploadFotoNomorPlat = `http://`+ip+`/bond/upload_nomor_plat.php`;
var ipUploadFotoOdometer = `http://`+ip+`/bond/upload_odometer.php`;
var ipUploadFotoNotaPengeluaran = `http://`+ip+`/bond/upload_nota_pengeluaran.php`;

var ipUploadDesktopGambarPricelist = `http://${ip}/bond/upload_desktop_gambar_pricelist.php`;

var ipGambarTokoPelanggan = `https://`+ip+`/bond/gambar_pelanggan/toko/`;
var ipGambarKtpPelanggan = `https://`+ip+`/bond/gambar_pelanggan/ktp/`;
var ipGambarNpwpPelanggan = `https://`+ip+`/bond/gambar_pelanggan/npwp/`;
var ipGambarKunjungan = `https://`+ip+`/bond/gambar_kunjungan/`;
var ipGambarRencanaKunjungan = `https://`+ip+`/bond/gambar_rencana_kunjungan/`;
var ipGambarPricelist = `http://`+ip+`/bond/gambar_barang/`;
var ipGambarPemantauanBan = `http://`+ip+`/bond/gambar_td_pemantauan_ban/`;
var ipGambarTmPemantauanBan = `http://`+ip+`/bond/gambar_pemantauan_ban/`;
var ipGambarTdPemasanganBan = `http://`+ip+`/bond/gambar_td_pemasangan_ban/`;
var ipGambarAbsensi = `http://`+ip+`/bond/gambar_absensi/`;
var ipGambarPengeluaran = `http://`+ip+`/bond/gambar_pengeluaran/`;


/*var ip = "blessingcom.com/trial1";
var ipGambar = `https://`+ip+`/bond/gambar_karyawan/`;
var ipTujuan = `https://`+ip+`/bond/bond_online.php`;
var iconCar = "https://"+ip+"/img/icon_car_map.png";
var noPict = "https://"+ip+"/img/no_pict.jpg";
var noProfilePict = "https://"+ip+"/img/default-profile.png";
var imgFolder = "https://"+ip+"/img/";

var ipUpload = `http://`+ip+`/bond/upload_online.php`;
var ipUploadTokoPelanggan = `http://`+ip+`/bond/upload_toko_pelanggan.php`;
var ipUploadKtpPelanggan = `http://`+ip+`/bond/upload_ktp_pelanggan.php`;
var ipUploadNpwpPelanggan = `http://`+ip+`/bond/upload_npwp_pelanggan.php`;
var ipUploadKunjungan = `http://`+ip+`/bond/upload_kunjungan.php`;
var ipUploadRencanaKunjungan = `http://`+ip+`/bond/upload_rencana_kunjungan.php`;
var ipUploadPricelist = `http://`+ip+`/bond/upload_pricelist.php`;
var ipUploadTdPemasanganBan = `http://`+ip+`/bond/upload_td_pemasangan_ban.php`;
var ipUploadPemantauanBan = `http://`+ip+`/bond/upload_pemantauan_ban.php`;
var ipUploadTdPemantauanBan = `http://`+ip+`/bond/upload_td_pemantauan_ban.php`;

var ipUploadDesktopGambarPricelist = `http://${ip}/bond/upload_desktop_gambar_pricelist.php`;

var ipGambarTokoPelanggan = `https://`+ip+`/bond/gambar_pelanggan/toko/`;
var ipGambarKtpPelanggan = `https://`+ip+`/bond/gambar_pelanggan/ktp/`;
var ipGambarNpwpPelanggan = `https://`+ip+`/bond/gambar_pelanggan/npwp/`;
var ipGambarKunjungan = `https://`+ip+`/bond/gambar_kunjungan/`;
var ipGambarRencanaKunjungan = `https://`+ip+`/bond/gambar_rencana_kunjungan/`;
var ipGambarPricelist = `https://`+ip+`/bond/gambar_barang/`;
var ipGambarPemantauanBan = `http://`+ip+`/bond/gambar_td_pemantauan_ban/`;
var ipGambarTmPemantauanBan = `http://`+ip+`/bond/gambar_pemantauan_ban/`;
var ipGambarTdPemasanganBan = `http://`+ip+`/bond/gambar_td_pemasangan_ban/`;*/

/*var ip = "blessingcom.com/abason";
var ipGambar = `https://`+ip+`/bond/gambar_karyawan/`;
var ipTujuan = `https://`+ip+`/bond/bond_online.php`;
var iconCar = "https://"+ip+"/img/icon_car_map.png";
var noPict = "https://"+ip+"/img/no_pict.jpg";
var noProfilePict = "https://"+ip+"/img/default-profile.png";
var imgFolder = "https://"+ip+"/img/";

var ipUpload = `http://`+ip+`/bond/upload_online.php`;
var ipUploadTokoPelanggan = `http://`+ip+`/bond/upload_toko_pelanggan.php`;
var ipUploadKtpPelanggan = `http://`+ip+`/bond/upload_ktp_pelanggan.php`;
var ipUploadNpwpPelanggan = `http://`+ip+`/bond/upload_npwp_pelanggan.php`;
var ipUploadKunjungan = `http://`+ip+`/bond/upload_kunjungan.php`;
var ipUploadRencanaKunjungan = `http://`+ip+`/bond/upload_rencana_kunjungan.php`;
var ipUploadPricelist = `http://`+ip+`/bond/upload_pricelist.php`;
var ipUploadTdPemasanganBan = `http://`+ip+`/bond/upload_td_pemasangan_ban.php`;
var ipUploadPemantauanBan = `http://`+ip+`/bond/upload_pemantauan_ban.php`;
var ipUploadTdPemantauanBan = `http://`+ip+`/bond/upload_td_pemantauan_ban.php`;

var ipUploadDesktopGambarPricelist = `http://${ip}/bond/upload_desktop_gambar_pricelist.php`;

var ipGambarTokoPelanggan = `https://`+ip+`/bond/gambar_pelanggan/toko/`;
var ipGambarKtpPelanggan = `https://`+ip+`/bond/gambar_pelanggan/ktp/`;
var ipGambarNpwpPelanggan = `https://`+ip+`/bond/gambar_pelanggan/npwp/`;
var ipGambarKunjungan = `https://`+ip+`/bond/gambar_kunjungan/`;
var ipGambarRencanaKunjungan = `https://`+ip+`/bond/gambar_rencana_kunjungan/`;
var ipGambarPricelist = `https://`+ip+`/bond/gambar_barang/`;
var ipGambarPemantauanBan = `http://`+ip+`/bond/gambar_td_pemantauan_ban/`;
var ipGambarTmPemantauanBan = `http://`+ip+`/bond/gambar_pemantauan_ban/`;
var ipGambarTdPemasanganBan = `http://`+ip+`/bond/gambar_td_pemasangan_ban/`;*/





var USERID = "";
var GCM_ID = "";
var KODECABANG = "";
var KODEJABATAN = "";
var PASSWORD = "";
var TAMPUNGKODECABANG ="";
var bgGeo;

var waktuLoginDashboard ="";
var kodePelangganLoginDashboard ="";

var tampungCounter;

//SEMUA VARIABEL GLOBAL
var userMenuArrayGlobal = [];
var userIconArrayGlobal = [];
var userTagArrayGlobal = [];
var userHakAksesArrayGlobal = {};

var waktuMasukLoginTokoKunjungan = "";
var kodeLoginTokoKunjungan = "";
var namaLoginTokoKunjungan = "";
var waktuMasukLoginTokoCollector = "";
var kodeLoginTokoCollector = "";
var namaLoginTokoCollector = "";
var waktuMasukLoginTokoKiriman = "";
var kodeLoginTokoKiriman = "";
var namaLoginTokoKiriman = "";


var konfigurasiTrukTerpilih ="";
var nomorBuktiDariPemasanganBan;
var tanggalDariPemasanganBan;


//LOGIN TOKO
var halamanGlobal = "";
if(localStorage.getItem("waktuLoginDashboard")){
    waktuLoginDashboard = localStorage.getItem("waktuLoginDashboard");
}
if(localStorage.getItem("kodePelangganLoginDashboard")){
    kodePelangganLoginDashboard = localStorage.getItem("kodePelangganLoginDashboard");
}

if(localStorage.getItem("waktuMasukLoginTokoKunjungan")){
    waktuMasukLoginTokoKunjungan = localStorage.getItem("waktuMasukLoginTokoKunjungan");
}

if(localStorage.getItem("kodeLoginTokoKunjungan")){
    kodeLoginTokoKunjungan = localStorage.getItem("kodeLoginTokoKunjungan");
}

if(localStorage.getItem("namaLoginTokoKunjungan")){
    namaLoginTokoKunjungan = localStorage.getItem("namaLoginTokoKunjungan");
}

if(localStorage.getItem("waktuMasukLoginTokoCollector")){
    waktuMasukLoginTokoCollector = localStorage.getItem("waktuMasukLoginTokoCollector");
}

if(localStorage.getItem("kodeLoginTokoCollector")){
    kodeLoginTokoCollector = localStorage.getItem("kodeLoginTokoCollector");
}

if(localStorage.getItem("namaLoginTokoCollector")){
    namaLoginTokoCollector = localStorage.getItem("namaLoginTokoCollector");
}

if(localStorage.getItem("waktuMasukLoginTokoKiriman")){
    waktuMasukLoginTokoKiriman = localStorage.getItem("waktuMasukLoginTokoKiriman");
}

if(localStorage.getItem("kodeLoginTokoKiriman")){
    kodeLoginTokoKiriman = localStorage.getItem("kodeLoginTokoKiriman");
}

if(localStorage.getItem("namaLoginTokoKiriman")){
    namaLoginTokoKiriman = localStorage.getItem("namaLoginTokoKiriman");
}

document.addEventListener("backbutton", deviceBackButton, false);
function deviceBackButton(){
    mainView.router.back();
}


/*<widget id="io.cordovaz.indotyre" version="1.0.0" xmlns="http://www.w3.org/ns/widgets" xmlns:android="http://schemas.android.com/apk/res/android" xmlns:cdv="http://cordova.apache.org/ns/1.0">*/

/*<widget id="io.cordova.abason" version="1.0.1" xmlns="http://www.w3.org/ns/widgets" xmlns:android="http://schemas.android.com/apk/res/android" xmlns:cdv="http://cordova.apache.org/ns/1.0">*/
/*document.addEventListener('deviceready', function () {*/
    USERID = localStorage.getItem("USERID");
    KODECABANG = localStorage.getItem("KODECABANG");
    KODEJABATAN = localStorage.getItem("KODEJABATAN");
    PASSWORD = localStorage.getItem("PASSWORD");

    var act = "CEK_USERNAME_PASSWORD";
    myApp.request.post(ipTujuan,{case:act,USERID:USERID,GCM_ID:GCM_ID,PASSWORD:PASSWORD,KODEJABATAN:KODEJABATAN}
        ,function(data){
            var hasil_json = JSON.parse(data);
            if(hasil_json.hasil == "sama"){
                mainView.router.navigate("/home/",{reloadAll:true});
                KODEJABATAN = localStorage.getItem("KODEJABATAN");
            } else {
                mainView.router.navigate("/");
                localStorage.setItem("USERID",null);
                localStorage.setItem("KODECABANG",null);
                localStorage.setItem("KODEJABATAN",null);
                localStorage.setItem("PASSWORD",null);
                /*setTimeout(function() {
                    bgGeo.stop();
                }, 1000);*/
            }
        }
        ,function(xhr,status){
            PreloaderHide(status);
        });


    /*bgGeo = window.BackgroundGeolocation;

    BackgroundGeolocation.watchPosition(function(location) {

        console.log(location);
        latGlobal = location.coords.latitude;
        lngGlobal = location.coords.longitude;
        console.log(latGlobal);
        console.log(lngGlobal);
    }, function(errorCode) {
        alert('An location error occurred: ' + errorCode);
    }, {
        interval: 1000, 
        persist: false,    
    });
    


    //This callback will be executed every time a geolocation is recorded in the background.
    var callbackFn = function(location) {
        var coords = location.coords;
        var lat    = coords.latitude;
        var lng    = coords.longitude;
        console.log('- Location: ', JSON.stringify(location));        
    };

    // This callback will be executed if a location-error occurs.  Eg: this will be called if user disables location-services.
    var failureFn = function(errorCode) {
        console.warn('- BackgroundGeoLocation error: ', errorCode);
    }

    // Listen to location events & errors.
    bgGeo.on('location', callbackFn, failureFn);
    // Fired whenever state changes from moving->stationary or vice-versa.
    bgGeo.on('motionchange', function(isMoving) {
      console.log('- onMotionChange: ', isMoving);
  });
    // Fired whenever a geofence transition occurs.
    bgGeo.on('geofence', function(geofence) {
      console.log('- onGeofence: ', geofence.identifier, geofence.location);
  });
    // Fired whenever an HTTP response is received from your server.
    bgGeo.on('http', function(response) {
      console.log('http success: ', response.responseText);
  }, function(response) {
      console.log('http failure: ', response.status);
  });




    
    // BackgroundGeoLocation is highly configurable.
    bgGeo.ready({
        // Geolocation config
        //reset:true,
        desiredAccuracy: BackgroundGeolocation.DESIRED_ACCURACY_HIGH,
        distanceFilter: 0,
        stationaryRadius: 25,
        foregroundService:true,
        // Activity Recognition config
        activityRecognitionInterval: 0,
        //activityRecognitionInterval: 1000,
        stopTimeout: 3,
        // Application config
        debug: false,  // <-- Debug sounds & notifications.
        
        stopOnTerminate: false,
        startOnBoot: true,
        // HTTP / SQLite config
        url: "http://"+ip+"/bond/bond_geolocation.php",
        method: "POST",
        autoSync: true,
        maxDaysToPersist: 3,
        //logLevel: bgGeo.LOG_LEVEL_VERBOSE,
        headers: {  // <-- Optional HTTP headers
            "X-FOO": "bar",
            asd : "asd"
        },
        params: {   // <-- Optional HTTP params
            USERID : USERID,
            case : "HISTORY_PERJALANAN"
        },

    }, function(state) {

        // This callback is executed when the plugin is ready to use.
        console.log("BackgroundGeolocation ready: ", state);
    });*/
    

    $$('.halamanCoba').on('click',function(){
        mainView.router.navigate("/halaman_coba_coba/");
    });

    var act = "CEK_VERSI_APP";
    myApp.request.post(ipTujuan,{case:act,KODEVERSI:KODEVERSI,USERID:USERID,VERSIMANUAL:VERSIMANUAL},function(data){
        var hasil_json = JSON.parse(data);
        if(hasil_json.hasil != KODEVERSI){
            myApp.dialog.confirm("Aplikasi Anda Belum Paling Terbaru, Silahkan Update Terlebih Dahulu",function(){
                var url = "http://"+ip+"/bond/aplikasi/esp.apk";
                cordova.InAppBrowser.open(url, '_system', 'location=yes');
            },function(){
                navigator.app.exitApp();
            });
        } else {
            //console.log("sudah sama");
        }
    });


    cycleTimer = setInterval(function () {
        navigator.geolocation.getCurrentPosition(function(position) {
            console.log(position);
            latGlobal = position.coords.latitude;
            lngGlobal = position.coords.longitude;
            uluru = {lat: latGlobal, lng: lngGlobal};

            console.log(latGlobal+'-'+lngGlobal)
        }, function() {
            handleLocationError(true, infoWindow, map.getCenter());
        },{ enableHighAccuracy:true});

    }, 5000);

    
// Login Screen Demo
$$('.btnMasuk').on('click', function () {
    myApp.loginScreen.close('#my-login-screen');
    mainView.router.navigate("/login/");
});



$$(document).on('page:init', '.page[data-name="index"]', function (page) {
    $$(".btnMasuk").on('click',function(){
        mainView.router.navigate("/login/");
    });  
})

var cycleTimer;



$$(document).on('page:init', '.page[data-name="login"]', function (page) {
    var gambar = `${ipGambar}logoBlessing.jpg?`+ new Date().getTime();
    $$("#fotoLogin").attr("src",gambar);
    myApp.preloader.hide();
    userMenuArrayGlobal = [];
    userIconArrayGlobal = [];
    userTagArrayGlobal = [];
    

    $$("input[type=text]").keyup(function(){
        $$(this).val( $$(this).val().toUpperCase() );
    });

    $$("input[type=password]").keyup(function(){
        $$(this).val( $$(this).val().toUpperCase() );
    });

    

    $$('.btnDaftar').on('click',function(){
        myApp.dialog.alert("Kunjungi Website Kami <br>www.blessingcom.com");
    });



    $$('.login-button').on('click',function(){
        myApp.preloader.show();
        var act = "LOGIN";
        USERID = $$('.userId').val();
        var PASSWORD = $$('.password').val();
        KODECABANG = $$('.cabang').val();

        if(!KODECABANG){
            alertKosong("Cabang");
        } else {
            myApp.request.post(ipTujuan,{case:act,USERID:USERID,PASSWORD:PASSWORD,GCM_ID:GCM_ID},function(data){
                var hasil_json = JSON.parse(data);
                if(hasil_json.login=="berhasil"){
                    mainView.router.navigate("/home/",{reloadAll:true});

                    if(hasil_json.HASIL_USERMENU == "ada"){
                        /*bgGeo.setConfig({
                            desiredAccuracy: BackgroundGeolocation.DESIRED_ACCURACY_HIGH,
                            params: {USERID:USERID,case:"HISTORY_PERJALANAN"}
                        });
                        bgGeo.start(function(){
                            BackgroundGeolocation.watchPosition(function(location) {

                                console.log(location);
                                latGlobal = location.coords.latitude;
                                lngGlobal = location.coords.longitude;
                                console.log(latGlobal);
                                console.log(lngGlobal);
                            }, function(errorCode) {
                                alert('An location error occurred: ' + errorCode);
                            }, {
                                interval: 1000, 
                                persist: false,    
                            });
                        });*/

                        localStorage.setItem('USERID',USERID);
                        localStorage.setItem('KODECABANG',KODECABANG);
                        localStorage.setItem('KODEJABATAN',hasil_json.KODEJABATAN);
                        localStorage.setItem('PASSWORD',PASSWORD)
                        KODEJABATAN = hasil_json.KODEJABATAN;
                        for(var i = 0; i<hasil_json.MENU.length; i++){
                            userMenuArrayGlobal[i] = hasil_json.MENU[i];
                            userIconArrayGlobal[i] = hasil_json.ICON[i];
                            userTagArrayGlobal[i] = hasil_json.TAG[i];
                            userHakAksesArrayGlobal[hasil_json.TAG[i]] = new Array();

                            userHakAksesArrayGlobal[hasil_json.TAG[i]]['TAMBAH'] = hasil_json.TAMBAH[i];
                            userHakAksesArrayGlobal[hasil_json.TAG[i]]['UBAH'] = hasil_json.UBAH[i];
                            userHakAksesArrayGlobal[hasil_json.TAG[i]]['HAPUS'] = hasil_json.HAPUS[i];
                            userHakAksesArrayGlobal[hasil_json.TAG[i]]['CETAK'] = hasil_json.CETAK[i];
                            userHakAksesArrayGlobal[hasil_json.TAG[i]]['POSTING'] = hasil_json.POSTING[i];
                            userHakAksesArrayGlobal[hasil_json.TAG[i]]['CARI'] = hasil_json.CARI[i];
                        }
                    }
                } else if(hasil_json.login == "super"){
                    if(hasil_json.HASIL_USERMENU == "ada"){
                        localStorage.setItem('USERID',USERID);
                        localStorage.setItem('KODECABANG',KODECABANG);
                        for(var i = 0; i<hasil_json.MENU.length; i++){
                            userMenuArrayGlobal[i] = hasil_json.MENU[i];
                            userIconArrayGlobal[i] = hasil_json.ICON[i];
                            userTagArrayGlobal[i] = hasil_json.TAG[i];
                            userHakAksesArrayGlobal[hasil_json.TAG[i]] = new Array();

                            userHakAksesArrayGlobal[hasil_json.TAG[i]]['TAMBAH'] = hasil_json.TAMBAH[i];
                            userHakAksesArrayGlobal[hasil_json.TAG[i]]['UBAH'] = hasil_json.UBAH[i];
                            userHakAksesArrayGlobal[hasil_json.TAG[i]]['HAPUS'] = hasil_json.HAPUS[i];
                            userHakAksesArrayGlobal[hasil_json.TAG[i]]['CETAK'] = hasil_json.CETAK[i];
                            userHakAksesArrayGlobal[hasil_json.TAG[i]]['POSTING'] = hasil_json.POSTING[i];
                            userHakAksesArrayGlobal[hasil_json.TAG[i]]['CARI'] = hasil_json.CARI[i];
                        }
                    }

                    mainView.router.navigate("/home/",{reloadAll:true});


                } else {
                    myApp.dialog.alert("Maaf Username / Password Salah");
                    myApp.preloader.hide();
                }
            });
}
});




var typingTimer;
var doneTypingInterval = 100;
var input = $$('.userId');

$$('.userId').on('focusout', function () {
  clearTimeout(typingTimer);
  typingTimer = setTimeout(doneTyping, doneTypingInterval);
});

$$('.userId').on('keyup', function () {
  clearTimeout(typingTimer);
  typingTimer = setTimeout(doneTyping, doneTypingInterval);
});

$$('.userId').on('keydown', function () {
  clearTimeout(typingTimer);
});

function doneTyping () {
    var act = "TAMPIL_CABANG_SESUAI_USERID";
    var USERID = $$('.userId').val();
    myApp.request.post(ipTujuan,{case:act,USERID:USERID},function(data){
        var hasil_json = JSON.parse(data);
        var tampungCabang ='';
        

        if(hasil_json.hasil == "ada"){
            var image = document.getElementById("fotoLogin");
            image.src = ipGambar+USERID+`-karyawan.jpg?`+ new Date().getTime();
            for(var i = 0; i<hasil_json.KODECABANG.length; i++){
                tampungCabang += "<option value='"+hasil_json.KODECABANG[i]+"' selected>"+hasil_json.KODECABANG[i]+"</option>";
            }
            $$('.cabang').html(tampungCabang);
        } else {
            var image = document.getElementById("fotoLogin");
            image.src = ipGambar+`logoBlessing.jpg?`+ new Date().getTime();
            $$('.cabang').html("");
        }
    });
}

});

//pilih_konfigurasi
$$(document).on('page:init', '.page[data-name="pilih_konfigurasi"]', function (page) {
    myApp.preloader.hide();
});

//pilih_konfigurasi
$$(document).on('page:init', '.page[data-name="halaman_konfigurasi"]', function (page) {

    var counterPlus = 3;
    var counterX = [];
    //diisi array yang mau ada X nya
    var tampungHalamanKonfigurasi = `
    <div class="row ">
    <div class="col-5"></div>
    <div class="col-20"></div>
    <div class="col-20 wrap" onClick="PilihPosisiBan('1','${nomorBuktiDariPemasanganBan}','${tanggalDariPemasanganBan}')"><img src="img/tyre.jpg"  style="width:100%"><div class="boldHitam text_over_image" >1</div></div>
    <div class="col-20"></div>
    <div class="col-20 wrap" onClick="PilihPosisiBan('2','${nomorBuktiDariPemasanganBan}','${tanggalDariPemasanganBan}')"><img src="img/tyre.jpg" style="width:100%"><div class="boldHitam text_over_image" >2</div></div>
    <div class="col-20"></div>
    <div class="col-5"></div>
    </div>`;

    var counterRowKonfigurasi = 0;
    /*<img src="img/x_gardan.png" style="width:100%;height:100%;margin-top:70%">*/
    if(konfigurasiTrukTerpilih == "4 X 2"){
        tampungHalamanKonfigurasi += `
        <div class="row ">
        <div class="col-5"></div>
        <div class="col-20"></div>
        <div class="col-20 wrap" onClick="PilihPosisiBan('3','${nomorBuktiDariPemasanganBan}','${tanggalDariPemasanganBan}')"><img src="img/tyre.jpg" style="width:100%"><div class="boldHitam text_over_image" >3</div></div>
        <div class="col-10"></div>
        <div class="col-20 wrap" onClick="PilihPosisiBan('4','${nomorBuktiDariPemasanganBan}','${tanggalDariPemasanganBan}')"><img src="img/tyre.jpg" style="width:100%"><div class="boldHitam text_over_image" >4</div></div>
        <div class="col-20"></div>
        <div class="col-5"></div>
        </div>`
    } else if(konfigurasiTrukTerpilih == "4 X 2 6BAN"){
        counterRowKonfigurasi = 1;
    } else if(konfigurasiTrukTerpilih == "6 X 2" || konfigurasiTrukTerpilih == "6 X 4"){
        counterRowKonfigurasi = 2;
    } else if(konfigurasiTrukTerpilih == "8 X 2"){
        counterRowKonfigurasi = 3;
    } else if(konfigurasiTrukTerpilih == "10 X 2"){
        counterRowKonfigurasi = 4;
    } else if(konfigurasiTrukTerpilih == "TRAILER 2" || konfigurasiTrukTerpilih == "TRAILER 3") {
        counterPlus = 5;
        tampungHalamanKonfigurasi = `
        <div class="row ">
        <div class="col-5"></div>
        <div class="col-20 wrap" onClick="PilihPosisiBan('1','${nomorBuktiDariPemasanganBan}','${tanggalDariPemasanganBan}')"><img src="img/tyre.jpg"  style="width:100%"><div class="boldHitam text_over_image" >1</div></div>
        <div class="col-20 wrap" onClick="PilihPosisiBan('2','${nomorBuktiDariPemasanganBan}','${tanggalDariPemasanganBan}')"><img src="img/tyre.jpg" style="width:100%"><div class="boldHitam text_over_image" >2</div></div>
        
        <div class="col-20 wrap">
        
        </div>
        
        <div class="col-20 wrap" onClick="PilihPosisiBan('3','${nomorBuktiDariPemasanganBan}','${tanggalDariPemasanganBan}')"><img src="img/tyre.jpg" style="width:100%"><div class="boldHitam text_over_image" >3</div></div>
        <div class="col-20 wrap" onClick="PilihPosisiBan('4','${nomorBuktiDariPemasanganBan}','${tanggalDariPemasanganBan}')"><img src="img/tyre.jpg" style="width:100%"><div class="boldHitam text_over_image" >4</div></div>    
        <div class="col-5"></div>
        </div>`;
        if(konfigurasiTrukTerpilih == "TRAILER 2"){
            counterRowKonfigurasi = 1;
        } else if(konfigurasiTrukTerpilih == "TRAILER 3"){
            counterRowKonfigurasi = 2;
        }
    } else {
        myApp.dialog.alert("Terjadi Kesalahan, Silahkan Laporkan pada Admin");
    }

    if(counterRowKonfigurasi !=0){
        for(var i = 0; i<counterRowKonfigurasi; i++){
            tampungHalamanKonfigurasi += `
            <div class="row ">
            <div class="col-5"></div>

            <div class="col-20 wrap" onClick="PilihPosisiBan('${counterPlus}','${nomorBuktiDariPemasanganBan}','${tanggalDariPemasanganBan}')">
            <img src="img/tyre.jpg" style="width:100%" >
            <div class="boldHitam text_over_image">${counterPlus}</div>
            </div>`;
            counterPlus++;
            tampungHalamanKonfigurasi +=`
            <div class="col-20 wrap" onClick="PilihPosisiBan('${counterPlus}','${nomorBuktiDariPemasanganBan}','${tanggalDariPemasanganBan}')">
            <img src="img/tyre.jpg" style="width:100%" >
            <div class="boldHitam text_over_image">${counterPlus}</div>
            </div>`;

            counterPlus++;

            /*if($.inArray(i, counterX) >= 0){
                tampungHalamanKonfigurasi+=`<div class="col-20 wrap">
        <img src="img/x_gardan.png" style="width:100%;height:100%;margin-top:70%">
        </div>`;
            } else {
                tampungHalamanKonfigurasi +=`<div class="col-20"></div>`;
            }*/
            tampungHalamanKonfigurasi+=`<div class="col-20 wrap">

            </div>

            <div class="col-20 wrap" onClick="PilihPosisiBan('${counterPlus}','${nomorBuktiDariPemasanganBan}','${tanggalDariPemasanganBan}')">
            <img src="img/tyre.jpg" style="width:100%" >
            <div class="boldHitam text_over_image">${counterPlus}</div>
            </div>`;

            counterPlus++;
            tampungHalamanKonfigurasi +=`<div class="col-20 wrap" onClick="PilihPosisiBan('${counterPlus}','${nomorBuktiDariPemasanganBan}','${tanggalDariPemasanganBan}')">
            <img src="img/tyre.jpg" style="width:100%">
            <div class="boldHitam text_over_image">${counterPlus}</div>
            </div>

            <div class="col-5"></div>
            </div>`;
            counterPlus++;
        }
    }

    $$('.halamanKonfigurasi').html(tampungHalamanKonfigurasi);
    myApp.preloader.hide();
});


var parameter_rencana = '';
var home;
$$(document).on('page:init', '.page[data-name="home"]', function (page) {
    /*Highcharts.chart('container', {
        chart: {
            type: 'column'
        },
        title: {
            text: 'Histogram using a column chart'
        },
        subtitle: {
            text: ''
        },
        xAxis: {
            categories: [
            'BFG',
            'HPT',
            'NON HPT'
            ],
            crosshair: true
        },
        yAxis: {
            min: 0,
            title: {
                text: ''
            }
        },
        tooltip: {
            headerFormat: '<span style="font-size:10px">{point.key}</span><table>',
            pointFormat: '<tr><td style="color:{series.color};padding:0">{series.name}: </td>' +
            '<td style="padding:0"><b>{point.y:.1f} mm</b></td></tr>',
            footerFormat: '</table>',
            shared: true,
            useHTML: true
        },
        plotOptions: {
            column: {
                pointPadding: 0,
                borderWidth: 0,
                groupPadding: 0,
                shadow: false
            },    
            area: {
                gapSize:1
            }
        },
        series: [{
            name: 'Data',
            data: [200,600,600]

        }]
    });*/

    parameter_rencana = "tidakada";
    var today = new Date();
    var day = today.getDate();
    var monthIndex = today.getMonth();
    var year = today.getFullYear();
    var TANGGAL = year+'-'+(parseInt(monthIndex)+1)+'-'+day;
    var params = {
        case:"DASHBOARD_RENCANA",
        USERID:USERID,
        KODECABANG:KODECABANG,
        KODEJABATAN:KODEJABATAN,
        DATETRANSACTION:TANGGAL
    }

    myApp.request.post(ipTujuan,params,
        function(data){
            var response = JSON.parse(data);
            if(response.inbox >0){
                $$("#badge_inbox").html(response.inbox);
            } else {
                $$("#badge_inbox").remove();
            }

            var title = `Total Point Kunjungan Anda ${response.total_point_kunjungan}`;
            //chart
            /*total_point_kunjungan = response.total_point_kunjungan / 300 *100;
            standar_point_kunjungan = (response.standar_point_kunjungan - response.total_point_kunjungan)/ 300*100;*/
            
            total_point_kunjungan = 0;
            standar_point_kunjungan = 0;
            HighChartDiagramTotalPointKunjungan(title,total_point_kunjungan,standar_point_kunjungan,"containerChartPointKunjungan");
            var total_kunjungan = 0;
            var total_sesuai_rencana = 0;
            var total_diluar_rencana = 0;

            if(response.hasil_point == "ada"){
                total_kunjungan = response.total_kunjungan;
            }

            if(response.total_sesuai_rencana){
                total_sesuai_rencana = response.total_sesuai_rencana;
            }

            total_diluar_rencana = total_kunjungan - total_sesuai_rencana;

            $$("#homeTitle").html(`Hi, ${response.PEMAKAI.NAMA}`)
            
            //chart
            /*var element =`
            <span style="font-size:1.5em;font-weight:bold">${total_kunjungan}/150 (${PercentNumberFormat(Number(total_kunjungan/150*100),1)}%)</span>
            Total Kunjungan Anda<br>
            <span style="font-size:1.5em;font-weight:bold">${total_sesuai_rencana} (${PercentNumberFormat(Number(total_sesuai_rencana/150*100),1) }%)</span>
            Sesuai Rencana<br>
            <span style="font-size:1.5em;font-weight:bold">${total_diluar_rencana} (${PercentNumberFormat(Number(total_diluar_rencana/150*100),1)}%)</span>
            Diluar Rencana<br>
            `;*/

            var targetKunjungan = 150;
            var indexPresentaseKunjungan;
            response.presentase_kunjungan.forEach(function(obj,x){
                if(parseFloat(PercentNumberFormat(Number(total_kunjungan/targetKunjungan*100),1)) > parseFloat(obj.presentase_kunjungan)){
                    indexPresentaseKunjungan = x;
                }
            })

            /*Menghitung Total Bonus*/

            var jumlahBonusDiterima = 0;
            if(indexPresentaseKunjungan){
                var jumlahDariPresentaseTercapai = response.presentase_kunjungan[indexPresentaseKunjungan].presentase_kunjungan * targetKunjungan/100;
                console.log(jumlahDariPresentaseTercapai,total_sesuai_rencana);
                if(total_sesuai_rencana <= jumlahDariPresentaseTercapai){
                    jumlahBonusDiterima = total_sesuai_rencana * response.presentase_kunjungan[indexPresentaseKunjungan].harga_sesuai;
                    jumlahBonusDiterima = jumlahBonusDiterima + ((total_kunjungan - jumlahDariPresentaseTercapai) * response.presentase_kunjungan[indexPresentaseKunjungan].harga_tidak_sesuai );
                } else {
                    jumlahBonusDiterima = total_sesuai_rencana * response.presentase_kunjungan[indexPresentaseKunjungan].harga_sesuai;
                }
            }

            var element_bonus_kunjungan = `
            <span style="color:red;font-weight:bold">`;
            //chart
            /*if(PercentNumberFormat(Number(total_kunjungan/targetKunjungan*100),1) >= 100){
                element_bonus_kunjungan += `Selamat !! Mencapai ${PercentNumberFormat(Number(total_sesuai_rencana/150*100),1) }% Kunjungan, anda mendapatkan uang Rp. ${FormatHarga(jumlahBonusDiterima)}`;
            } else if(PercentNumberFormat(Number(total_kunjungan/targetKunjungan*100),1) >= 90){
                element_bonus_kunjungan += `Kunjungan Mencapai ${PercentNumberFormat(Number(total_sesuai_rencana/150*100),1) }% Anda mendapatkan uang Rp. ${FormatHarga(jumlahBonusDiterima)} <br> Semangat sedikit lagi udah 100%`;
            } else if(PercentNumberFormat(Number(total_kunjungan/targetKunjungan*100),1) >= 80){
                element_bonus_kunjungan += `Kunjungan Mencapai ${PercentNumberFormat(Number(total_sesuai_rencana/150*100),1) }% Anda mendapatkan uang Rp. ${FormatHarga(jumlahBonusDiterima)} <br> Semangat yaaa kejar sampai 100%`;
            } else if(PercentNumberFormat(Number(total_kunjungan/targetKunjungan*100),1) >= 70){
                element_bonus_kunjungan += `Kunjungan Mencapai ${PercentNumberFormat(Number(total_sesuai_rencana/150*100),1) }% Anda mendapatkan uang Rp. ${FormatHarga(jumlahBonusDiterima)} <br> Yuk Buruan Kejar sampai 100%`;
            } else {
                element_bonus_kunjungan += `Yuk Kejar kunjunganmu sampai 100% semangat ya !!`;
            }*/
            element_bonus_kunjungan +=`</span>`;
            ChartDashboard(PercentNumberFormat(Number(total_sesuai_rencana/150*100),1),PercentNumberFormat(Number(total_diluar_rencana/150*100),1));

            $$("#homeWelcome").html(element);
            if(KODEJABATAN == "SALESMAN" && KODEJABATAN != ""){
                $$("#homeWelcome").append(element_bonus_kunjungan);
            }

            var element = ``;
            var jumlahRencana = {};
            var jumlahKunjungan = {};
            jumlahKunjungan['sesuai_rencana'] = 0;
            jumlahKunjungan['tambahan_kunjungan'] = 0;
            jumlahRencana['kunjungan'] = 0;
            jumlahRencana['collector'] = 0;
            jumlahRencana['kiriman'] = 0;
            if( response.rencana.length > 0){
                response.rencana.forEach(function(obj,x){

                    var jenis = "";
                    if(obj.jenis == "kunjungan"){
                        jenis = "kunjungan";
                    } else if(obj.jenis == "kiriman"){
                        jenis = "kiriman";
                    } else if(obj.jenis == "collector"){
                        jenis = "collector";
                    }
                    element = `<li>
                    <a href="#"`;
                    if(obj.jenis != "sudah_kunjungan" && obj.jenis != "sudah_kiriman"  && obj.jenis !="sudah_collector"){ 

                        element+=`onClick="DashboardKunjungan('${jenis}','${obj.KODEPELANGGAN}','${obj.NAMAPELANGGAN}')"`;
                    }
                    element+=`class="item-link item-content">
                    <div class="item-inner">
                    <div class="item-title" >${obj.NAMAPELANGGAN} - ${obj.KOTA}</div>
                    </div>
                    </a>
                    </li>`;
                    $$(".homeGroupRencanaKujungan").find("ul").append(element);

                    if(obj.jenis == "kunjungan" || obj.jenis =="collector" || obj.jenis == "kiriman"){
                        element = `
                        <div `;
                        /*if(obj.jenis != "sudah_kunjungan" && obj.jenis != "sudah_kiriman"  && obj.jenis !="sudah_collector"){ 
                            element+=`onClick="DashboardKunjungan('${jenis}','${obj.KODEPELANGGAN}','${obj.NAMAPELANGGAN}')"`;
                        }*/
                        element +=`class="card demo-card-header-pic col-50 desktop-25 tablet-33 marginCard">`;
                        if(obj.gambar_rencana_kunjungan == "ada"){
                            element +=`<div style="background-image:url('${ipGambarTokoPelanggan}${obj.nama_gambar}.jpg?`+ new Date().getTime() +`')"`;
                        } else {
                            element +=`<div style="background-image:url('${noPict}?`+ new Date().getTime() +`')"`;
                        }
                        element+=`class="card-header align-items-flex-end"></div>
                        <div class="card-content card-content-padding">
                        <p>${obj.NAMAPELANGGAN} - ${obj.KOTA}</p>
                        </div>`;
                        if(obj.KODEPELANGGAN == kodePelangganLoginDashboard){
                            element+=`<div class="card-footer"><a href="#" class="link" onClick="DashboardKunjungan('${jenis}','${obj.KODEPELANGGAN}','${obj.NAMAPELANGGAN}')">Report</a></div>`;
                        } else {
                            element+=`<div class="card-footer"><a href="#" class="link" onClick="LoginDashboardRencana(this,'${jenis}','${obj.KODEPELANGGAN}','${obj.NAMAPELANGGAN}')">Login</a></div>`;
                        }
                        
                        element+=`</div>
                        `;

                        $$("#homeRencanaKunjungan").append(element);

                    }
                    jumlahRencana['kunjungan']++;
                })
                
                var element = `Rencana Kunjungan - ${jumlahRencana['kunjungan']}`;
                $$("#blockRencanaKunjungan").html(element);


                if($$('.homeGroupRencanaKujungan li').length == 1){
                    $$('.homeGroupRencanaKujungan').remove();
                } else {
                    $$('.homeGroupRencanaKujungan').find('.list-group-title').html(`Rencana Kunjungan - ${jumlahRencana['kunjungan']}`);
                }

                if($$('.homeGroupKiriman li').length == 1){
                    $$('.homeGroupKiriman').remove();
                } else {
                    $$('.homeGroupKiriman').find('.list-group-title').html(`Rencana Kiriman - ${jumlahRencana['kiriman']}`);
                }

                if($$('.homeGroupCollector li').length == 1){
                    $$('.homeGroupCollector').remove();
                } else {
                    $$('.homeGroupCollector').find('.list-group-title').html(`Rencana Collector - ${jumlahRencana['collector']}`);
                }

            } else {
                $$("#homeListKunjungan").remove();
            }

            if(response.kunjungan.length > 0 ){
                var element =``;
                response.kunjungan.forEach(function(obj,x){
                    element = `<li>
                    <div class="item-content">
                    <div class="item-inner">
                    <div class="item-title" >${obj.NAMAPELANGGAN} - ${obj.KOTA} `;

                    if(obj.jenis =="sesuai_rencana"){
                        element += `<i class="fas fa-star" style="color:orange"></i>`;
                        jumlahKunjungan['sesuai_rencana']++;
                    } else {
                        jumlahKunjungan['tambahan_kunjungan']++;
                    }

                    var waktu = new Date(obj.DATETRANSACTION);
                    
                    var hours = waktu.getHours();
                    hours = ("0" + hours).slice(-2);
                    var minutes = waktu.getMinutes();
                    minutes = ("0" + minutes).slice(-2);
                    var seconds = waktu.getSeconds();
                    seconds = ("0" + seconds).slice(-2);

                    element+=`
                    <div class="item-footer">${hours+':'+minutes+':'+seconds}</div></div>
                    </div>
                    </div>
                    </li>`;
                    $$(".homeGroupKunjungan").find("ul").append(element);

                    element = `<div class="card demo-card-header-pic col-50 desktop-25 tablet-33 marginCard">`;

                    if(obj.gambar_kunjungan == "ada"){
                        element +=`<div style="background-image:url('${ipGambarKunjungan}${obj.nama_gambar}.jpg?`+ new Date().getTime() +`')"`;
                    } else {
                        element +=`<div style="background-image:url('${noPict}?`+ new Date().getTime() +`')"`;
                    }

                    element +=`class="card-header align-items-flex-end"></div>
                    <div class="card-content card-content-padding">
                    <p class="date">Kunjungan Pukul ${hours+':'+minutes+':'+seconds}</p>
                    <p>`;
                    if(obj.jenis == "sesuai_rencana"){
                        element +=`<i class="fas fa-star" style="color:orange"></i>`;
                    }
                    element+=` ${obj.NAMAPELANGGAN} - ${obj.KOTA}</p>
                    </div>
                    </div>`;

                    $$("#homeKunjungan").append(element);
                })
                var element = `<i class="fas fa-star" style="color:orange"></i> Sesuai Rencana - ${jumlahKunjungan['sesuai_rencana']}/${jumlahRencana['kunjungan']} /
                Tambahan Kunjungan - ${jumlahKunjungan['tambahan_kunjungan']}`;
                $$('.homeGroupKunjungan').find('.list-group-title').html(element);

                var element = `<i class="fas fa-star" style="color:orange"></i> Sesuai Rencana - ${jumlahKunjungan['sesuai_rencana']}/${jumlahRencana['kunjungan']} / Tambahan Kunjungan
                - ${jumlahKunjungan['tambahan_kunjungan']}`;
                $$("#blockKunjungan").html(element);
            }

            var element = `
            <div class="item-content userprofile">
            <div class="item-media"><img src="`;
            if(response.profile.FOTO == "ada"){
                element +=ipGambar+USERID+`-karyawan.jpg?`+ new Date().getTime();
            } else {
                element +=noProfilePict;
            }
            element +=`" width="44" alt=""/></div>
            <div class="item-inner">
            <div class="item-title-row">
            <div class="item-title">${response.profile.NAMA}</div>
            </div>
            <div class="item-subtitle">
            ${response.profile.TELEPON}<br>
            xx Point / <i class="fas fa-star" style="color:orange"></i><i class="fas fa-star" style="color:orange"></i><i class="fas fa-star" style="color:orange"></i><i class="fas fa-star" style="color:orange"></i><i class="fas fa-star" style="color:orange"></i> Jumlah Bintang

            </div>
            </div>
            </div>
            `;

            $$("#tab-account").prepend(element);
            
        },
        function(xhr,status){

        })
home = "okky";
var act = "HOME_LOGIN";
myApp.request.post(ipTujuan,{case:act,USERID:USERID},function(data){
    //myApp.preloader.show();
    var hasil_json = JSON.parse(data);
    var tampungCardHome = "Tidak Mempunyai Hak Akses";
/*
    if(hasil_json.HASIL_USERMENU == "ada"){
        localStorage.setItem('USERID',USERID);
        localStorage.setItem('KODECABANG',KODECABANG);
        localStorage.setItem('KODEJABATAN',hasil_json.KODEJABATAN);
        KODEJABATAN = hasil_json.KODEJABATAN;
        for(var i = 0; i<hasil_json.MENU.length; i++){
            userMenuArrayGlobal[i] = hasil_json.MENU[i];
            userIconArrayGlobal[i] = hasil_json.ICON[i];
            userTagArrayGlobal[i] = hasil_json.TAG[i];
            userHakAksesArrayGlobal[hasil_json.TAG[i]] = new Array();

            userHakAksesArrayGlobal[hasil_json.TAG[i]]['TAMBAH'] = hasil_json.TAMBAH[i];
            userHakAksesArrayGlobal[hasil_json.TAG[i]]['UBAH'] = hasil_json.UBAH[i];
            userHakAksesArrayGlobal[hasil_json.TAG[i]]['HAPUS'] = hasil_json.HAPUS[i];
            userHakAksesArrayGlobal[hasil_json.TAG[i]]['CETAK'] = hasil_json.CETAK[i];
            userHakAksesArrayGlobal[hasil_json.TAG[i]]['POSTING'] = hasil_json.POSTING[i];
            userHakAksesArrayGlobal[hasil_json.TAG[i]]['CARI'] = hasil_json.CARI[i];
        }

        if(userMenuArrayGlobal.length>0){
            tampungCardHome = `<ul>`;
            for(var i = 0 ; i<userMenuArrayGlobal.length;i++){
                tampungCardHome += `
                <li>
                <a href="#" class="item-link item-content `+userTagArrayGlobal[i]+`">
                <div class="item-inner">
                <div class="item-title"><i class="`+userIconArrayGlobal[i]+` fontAwesomeBiru"></i>  `+userMenuArrayGlobal[i]+`</div>
                </div>
                </a>
                </li>`;
            }
            tampungCardHome += `</ul>`;
            myApp.preloader.hide();
        }
        $$('.cardMaster').html(tampungCardHome);

        if(KODEJABATAN == "OWNER"){
            $$('.ubahPasswordLink').remove();
        } else {

        }
        myApp.preloader.hide();
    }
    else {
        $$('.cardMaster').html(tampungCardHome);
        myApp.preloader.hide();
    }*/
    $$('.petaGps').on('click',function(){
        mainView.router.navigate("/coba_peta/");
    });

    $$('.masterRencanaKunjungan').on('click',function(){
        halamanGlobal = "MASTER_RENCANA_KUNJUNGAN";
        tampungHalamanFollowDanCollector = "RENCANA_KUNJUNGAN";
        mainView.router.navigate("/master_rencana_kunjungan/");
        myApp.preloader.show();
    });

    $$('.masterKunjungan').on('click',function(){
            //mainView.router.navigate("/master_kunjungan/");
            mainView.router.navigate("/halaman_pilih_login_report/");
            halamanGlobal = "MASTER_KUNJUNGAN";
            myApp.preloader.show();
        });

    $$('.masterPelanggan').on('click',function(){
        halamanGlobal = "MASTER_PELANGGAN";
        mainView.router.navigate("/master_pelanggan/");
        myApp.preloader.show();
    });

    $$('.masterBarang').on('click',function(){
        mainView.router.navigate("/master_barang/");
        myApp.preloader.show();
    });

    $$('.masterKaryawan').on('click',function(){
        mainView.router.navigate("/master_karyawan/");
        myApp.preloader.show();
    });

    $$('.masterJabatan').on('click',function(){
        mainView.router.navigate("/master_jabatan/");
        myApp.preloader.show();
    });

    $$('.masterMenu').on('click',function(){
        mainView.router.navigate("/master_menu/");
        myApp.preloader.show();
    });

    $$('.masterHakAkses').on('click',function(){
        myApp.preloader.show();
        mainView.router.navigate("/master_hak_akses/");
    });

    $$('.masterKategori').on('click',function(){
        mainView.router.navigate("/master_kategori_pelanggan/");
        myApp.preloader.show();
    });

    $$('.masterJenisPelanggan').on('click',function(){
        mainView.router.navigate("/master_jenis_pelanggan/");
        myApp.preloader.show();
    });

    $$('.masterDetailPajak').on('click',function(){
        mainView.router.navigate("/master_detail_pajak/");
        myApp.preloader.show();
    });

    $$('.masterUbahPassword').on('click',function(){
        mainView.router.navigate({url:"/ubah_password/"});
        myApp.preloader.show();
    });

    $$('.masterFollowUp').on('click',function(){
        halamanGlobal = "MASTER_FOLLOWUP";
        tampungHalamanFollowDanCollector = "FOLLOWUP";
        myApp.preloader.show();
        mainView.router.navigate("/master_followup/")
    });

    $$('.masterCollector').on('click',function(){
        tampungHalamanFollowDanCollector = "COLLECTOR";
        halamanGlobal = "MASTER_COLLECTOR";
        myApp.preloader.show();
        mainView.router.navigate("/halaman_pilih_login_report/");
    });

    $$('.masterKiriman').on('click',function(){
        tampungHalamanFollowDanCollector = "KIRIMAN";
        halamanGlobal = "MASTER_KIRIMAN";
        myApp.preloader.show();
        mainView.router.navigate("/halaman_pilih_login_report/");
    });

    $$('.masterPricelist').on('click',function(){
        myApp.preloader.show();
        mainView.router.navigate("/master_pricelist/");
    });

    $$('.masterLaporan').on('click',function(){
        halamanGlobal = "MASTER_LAPORAN";
        myApp.preloader.show();
        mainView.router.navigate("/master_laporan/");
    });

    $$('.masterLaporanRencanaKunjungan').on('click',function(){
        halamanGlobal = "MASTER_LAPORAN_RENCANA_KUNJUNGAN";
        myApp.preloader.show();

        //mainView.router.navigate("/master_laporan_rencana_kunjungan/");
        mainView.router.navigate("/parameter_rencana_kunjungan/");
    });

    $$('.masterGpsHarian').on('click',function(){
        halamanGlobal = "MASTER_GPS";
        myApp.preloader.show();
        mainView.router.navigate("/master_gps/");
    });

    $$('.masterLaporanPelanggan').on('click',function(){
        halamanGlobal = "MASTER_LAPORAN_PELANGGAN";
        myApp.preloader.show();
        mainView.router.navigate("/master_laporan_pelanggan/");
    });


    $$('.rencanaVsKunjungan').on('click',function(){
        halamanGlobal = "MASTER_RENCANA_VS_KUNJUNGAN";
        myApp.preloader.show();
        mainView.router.navigate("/master_rencana_vs_kunjungan/");
    });

    $$('.laporanKunjunganFollowUpPerStaff').on('click',function(){
        halamanGlobal = "LAPORAN_KUNJUNGAN_FOLLOW_UP_PER_STAFF";
        myApp.preloader.show();
        mainView.router.navigate("/laporan_kunjungan_follow_up_per_staff/");
    });

    $$('.laporanPelangganPerTanggal').on('click',function(){
        halamanGlobal = "LAPORAN_PELANGGAN_PER_TANGGAL";
        myApp.preloader.show();
        mainView.router.navigate("/laporan_pelanggan_per_tanggal/");
    });

    $$('.pemetaanPelanggan').on('click',function(){
        halamanGlobal = "PEMETAAN_PELANGGAN";
        myApp.preloader.show();
        mainView.router.navigate("/pemetaan_pelanggan/");
    });

    $$('.pemetaanByPelanggan').on('click',function(){
        halamanGlobal = "PEMETAAN_BY_PELANGGAN";
        myApp.preloader.show();
        mainView.router.navigate("/detail_pemetaan_by_pelanggan/");
    });

    $$('.updateGpsPelanggan').on('click',function(){
        halamanGlobal = "UPDATE_GPS_PELANGGAN";
        myApp.preloader.show();
        mainView.router.navigate("/update_gps_pelanggan/");
    });

    $$('.rencanaKiriman').on('click',function(){
        halamanGlobal = "RENCANA_KIRIMAN";
        myApp.preloader.show();
        mainView.router.navigate("/input_rencana_kiriman_collector/");
    })


    $$('.rencanaCollector').on('click',function(){
        halamanGlobal = "RENCANA_COLLECTOR";
        myApp.preloader.show();
        mainView.router.navigate("/input_rencana_kiriman_collector/");
    })

    $$('.laporanRencanaKiriman').on('click',function(){
        halamanGlobal = "LAPORAN_RENCANA_KIRIMAN";
        myApp.preloader.show();
        mainView.router.navigate("/laporan_rencana_kiriman_collector/");
    });

    $$('.laporanRencanaCollector').on('click',function(){
        halamanGlobal = "LAPORAN_RENCANA_COLLECTOR";
        myApp.preloader.show();
        mainView.router.navigate("/laporan_rencana_kiriman_collector/");
    });

    $$('.laporanKiriman').on('click',function(){
        halamanGlobal = "LAPORAN_KIRIMAN";
        myApp.preloader.show();
        mainView.router.navigate("/laporan_kiriman_collector/");
    });

    $$('.laporanCollector').on('click',function(){
        halamanGlobal = "LAPORAN_COLLECTOR";
        myApp.preloader.show();
        mainView.router.navigate("/laporan_kiriman_collector/");
    });

    $$('.pemasanganBan').on('click',function(){
        halamanGlobal = "PEMASANGAN_BAN";
        myApp.preloader.show();
            //mainView.router.navigate("/input_pemasangan_ban/");
            mainView.router.navigate("/master_pemasangan_ban/");
        });

    $$('.pemantauanUser').on('click',function(){
        halamanGlobal = "PEMANTAUAN_USER";
        myApp.preloader.show();
        mainView.router.navigate("/pemantauan_user/");
    });

    $$('.pemantauanBan').on('click',function(){
        halamanGlobal = "PEMANTAUAN_BAN";
        myApp.preloader.show();
        mainView.router.navigate("/master_pemantauan_ban/");
            //mainView.router.navigate("/pilih_konfigurasi/");
        });

    $$('.masterKendaraan').on('click',function(){
        halamanGlobal = "MASTER_KENDARAAN";
            //myApp.preloader.show();
            mainView.router.navigate("/master_kendaraan/");
        });

    $$('.rekapRencanaKiriman').on('click',function(){
        halamanGlobal = "REKAP_RENCANA_KIRIMAN";
        myApp.preloader.show();
        mainView.router.navigate("/rekap_rencana_kiriman_collector/");
    });

    $$('.rekapRencanaCollector').on('click',function(){
        halamanGlobal = "REKAP_RENCANA_COLLECTOR";
        myApp.preloader.show();
        mainView.router.navigate("/rekap_rencana_kiriman_collector/");
    });

    $$('.rekapKiriman').on('click',function(){
        halamanGlobal = "REKAP_KIRIMAN";
        myApp.preloader.show();
        mainView.router.navigate("/rekap_kiriman_collector/");
    });

    $$('.rekapCollector').on('click',function(){
        halamanGlobal = "REKAP_COLLECTOR";
        myApp.preloader.show();
        mainView.router.navigate("/rekap_kiriman_collector/");
    });



    $$('.importLaporan').on('click',function(){
        halamanGlobal = "IMPORT_LAPORAN";
        mainView.router.navigate("/IMPORT_LAPORAN/");

    });


    $$('.importDatabase').on('click',function(){
        halamanGlobal = "IMPORT_DATABASE";
        mainView.router.navigate("/import_database/");
    });

    $$('.importTmFaktur').on('click',function(){
        halamanGlobal = "IMPORT_TM_FAKTUR";
        mainView.router.navigate("/import_tm_faktur/");
    });

    $$('.importTdFaktur').on('click',function(){
        halamanGlobal = "IMPORT_TD_FAKTUR";
        mainView.router.navigate("/import_td_faktur/");
    });


    $$('.realisasiKunjungan').on('click',function(){
        halamanGlobal = "REALISASI_KUNJUNGAN";
        mainView.router.navigate("/realisasi_kunjungan/");
    });

    $$('.historyTracking').on('click',function(){
        halamanGlobal = "HISTORY_TRACKING";
        mainView.router.navigate("/history_tracking/");
    });

    $$(".laporanKunjungan").on('click',function(){
        halamanGlobal = "LAPORAN_KUNJUNGAN";
        mainView.router.navigate("/parameter_kunjungan/");
    });

    $$(".masterAbsensi").on('click',function(){
        halamanGlobal = "MASTER_ABSENSI";
        mainView.router.navigate("/master_absensi/");
    });

    $$(".laporanAbsensi").on('click',function(){
        halamanGlobal = "LAPORAN_ABSENSI";
        mainView.router.navigate("/parameter_laporan_absensi/");
    });

    $$(".laporanPointKunjungan").on('click',function(){
        halamanGlobal = "LAPORAN_POINT_KUNJUNGAN";
        mainView.router.navigate("/parameter_laporan_point_kunjungan/");
    });

    $$(".rencanaTagihanAdmin").on('click',function(){
        halamanGlobal = "RENCANA_TAGIHAN_ADMIN";
        mainView.router.navigate("/master_rencana_tagihan_admin/");
    });

    $$(".laporanRencanaTagihan").on('click',function(){
        halamanGlobal = "LAPORAN_RENCANA_TAGIHAN";
        mainView.router.navigate("/parameter_rencana_tagihan/");
    });

    $$(".pemetaanPelangganVerifikasi").on('click',function(){
        halamanGlobal = "PEMETAAN_PELANGGAN_VERIFIKASI";
        mainView.router.navigate("/detail_pemetaan_by_pelanggan_verifikasi/");
    });


    $$(".laporanBulananKunjungan").on('click',function(){
        halamanGlobal = "LAPORAN_BULANAN_KUNJUNGAN";
        mainView.router.navigate("/parameter_laporan_bulanan_kunjungan/");
    });

    $$(".masterUnitKendaraan").on('click',function(){
        halamanGlobal = "MASTER_UNIT_KENDARAAN";
        mainView.router.navigate("/master_unit_kendaraan/");
    });

    $$(".masterPengeluaran").on('click',function(){
        halamanGlobal = "MASTER_PENGELUARAN";
        mainView.router.navigate("/master_pengeluaran/");
    });

    $$(".realisasiKunjunganSemua").on('click',function(){
        halamanGlobal = "REALISASI_KUNJUNGAN_SEMUA";
        mainView.router.navigate("/realisasi_kunjungan_semua/");
    });



},function(xhr,status){
    PreloaderHide(status);
});
myApp.preloader.show();
LoadMenu(1,null,null);
});



//detail_pengeluaran
$$(document).on('page:init', '.page[data-name="detail_pengeluaran"]', function (page) {
    myApp.preloader.hide();
    var params = {
        case:"DETAIL_PENGELUARAN",
        nomorbukti:nomor_bukti_detail_pengeluaran,
        USERID:USERID,
    }

    myApp.request.post(ipTujuan,params,
        function(data){
            var response = JSON.parse(data);
            if(response.hasil == "ada"){
                var element = "";
                element += `
                <div class="card card-outline">
                <div class="card-content card-content-padding">


                <div class="row">
                <div class="col-45 cardContentDetail" >Nomor Bukti</div>
                <div class="col-5 boldHitam"> : </div>
                <div class="col-50 cardContentHasilDetail detailTanggalKunjunganPelanggan">${response.pengeluaran.nomorbukti}</div>
                </div>


                <div class="row">
                <div class="col-45 cardContentDetail" >Tanggal</div>
                <div class="col-5 boldHitam"> : </div>
                <div class="col-50 cardContentHasilDetail detailTanggalKunjunganPelanggan">${ConvertDateTimeToText(response.pengeluaran.tanggal,'dateday')}</div>
                </div>

                <div class="row">
                <div class="col-45 cardContentDetail" >Nomor Plat</div>
                <div class="col-5 boldHitam"> : </div>
                <div class="col-50 cardContentHasilDetail detailTanggalKunjunganPelanggan">${response.pengeluaran.nomor_plat_unit}</div>
                </div>

                <div class="row">
                <div class="col-45 cardContentDetail" >Jenis Pengeluaran</div>
                <div class="col-5 boldHitam"> : </div>
                <div class="col-50 cardContentHasilDetail detailTanggalKunjunganPelanggan">${response.pengeluaran.nama_pengeluaran}</div>
                </div>

                <div class="row">
                <div class="col-45 cardContentDetail" >Salesman</div>
                <div class="col-5 boldHitam"> : </div>
                <div class="col-50 cardContentHasilDetail detailTanggalKunjunganPelanggan">${response.pengeluaran.kodesalesman}</div>
                </div>

                </div>
                </div>`;

                $$('.detail-pengeluaran').append(element);

                var element = "";
                element += `
                <div class="card card-outline">
                <div class="card-content card-content-padding">

                <div class="row">
                <div class="col-45 cardContentDetail" >Nomor Plat</div>
                <div class="col-5 boldHitam"> : </div>
                <div class="col-50 cardContentHasilDetail detailTanggalKunjunganPelanggan">${response.pengeluaran.nomor_plat_unit}</div>
                </div>


                <a href="#" style="width:100%;height:100%" onClick="zoomInOutGambarGlobal('${ipGambarPengeluaran}nomor_plat/${response.pengeluaran.foto_nomor_plat}.jpg?${new Date().getTime()}','0','foto_nomor_plat')">
                <img src="${ipGambarPengeluaran}nomor_plat/${response.pengeluaran.foto_nomor_plat}.jpg?${new Date().getTime()}" height="150" width="100%">
                </a>

                </div>
                </div>
                `;
                $$('.detail-pengeluaran').append(element);

                var element = "";
                if(response.pengeluaran.jenis_pengeluaran == 1){
                    element += `
                    <div class="card card-outline">
                    <div class="card-content card-content-padding">

                    <div class="row">
                    <div class="col-45 cardContentDetail" >Odometer</div>
                    <div class="col-5 boldHitam"> : </div>
                    <div class="col-50 cardContentHasilDetail detailTanggalKunjunganPelanggan">${FormatHarga(response.pengeluaran.odometer)}</div>
                    </div>

                    <a href="#" style="width:100%;height:100%" onClick="zoomInOutGambarGlobal('${ipGambarPengeluaran}odometer/${response.pengeluaran.foto_odometer}.jpg?${new Date().getTime()}','0','foto_odometer')">
                    <img src="${ipGambarPengeluaran}odometer/${response.pengeluaran.foto_odometer}.jpg?${new Date().getTime()}" height="150" width="100%">
                    </a>

                    </div>
                    </div>
                    `;
                    $$('.detail-pengeluaran').append(element);
                }

                var element = "";
                element += `
                <div class="card card-outline">
                <div class="card-content card-content-padding">

                <div class="row">
                <div class="col-45 cardContentDetail" >Total Pengeluaran</div>
                <div class="col-5 boldHitam"> : </div>
                <div class="col-50 cardContentHasilDetail detailTanggalKunjunganPelanggan">Rp. ${FormatHarga(response.pengeluaran.total_pengeluaran)}</div>
                `;

                if(response.pengeluaran.jenis_pengeluaran == 1){

                    element +=`
                    <div class="col-45 cardContentDetail" >Jumlah Liter</div>
                    <div class="col-5 boldHitam"> : </div>
                    <div class="col-50 cardContentHasilDetail detailTanggalKunjunganPelanggan">${FormatHarga(response.pengeluaran.jumlah_liter)}</div>
                    `;
                }

                element+=`</div>`;

                
                urlZoomInOutGambar.foto_nota_pengeluaran = response.foto_nota_pengeluaran;

                response.foto_nota_pengeluaran.forEach(function(obj,x){             
                    element += `
                    <a href="#" style="width:100%;height:100%" onClick="zoomInOutGambarGlobal('url','${x}','nota_pengeluaran')">
                    <img src="${ipGambarPengeluaran}nota_pengeluaran/${obj.url}.jpg?${new Date().getTime()}" height="150" width="100%">
                    </a>`;
                })
                element += `</div>
                </div>`;
                $$('.detail-pengeluaran').append(element);
            }
        },
        function(xhr,status){

        })
})

//master_pengeluaran
$$(document).on('page:init', '.page[data-name="master_pengeluaran"]', function (page) {
    var params = {
        case:"MASTER_PENGELUARAN",
        USERID:USERID
    }
    myApp.request.post(ipTujuan,params,
        function(data){
            var response = JSON.parse(data);
            var element = [];
            var jumlahLoadItem = 30;
            if(response.pengeluaran){

                response.pengeluaran.forEach(function(obj,x){
                    if(x<jumlahLoadItem){
                        element[x] = `<li class="liInfiniteScroll" onClick="DetailPengeluaran('${obj.nomorbukti}')">
                        <div class="item-content item-inner">
                        <div class="item-title">${ConvertDateTimeToText(obj.tanggal,'dateday')}</div>
                        <div class="item-after">
                        ${obj.kodesalesman}
                        </div>
                        </div>
                        </li>`
                        $$('.list .ulInfiniteScrollMasterPengeluaran').append(element[x]);
                    } else {
                        element[x] = `<li class="liInfiniteScroll" onClick="DetailPengeluaran('${obj.nomorbukti}')">
                        <div class="item-content item-inner">
                        <div class="item-title">${ConvertDateTimeToText(obj.tanggal,'dateday')}</div>
                        <div class="item-after">
                        ${obj.kodesalesman}
                        </div>
                        </div>
                        </li>`;
                    }
                });
                InfiniteScroll('.list .liInfiniteScroll','.list .ulInfiniteScrollMasterPengeluaran',element,10);
            } else {
                InfiniteScroll('.list .liInfiniteScroll','.list .ulInfiniteScrollMasterPengeluaran',element,10);
            }
        },
        function(xhr,status){

        })
    myApp.preloader.hide();
})
//input_pengeluaran
$$(document).on('page:init', '.page[data-name="input_pengeluaran"]', function (page) {
    document.getElementById('input_total_pengeluaran').addEventListener('input', event =>
        event.target.value = (parseInt(event.target.value.replace(/[^\d]+/gi, '')) || 0).toLocaleString('en-US')
        );

    document.getElementById('input_odometer').addEventListener('input', event =>
        event.target.value = (parseInt(event.target.value.replace(/[^\d]+/gi, '')) || 0).toLocaleString('en-US')
        );
    
    var today = new Date();
    var day = today.getDate();
    var monthIndex = today.getMonth();
    var year = today.getFullYear();
    $$("#kalender-tanggal-pengeluaran").val(day + ' ' + monthNames[monthIndex] + ' ' + year);

    $$('.popup-open-unit').on('click',function(){
        myApp.popup.open('.popup-unit'); 
    });

    var params = {
        case:"GET_PROPERTY_PENGELUARAN",
        kodesalesman:USERID
    }

    myApp.request.post(ipTujuan,params,
        function(data){
            var response = JSON.parse(data);
            if(response.hasil_unit == "ada"){
                var element = "";
                response.unit.forEach(function(obj,x){
                    element += `
                    <li>
                    <a href="#" class="item-link item-content" onClick="pilihUnit('${obj.nomor_plat}')">
                    <div class="item-inner">
                    <div class="item-text namaToko" style="color:black">${obj.nomor_plat}</div>
                    </div>
                    </a>
                    </li>`;
                })
                $$(".list-unit").html(element);
            } else {
                $$(".list-unit").html("Tidak Ada Unit Kendaraan Terdaftar");
            }

            if(response.hasil_jenis_pengeluaran == "ada"){
                var element = ``;
                response.jenis_pengeluaran.forEach(function(obj,x){
                    element += `<option value="${obj.id}">${obj.nama}</option>`;
                })
                $$('.jenis_pengeluaran').html(element);
            }
        },
        function(xhr,status){

        })
    $$('.jenis_pengeluaran').on('change',function(){
        var element = `
        <div class="item-content item-input">
        <div class="item-inner">
        <div class="item-title item-label" style="color:#2196F3"><b>Lokasi SPBU</b></div>
        <div class="item-input-wrap">
        <input type="text" class ="lokasi_spbu" placeholder="SPBU 31">
        </div>
        </div>
        </div> 

        <div class="item-content item-input">
        <div class="item-inner">
        <div class="item-title item-label" style="color:#2196F3"><b>Jumlah Liter</b></div>
        <div class="item-input-wrap">
        <input type="text" class ="jumlah_liter" placeholder="Jumlah Liter">
        </div>
        </div>
        </div> `;
        if($$(this).val() != 1){
            $$('.pengeluaran_bahan_bakar').html("");
        } else {
            $$('.pengeluaran_bahan_bakar').html(element);
        }
    })
    myApp.preloader.hide();
})



//edit_unit_kendaraan
$$(document).on('page:init', '.page[data-name="edit_unit_kendaraan"]', function (page) {
    SearhInputDari('searchKaryawanDari','listPopUpNamaKaryawanDari','namaKaryawanDari');
    $$('.popup-open-karyawanPelangganDari').on('click',function(){
        myApp.popup.open('.popup-karyawanDari'); 
    });

    $$('.btnCancel').on('click',function(){
        myApp.popup.close('.popup-karyawanDari');
    });

    PopupLaporanKaryawanDari("SEMUA");

    var params = {
        case:"DETAIL_UNIT_KENDARAAN",
        nomor_plat:nomor_plat_unit_kendaraan
    }

    var element = "";
    myApp.request.post(ipTujuan,params,
        function(data){
            var response = JSON.parse(data);
            if(response.hasil == "ada"){
                $$('.nomor_plat').val(response.detail.nomor_plat);
                $$('.kodeDariSalesmanLaporan').val(response.detail.USERID);
                $$('.namaDariSalesmanLaporan').val(response.detail.nama_karyawan);
                var element = "";
                response.unit.forEach(function(obj,x){
                    element += `<option value="${obj.id}"`;
                    if(response.detail.id_jenis_kendaraan == obj.id){
                        element += " selected ";
                    }
                    element +=`>${obj.nama}</option>`;
                })
                $$('.jenis_kendaraan').html(element);

            }
        },
        function(xhr,status){

        })
    myApp.preloader.hide();
})


//detail_unit_kendaran
$$(document).on('page:init', '.page[data-name="detail_unit_kendaraan"]', function (page) {
    var params = {
        case:"DETAIL_UNIT_KENDARAAN",
        nomor_plat:nomor_plat_unit_kendaraan
    }

    var element = "";
    myApp.request.post(ipTujuan,params,
        function(data){
            var response = JSON.parse(data);
            if(response.edit == "tidak_bisa"){
                console.log("asd");
                $$('.edit_unit_kendaraan').remove();
            }

            if(response.hasil == "ada"){
                element += `
                <div class="card card-outline">
                <div class="card-content card-content-padding">


                <div class="row">
                <div class="col-45 cardContentDetail" >Nomor Plat</div>
                <div class="col-5 boldHitam"> : </div>
                <div class="col-50 cardContentHasilDetail ">${response.detail.nomor_plat}</div>
                </div>


                <div class="row">
                <div class="col-45 cardContentDetail" >Jenis Kendaraan</div>
                <div class="col-5 boldHitam"> : </div>
                <div class="col-50 cardContentHasilDetail ">${response.detail.nama_jenis_kendaraan}</div>
                </div>
                <div class="row">
                <div class="col-45 cardContentDetail" >Salesman</div>
                <div class="col-5 boldHitam"> : </div>
                <div class="col-50 cardContentHasilDetail">${response.detail.nama_karyawan}</div>
                </div>

                </div>
                </div>
                `;
            }
            $$('.detail-unit-kendaraan').html(element);
        },
        function(xhr,status){

        })

    myApp.preloader.hide();
    
})

//master_unit_kendaraan
$$(document).on('page:init', '.page[data-name="master_unit_kendaraan"]', function (page) {
    var params = {
        case:"MASTER_UNIT_KENDARAAN"
    };

    myApp.request.post(ipTujuan,params,
        function(data){
            var response = JSON.parse(data);
            var element = [];
            var jumlahLoadItem = 10;
            if(response.hasil == "ada"){
                response.munitkendaraan.forEach(function(obj,x){
                    if(x<jumlahLoadItem){
                        element[x] = `<li class="liInfiniteScrollMasterUnitKendaraan" onClick="DetailUnitKendaraan('${obj.nomor_plat}')">
                        <a href="#" class="item-link item-content">

                        <div class="item-inner">
                        <div class="item-title-row">
                        <div class="item-title"><b>${obj.nomor_plat}</b></div>
                        </div>
                        <div class="item-text">${obj.nama}</div>
                        </div>
                        </a>
                        </li>`
                        $$('.list .ulInfiniteScrollMasterUnitKendaraan').append(element[x]);
                    } else {
                        element[x] = `<li class="liInfiniteScrollMasterUnitKendaraan">
                        <a href="#" class="item-link item-content">

                        <div class="item-media"><img src="https://cdn.framework7.io/placeholder/fashion-88x88-1.jpg" width="44"/></div>
                        <div class="item-inner">
                        <div class="item-title-row">
                        <div class="item-title"><b>${obj.nama}</b></div>
                        </div>
                        <div class="item-text">${obj.kode}</div>
                        </div>
                        </a>
                        </li>`;
                    }
                });
            } else {
                $$(".ulInfiniteScrollMasterUnitKendaraan").html("Tidak Ada Unit Kendaraan Terdaftar");
            }

            InfiniteScroll('.list .liInfiniteScrollMasterUnitKendaraan','.list .ulInfiniteScrollMasterUnitKendaraan',element,10);
        },
        function(xhr,status){

        })
})

//master_unit_kendaraan
$$(document).on('page:init', '.page[data-name="input_unit_kendaraan"]', function (page) {
    SearhInputDari('searchKaryawanDari','listPopUpNamaKaryawanDari','namaKaryawanDari');
    $$('.popup-open-karyawanPelangganDari').on('click',function(){
        myApp.popup.open('.popup-karyawanDari'); 
    });

    $$('.btnCancel').on('click',function(){
        myApp.popup.close('.popup-karyawanDari');
    });

    PopupLaporanKaryawanDari("SEMUA");
    var params = {
        case:"GET_JENIS_KENDARAAN"
    }
    myApp.request.post(ipTujuan,params,
        function(data){
            var response = JSON.parse(data);
            if(response.jenis_kendaraan.length > 0){
                var element = "";
                response.jenis_kendaraan.forEach(function(obj,x){
                    element += `<option value="${obj.id}">${obj.nama}</option>`;
                })
                $$(".jenis_kendaraan").html(element);
            } else {
                myApp.dialog.alert("Tidak Mempunyai Jenis Kendaraan");
            }
            myApp.preloader.hide();
        },
        function(xhr,status){

            myApp.preloader.hide();
        });
})



/*parameter_rencana_tagihan*/
$$(document).on('page:init', '.page[data-name="parameter_rencana_tagihan"]', function (page) {
    var calendarModal = myApp.calendar.create({
        inputEl: '#dariTanggalLaporanPerStaff',
        openIn: 'customModal',
        header: true,
        footer: true,
        dateFormat: 'MM dd yyyy',
    });

    var calendarModal = myApp.calendar.create({
        inputEl: '#sampaiTanggalLaporanPerStaff',
        openIn: 'customModal',
        header: true,
        footer: true,
        dateFormat: 'MM dd yyyy',
    });

    $$('.popup-open-karyawanPelangganDari').on('click',function(){
        myApp.popup.open('.popup-karyawanDari'); 
    });

    $$('.popup-open-karyawanPelangganSampai').on('click',function(){
        myApp.popup.open('.popup-karyawanSampai');
    });

    $$('.btnCancel').on('click',function(){
        myApp.popup.close('.popup-karyawanDari');
        myApp.popup.close('.popup-karyawanSampai');
    });


    PopupLaporanKaryawanDari("FINANCE");
    PopupLaporanKaryawanSampai("FINANCE");
    myApp.preloader.hide();
});


/*parameter_rencana_kunjungan*/
$$(document).on('page:init', '.page[data-name="parameter_rencana_kunjungan"]', function (page) {
    var calendarModal = myApp.calendar.create({
        inputEl: '#dariTanggalLaporanPerStaff',
        openIn: 'customModal',
        header: true,
        footer: true,
        dateFormat: 'MM dd yyyy',
    });

    var calendarModal = myApp.calendar.create({
        inputEl: '#sampaiTanggalLaporanPerStaff',
        openIn: 'customModal',
        header: true,
        footer: true,
        dateFormat: 'MM dd yyyy',
    });

    $$('.popup-open-karyawanPelangganDari').on('click',function(){
        myApp.popup.open('.popup-karyawanDari'); 
    });

    $$('.popup-open-karyawanPelangganSampai').on('click',function(){
        myApp.popup.open('.popup-karyawanSampai');
    });

    $$('.btnCancel').on('click',function(){
        myApp.popup.close('.popup-karyawanDari');
        myApp.popup.close('.popup-karyawanSampai');
    });


    PopupLaporanKaryawanDari("SALESMAN");
    PopupLaporanKaryawanSampai("SALESMAN");
    myApp.preloader.hide();
});

/*parameter_kunjungan*/
$$(document).on('page:init', '.page[data-name="parameter_kunjungan"]', function (page) {
    SearhInputDari('searchKaryawanDari','listPopUpNamaKaryawanDari','namaKaryawanDari');
    SearhInputSampai('searchKaryawanSampai','listPopUpNamaKaryawanSampai','namaKaryawanSampai');
    var calendarModal = myApp.calendar.create({
        inputEl: '#dariTanggalLaporanPerStaff',
        openIn: 'customModal',
        header: true,
        footer: true,
        dateFormat: 'MM dd yyyy',
    });

    var calendarModal = myApp.calendar.create({
        inputEl: '#sampaiTanggalLaporanPerStaff',
        openIn: 'customModal',
        header: true,
        footer: true,
        dateFormat: 'MM dd yyyy',
    });

    $$('.popup-open-karyawanPelangganDari').on('click',function(){
        myApp.popup.open('.popup-karyawanDari'); 
    });

    $$('.popup-open-karyawanPelangganSampai').on('click',function(){
        myApp.popup.open('.popup-karyawanSampai');
    });

    $$('.btnCancel').on('click',function(){
        myApp.popup.close('.popup-karyawanDari');
        myApp.popup.close('.popup-karyawanSampai');
    });


    PopupLaporanKaryawanDari("SALESMAN");
    PopupLaporanKaryawanSampai("SALESMAN");
    myApp.preloader.hide();
});

//pemasangan_ban
$$(document).on('page:init', '.page[data-name="edit_pemasangan_ban"]', function (page) {
    var calendarModal = myApp.calendar.create({
        inputEl: '#tanggalPemasanganBan',
        openIn: 'customModal',
        header: true,
        footer: true,
        dateFormat: 'dd MM yyyy',
    });

    $$("input").keyup(function(){
        $$(this).val( $$(this).val().toUpperCase() );
    });

    $$("textarea").keyup(function(){
        $$(this).val( $$(this).val().toUpperCase() );
    });
    var today = new Date();
    var day = today.getDate();
    var monthIndex = today.getMonth();
    var year = today.getFullYear();
    $$('#tanggalPemasanganBan').val(day + ' ' + monthNames[monthIndex] + ' ' + year)
    $$('.userIdPemasanganBan').val(USERID);


    var searchbar = myApp.searchbar.create({
        el: '.searchbar',
        searchContainer: '.list',
        searchIn: '.namaToko',
        on: {
            search(sb, query, previousQuery) {
            }
        }
    });
    
    $$('.btnCancel').on('click',function(){
        myApp.popup.close('.popup-toko');
        myApp.popup.close('.popup-nomorplat');
    });

    var act = "POPUP_TAMPIL_PELANGGAN_NOMORPLAT";
    myApp.request.post(ipTujuan,{case:act,KODECABANG:KODECABANG,USERID:USERID},function(data){
        var hasil_json = JSON.parse(data);
        tampungPopupNamaToko = "";
        if(hasil_json.hasil=="ada"){
            for(var i = 0; i<hasil_json.KODEPELANGGAN.length;i++){
                tampungPopupNamaToko +=`
                <li>
                <a href="#" class="item-link item-content" onClick="pilihTokoNomorPlat('`+hasil_json.KODEPELANGGAN[i]+`','`+hasil_json.NAMA[i]+`')">
                <div class="item-inner">
                <div class="item-text namaToko" style="color:black"><b>`+hasil_json.KODEPELANGGAN[i]+`</b> - `+hasil_json.NAMA[i] +`</div>
                </div>
                </a>
                </li>`;
            }
        } else {
            $$('.listPopupNamaPelanggan').html("");
        }
        $$('.listPopupNamaPelanggan').html(tampungPopupNamaToko);
        myApp.preloader.hide();
    });

    var params = {
        case:"EDIT_PEMASANGAN_BAN",
        USERID:USERID,
        KODECABANG:KODECABANG,
        KODEJABATAN:KODEJABATAN,
        NOMORBUKTI:tampungNomorBuktiTmPemasanganBan
    }

    myApp.request.post(ipTujuan,params,
        function(data){
            var response = JSON.parse(data);
            console.log(response);
            $$('.kunjunganNamaToko').val(response.PEMASANGAN.NAMAPELANGGAN);
            $$('.kunjunganKodeToko').val(response.PEMASANGAN.KODEPELANGGAN);
            $$('#tanggalPemasanganBan').val(response.PEMASANGAN.TANGGAL);
            $$('.nomorPlatPemasanganBan').val(response.PEMASANGAN.NOMORPLAT);
            $$('.odometerPemasanganBan').val(response.PEMASANGAN.ODOMETER);
            $$('.namaSopirPemasanganBan').val(response.PEMASANGAN.NAMASOPIR);
            $$('.noHpSopirPemasanganBan').val(response.PEMASANGAN.NOHPSOPIR);
            $$('.namaPengawasPemasanganBan').val(response.PEMASANGAN.NAMAPENGAWAS);
            $$('.noHpPengawasPemasanganBan').val(response.PEMASANGAN.NOHPPENGAWAS);
            $$('.merekTrukPemasanganBan').val(response.PEMASANGAN.MEREKTRUK);
            $$('.karoseriPemasanganBan').val(response.PEMASANGAN.KAROSERI);
            $$('.konfigurasiTrukPemasanganBan').val(response.PEMASANGAN.KONFIGURASITRUK);
            $$('.kesimpulanPemasanganBan').val(response.PEMASANGAN.KESIMPULAN)
        },
        function(xhr,status){
            PreloaderHide(status);
        })


    $$('.btnEditPemasanganBan').on('click',function(){
        //myApp.preloader.show();
        var KODEPELANGGAN = $$('.kunjunganKodeToko').val();
        var TANGGAL = $$('#tanggalPemasanganBan').val();
        var NOMORPLAT = $$('.nomorPlatPemasanganBan').val();
        var ODOMETER = $$('.odometerPemasanganBan').val();
        var NAMASOPIR = $$('.namaSopirPemasanganBan').val();
        var NOHPSOPIR = $$('.noHpSopirPemasanganBan').val();
        var NAMAPENGAWAS = $$('.namaPengawasPemasanganBan').val();
        var NOHPPENGAWAS = $$('.noHpPengawasPemasanganBan').val();
        var MEREKTRUK = $$('.merekTrukPemasanganBan').val();
        var KONFIGURASITRUK = $$('.konfigurasiTrukPemasanganBan').val();
        var KAROSERI = $$('.karoseriPemasanganBan').val();
        var USERID = $$('.userIdPemasanganBan').val();
        var KESIMPULAN = $$('.kesimpulanPemasanganBan').val(); 

        var act = "UPDATE_PEMASANGAN_BAN";
        if(!KODEPELANGGAN){
            alertKosong("PT / Toko / Pelanggan");
        } else if(!NOMORPLAT){
            alertKosong("Nomor Plat");
        } else if(!ODOMETER){
            alertKosong("Odometer");
        } else if(!NAMASOPIR){
            alertKosong("Nama Sopir");
        } else if(!NOHPSOPIR){
            alertKosong("No HP Sopir");
        } else if(!NAMAPENGAWAS){
            alertKosong("Nama Pengawas");
        } else if(!NOHPPENGAWAS){
            alertKosong("No HP Pengawas");
        } else if(!MEREKTRUK){
            alertKosong("Merek Truk");
        } else {
            myApp.request.post(ipTujuan,{case:act,KODEPELANGGAN:KODEPELANGGAN,TANGGAL:TANGGAL,NOMORPLAT:NOMORPLAT,ODOMETER:ODOMETER,NAMASOPIR:NAMASOPIR,
                NOHPSOPIR:NOHPSOPIR,NAMAPENGAWAS:NAMAPENGAWAS,NOHPPENGAWAS:NOHPPENGAWAS,MEREKTRUK:MEREKTRUK,KONFIGURASITRUK:KONFIGURASITRUK,KAROSERI:KAROSERI,
                USERID:USERID,KESIMPULAN:KESIMPULAN,NOMORBUKTI:tampungNomorBuktiTmPemasanganBan},function(data){
                    var hasil_json = JSON.parse(data);
                    console.log(data);
                    if(hasil_json.hasil == "berhasil"){
                        myApp.dialog.alert("Berhasil Mengedit");
                        mainView.router.back({force:true});
                    } else if(hasil_json.hasil == "duplicated"){
                        myApp.preloader.hide();
                        myApp.dialog.alert("Sudah Di input, Silahkan Mengedit Data Lama");
                    } else {
                        myApp.dialog.alert("Terdapat Error, Segera Hubungi Admin :D");
                        myApp.preloader.hide();
                    }
                }, function(xhr,status){
                    PreloaderHide(status);
                });
        }

    });
});

//pemasangan_ban
$$(document).on('page:init', '.page[data-name="input_pemasangan_ban"]', function (page) {
    var calendarModal = myApp.calendar.create({
        inputEl: '#tanggalPemasanganBan',
        openIn: 'customModal',
        header: true,
        footer: true,
        dateFormat: 'dd MM yyyy',
    });

    $$("input").keyup(function(){
        $$(this).val( $$(this).val().toUpperCase() );
    });

    $$("textarea").keyup(function(){
        $$(this).val( $$(this).val().toUpperCase() );
    });
    var today = new Date();
    var day = today.getDate();
    var monthIndex = today.getMonth();
    var year = today.getFullYear();
    $$('#tanggalPemasanganBan').val(day + ' ' + monthNames[monthIndex] + ' ' + year)
    $$('.userIdPemasanganBan').val(USERID);

    $$('.popup-open-toko').on('click',function(){
        myApp.popup.open('.popup-toko');
    });

    $$('.popup-open-nomorplat').on('click',function(){
        myApp.popup.open('.popup-nomorplat');
    });

    var searchbar = myApp.searchbar.create({
        el: '.searchbar',
        searchContainer: '.list',
        searchIn: '.namaToko',
        on: {
            search(sb, query, previousQuery) {
            }
        }
    });
    
    $$('.btnCancel').on('click',function(){
        myApp.popup.close('.popup-toko');
        myApp.popup.close('.popup-nomorplat');
    });

    var act = "POPUP_TAMPIL_PELANGGAN_NOMORPLAT";
    myApp.request.post(ipTujuan,{case:act,KODECABANG:KODECABANG,USERID:USERID},function(data){
        var hasil_json = JSON.parse(data);
        tampungPopupNamaToko = "";
        if(hasil_json.hasil=="ada"){
            for(var i = 0; i<hasil_json.KODEPELANGGAN.length;i++){
                tampungPopupNamaToko +=`
                <li>
                <a href="#" class="item-link item-content" onClick="pilihTokoNomorPlat('`+hasil_json.KODEPELANGGAN[i]+`','`+hasil_json.NAMA[i]+`')">
                <div class="item-inner">
                <div class="item-text namaToko" style="color:black"><b>`+hasil_json.KODEPELANGGAN[i]+`</b> - `+hasil_json.NAMA[i] +`</div>
                </div>
                </a>
                </li>`;
            }
        } else {
            $$('.listPopupNamaPelanggan').html("");
        }
        $$('.listPopupNamaPelanggan').html(tampungPopupNamaToko);
        myApp.preloader.hide();
    });

    /*var act = "TAMPIL_KONFIGURASI_TRUK_DAN_KAROSERI";
    myApp.request.post(ipTujuan,{case:act},function(data){
        var hasil_json = JSON.parse(data);
        if(hasil_json.karoseri == "ada"){
            for(var i = 0; i<hasil_json.KODEKAROSERI.length; i++){
                $$('.karoseriPemasanganBan').append(`<option value="${hasil_json.KODEKAROSERI[i]}">${hasil_json.KODEKAROSERI[i]}</option>`)
            }
        } else {
            mainView.router.navigate("/home/");
        }

        if(hasil_json.konfigurasi == "ada"){
            for(var i = 0; i<hasil_json.KODEKONFIGURASI.length; i++){
                $$('.konfigurasiTrukPemasanganBan').append(`<option value="${hasil_json.KODEKONFIGURASI[i]}">${hasil_json.KODEKONFIGURASI[i]}</option>`)
            }
        } else {
            mainView.router.navigate("/home/");
        }
        myApp.preloader.hide();
    });*/



    $$('.btnInputPemasanganBan').on('click',function(){
        myApp.preloader.show();
        var KODEPELANGGAN = $$('.kunjunganKodeToko').val();
        var TANGGAL = $$('#tanggalPemasanganBan').val();
        var NOMORPLAT = $$('.nomorPlatPemasanganBan').val();
        var ODOMETER = $$('.odometerPemasanganBan').val();
        var NAMASOPIR = $$('.namaSopirPemasanganBan').val();
        var NOHPSOPIR = $$('.noHpSopirPemasanganBan').val();
        var NAMAPENGAWAS = $$('.namaPengawasPemasanganBan').val();
        var NOHPPENGAWAS = $$('.noHpPengawasPemasanganBan').val();
        var MEREKTRUK = $$('.merekTrukPemasanganBan').val();
        var KONFIGURASITRUK = $$('.konfigurasiTrukPemasanganBan').val();
        var KAROSERI = $$('.karoseriPemasanganBan').val();
        var USERID = $$('.userIdPemasanganBan').val();
        var KESIMPULAN = $$('.kesimpulanPemasanganBan').val(); 
        konfigurasiTrukTerpilih = KONFIGURASITRUK;

        var act = "INPUT_PEMASANGAN_BANN";
        if(!KODEPELANGGAN){
            alertKosong("PT / Toko / Pelanggan");
        } else if(!NOMORPLAT){
            alertKosong("Nomor Plat");
        } else if(!ODOMETER){
            alertKosong("Odometer");
        } else if(!NAMASOPIR){
            alertKosong("Nama Sopir");
        } else if(!NOHPSOPIR){
            alertKosong("No HP Sopir");
        } else if(!NAMAPENGAWAS){
            alertKosong("Nama Pengawas");
        } else if(!NOHPPENGAWAS){
            alertKosong("No HP Pengawas");
        } else if(!MEREKTRUK){
            alertKosong("Merek Truk");
        } else {
            myApp.request.post(ipTujuan,{case:act,KODEPELANGGAN:KODEPELANGGAN,TANGGAL:TANGGAL,NOMORPLAT:NOMORPLAT,ODOMETER:ODOMETER,NAMASOPIR:NAMASOPIR,
                NOHPSOPIR:NOHPSOPIR,NAMAPENGAWAS:NAMAPENGAWAS,NOHPPENGAWAS:NOHPPENGAWAS,MEREKTRUK:MEREKTRUK,KONFIGURASITRUK:KONFIGURASITRUK,KAROSERI:KAROSERI,
                USERID:USERID,KESIMPULAN:KESIMPULAN},function(data){
                    var hasil_json = JSON.parse(data);
                    if(hasil_json.hasil == "berhasil"){
                        myApp.dialog.alert("Sudah Di input, Saatnya Memilih Posisi Ban yang akan diinput");
                        mainView.router.navigate("/halaman_konfigurasi/");
                        nomorBuktiDariPemasanganBan = hasil_json.NOMORBUKTI;
                        tanggalDariPemasanganBan = TANGGAL;
                    } else if(hasil_json.hasil == "duplicated"){
                        myApp.preloader.hide();
                        myApp.dialog.alert("Sudah Di input, Silahkan Mengedit Data Lama");
                    } else {
                        myApp.dialog.alert("Terdapat Error, Segera Hubungi Admin :D");
                        myApp.preloader.hide();
                    }
                }, function(xhr,status){
                    PreloaderHide(status);
                });
        }

    });
});

//master_pemantauan_ban
$$(document).on('page:init', '.page[data-name="master_pemasangan_ban"]', function (page) {


    if(!userHakAksesArrayGlobal["pemasanganBan"]){
    } else {
        if(userHakAksesArrayGlobal['pemasanganBan']['TAMBAH'] == "F" && halamanGlobal == "PEMASANGAN_BAN"){
            $$('.fabInputPemasanganBan').remove();
        } 
    }

    myApp.preloader.hide();
    var monthNames = [
    "Januari", "Februari", "Maret",
    "April", "Mei", "Juni", "Juli",
    "Agustus", "September", "Oktober",
    "November", "Desember"
    ];
    var act = "TAMPIL_MASTER_PEMASANGAN_BAN";
    var tampungMasterPemasanganBan = "";
    var maxItems;
    var TANGGAL = [];
    var total = 0;
    var itemsPerLoad = 20;

    
    myApp.request.post(ipTujuan,{case:act,KODEJABATAN:KODEJABATAN,USERID:USERID,KODECABANG:KODECABANG},
        function(data){
            var hasil_json = JSON.parse(data);
            if(hasil_json.hasil == "ada"){
                maxItems = hasil_json.TANGGAL.length;
                TANGGAL = hasil_json.TANGGAL;
                tampungMasterPemasanganBan = "<ul>";
                if(hasil_json.TANGGAL.length < itemsPerLoad){
                    total = hasil_json.TANGGAL.length;
                } else {
                    total = itemsPerLoad;
                }
                for(var i = 0; i<total;i++){
                    var today = new Date(hasil_json.TANGGAL[i]);
                    var day = today.getDate();
                    var monthIndex = today.getMonth();
                    var year = today.getFullYear();

                    tampungMasterPemasanganBan += `<li>
                    <a href="#" onClick="klikListTanggalPemasanganBan('`+hasil_json.TANGGAL[i]+`')" class="item-link item-content">
                    <div class="item-inner">
                    <div class="item-title">`+day + ' ' + monthNames[monthIndex] + ' ' + year+`</div>
                    </div>
                    </a>
                    </li>`;    
                }

                tampungMasterPemasanganBan += "</ul>";
            } else {
                total = 0;
                tampungMasterPemasanganBan = "Belum Ada Laporan";
            }

            $$('.semuaTampilMasterPemasanganBan').html(tampungMasterPemasanganBan);
            
            var allowInfinite = true;
            var lastItemIndex = $$('.semuaTampilMasterPemasanganBan li').length;
            
            if(total < itemsPerLoad){
                myApp.infiniteScroll.destroy('.infinite-scroll-content');
                $$('.infinite-scroll-preloader').remove();
            } 


            $$('.infinite-scroll-content').on('infinite', function () {
              if (!allowInfinite){
                return;
            }  
            allowInfinite = false;

            setTimeout(function () {
                allowInfinite = true;
                if(maxItems - $$('.semuaTampilMasterPemasanganBan li').length > itemsPerLoad){
                    itemsPerLoad = itemsPerLoad;
                } else {
                    itemsPerLoad = maxItems - $$('.semuaTampilMasterPemasanganBan li').length;
                }

                var html = '';
                for (var i = lastItemIndex; i < lastItemIndex + itemsPerLoad; i++) {
                    var today = new Date(TANGGAL[i]);
                    var day = today.getDate();
                    var monthIndex = today.getMonth();
                    var year = today.getFullYear();
                    html += `<li>
                    <a href="#" onClick="klikListTanggalPemasanganBan('`+TANGGAL[i]+`')" class="item-link item-content">
                    <div class="item-inner">
                    <div class="item-title">`+day + ' ' + monthNames[monthIndex] + ' ' + year+`</div>
                    </div>
                    </a>
                    </li>`;
                }

                $$('.semuaTampilMasterPemasanganBan ul').append(html);
                lastItemIndex = $$('.semuaTampilMasterPemasanganBan li').length;

                if (lastItemIndex >= maxItems) {
                  myApp.infiniteScroll.destroy('.infinite-scroll-content');
                  $$('.infinite-scroll-preloader').remove();
                  return;
              }
          }, 1000);
        });


            myApp.preloader.hide();
        }, 
        function(xhr,status){
            PreloaderHide(status);
        });

    $$('.fabInputPemasanganBan').on('click',function(){
        mainView.router.navigate("/input_pemasangan_ban/");
    });
});

//master_pemasangan_ban_per_tanggal
$$(document).on('page:init', '.page[data-name="master_pemasangan_ban_per_tanggal"]', function (page) {
    var monthNames = [
    "Januari", "Februari", "Maret",
    "April", "Mei", "Juni", "Juli",
    "Agustus", "September", "Oktober",
    "November", "Desember"
    ];

    var today = new Date(tampungTanggalPemasanganBan);
    var day = today.getDate();
    var year = today.getFullYear();
    var monthIndex = today.getMonth();

    $$('.titleTanggal').html(day + ' ' + monthNames[monthIndex] + ' ' + year);
    var act = "TAMPIL_MASTER_PEMASANGAN_BAN_PER_TANGGAL";
    var tampungMasterPemasanganBan = "";
    myApp.request.post(ipTujuan,{case:act,TANGGAL:tampungTanggalPemasanganBan,KODEJABATAN:KODEJABATAN,USERID:USERID,KODECABANG:KODECABANG},
        function(data){
            var hasil_json = JSON.parse(data);
            if(hasil_json.hasil == "ada"){
               tampungMasterPemasanganBan = "<ul>";
               for(var i = 0; i<hasil_json.NOMORBUKTI.length;i++){



                tampungMasterPemasanganBan += `<li>
                <a href="#" onClick="klikListTanggalPemasanganBanDetail('`+hasil_json.NOMORBUKTI[i]+`')" class="item-link item-content">
                <div class="item-inner">
                <div class="item-title">`+hasil_json.NOMORPLAT[i]+`</div>
                </div>
                </a>
                </li>`;    
            }

            tampungMasterPemasanganBan += "</ul>";
        } else {
            tampungMasterPemasanganBan = "Belum Ada Laporan";
        }

        $$('.semuaTampilMasterPemasanganBanPerTanggal').html(tampungMasterPemasanganBan);
        myApp.preloader.hide();
    }, 
    function(xhr,status){
        PreloaderHide(status);
    });
});

//input_detail_pemasangan_ban
$$(document).on('page:init', '.page[data-name="input_detail_pemasangan_ban"]', function (page) {
    $$('.inputAtauEdit').val("input");
    var act = "CEK_INPUT_DETAIL_PEMASANGAN_BAN";
    var gambarHapus = [];
    myApp.request.post(ipTujuan,{case:act,NOMORBUKTI:nomorBuktiTerpilih,POSISI:posisiBanTerpilih},function(data){
        var hasil_json = JSON.parse(data);
        if(hasil_json.hasil == "ada"){      
            $$('.inputAtauEdit').val("edit");
            $$('.namaBarang').val(hasil_json.NAMA);

            $$('.valueBarang').val(hasil_json.KODEBARANG);

            $$('.serialNumberPemasanganBan').val(hasil_json.SERIALNUMBER);
            $$('.tekananAnginPemasanganBan').val(hasil_json.TEKANANANGIN);
            $$('.tebalKembanganPemasanganBan').val(hasil_json.TD1);
            $$('.tebalKembanganPemasanganBan2').val(hasil_json.TD2);
            $$('.tebalKembanganPemasanganBan3').val(hasil_json.TD3);
            $$('.tebalKembanganPemasanganBan4').val(hasil_json.TD4);
            $$('.hargaPemasanganBan').val(hasil_json.HARGA);
            $$('.keteranganPemasanganBan').val(hasil_json.KETERANGAN);
            $$('.idTdPemasanganBan').val(hasil_json.ID);

        } else {
            inputVSedit = "input";
            $$('.idTdPemasanganBan').val("");
        }

        if(hasil_json.foto == "ada"){
            var tampungFotoDetailPemasanganBan = "";
            for(var i = 0; i<hasil_json.NAMAGAMBAR.length; i++){
                tampungFotoDetailPemasanganBan = `<div class="card">
                <div class="card-header row" style="background-color:#2196F3;color:white">
                <div class="col padding5">
                <a href="#" class="hapusFotoKunjungan col-50 padding5" id="${hasil_json.NAMAGAMBAR[i]}">
                <i class="fas fa-window-close  middleWhite" ></i>
                </a>
                </div>
                </div>
                <div class="card-content card-content-padding">
                <img src="`+ipGambarTdPemasanganBan+hasil_json.NAMAGAMBAR[i]+`.jpg?`+ new Date().getTime()+`" id="foto-${hasil_json.NAMAGAMBAR[i]}" height="150" width="100%">
                </div>
                </div>`;


                $$('.fotoTersimpan').append(tampungFotoDetailPemasanganBan);
                $$('.hapusFotoKunjungan').on('click',function(){
                    var hapusId = $$(this).attr("id");
                    var tampung = $$("#foto-"+hapusId).attr("src");
                    if(tampung != null){
                        gambarHapus.push(hapusId);
                        $$(this).closest('.card').remove();
                    }
                });
            }
        }
    });

    $$("input[type=text]").keyup(function(){
        $$(this).val( $$(this).val().toUpperCase() );
    });

    $$("textarea").keyup(function(){
        $$(this).val( $$(this).val().toUpperCase() );
    });
    $$('.popup-open-barang').on('click',function(){
        myApp.popup.open('.popup-barang');
    });

    $$('.popup-open-nomorplat').on('click',function(){
        myApp.popup.open('.popup-nomorplat');
    });

    var searchbar = myApp.searchbar.create({
        el: '.searchbar',
        searchContainer: '.list',
        searchIn: '.namaBarang',
        on: {
            search(sb, query, previousQuery) {
            }
        }
    });


    
    $$('.btnCancel').on('click',function(){
        myApp.popup.close('.popup-barang');
    });

    var act = "POPUP_TAMPIL_BARANG";
    myApp.request.post(ipTujuan,{case:act,KODECABANG:KODECABANG,USERID:USERID},function(data){
        var hasil_json = JSON.parse(data);
        tampungPopupNamaBarang = "";
        if(hasil_json.hasil=="ada"){
            for(var i = 0; i<hasil_json.KODEBARANG.length;i++){
                tampungPopupNamaBarang +=`
                <li>
                <a href="#" class="item-link item-content" onClick="pilihBarang('`+hasil_json.KODEBARANG[i]+`','`+hasil_json.NAMA[i]+`','`+hasil_json.HARGAJUAL[i]+`')">
                <div class="item-inner">
                <div class="item-text namaBarang" style="color:black"><b>`+hasil_json.KODEBARANG[i]+`</b> - `+hasil_json.NAMA[i] +`</div>
                </div>
                </a>
                </li>`;
            }
        } else {
            $$('.listPopupBarang').html("");
        }
        $$('.listPopupBarang').html(tampungPopupNamaBarang);
        myApp.preloader.hide();
    });

    $$('.btnInputDetailPemasanganBan').on('click',function(){
        myApp.preloader.show();
        var act = "INPUT_DETAIL_PEMASANGAN_BAN";
        var KODEBARANG = $$('.valueBarang').val();
        var SERIALNUMBER = $$('.serialNumberPemasanganBan').val();
        var TEKANANANGIN = $$('.tekananAnginPemasanganBan').val();
        var TD = $$('.tebalKembanganPemasanganBan').val();
        var TD2 = $$('.tebalKembanganPemasanganBan2').val();
        var TD3 = $$('.tebalKembanganPemasanganBan3').val();
        var TD4 = $$('.tebalKembanganPemasanganBan4').val();
        var HARGA = $$('.hargaPemasanganBan').val();
        var KETERANGAN = $$('.keteranganPemasanganBan').val();
        var foto= [];
        var namaFoto = [];

        $$('img[name^="fotoKunjunganUpload"]').each(function() {
            if($$(this).attr("src") !=null){
                foto.push($$(this).attr("src"));
                namaFoto.push(this.className);
            }
        });

        if(!KODEBARANG){
            alertKosong("Kode Barang");
        } else if(!SERIALNUMBER){
            alertKosong("Serial Number");
        } else if(!TEKANANANGIN){
            alertKosong("Tekanan Angin");
        } else if(!TD){
            alertKosong("Tebal Kembangan");
        } else {
            if($$('.inputAtauEdit').val() == "input") {
                myApp.request.post(ipTujuan,{case:act,KODEBARANG:KODEBARANG,SERIALNUMBER:SERIALNUMBER,TEKANANANGIN:TEKANANANGIN,TD:TD,TD2:TD2,TD3:TD3,TD4:TD4,
                    HARGA:HARGA,KETERANGAN:KETERANGAN,namaFoto:namaFoto,NOMORBUKTI:nomorBuktiTerpilih,POSISI:posisiBanTerpilih},function(data){
                        var hasil_json = JSON.parse(data);
                        if(hasil_json.hasil == "berhasil"){
                            if(hasil_json.hasilfoto == "ada"){
                                for(var i =0; i<foto.length;i++){
                                    var toko = new FileUploadOptions();
                                    toko.fileKey = "photo";
                                    toko.fileName = foto[i].substr(foto[i].lastIndexOf('/') + 1);
                                    toko.mimeType = "image/jpeg";
                                    toko.chunkedMode = false;
                                    toko.headers = {
                                        Connection: "close"
                                    };
                                    toko.params = {
                                        namaFile:hasil_json.namaFoto[i]
                                    }
                                    var ft = new FileTransfer();
                                    ft.upload(foto[i], 
                                        encodeURI(ipUploadTdPemasanganBan),
                                        win,
                                        fail,
                                        toko);

                                    var win = function(r) {
                                        console.log("Should not be called.");
                                    }

                                    var fail = function(error) {
                                        myApp.dialog.alert("eror :" +error.code);
                                        alert("An error has occurred: Code = " + error.code);
                                        console.log("upload error source " + error.source);
                                        console.log("upload error target " + error.target);
                                    }
                                }
                            }
                            mainView.router.back("/halaman_konfigurasi/",{force:true});
                        } else if(hasil_json.hasil == "duplicate_serialnumber"){
                            myApp.preloader.hide();
                            myApp.dialog.alert("Serial Number Sudah Terdaftar");
                        } else {
                            myApp.dialog.alert("Terjadi Error, Hubungi Admin");
                            myApp.preloader.hide();
                        }
                    });

            } else {
                act = "EDIT_DETAIL_PEMASANGAN_BAN";
                myApp.request.post(ipTujuan,{case:act,KODEBARANG:KODEBARANG,SERIALNUMBER:SERIALNUMBER,TEKANANANGIN:TEKANANANGIN,TD:TD,TD2:TD2,TD3:TD3,TD4:TD4,
                    HARGA:HARGA,KETERANGAN:KETERANGAN,gambarHapus:gambarHapus,namaFoto:namaFoto,NOMORBUKTI:nomorBuktiTerpilih,POSISI:posisiBanTerpilih,ID:$$('.idTdPemasanganBan').val()},function(data){
                        var hasil_json = JSON.parse(data);
                        if(hasil_json.hasil == "berhasil"){

                            if(hasil_json.hasilfoto == "ada"){
                                for(var i =0; i<foto.length;i++){
                                    var toko = new FileUploadOptions();
                                    toko.fileKey = "photo";
                                    toko.fileName = foto[i].substr(foto[i].lastIndexOf('/') + 1);
                                    toko.mimeType = "image/jpeg";
                                    toko.chunkedMode = false;
                                    toko.headers = {
                                        Connection: "close"
                                    };
                                    toko.params = {
                                        namaFile:hasil_json.namaFoto[i]
                                    }
                                    var ft = new FileTransfer();
                                    ft.upload(foto[i], 
                                        encodeURI(ipUploadTdPemasanganBan),
                                        win,
                                        fail,
                                        toko);

                                    var win = function(r) {
                                        console.log("Should not be called.");
                                    }

                                    var fail = function(error) {
                                        myApp.dialog.alert("eror :" +error.code);
                                        alert("An error has occurred: Code = " + error.code);
                                        console.log("upload error source " + error.source);
                                        console.log("upload error target " + error.target);
                                    }
                                }
                            }
                            mainView.router.back("/halaman_konfigurasi/",{force:true});
                        } else if(hasil_json.hasil == "duplicate_serialnumber"){
                            myApp.preloader.hide();
                            myApp.dialog.alert("Serial Number Sudah Terdaftar");
                        } else {
                            myApp.dialog.alert("Terjadi Error, Hubungi Admin");
                            myApp.preloader.hide();
                        }
                    });
            }
        }
    });
});

//detail_pemasangan_ban
$$(document).on('page:init', '.page[data-name="detail_pemasangan_ban"]', function (page) {
    var act = "TAMPIL_DETAIL_PEMASANGAN_BAN";
    var monthNames = [
    "Januari", "Februari", "Maret",
    "April", "Mei", "Juni", "Juli",
    "Agustus", "September", "Oktober",
    "November", "Desember"
    ];

    
    myApp.request.post(ipTujuan,{case:act,KODECABANG:KODECABANG,USERID:USERID,KODEJABATA:KODEJABATAN,NOMORBUKTI:nomorBuktiDariPemasanganBan},function(data){
        var hasil_json = JSON.parse(data);
        var tampungHalamanDetailPemantauanBan = "";
        if(hasil_json.hasil_tm == "ada"){
            var today = new Date(hasil_json.TANGGAL);
            var day = today.getDate();
            var year = today.getFullYear();
            var monthIndex = today.getMonth();
            konfigurasiTrukTerpilih = hasil_json.KONFIGURASITRUK;
            tampungHalamanDetailPemantauanBan+=`
            <div class="card" >
            <div class ="card-header cardHeaderBiru">${hasil_json.NOMORPLAT} `;

            if(!userHakAksesArrayGlobal["pemasanganBan"]){
            } else {
                if(userHakAksesArrayGlobal['pemasanganBan']['UBAH'] == "T" && halamanGlobal == "PEMASANGAN_BAN" && hasil_json.STATUSTM == "OPEN"){
                    tampungHalamanDetailPemantauanBan+=`
                    <a href="#" style="color:white" class="link right" onClick="editTmPemasanganBan('`+nomorBuktiDariPemasanganBan+`','`+hasil_json.KONFIGURASITRUK+`')">
                    <i class="fas fa-edit"></i>
                    </a>`;
                } else {
                    $$('.rightDetailPemasanganBan').remove();
                }
            }

            tampungHalamanDetailPemantauanBan+=`</div>
            <div class="card-content card-content-padding">



            <div class="row">
            <div class="col-45 cardContentDetail" >Pelanggan</div>
            <div class="col-5 boldHitam"> : </div>
            <div class="col-50 cardContentHasilDetail ">`+hasil_json.NAMA+`</div>
            </div>

            <div class="row">
            <div class="col-45 cardContentDetail" >Nama Sopir</div>
            <div class="col-5 boldHitam"> : </div>
            <div class="col-50 cardContentHasilDetail ">`+hasil_json.NAMASOPIR+`</div>
            </div>

            <div class="row">
            <div class="col-45 cardContentDetail" >No HP Sopir</div>
            <div class="col-5 boldHitam"> : </div>
            <div class="col-50 cardContentHasilDetail ">`+hasil_json.NOHPSOPIR+`</div>
            </div>

            <div class="row">
            <div class="col-45 cardContentDetail" >Nama Pengawas</div>
            <div class="col-5 boldHitam"> : </div>
            <div class="col-50 cardContentHasilDetail ">`+hasil_json.NAMAPENGAWAS+`</div>
            </div>

            <div class="row">
            <div class="col-45 cardContentDetail" >No HP Pengawas</div>
            <div class="col-5 boldHitam"> : </div>
            <div class="col-50 cardContentHasilDetail ">`+hasil_json.NOHPPENGAWAS+`</div>
            </div>

            <div class="row">
            <div class="col-45 cardContentDetail" >Odometer</div>
            <div class="col-5 boldHitam"> : </div>
            <div class="col-50 cardContentHasilDetail ">`+hasil_json.ODOMETER+`</div>
            </div>

            

            <div class="row">
            <div class="col-45 cardContentDetail" >Nomor Plat</div>
            <div class="col-5 boldHitam"> : </div>
            <div class="col-50 cardContentHasilDetail ">`+hasil_json.NOMORPLAT+`</div>
            </div>

            <div class="row">
            <div class="col-45 cardContentDetail" >Merek</div>
            <div class="col-5 boldHitam"> : </div>
            <div class="col-50 cardContentHasilDetail ">`+hasil_json.MEREKTRUK+`</div>
            </div>

            <div class="row">
            <div class="col-45 cardContentDetail" >Karoseri</div>
            <div class="col-5 boldHitam"> : </div>
            <div class="col-50 cardContentHasilDetail ">`+hasil_json.KAROSERI+`</div>
            </div>

            <div class="row">
            <div class="col-45 cardContentDetail" >Konfigurasi</div>
            <div class="col-5 boldHitam"> : </div>
            <div class="col-50 cardContentHasilDetail ">`+hasil_json.KONFIGURASITRUK+`</div>
            </div>

            <div class="row">
            <div class="col-45 cardContentDetail" >Kesimpulan</div>
            <div class="col-5 boldHitam"> : </div>
            <div class="col-50 cardContentHasilDetail ">`+hasil_json.KESIMPULAN+`</div>
            </div>
            `;


            tampungHalamanDetailPemantauanBan+=`</div>
            </div>`;
            $$('.semuaTampilDetailPemasanganBan').html(tampungHalamanDetailPemantauanBan);
        }

        if(hasil_json.hasil_td == "ada"){
            var element = "";
            hasil_json.TD_PEMASANGAN.forEach(function(obj,x){
                element +=`<div class="card" >
                <div class ="card-header cardHeaderBiru">${hasil_json.NOMORPLAT} `;

                if(!userHakAksesArrayGlobal["pemasanganBan"]){
                } else {
                    if(userHakAksesArrayGlobal['pemasanganBan']['UBAH'] == "T" && halamanGlobal == "PEMASANGAN_BAN" && hasil_json.STATUSTM == "OPEN"){
                        element+=`
                        <a href="#" style="color:white" class="link right" onClick="editPemasanganBan('`+nomorBuktiDariPemasanganBan+`','`+hasil_json.KONFIGURASITRUK+`')">
                        <i class="fas fa-edit"></i>
                        </a>`;
                    } else {
                        $$('.rightDetailPemasanganBan').remove();
                    }
                }

                element+=`</div>
                <div class="card-content card-content-padding">



                <div class="row">
                <div class="col-45 cardContentDetail" >Posisi</div>
                <div class="col-5 boldHitam"> : </div>
                <div class="col-50 cardContentHasilDetail ">`+obj.POSISI+`</div>
                </div>

                <div class="row">
                <div class="col-45 cardContentDetail" >Nama Barang</div>
                <div class="col-5 boldHitam"> : </div>
                <div class="col-50 cardContentHasilDetail ">`+obj.NAMABARANG+`</div>
                </div>

                <div class="row">
                <div class="col-45 cardContentDetail" >Harga</div>
                <div class="col-5 boldHitam"> : </div>
                <div class="col-50 cardContentHasilDetail ">`+obj.HARGA+`</div>
                </div>

                <div class="row">
                <div class="col-45 cardContentDetail" >Serial Number</div>
                <div class="col-5 boldHitam"> : </div>
                <div class="col-50 cardContentHasilDetail ">`+obj.SERIALNUMBER+`</div>
                </div>

                <div class="row">
                <div class="col-45 cardContentDetail" >Tekanan Angin</div>
                <div class="col-5 boldHitam"> : </div>
                <div class="col-50 cardContentHasilDetail ">`+obj.TEKANANANGIN+`</div>
                </div>

                <div class="row">
                <div class="col-45 cardContentDetail" >Tebal Kembangan 1</div>
                <div class="col-5 boldHitam"> : </div>
                <div class="col-50 cardContentHasilDetail ">`+obj.TD1+`</div>
                </div>

                <div class="row">
                <div class="col-45 cardContentDetail" >Tebal Kembangan 2</div>
                <div class="col-5 boldHitam"> : </div>
                <div class="col-50 cardContentHasilDetail ">`+obj.TD2+`</div>
                </div>

                <div class="row">
                <div class="col-45 cardContentDetail" >Tebal Kembangan 3</div>
                <div class="col-5 boldHitam"> : </div>
                <div class="col-50 cardContentHasilDetail ">`+obj.TD3+`</div>
                </div>

                <div class="row">
                <div class="col-45 cardContentDetail" >Tebal Kembangan 4</div>
                <div class="col-5 boldHitam"> : </div>
                <div class="col-50 cardContentHasilDetail ">`+obj.TD4+`</div>
                </div>

                <div class="row">
                <div class="col-45 cardContentDetail" >Keterangan</div>
                <div class="col-5 boldHitam"> : </div>
                <div class="col-50 cardContentHasilDetail ">`+obj.KETERANGAN+`</div>
                </div>






                </div>
                </div>`;
            })
            $$(".semuaTampilDetailPemasanganBan").append(element);
        }


        


        myApp.preloader.hide();

    }, function(xhr,status){
        PreloaderHide(status);
    });
});

//input_detail_pemantauan_ban
$$(document).on('page:init', '.page[data-name="input_detail_pemantauan_ban"]', function (page) {
    var posisiTerinput = [];
    var act = "GET_POSISI_TD_PEMANTAUAN_BAN";
    myApp.request.post(ipTujuan,{case:act,NOMORBUKTI:tampungNomorBuktiPemantauanBan},function(data){
        var hasil_json = JSON.parse(data);
        if(hasil_json.hasil == "ada"){
            for(var i = 0; i<hasil_json.POSISI.length;i++){
                posisiTerinput.push(hasil_json.POSISI[i]);
            }
        }
    });

    $$('.btnInputPemantauanBan').on('click',function(){
        var SERIALNUMBER = [];
        var POSISI = [];
        var TEKANANANGIN = [];
        var TD = [];
        var KETERANGAN = [];
        $$('input[name^="serialNumberTdPemantauanBan"]').each(function() {
            SERIALNUMBER.push($$(this).val());
        });

        $$('input[name^="posisiTdPemantauanBan"]').each(function() {
            POSISI.push($$(this).val());
        });

        $$('input[name^="tekananAnginTdPemantauanBan"]').each(function() {
            TEKANANANGIN.push($$(this).val());
        });

        $$('input[name^="tebalKembanganTdPemantauanBan"]').each(function() {
            TD.push($$(this).val());
        });

        $$('input[name^="keteranganTdPemantauanBan"]').each(function() {
            KETERANGAN.push($$(this).val());
        });


        var arrayFoto = [];

        var fotoKunjunganz = {};
        var namaFotoKunjunganz = {};
        var counterArrayFotoTampung;
        var counteringFoto;

        i=1;
        $$('input[name^="counterArrayFoto"]').each(function() {
            fotoKunjunganz[$$(this).val()] = new Array();
            namaFotoKunjunganz[$$(this).val()] = new Array();
            arrayFoto.push($$(this).val());
            counterArrayFotoTampung = $$(this).val();
            counteringFoto = this.className;

            $$('img[name^="fotozKunjunganUploadz['+counteringFoto+']"]').each(function() {

                if($$(this).attr("src") !=null){
                    console.log(i);
                    fotoKunjunganz[counterArrayFotoTampung].push($$(this).attr("src"));
                    namaFotoKunjunganz[counterArrayFotoTampung].push(this.className);
                }
            });
            i++;
        });

        var uniqueNames = [];
        var unique;

        $.each(POSISI,function(i,el){
            if($.inArray(el, uniqueNames) === -1){
                uniqueNames.push(el)
                unique = "tidaksama"
            } else {
                unique = "sama";
            }
        });

        

        var filteredKeywords = POSISI.filter((word) => !posisiTerinput.includes(word));
        console.log(POSISI.length);
        console.log(POSISI);
        console.log(filteredKeywords);
        console.log(filteredKeywords.length);
        
        if(unique == "sama"){
            myApp.dialog.alert("Posisi Tidak Boleh Sama");
        } else if(POSISI.length ==0 || $.inArray("", POSISI) >= 0){
            alertKosong("Posisi");
        } else if(unique == "sama"){
            myApp.dialog.alert("Posisi Tidak Boleh Sama");
        } else if(SERIALNUMBER.length ==0 || $.inArray("", SERIALNUMBER) >= 0){
            alertKosong("Serial Number");
        } else if(TEKANANANGIN.length ==0 || $.inArray("", TEKANANANGIN) >= 0){
            alertKosong("Tekanan Angin");
        } else if(TD.length ==0 || $.inArray("", TD) >= 0){
            alertKosong("Tebal Kembangan");
        } else if(POSISI.length != 0 && POSISI.length > filteredKeywords.length){
            myApp.dialog.alert("Posisi Sudah Terdaftar");
        }
    });
    
    var counterzz = 1;

    $$('.btnTambahBarang').on('click',function(){
        element = `<div class="card">
        <div class="card-header" style="background-color:#2196F3;color:white">

        <span style="font-size:0.9em"><b>Barang</b></span>
        <a href="#" class="hapusToko"><span style="font-size:0.9em;text-align: right"><i class="fas fa-window-close " style="color:white"></i></span></a>

        </div>
        <div class="card-content card-content-padding">
        <div class="list form-store-data" >

        <div class="item-content item-input">
        <div class="item-inner">
        <div class="item-title item-label" style="color:#2196F3;font-weight: bold">Posisi</div>
        <div class="item-input-wrap">
        <input type="number" placeholder="Posisi" name="posisiTdPemantauanBan" maxlength="3" />
        </div>
        </div>
        </div>


        <div class="item-content item-input">
        <div class="item-inner">
        <div class="item-title item-label" style="color:#2196F3;font-weight: bold">Serial Number</div>
        <div class="item-input-wrap">
        <input type="text" placeholder="Serial Number" name="serialNumberTdPemantauanBan" maxlength="20" />
        </div>
        </div>
        </div>


        

        <div class="item-content item-input">
        <div class="item-inner">
        <div class="item-title item-label" style="color:#2196F3;font-weight: bold">Tekanan Angin</div>
        <div class="item-input-wrap">
        <input type="number" placeholder="Posisi" name="tekananAnginTdPemantauanBan" maxlength="3" />
        </div>
        </div>
        </div>

        <div class="item-content item-input">
        <div class="item-inner">
        <div class="item-title item-label" style="color:#2196F3;font-weight: bold">Tebal Kembangan</div>
        <div class="item-input-wrap">
        <input type="number" placeholder="Tebal Kembangan" required name="tebalKembanganTdPemantauanBan" maxlength="3"/>
        </div>
        </div>
        </div>

        
        <div class="item-content item-input">
        <div class="item-inner">
        <div class="item-title item-label" style="color:#2196F3;font-weight: bold">Keterangan</div>
        <div class="item-input-wrap">
        <input type="text" placeholder="Keterangan" name="keteranganTdPemantauanBan" maxlength="1000"/>
        </div>
        </div>
        </div>

        
        </div>

        <span class="spanFotoKunjungan">
        <div class="card">
        <div class="card-header row" style="background-color:#2196F3;color:white">

        <a href="#" onClick="ambilFotoKunjunganzz('${counterzz}','1')" class="ambilFotoKunjunganzz-${counterzz}-1 col padding5">
        <i class="fa fa-camera  middleWhite"> </i>
        </a>

        <a href="#" onClick="ambilFotoGalleryzz('${counterzz}','1')" class="ambilFotoGalleryzz-${counterzz}-1 col padding5">
        <i class="far fa-image  middleWhite"> </i>
        </a>
        </div>
        <div class="card-content card-content-padding">
        <input type="hidden" class="${counterzz}" name="counterArrayFoto" value="${counterzz}-1">

        <img id="foto-kunjungan-${counterzz}-1" name="fotozKunjunganUploadz[${counterzz}][]" class="1" height="150" width="100%">
        

        </div>
        </div>
        </span>

        </div>
        </div>`;
        $$('.generateTambahBarang').append(element);
        

        element = `<div class="popup popup-toko-${counterzz}" style="background-color:white" data-ajax="false">
        <form class="searchbar searchToko${counterzz}">
        <div class="searchbar-inner">
        <div class="searchbar-input-wrap">
        <input type="search" placeholder="Search">
        <i class="searchbar-icon"></i>
        <span class="input-clear-button"></span>
        </div>
        <span class="searchbar-disable-button" >Cancel</span>
        </div>

        </form>
        <div class="judul" style="font-size:1.3em;text-align: center"></div>

        <div class="searchbar-backdrop"></div>
        <div class="block">
        <div class="row">
        <button class="col button button-fill btnCancel" onClick="popupCancel('${counterzz}')">Cancel</button>
        </div>
        </div>
        <div class="list inset searchbar-found">
        <ul class="listPopupNamaTokoRencanaKunjungan${counterzz}">
        </ul>
        </div>
        <div class="block searchbar-not-found">
        <div class="block-inner">Nothing found</div>
        </div>
        </div>`;

        

        $$('.hapusToko').on('click',function(){
            $$(this).closest('.card').remove();
        });

        counterzz++;
    });

});

//pemantauan_ban
$$(document).on('page:init', '.page[data-name="input_pemantauan_ban"]', function (page) {
    $$('.popup-open-toko').on('click',function(){
        myApp.popup.open('.popup-toko');
    });

    var params = {
        case:"TAMPIL_POPUP_NOMORPLAT",
        USERID:USERID,
        KODECABANG:KODECABANG,
        KODEJABATAN:KODEJABATAN
    };

    myApp.request.post(ipTujuan,params,
        function(data){
            var response = JSON.parse(data);
            console.log(response);
            if(response.hasil == "ada"){
                var element = "";
                response.DETAIL.forEach(function(obj,x){
                    element += `<li>
                    <a href="#" class="item-link item-content cobaKlik" onClick="PilihPopupNomorPlat('`+obj.NOMORPLAT+`','`+obj.KODEPELANGGAN+`')">
                    <div class="item-inner">
                    <div class="item-text namaKaryawanDari" style="color:black">`+obj.NOMORPLAT+`<br>
                    <div class="item-text namaKaryawanDari" style="color:black">`+obj.NAMAPELANGGAN+`</div></div>

                    </div>
                    </a>
                    </li>`
                })
                $$('.listPopupToko').html(element);
            } else {
                $$(".listPopupToko").html("Daftarkan Kendaraan Terlebih Dahulu");
            }
        },
        function(xhr,status){
            PreloaderHide(status);
        })

    $$("input[type=text]").keyup(function(){
        $$(this).val( $$(this).val().toUpperCase() );
    });
    myApp.preloader.hide();
    var today = new Date();
    today = new Date().setDate(today.getDate());

    var calendarModal = myApp.calendar.create({
        inputEl: '#calendarPemantauanBan',
        openIn: 'customModal',
        header: true,
        footer: true,
        dateFormat: 'dd MM yyyy',
        maxDate: today,
    });

    var counterzz = 1;
    $$('.btnTambahBarang').on('click',function(){
        element = `<div class="card">
        <div class="card-header" style="background-color:#2196F3;color:white">

        <span style="font-size:0.9em"><b>Barang</b></span>
        <a href="#" class="hapusToko"><span style="font-size:0.9em;text-align: right"><i class="fas fa-window-close " style="color:white"></i></span></a>

        </div>
        <div class="card-content card-content-padding">
        <div class="list form-store-data" >

        <div class="item-content item-input">
        <div class="item-inner">
        <div class="item-title item-label" style="color:#2196F3;font-weight: bold">Posisi</div>
        <div class="item-input-wrap">
        <input type="number" placeholder="Posisi" name="posisiTdPemantauanBan" maxlength="3" />
        </div>
        </div>
        </div>


        <div class="item-content item-input">
        <div class="item-inner">
        <div class="item-title item-label" style="color:#2196F3;font-weight: bold">Serial Number</div>
        <div class="item-input-wrap">
        <input type="text" placeholder="Serial Number" name="serialNumberTdPemantauanBan" maxlength="20" />
        </div>
        </div>
        </div>


        

        <div class="item-content item-input">
        <div class="item-inner">
        <div class="item-title item-label" style="color:#2196F3;font-weight: bold">Tekanan Angin</div>
        <div class="item-input-wrap">
        <input type="number" placeholder="Posisi" name="tekananAnginTdPemantauanBan" maxlength="3" />
        </div>
        </div>
        </div>

        <div class="item-content item-input">
        <div class="item-inner">
        <div class="item-title item-label" style="color:#2196F3;font-weight: bold">Tebal Kembangan</div>
        <div class="item-input-wrap">
        <input type="number" placeholder="Tebal Kembangan" required name="tebalKembanganTdPemantauanBan" maxlength="3"/>
        </div>
        </div>
        </div>

        
        <div class="item-content item-input">
        <div class="item-inner">
        <div class="item-title item-label" style="color:#2196F3;font-weight: bold">Keterangan</div>
        <div class="item-input-wrap">
        <input type="text" placeholder="Keterangan" name="keteranganTdPemantauanBan" maxlength="1000"/>
        </div>
        </div>
        </div>

        
        </div>

        <span class="spanFotoKunjungan">
        <div class="card">
        <div class="card-header row" style="background-color:#2196F3;color:white">

        <a href="#" onClick="ambilFotoKunjunganzz('${counterzz}','1')" class="ambilFotoKunjunganzz-${counterzz}-1 col padding5">
        <i class="fa fa-camera  middleWhite"> </i>
        </a>

        <a href="#" onClick="ambilFotoGalleryzz('${counterzz}','1')" class="ambilFotoGalleryzz-${counterzz}-1 col padding5">
        <i class="far fa-image  middleWhite"> </i>
        </a>
        </div>
        <div class="card-content card-content-padding">
        <input type="hidden" class="${counterzz}" name="counterArrayFoto" value="${counterzz}-1">
        <input type="hidden" name="counterArrFoto" value="${counterzz}-1">
        <img src="aa" id="foto-kunjungan-${counterzz}-1" name="fotozKunjunganUploadz[${counterzz}][]" class="1" height="150" width="100%">
        

        </div>
        </div>
        </span>

        </div>
        </div>`;
        /*
        <img id="foto-kunjungan-${counter}-1" name="fotoKunjunganUpload[${counter}][]" class="1" height="150" width="100%">*/


        /*<img `;
        if(counter % 2 = 0){
            src = "www.com";
        }
        element+=`id="foto-kunjungan-${counter}-1" name="fotoKunjunganUpload[${counter}][]" class="1" height="150" width="100%">*/
        $$('.generateTambahBarang').append(element);
        

        element = `<div class="popup popup-toko-${counterzz}" style="background-color:white" data-ajax="false">
        <form class="searchbar searchToko${counterzz}">
        <div class="searchbar-inner">
        <div class="searchbar-input-wrap">
        <input type="search" placeholder="Search">
        <i class="searchbar-icon"></i>
        <span class="input-clear-button"></span>
        </div>
        <span class="searchbar-disable-button" >Cancel</span>
        </div>

        </form>
        <div class="judul" style="font-size:1.3em;text-align: center"></div>

        <div class="searchbar-backdrop"></div>
        <div class="block">
        <div class="row">
        <button class="col button button-fill btnCancel" onClick="popupCancel('${counterzz}')">Cancel</button>
        </div>
        </div>
        <div class="list inset searchbar-found">
        <ul class="listPopupNamaTokoRencanaKunjungan${counterzz}">
        </ul>
        </div>
        <div class="block searchbar-not-found">
        <div class="block-inner">Nothing found</div>
        </div>
        </div>`;

        

        $$('.hapusToko').on('click',function(){
            $$(this).closest('.card').remove();
        });

        counterzz++;
    });



$$('.btnInputPemantauanBan').on('click',function(){
    myApp.preloader.hide();
    var act = "INPUT_PEMANTAUAN_BAN";
    var TANGGAL = $$('#calendarPemantauanBan').val();
    var ODOMETER = $$('.odometerPemantauanBan').val();
    var NOMORPLAT = $$('.nomorPlatPemantauanBan').val();
    var SERIALNUMBER = [];
    var POSISI = [];
    var TEKANANANGIN = [];
    var TD = [];
    var KETERANGAN = [];

    var arrayFoto = [];
    var counterArrFoto = [];

    var fotoKunjungan= [];
    var namaFotoKunjungan = [];

    $$('img[name^="fotoKunjunganUpload"]').each(function() {
        if($$(this).attr("src") !=null){
            fotoKunjungan.push($$(this).attr("src"));
            namaFotoKunjungan.push(this.className);
            
        }
    });

    

    $$('input[name^="serialNumberTdPemantauanBan"]').each(function() {
        SERIALNUMBER.push($$(this).val());
    });

    $$('input[name^="posisiTdPemantauanBan"]').each(function() {
        POSISI.push($$(this).val());
    });

    $$('input[name^="tekananAnginTdPemantauanBan"]').each(function() {
        TEKANANANGIN.push($$(this).val());
    });

    $$('input[name^="tebalKembanganTdPemantauanBan"]').each(function() {
        TD.push($$(this).val());
    });

    $$('input[name^="keteranganTdPemantauanBan"]').each(function() {
        KETERANGAN.push($$(this).val());
    });

    $$('input[name^="counterArrFoto"]').each(function() {
        counterArrFoto.push($$(this).val());
    });

    var fotoKunjunganz = {};
    var namaFotoKunjunganz = {};
    var counterArrayFotoTampung;
    var counteringFoto;

    i=1;
    $$('input[name^="counterArrayFoto"]').each(function() {
        fotoKunjunganz[$$(this).val()] = new Array();
        namaFotoKunjunganz[$$(this).val()] = new Array();
        
        console.log($$(this).closest('.card-content').find('img').attr("src"));
        if($$(this).closest('.card-content').find('img').attr("src")!=null){
            arrayFoto.push($$(this).val());
        }
        
        counterArrayFotoTampung = $$(this).val();
        counteringFoto = this.className;


        $$('img[name^="fotozKunjunganUploadz['+counteringFoto+']"]').each(function() {

                //namaFotoKunjungan[kodePelanggan].push(this.className);
                if($$(this).attr("src") !=null){
                    fotoKunjunganz[counterArrayFotoTampung].push($$(this).attr("src"));
                    namaFotoKunjunganz[counterArrayFotoTampung].push(this.className);
                }
            });
        i++;
    });

    var uniqueNames = [];
    var unique;

    $.each(POSISI,function(i,el){
        if($.inArray(el, uniqueNames) === -1){
            uniqueNames.push(el)
            unique = "tidaksama"
        } else {
            unique = "sama";
        }
    });
    
    if(!TANGGAL){
        alertKosong("Tanggal");
    } else if(!NOMORPLAT){
        alertKosong("Nomor Plat");
    }  else if(!ODOMETER){
        alertKosong("Odometer");
    } else if(POSISI.length ==0 || $.inArray("", POSISI) >= 0){
        alertKosong("Posisi");
    } else if(unique == "sama"){
        myApp.dialog.alert("Posisi Tidak Boleh Sama");
    } else if(SERIALNUMBER.length ==0 || $.inArray("", SERIALNUMBER) >= 0){
        alertKosong("Serial Number");
    } else if(TEKANANANGIN.length ==0 || $.inArray("", TEKANANANGIN) >= 0){
        alertKosong("Tekanan Angin");
    } else if(TD.length ==0 || $.inArray("", TD) >= 0){
        alertKosong("Tebal Kembangan");
    } else {
        myApp.request.post(ipTujuan,{case:act,counterArrFoto:counterArrFoto,USERID:USERID,TANGGAL:TANGGAL,ODOMETER:ODOMETER, NOMORPLAT:NOMORPLAT,namaFotoKunjungan:namaFotoKunjungan,
            namaFotoKunjunganz:namaFotoKunjunganz,SERIALNUMBER:SERIALNUMBER,POSISI:POSISI,TEKANANANGIN:TEKANANANGIN,TD:TD,KETERANGAN:KETERANGAN,arrayFoto:arrayFoto},function(data){
                var hasil_json = JSON.parse(data);
                if(hasil_json.hasil == "berhasil"){
                    if(fotoKunjungan.length !=0){
                        for(var i =0; i<fotoKunjungan.length;i++){
                            var toko = new FileUploadOptions();
                            toko.fileKey = "photo";
                            toko.fileName = fotoKunjungan[i].substr(fotoKunjungan[i].lastIndexOf('/') + 1);
                            toko.mimeType = "image/jpeg";
                            toko.chunkedMode = false;
                            toko.headers = {
                              Connection: "close"
                          };
                          toko.params = {
                            /*namaFile:hasil_json.NOMORBUKTI +'_'+namaFotoKunjungan[i]*/
                            namaFile:hasil_json.NAMAGAMBARPEMANTAUAN[i]
                        }
                        var ft = new FileTransfer();
                        ft.upload(fotoKunjungan[i], 
                          encodeURI(ipUploadPemantauanBan),
                          win,
                          fail,
                          toko);

                        var win = function(r) {
                            console.log("Should not be called.");
                        }

                        var fail = function(error) {
                            alert("An error has occurred: Code = " + error.code);
                            console.log("upload error source " + error.source);
                            console.log("upload error target " + error.target);
                        }
                    }
                }

                if(hasil_json.adafoto == "ada"){
                    hasil_json.LASTID.forEach(function(e){
                        if(fotoKunjunganz[e].length !=0){
                            hasil_json[e].forEach(function(x,idx){
                                var toko = new FileUploadOptions();
                                toko.fileKey = "photo";
                                toko.fileName = fotoKunjunganz[e][idx].substr(fotoKunjunganz[e][idx].lastIndexOf('/') + 1);
                                toko.mimeType = "image/jpeg";
                                toko.chunkedMode = false;
                                toko.headers = {
                                    Connection: "close"
                                };
                                toko.params = {
                                    namaFile:x
                                }
                                var ft = new FileTransfer();
                                ft.upload(fotoKunjunganz[e][idx], 
                                    encodeURI(ipUploadTdPemantauanBan),
                                    win,
                                    fail,
                                    toko);

                                var win = function(r) {
                                    console.log("Should not be called.");
                                }

                                var fail = function(error) {
                                    myApp.dialog.alert("eror :" +error.code);
                                    alert("An error has occurred: Code = " + error.code);
                                    console.log("upload error source " + error.source);
                                    console.log("upload error target " + error.target);
                                }


                            });
                        }
                    });
                    myApp.dialog.alert("Berhasil Menginput Data");
                    mainView.router.back("/master_pemantauan_ban/",{force:true});
                } else {
                    myApp.dialog.alert("Berhasil Menginput Data");
                    mainView.router.back("/master_pemantauan_ban/",{force:true});
                }
            } else if(hasil_json.hasil == "batas_tanggal_sama"){
                myApp.dialog.alert("Tanggal Sudah Pernah Diinput dengan Nomor Plat sama");
                myApp.preloader.hide();
            } else if(hasil_json.hasil == "batas_tanggal"){
                myApp.dialog.alert("Tanggal yang lebih besar sudah pernah diinput");
            } else if(hasil_json.hasil == "batas_odometer"){
                myApp.dialog.alert("Odometer tidak boleh lebih rendah dari yang terakhir untuk plat nomor tersebut");
            }


        });
}




});



});

//master_pemantauan_ban
$$(document).on('page:init', '.page[data-name="master_pemantauan_ban"]', function (page) {
    myApp.preloader.hide();
    var monthNames = [
    "Januari", "Februari", "Maret",
    "April", "Mei", "Juni", "Juli",
    "Agustus", "September", "Oktober",
    "November", "Desember"
    ];
    var act = "TAMPIL_MASTER_PEMANTAUAN_BAN";
    var tampungMasterPemantauanBan = "";
    var maxItems;
    var TANGGAL = [];
    var total = 0;
    var itemsPerLoad = 20;

    
    myApp.request.post(ipTujuan,{case:act,KODEJABATAN:KODEJABATAN,USERID:USERID,KODECABANG:KODECABANG},
        function(data){
            var hasil_json = JSON.parse(data);
            if(hasil_json.hasil == "ada"){
                maxItems = hasil_json.TANGGAL.length;

                TANGGAL = hasil_json.TANGGAL;
                tampungMasterPemantauanBan = "<ul>";
                if(hasil_json.TANGGAL.length < itemsPerLoad){
                    total = hasil_json.TANGGAL.length;
                } else {
                    total = itemsPerLoad;
                }
                for(var i = 0; i<total;i++){
                    var today = new Date(hasil_json.TANGGAL[i]);
                    var day = today.getDate();
                    var monthIndex = today.getMonth();
                    var year = today.getFullYear();

                    tampungMasterPemantauanBan += `<li>
                    <a href="#" onClick="klikListTanggalPemantauanBan('`+hasil_json.TANGGAL[i]+`')" class="item-link item-content">
                    <div class="item-inner">
                    <div class="item-title">`+day + ' ' + monthNames[monthIndex] + ' ' + year+`</div>
                    </div>
                    </a>
                    </li>`;    
                }

                tampungMasterPemantauanBan += "</ul>";
            } else {
                maxItems = 0;
                total = 0;
                tampungMasterPemantauanBan = "Belum Ada Laporan";
            }

            $$('.semuaTampilMasterPemantauanBan').html(tampungMasterPemantauanBan);
            
            var allowInfinite = true;
            var lastItemIndex = $$('.semuaTampilMasterPemantauanBan li').length;
            
            if(total < itemsPerLoad){
                myApp.infiniteScroll.destroy('.infinite-scroll-content');
                $$('.infinite-scroll-preloader').remove();
            } 


            $$('.infinite-scroll-content').on('infinite', function () {
              if (!allowInfinite){
                return;
            }  
            allowInfinite = false;

            setTimeout(function () {
                allowInfinite = true;
                if(maxItems - $$('.semuaTampilMasterPemantauanBan li').length > itemsPerLoad){
                    itemsPerLoad = itemsPerLoad;
                    console.log("if");
                } else {
                    itemsPerLoad = maxItems - $$('.semuaTampilMasterPemantauanBan li').length;
                    console.log("else");
                }

                var html = '';
                for (var i = lastItemIndex; i < lastItemIndex + itemsPerLoad; i++) {
                    var today = new Date(TANGGAL[i]);
                    var day = today.getDate();
                    var monthIndex = today.getMonth();
                    var year = today.getFullYear();
                    html += `<li>
                    <a href="#" onClick="klikListTanggalPemantauanBan('`+TANGGAL[i]+`')" class="item-link item-content">
                    <div class="item-inner">
                    <div class="item-title">`+day + ' ' + monthNames[monthIndex] + ' ' + year+`</div>
                    </div>
                    </a>
                    </li>`;
                }

                $$('.semuaTampilMasterPemantauanBan ul').append(html);
                lastItemIndex = $$('.semuaTampilMasterPemantauanBan li').length;

                if (lastItemIndex >= maxItems) {
                  myApp.infiniteScroll.destroy('.infinite-scroll-content');
                  $$('.infinite-scroll-preloader').remove();
                  return;
              }
          }, 1000);
        });


            myApp.preloader.hide();
        }, 
        function(xhr,status){
            PreloaderHide(status);
        });






    $$('.fabInputPemantauanBan').on('click',function(){
        mainView.router.navigate("/input_pemantauan_ban/");
    });

    /*var monthNames = [
    "Januari", "Februari", "Maret",
    "April", "Mei", "Juni", "Juli",
    "Agustus", "September", "Oktober",
    "November", "Desember"
    ];
    var act = "TAMPIL_MASTER_PEMANTAUAN_BAN";
    var tampungMasterPemantauanBan = "";
    myApp.request.post(ipTujuan,{case:act,KODEJABATAN:KODEJABATAN,USERID:USERID,KODECABANG:KODECABANG},
        function(data){
            var hasil_json = JSON.parse(data);
            if(hasil_json.hasil == "ada"){
               tampungMasterPemantauanBan = "<ul>";
               for(var i = 0; i<hasil_json.TANGGAL.length;i++){
                var today = new Date(hasil_json.TANGGAL[i]);
                var day = today.getDate();
                var monthIndex = today.getMonth();
                var year = today.getFullYear();

                tampungMasterPemantauanBan += `<li>
                <a href="#" onClick="klikListTanggalPemantauanBan('`+hasil_json.TANGGAL[i]+`')" class="item-link item-content">
                <div class="item-inner">
                <div class="item-title">`+day + ' ' + monthNames[monthIndex] + ' ' + year+`</div>
                </div>
                </a>
                </li>`;    
            }

            tampungMasterPemantauanBan += "</ul>";
        } else {
            tampungMasterPemantauanBan = "Belum Ada Laporan";
        }

        $$('.semuaTampilMasterPemantauanBan').html(tampungMasterPemantauanBan);
        myApp.preloader.hide();
    }, 
    function(xhr,status){
        PreloaderHide(status);
    });*/
});

//master_pemantauan_ban_per_tanggal
$$(document).on('page:init', '.page[data-name="master_pemantauan_ban_per_tanggal"]', function (page) {
    var monthNames = [
    "Januari", "Februari", "Maret",
    "April", "Mei", "Juni", "Juli",
    "Agustus", "September", "Oktober",
    "November", "Desember"
    ];

    var today = new Date(tampungTanggalPemantauanBan);
    var day = today.getDate();
    var year = today.getFullYear();
    var monthIndex = today.getMonth();

    $$('.titleTanggal').html(day + ' ' + monthNames[monthIndex] + ' ' + year);
    var act = "TAMPIL_MASTER_PEMANTAUAN_BAN_PER_TANGGAL";
    var tampungMasterPemantauanBan = "";
    myApp.request.post(ipTujuan,{case:act,TANGGAL:tampungTanggalPemantauanBan,KODEJABATAN:KODEJABATAN,USERID:USERID,KODECABANG:KODECABANG},
        function(data){
            var hasil_json = JSON.parse(data);
            if(hasil_json.hasil == "ada"){
               tampungMasterPemantauanBan = "<ul>";
               for(var i = 0; i<hasil_json.NOMORBUKTI.length;i++){



                tampungMasterPemantauanBan += `<li>
                <a href="#" onClick="klikListTanggalPemantauanBanDetail('`+hasil_json.NOMORBUKTI[i]+`')" class="item-link item-content">
                <div class="item-inner">
                <div class="item-title">`+hasil_json.NOMORPLAT[i]+`</div>
                </div>
                </a>
                </li>`;    
            }

            tampungMasterPemantauanBan += "</ul>";
        } else {
            tampungMasterPemantauanBan = "Belum Ada Laporan";
        }

        $$('.semuaTampilMasterPemantauanBanPerTanggal').html(tampungMasterPemantauanBan);
        myApp.preloader.hide();
    }, 
    function(xhr,status){
        PreloaderHide(status);
    });
});

//detail_pemantauan_ban
$$(document).on('page:init', '.page[data-name="detail_pemantauan_ban"]', function (page) {
    var act = "TAMPIL_DETAIL_PEMANTAUAN_BAN";
    var monthNames = [
    "Januari", "Februari", "Maret",
    "April", "Mei", "Juni", "Juli",
    "Agustus", "September", "Oktober",
    "November", "Desember"
    ];

    
    myApp.request.post(ipTujuan,{case:act,KODECABANG:KODECABANG,USERID:USERID,KODEJABATA:KODEJABATAN,NOMORBUKTI:tampungNomorBuktiPemantauanBan},function(data){
        var hasil_json = JSON.parse(data);
        var tampungHalamanDetailPemantauanBan = "";
        if(hasil_json.hasil_tm == "ada"){
            var today = new Date(hasil_json.TANGGAL);
            var day = today.getDate();
            var year = today.getFullYear();
            var monthIndex = today.getMonth();

            tampungHalamanDetailPemantauanBan+=`
            <div class="card" >
            <div class ="card-header cardHeaderBiru">${tampungNomorBuktiPemantauanBan} `;
            if(!userHakAksesArrayGlobal["pemantauanBan"]){
            } else {
                if(userHakAksesArrayGlobal['pemantauanBan']['UBAH'] == "T" && halamanGlobal == "PEMANTAUAN_BAN" && hasil_json.STATUSTM == "OPEN"){

                    tampungHalamanDetailPemantauanBan+=`
                    <a href="#" style="color:white" class="link right" onClick="editPemantauanBan('`+tampungNomorBuktiPemantauanBan+`',null)">
                    <i class="fas fa-edit"></i>
                    </a>`;
                }
            }


            tampungHalamanDetailPemantauanBan+=`</div>
            <div class="card-content card-content-padding">




            <div class="row">
            <div class="col-45 cardContentDetail" >Odometer</div>
            <div class="col-5 boldHitam"> : </div>
            <div class="col-50 cardContentHasilDetail ">`+hasil_json.ODOMETER+`</div>
            </div>

            <div class="row">
            <div class="col-45 cardContentDetail" >Tanggal</div>
            <div class="col-5 boldHitam"> : </div>
            <div class="col-50 cardContentHasilDetail ">`+day + ' ' + monthNames[monthIndex] + ' ' + year+`</div>
            </div>

            <div class="row">
            <div class="col-45 cardContentDetail" >Nomor Plat</div>
            <div class="col-5 boldHitam"> : </div>
            <div class="col-50 cardContentHasilDetail ">`+hasil_json.NOMORPLAT+`</div>
            </div>

            <div class="row">
            <div class="col-45 cardContentDetail" >User ID</div>
            <div class="col-5 boldHitam"> : </div>
            <div class="col-50 cardContentHasilDetail ">`+hasil_json.USERID+`</div>
            </div>

            <div class="row">
            <div class="col-45 cardContentDetail" >Status</div>
            <div class="col-5 boldHitam"> : </div>
            <div class="col-50 cardContentHasilDetail ">`+hasil_json.STATUSTM+`</div>
            </div>`;

            if(hasil_json.foto_tm == "ada"){
                counter = 0;
                for(var j =0; j<hasil_json.NAMAGAMBARTM.length; j++){
                    tampungHalamanDetailPemantauanBan +=`
                    <a href ="#" onClick="zoomInOutGambarTmPemantauanBan('${tampungNomorBuktiPemantauanBan}','`+counter+`')">
                    <img src="`+ipGambarTmPemantauanBan+hasil_json.NAMAGAMBARTM[j]+`.jpg?`+ new Date().getTime()+`" height="45px" width="45px">
                    </a>
                    `;
                    counter++;
                }
            }

            tampungHalamanDetailPemantauanBan+=`</div>
            </div>`;
            $$('.semuaTampilDetailPemantauanBan').html(tampungHalamanDetailPemantauanBan);
        }

        if(hasil_json.hasil_td == "ada"){
                /*var tampungHalamanLaporanKunjunganFilter = `<div class="row">
                <div class="col-100" style="text-align: center"><span style="font-size:1.2em" class="badge color-red"><b>Jumlah `;
                if(halamanGlobal == "LAPORAN_KIRIMAN"){
                    tampungHalamanLaporanKunjunganFilter += "Kiriman";
                } else {
                    tampungHalamanLaporanKunjunganFilter += "Collector";
                }
                tampungHalamanLaporanKunjunganFilter+=` : `+hasil_json.TOTJUMLAH+`</b></span></div>
                </div>`;*/
                
                for(var i = 0; i<hasil_json.NOMORBUKTI.length; i++){
                    tampungHalamanDetailPemantauanBan+=`

                    <div class="card">
                    <div class ="card-header cardHeaderBiru">`+hasil_json.NOMORBUKTI[i];

                    if(!userHakAksesArrayGlobal["pemantauanBan"]){
                    } else {
                        if(userHakAksesArrayGlobal['pemantauanBan']['UBAH'] == "T" && halamanGlobal == "PEMANTAUAN_BAN" && hasil_json.STATUS[i] == "OPEN"){
                            tampungHalamanDetailPemantauanBan+=`
                            <a href="#" style="color:white" class="link right" onClick="editPemantauanBan('`+hasil_json.NOMORBUKTI[i]+`','`+hasil_json.POSISI[i]+`')">
                            <i class="fas fa-edit"></i>
                            </a>`;
                        }
                    }

                    /*if(!userHakAksesArrayGlobal["laporanCollector"]){

                    } else {
                        if(userHakAksesArrayGlobal['laporanCollector']['UBAH'] == "T" && halamanGlobal == "LAPORAN_COLLECTOR" && hasil_json.STATUS[i] == "OPEN"){
                            tampungHalamanDetailPemantauanBan+=`
                            <a href="#" style="color:white" class="link right" onClick="editRencanaKirimanCollector('`+hasil_json.NOMORBUKTI[i]+`')">
                            <i class="fas fa-edit"></i>
                            </a>`;
                        } 
                    }*/

                    tampungHalamanDetailPemantauanBan+=`</div>
                    <div class="card-content card-content-padding">
                    

                    

                    <div class="row">
                    <div class="col-45 cardContentDetail" >Posisi</div>
                    <div class="col-5 boldHitam"> : </div>
                    <div class="col-50 cardContentHasilDetail ">`+hasil_json.POSISI[i]+`</div>
                    </div>

                    <div class="row">
                    <div class="col-45 cardContentDetail" >Serial Number</div>
                    <div class="col-5 boldHitam"> : </div>
                    <div class="col-50 cardContentHasilDetail ">`+hasil_json.SERIALNUMBER[i]+`</div>
                    </div>


                    <div class="row">
                    <div class="col-45 cardContentDetail" >Tekanan Angin</div>
                    <div class="col-5 boldHitam"> : </div>
                    <div class="col-50 cardContentHasilDetail ">`+hasil_json.PSI[i]+`</div>
                    </div>

                    <div class="row">
                    <div class="col-45 cardContentDetail" >Tebal Kembangan</div>
                    <div class="col-5 boldHitam"> : </div>
                    <div class="col-50 cardContentHasilDetail ">`+hasil_json.TD[i]+`</div>
                    </div>

                    <div class="row">
                    <div class="col-45 cardContentDetail" >Keterangan</div>
                    <div class="col-5 boldHitam"> : </div>
                    <div class="col-50 cardContentHasilDetail ">`;
                    if(hasil_json.KETERANGAN[i]){
                        tampungHalamanDetailPemantauanBan += hasil_json.KETERANGAN[i];
                    } else {
                        tampungHalamanDetailPemantauanBan +='-';
                    }
                    tampungHalamanDetailPemantauanBan+=`</div>
                    </div>`;
                    
                    if(hasil_json.hasilgambar == "ada"){
                        counter = 0;
                        for(var j =0; j<hasil_json.COUNTERGAMBAR.length; j++){
                            if(hasil_json.COUNTERGAMBAR[j] == hasil_json.NOMORBUKTI[i] +"_"+hasil_json.POSISI[i]){
                                tampungHalamanDetailPemantauanBan +=`
                                <a href ="#" onClick="zoomInOutGambarTdPemantauanBan('${hasil_json.NOMORBUKTIPOSISI[i]}','`+counter+`')">
                                <img src="`+ipGambarPemantauanBan+hasil_json.NAMAGAMBAR[j]+`.jpg?`+ new Date().getTime()+`" height="45px" width="45px">
                                </a>
                                `;
                                counter++;
                            } 
                        }
                    }

                    
                    tampungHalamanDetailPemantauanBan+=`</div>
                    </div>`;
                }
                $$('.semuaTampilDetailPemantauanBan').html(tampungHalamanDetailPemantauanBan);
            } 

            if(hasil_json.hasil_tm == "tidakada" && hasil_json.hasiltd == "tidakada" ){
                $$('.semuaTampilDetailPemantauanBan').html("Tidak Ada Laporan");
            }
            myApp.preloader.hide();

        }, function(xhr,status){
            PreloaderHide(status);
        });
});

//edit_pemantauan_ban
$$(document).on('page:init', '.page[data-name="edit_pemantauan_ban"]', function (page) {
    var act = "TAMPIL_EDIT_PEMANTAUAN_BAN";
    var counter = 0;
    var counterHapus = "tidak";
    var gambarHapus =[];
    myApp.request.post(ipTujuan,{case:act,NOMORBUKTI:tampungEditNomorBuktiPemantauanBan,NOMORBUKTIPOSISI:tampungEditNomorBuktiPosisiPemantauanBan,POSISI:tampungEditPosisiPemantauanBan},function(data){
        var hasil_json = JSON.parse(data);
        $$('.editSerialNumberPemantauanBan').val(hasil_json.SERIALNUMBER);
        $$('.editTekananAnginPemantauanBan').val(hasil_json.PSI);
        $$('.editTdPemantauanBan').val(hasil_json.TD);
        $$('.editKeteranganPemantauanBan').val(hasil_json.KETERANGAN);

        
        if(hasil_json.hasil_foto == "ada"){
            var tampungGambarPemantauanBan = "";
            for(var i = 0;i<hasil_json.NAMAGAMBAR.length;i++){
                counter=hasil_json.counter[i];
                tampungGambarPemantauanBan +=`<div class="card">
                <div class="card-header row" style="background-color:#2196F3;color:white">
                <div class="col padding5">
                <a href="#" class="hapusFotoKunjungan col-50 padding5" id ="${counter}">
                <i class="fas fa-window-close  middleWhite" ></i>
                </a>
                </div>
                </div>
                <div class="card-content card-content-padding">
                <img src="`+ipGambarPemantauanBan+hasil_json.NAMAGAMBAR[i]+`.jpg?`+ new Date().getTime()+`" id="foto-kunjungan-${counter}" class="${counter}" height="150" width="100%">
                </div>
                </div>`;
            }
            $$('.spanFotoSemuaPemantauanBan').html(tampungGambarPemantauanBan);
            $$('.hapusFotoKunjungan').on('click',function(){
                var hapusId = $$(this).attr("id");
                var tampung = $$("#foto-kunjungan-"+hapusId).attr("src");

                if(tampung != null){
                    gambarHapus.push(hapusId);
                    $$(this).closest('.card').remove();
                }
            });

            counter++;
            $$('.spanFotoPemantauanBan').html(`
                <div class="card">
                <div class="card-header row" style="background-color:#2196F3;color:white">

                <div class="col padding5">
                <a href="#" onClick="editAmbilFotoPemantauanBan('${counter}')" class="ambilFotoKunjunganzzz">
                <i class="fa fa-camera  middleWhite"></i>
                </a>
                </div>

                <div class="col padding5">
                <a href="#" onClick="editAmbilGalleryPemantauanBan('${counter}')" class="ambilFotoKunjunganzzz">
                <i class="fa fa-image  middleWhite"></i>
                </a>
                </div>

                </div>
                <div class="card-content card-content-padding">
                <img id="foto-pemantauan-${counter}" name="fotoPemantauanBanUpload" class="${counter}" height="150" width="100%">
                </div>
                </div>`);
        } else {
            $$('.spanFotoSemuaPemantauanBan').remove();
            $$('.spanFotoPemantauanBan').html(`
                <div class="card">
                <div class="card-header row" style="background-color:#2196F3;color:white">

                <div class="col padding5">
                <a href="#" onClick="editAmbilFotoPemantauanBan('1')" class="ambilFotoKunjunganzzz">
                <i class="fa fa-camera  middleWhite"></i>
                </a>
                </div>

                <div class="col padding5">
                <a href="#" onClick="editAmbilGalleryPemantauanBan('1')" class="ambilFotoKunjunganzzz">
                <i class="fa fa-image  middleWhite"></i>
                </a>
                </div>

                </div>
                <div class="card-content card-content-padding">
                <img  id="foto-pemantauan-1" name="fotoPemantauanBanUpload" class="1" height="150" width="100%">
                </div>
                </div>`);
        }
    });


    $$('.btnEditPemantauanBan').on('click',function(){
        var SERIALNUMBER = $$('.editSerialNumberPemantauanBan').val();
        var TEKANANANGIN = $$('.editTekananAnginPemantauanBan').val();
        var TD = $$('.editTdPemantauanBan').val();
        var KETERANGAN = $$('.editKeteranganPemantauanBan').val();
        var fotoPemantauan = [];
        var namaFotoPemantauan = [];
        $$('img[name^="fotoPemantauanBanUpload"]').each(function() {
            if($$(this).attr("src") !=null){
                fotoPemantauan.push($$(this).attr("src"));
                namaFotoPemantauan.push(this.className);
            }
        });

        var act = "EDIT_PEMANTAUAN_BAN";
        myApp.request.post(ipTujuan,{case:act,USERID:USERID,NOMORBUKTI:tampungEditNomorBuktiPemantauanBan,POSISI:tampungEditPosisiPemantauanBan,SERIALNUMBER:SERIALNUMBER,TEKANANANGIN:TEKANANANGIN,
            TD:TD,KETERANGAN:KETERANGAN,namaFotoPemantauan:namaFotoPemantauan,HAPUSGAMBAR:gambarHapus},function(data){
                var hasil_json = JSON.parse(data);
                if(namaFotoPemantauan.length>0 ){
                    for(var i =0; i<fotoPemantauan.length;i++){
                       var toko = new FileUploadOptions();
                       toko.fileKey = "photo";
                       toko.fileName = fotoPemantauan[i].substr(fotoPemantauan[i].lastIndexOf('/') + 1);
                       toko.mimeType = "image/jpeg";
                       toko.chunkedMode = false;
                       toko.headers = {
                          Connection: "close"
                      };
                      toko.params = {
                        namaFile:tampungEditNomorBuktiPemantauanBan +'_'+tampungEditPosisiPemantauanBan+'_'+namaFotoPemantauan[i]
                    }
                    var ft = new FileTransfer();
                    ft.upload(fotoPemantauan[i], 
                      encodeURI(ipUploadTdPemantauanBan),
                      win,
                      fail,
                      toko);

                    var win = function(r) {
                        console.log("Should not be called.");
                    }

                    var fail = function(error) {
                        myApp.dialog.alert("eror :" +error.code);
                        alert("An error has occurred: Code = " + error.code);
                        console.log("upload error source " + error.source);
                        console.log("upload error target " + error.target);
                    }
                }
                myApp.preloader.hide();
                myApp.dialog.alert("Berhasil Mengedit Data");
                mainView.router.back("/detail_pemantauan_ban/",{force:true});
            } else {
                myApp.preloader.hide();
                myApp.dialog.alert("Berhasil Mengedit Data");
                mainView.router.back("/detail_pemantauan_ban/",{force:true});
            }
        });
    });
});


//edit_tm_pemantauan_ban
$$(document).on('page:init', '.page[data-name="edit_tm_pemantauan_ban"]', function (page) {
    var act = "TAMPIL_EDIT_TM_PEMANTAUAN_BAN";
    var counter = 0;
    var counterHapus = "tidak";
    var gambarHapus =[];
    var TANGGAL;
    myApp.request.post(ipTujuan,{case:act,NOMORBUKTI:tampungEditNomorBuktiPemantauanBan},function(data){
        var hasil_json = JSON.parse(data);
        TANGGAL = hasil_json.TANGGAL;
        var today = new Date(hasil_json.TANGGAL);
        var day = today.getDate();
        var monthIndex = today.getMonth();
        var year = today.getFullYear();
        $$('.editTanggalPemantauanBan').val(day + ' ' + monthNames[monthIndex] + ' ' + year);
        $$('.editOdometerPemantauanBan').val(hasil_json.ODOMETER);
        $$('.editNomorPlatPemantauanBan').val(hasil_json.NOMORPLAT);

        
        if(hasil_json.hasil_foto == "ada"){
            var tampungGambarPemantauanBan = "";
            for(var i = 0;i<hasil_json.NAMAGAMBAR.length;i++){
                counter=hasil_json.counter[i];
                tampungGambarPemantauanBan +=`<div class="card">
                <div class="card-header row" style="background-color:#2196F3;color:white">
                <div class="col padding5">
                <a href="#" class="hapusFotoKunjungan col-50 padding5" id ="${counter}">
                <i class="fas fa-window-close  middleWhite" ></i>
                </a>
                </div>
                </div>
                <div class="card-content card-content-padding">
                <img src="`+ipGambarTmPemantauanBan+hasil_json.NAMAGAMBAR[i]+`.jpg?`+ new Date().getTime()+`" id="foto-kunjungan-${counter}" class="${counter}" height="150" width="100%">
                </div>
                </div>`;
            }
            $$('.spanFotoSemuaPemantauanBan').html(tampungGambarPemantauanBan);
            $$('.hapusFotoKunjungan').on('click',function(){
                var hapusId = $$(this).attr("id");
                var tampung = $$("#foto-kunjungan-"+hapusId).attr("src");

                if(tampung != null){
                    gambarHapus.push(hapusId);
                    $$(this).closest('.card').remove();
                }
            });

            counter++;
            $$('.spanFotoPemantauanBan').html(`
                <div class="card">
                <div class="card-header row" style="background-color:#2196F3;color:white">

                <div class="col padding5">
                <a href="#" onClick="editAmbilFotoPemantauanBan('${counter}')" class="ambilFotoKunjungan">
                <i class="fa fa-camera  middleWhite"></i>
                </a>
                </div>

                <div class="col padding5">
                <a href="#" onClick="editAmbilGalleryPemantauanBan('${counter}')" class="ambilFotoKunjungan">
                <i class="fa fa-image  middleWhite"></i>
                </a>
                </div>

                </div>
                <div class="card-content card-content-padding">
                <img id="foto-pemantauan-${counter}" name="fotoPemantauanBanUpload" class="${counter}" height="150" width="100%">
                </div>
                </div>`);
        } else {
            $$('.spanFotoSemuaPemantauanBan').remove();
            $$('.spanFotoPemantauanBan').html(`
                <div class="card">
                <div class="card-header row" style="background-color:#2196F3;color:white">

                <div class="col padding5">
                <a href="#" onClick="editAmbilFotoPemantauanBan('1')" class="ambilFotoKunjungan">
                <i class="fa fa-camera  middleWhite"></i>
                </a>
                </div>

                <div class="col padding5">
                <a href="#" onClick="editAmbilGalleryPemantauanBan('1')" class="ambilFotoKunjungan">
                <i class="fa fa-image  middleWhite"></i>
                </a>
                </div>

                </div>
                <div class="card-content card-content-padding">
                <img id="foto-pemantauan-1" name="fotoPemantauanBanUpload" class="1" height="150" width="100%">
                </div>
                </div>`);
        }
    });


    $$('.btnEditPemantauanBan').on('click',function(){
        var ODOMETER = $$('.editOdometerPemantauanBan').val();
        var NOMORPLAT = $$('.editNomorPlatPemantauanBan').val();
        var fotoPemantauan = [];
        var namaFotoPemantauan = [];
        $$('img[name^="fotoPemantauanBanUpload"]').each(function() {
            if($$(this).attr("src") !=null){
                fotoPemantauan.push($$(this).attr("src"));
                namaFotoPemantauan.push(this.className);
            }
        });

        var act = "EDIT_TM_PEMANTAUAN_BAN";
        myApp.request.post(ipTujuan,{case:act,USERID:USERID,NOMORBUKTI:tampungEditNomorBuktiPemantauanBan
            ,namaFotoPemantauan:namaFotoPemantauan,HAPUSGAMBAR:gambarHapus,TANGGAL:TANGGAL,ODOMETER:ODOMETER,
            NOMORPLAT:NOMORPLAT},function(data){
                var hasil_json = JSON.parse(data);
                if(namaFotoPemantauan.length>0 && hasil_json.hasil == "berhasil"){
                    for(var i =0; i<fotoPemantauan.length;i++){
                       var toko = new FileUploadOptions();
                       toko.fileKey = "photo";
                       toko.fileName = fotoPemantauan[i].substr(fotoPemantauan[i].lastIndexOf('/') + 1);
                       toko.mimeType = "image/jpeg";
                       toko.chunkedMode = false;
                       toko.headers = {
                          Connection: "close"
                      };
                      toko.params = {
                        namaFile:tampungEditNomorBuktiPemantauanBan +'_'+namaFotoPemantauan[i]
                    }
                    var ft = new FileTransfer();
                    ft.upload(fotoPemantauan[i], 
                      encodeURI(ipUploadPemantauanBan),
                      win,
                      fail,
                      toko);

                    var win = function(r) {
                        console.log("Should not be called.");
                    }

                    var fail = function(error) {
                        myApp.dialog.alert("eror :" +error.code);
                        alert("An error has occurred: Code = " + error.code);
                        console.log("upload error source " + error.source);
                        console.log("upload error target " + error.target);
                    }
                }
                myApp.preloader.hide();
                myApp.dialog.alert("Berhasil Mengedit Data");
                mainView.router.back("/detail_pemantauan_ban/",{force:true});
            } else if(hasil_json.hasil == "odometer_rendah"){
                myApp.preloader.hide();
                myApp.dialog.alert("Tidak boleh mengedit odometer lebih rendah");
            } else if(hasil_json.hasil == "odometer_tinggi"){
                myApp.preloader.hide();
                myApp.dialog.alert("Tidak boleh mengedit odometer lebih tinggi");
            } else if(hasil_json.hasil == "tanggal_sama_beda_nomorbukti"){
                myApp.preloader.hide();
                myApp.dialog.alert("Tanggal Tersebut Sudah ada Nomor Plat terinput");
            } else {
                myApp.preloader.hide();
                myApp.dialog.alert("Berhasil Mengedit Data");
                mainView.router.back("/detail_pemantauan_ban/",{force:true});
            }
        });
    });
});

//master_barang
$$(document).on('page:init', '.page[data-name="master_barang"]', function (page) {
    var searchbar = myApp.searchbar.create({
        el: '.searchbar',
        searchContainer: '.list',
        searchIn: '.namaBarang',
        on: {
            search(sb, query, previousQuery) {
                console.log(query, previousQuery);
            }
        }
    });
});

//laporan_kiriman_collector
$$(document).on('page:init', '.page[data-name="laporan_kiriman_collector"]', function (page) {
    if(halamanGlobal == "LAPORAN_KIRIMAN"){
        $$('.titleLaporanKirimanCollector').html("Laporan Kiriman");
    } else {
        $$('.titleLaporanKirimanCollector').html("Laporan Collector");
    }
    var searchbar3 = myApp.searchbar.create({
        el: '.searchKaryawanDari',
        searchContainer: '.listPopUpNamaKaryawanDari',
        searchIn: '.namaKaryawanDari',
        on: {
            search(sb, query, previousQuery) {
                console.log(query, previousQuery);
            }
        }
    });

    var searchbar4 = myApp.searchbar.create({
        el: '.searchKaryawanSampai',
        searchContainer: '.listPopUpNamaKaryawanSampai',
        searchIn: '.namaKaryawanSampai',
        on: {
            search(sb, query, previousQuery) {
                console.log(query, previousQuery);
            }
        }
    });


    var act ="TAMPIL_NAMA_KARYAWAN";
    myApp.request.post(ipTujuan,{case:act,USERID:USERID},function(data){
        $$('.namaDariSalesmanLaporan').val(data);
        $$('.namaSampaiSalesmanLaporan').val(data);
        $$('.kodeDariSalesmanLaporan').val(USERID);
        $$('.kodeSampaiSalesmanLaporan').val(USERID);
    });


    //myApp.preloader.hide();
    var calendarModal = myApp.calendar.create({
        inputEl: '#dariTanggalLaporanPerStaff',
        openIn: 'customModal',
        header: true,
        footer: true,
        dateFormat: 'MM dd yyyy',
    });

    var calendarModal = myApp.calendar.create({
        inputEl: '#sampaiTanggalLaporanPerStaff',
        openIn: 'customModal',
        header: true,
        footer: true,
        dateFormat: 'MM dd yyyy',
    });

    PopupLaporanKaryawanPerTanggalDari(KODEJABATAN,USERID);
    PopupLaporanKaryawanPerTanggalSampai(KODEJABATAN,USERID);

    

    $$('.popup-open-karyawanPelangganDari').on('click',function(){
        myApp.popup.open('.popup-karyawanDari'); 
    });

    $$('.popup-open-karyawanPelangganSampai').on('click',function(){
        myApp.popup.open('.popup-karyawanSampai');
    });

    $$('.btnCancel').on('click',function(){
        myApp.popup.close('.popup-karyawanDari');
        myApp.popup.close('.popup-karyawanSampai');
    });

    $$('.btnLaporanRencanaKirimanCollector').on('click',function(){
        tampungDariSalesmanKirimanCollector = $$('.kodeDariSalesmanLaporan').val();
        tampungSampaiSalesmanKirimanCollector = $$('.kodeSampaiSalesmanLaporan').val();
        tampungDariTanggalKirimanCollector = $$('#dariTanggalLaporanPerStaff').val();
        tampungSampaiTanggalKirimanCollector = $$('#sampaiTanggalLaporanPerStaff').val();
        mainView.router.navigate("/hasil_laporan_kiriman_collector/");
    });
});

//hasil_laporan_kiriman_collector
$$(document).on('page:init', '.page[data-name="hasil_laporan_kiriman_collector"]', function(page){
    if(halamanGlobal == "LAPORAN_KIRIMAN"){
        $$('.titleHasilLaporanKirimanCollector').html("Laporan Kiriman");
    } else {
        $$('.titleHasilLaporanKirimanCollector').html("Laporan Collector");
    }

    var act = "TAMPIL_HASIL_LAPORAN_KIRIMAN_COLLECTOR";
    myApp.request.post(ipTujuan,{case:act,KODESALESMANDARI:tampungDariSalesmanKirimanCollector,KODESALESMANSAMPAI:tampungSampaiSalesmanKirimanCollector,
        TANGGALDARI:tampungDariTanggalKirimanCollector,TANGGALSAMPAI:tampungSampaiTanggalKirimanCollector,HALAMAN:halamanGlobal,KODECABANG:KODECABANG},function(data){
            var hasil_json = JSON.parse(data);
            
            if(hasil_json.hasil == "ada"){
                var tampungHalamanLaporanKunjunganFilter = `<div class="row">
                <div class="col-100" style="text-align: center"><span style="font-size:1.2em" class="badge color-red"><b>Jumlah `;
                if(halamanGlobal == "LAPORAN_KIRIMAN"){
                    tampungHalamanLaporanKunjunganFilter += "Kiriman";
                } else {
                    tampungHalamanLaporanKunjunganFilter += "Collector";
                }
                tampungHalamanLaporanKunjunganFilter+=` : `+hasil_json.TOTJUMLAH+`</b></span></div>
                </div>`;
                for(var i = 0; i<hasil_json.NOMORBUKTI.length; i++){
                    var today1 = new Date(hasil_json.JAMMASUK[i]);
                    var day1 = today1.getDate();
                    var monthIndex1 = today1.getMonth();
                    var year1 = today1.getFullYear();
                    var hours1 = today1.getHours();
                    hours1 = ("0" + hours1).slice(-2);
                    var minutes1 = today1.getMinutes();
                    minutes1 = ("0" + minutes1).slice(-2);
                    var seconds1 = today1.getSeconds();
                    seconds1 = ("0" + seconds1).slice(-2);


                    var today2 = new Date(hasil_json.DATETRANSACTION[i]);
                    var day2 = today2.getDate();
                    var monthIndex2 = today2.getMonth();
                    var year2 = today2.getFullYear();
                    var hours2 = today2.getHours();
                    hours2 = ("0" + hours2).slice(-2);
                    var minutes2 = today2.getMinutes();
                    minutes2 = ("0" + minutes2).slice(-2);
                    var seconds2 = today2.getSeconds();
                    seconds2 = ("0" + seconds2).slice(-2);

                    tampungHalamanLaporanKunjunganFilter+=`

                    <div class="card">
                    <div class ="card-header cardHeaderBiru">`+hasil_json.NOMORBUKTI[i];

                    if(!userHakAksesArrayGlobal["laporanKiriman"]){

                    } else {
                        if(userHakAksesArrayGlobal['laporanKiriman']['UBAH'] == "T" && halamanGlobal == "LAPORAN_KIRIMAN" && hasil_json.STATUS[i] == "OPEN"){
                            tampungHalamanLaporanKunjunganFilter+=`
                            <a href="#" style="color:white" class="link right" onClick="editRencanaKirimanCollector('`+hasil_json.NOMORBUKTI[i]+`')">
                            <i class="fas fa-edit"></i>
                            </a>`;
                        }
                    }

                    if(!userHakAksesArrayGlobal["laporanCollector"]){

                    } else {
                        if(userHakAksesArrayGlobal['laporanCollector']['UBAH'] == "T" && halamanGlobal == "LAPORAN_COLLECTOR" && hasil_json.STATUS[i] == "OPEN"){
                            tampungHalamanLaporanKunjunganFilter+=`
                            <a href="#" style="color:white" class="link right" onClick="editRencanaKirimanCollector('`+hasil_json.NOMORBUKTI[i]+`')">
                            <i class="fas fa-edit"></i>
                            </a>`;
                        } 
                    }

                    tampungHalamanLaporanKunjunganFilter+=`</div>
                    <div class="card-content card-content-padding">
                    

                    

                    <div class="row">
                    <div class="col-45 cardContentDetail" >Jam Login PT</div>
                    <div class="col-5 boldHitam"> : </div>
                    <div class="col-50 cardContentHasilDetail ">`;
                    if(new Date(hasil_json.JAMMASUK[i]) < new Date("1980-01-01")){
                        tampungHalamanLaporanKunjunganFilter += ` - `;
                    } else {
                        tampungHalamanLaporanKunjunganFilter +=ConvertDateTimeToText(hasil_json.JAMMASUK[i],'datetimeday');
                    }
                    tampungHalamanLaporanKunjunganFilter+=`
                    </div>
                    </div>

                    <div class="row">
                    <div class="col-45 cardContentDetail" >Jam Report Fleet/Toko</div>
                    <div class="col-5 boldHitam"> : </div>
                    <div class="col-50 cardContentHasilDetail ">${ConvertDateTimeToText(hasil_json.DATETRANSACTION[i],'datetimeday')}</div>
                    </div>


                    <div class="row">
                    <div class="col-45 cardContentDetail" >Driver </div>
                    <div class="col-5 boldHitam"> : </div>
                    <div class="col-50 cardContentHasilDetail ">`+hasil_json.NAMAKARYAWANDRIVER[i]+`</div>
                    </div>

                    <div class="row">
                    <div class="col-45 cardContentDetail" >User ID </div>
                    <div class="col-5 boldHitam"> : </div>
                    <div class="col-50 cardContentHasilDetail ">`+hasil_json.NAMAKARYAWANUSERID[i]+`</div>
                    </div>

                    

                    <div class="row">
                    <div class="col-45 cardContentDetail" >Pelanggan</div>
                    <div class="col-5 boldHitam"> : </div>
                    <div class="col-50 cardContentHasilDetail ">`+hasil_json.NAMAPELANGGAN[i]+`</div>
                    </div>

                    
                    
                    <div class="row">
                    <div class="col-45 cardContentDetail" >Keterangan</div>
                    <div class="col-5 boldHitam"> : </div>
                    <div class="col-50 cardContentHasilDetail ">`;
                    if(hasil_json.KETERANGAN[i]){
                        tampungHalamanLaporanKunjunganFilter += hasil_json.KETERANGAN[i];
                    } else {
                        tampungHalamanLaporanKunjunganFilter +='-';
                    }
                    tampungHalamanLaporanKunjunganFilter+=`</div>
                    </div>

                    <div class="row">
                    <div class="col-45 cardContentDetail" >Kesimpulan</div>
                    <div class="col-5 boldHitam"> : </div>
                    <div class="col-50 cardContentHasilDetail ">`;
                    if(hasil_json.KESIMPULAN[i]){
                        tampungHalamanLaporanKunjunganFilter += hasil_json.KESIMPULAN[i];
                    } else {
                        tampungHalamanLaporanKunjunganFilter +='-';
                    }
                    tampungHalamanLaporanKunjunganFilter+=`</div>
                    </div>


                    <div class="row">
                    <div class="col-45 cardContentDetail" >Permintaan Khusus</div>
                    <div class="col-5 boldHitam"> : </div>
                    <div class="col-50 cardContentHasilDetail ">`;
                    if(hasil_json.NAMAPERMINTAAN[i]){
                        tampungHalamanLaporanKunjunganFilter += hasil_json.NAMAPERMINTAAN[i];
                    } else {
                        tampungHalamanLaporanKunjunganFilter +='-';
                    }
                    tampungHalamanLaporanKunjunganFilter+=`</div>
                    </div>`

                    if(hasil_json.hasilgambar == "ada"){
                        counter = 0;
                        for(var j =0; j<hasil_json.COUNTERGAMBAR.length; j++){
                            if(hasil_json.COUNTERGAMBAR[j] == hasil_json.NOMORBUKTI[i]){
                                tampungHalamanLaporanKunjunganFilter +=`
                                <a href ="#" onClick="zoomInOutGambarKunjungan('${hasil_json.NOMORBUKTI[i]}','`+counter+`')">
                                <img src="`+ipGambarKunjungan+hasil_json.NAMAGAMBAR[j]+`.jpg?`+ new Date().getTime()+`" height="45px" width="45px">
                                </a>
                                `;
                                counter++;
                            } 
                        }
                    }

                    
                    tampungHalamanLaporanKunjunganFilter+=`</div>
                    </div>`;
                }
                $$('.semuaTampilLaporanRencanaKirimanCollector').html(tampungHalamanLaporanKunjunganFilter);

            } else {
                $$('.semuaTampilLaporanRencanaKirimanCollector').html("Tidak Ada Laporan");
            }
            myApp.preloader.hide();

        }, function(xhr,status){
            PreloaderHide(status);
        });

$$('.editPostingHapusHasilLaporanKirimanCollector').on('click',function(){
    mainView.router.navigate("/halaman_posting_hapus_kiriman_collector/");
});
});

//edit_kiriman_collector
$$(document).on('page:init', '.page[data-name="edit_kiriman_collector"]', function (page) {
    var act = "TAMPIL_EDIT_KIRIMAN_COLLECTOR";
    var gambarHapus =[];
    myApp.request.post(ipTujuan,{case:act,NOMORBUKTI:tampungEditNomorBuktiRencanaKirimanCollector},function(data){
        var hasil_json = JSON.parse(data);

        $$('.editKeteranganKirimanCollector').val(hasil_json.KETERANGAN);
        $$('.editKesimpulanKirimanCollector').val(hasil_json.KESIMPULAN);
        if(hasil_json.gambar == "ada"){
            var tampungGambarKunjungan = "";
            for(var i = 0;i<hasil_json.NAMAGAMBAR.length;i++){
                counter=hasil_json.counter[i];
                tampungGambarKunjungan +=`<div class="card">
                <div class="card-header row" style="background-color:#2196F3;color:white">
                <div class="col padding5">
                <a href="#" class="hapusFotoKunjungan col-50 padding5" id ="${counter}">
                <i class="fas fa-window-close  middleWhite" ></i>
                </a>
                </div>
                </div>
                <div class="card-content card-content-padding">
                <img src="`+ipGambarRencanaKunjungan+hasil_json.NAMAGAMBAR[i]+`.jpg?`+ new Date().getTime()+`" id="foto-kunjungan-${counter}" class="${counter}" height="150" width="100%">
                </div>
                </div>`;
            }
            $$('.spanFotoSemuaKunjunganAda').html(tampungGambarKunjungan);
            $$('.hapusFotoKunjungan').on('click',function(){

                var hapusId = $$(this).attr("id");
                var tampung = $$("#foto-kunjungan-"+hapusId).attr("src");

                if(tampung != null){
                    gambarHapus.push(hapusId);
                    $$(this).closest('.card').remove();
                }
            });

            counter++;
            $$('.spanFotoKunjungan').html(`
                <div class="card">
                <div class="card-header row" style="background-color:#2196F3;color:white">
                

                <a href="#" onClick="ambilFotoKunjungan('${counter}')" class="ambilFotoKunjungan col padding5">
                <i class="fa fa-camera  middleWhite"> </i>
                </a>


                <a href="#" onClick="ambilFotoGallery('${counter}')" class="ambilFotoGallery col padding5">
                <i class="far fa-image  middleWhite"> </i>
                </a>
                </div>
                <div class="card-content card-content-padding">
                <img id="foto-kunjungan-${counter}" name="fotoKunjunganUpload" class="${counter}" height="150" width="100%">
                </div>
                </div>`);
        } else {
            $$('.spanFotoSemuaKunjunganAda').remove();
            $$('.spanFotoKunjungan').html(`
                <div class="card">
                <div class="card-header row" style="background-color:#2196F3;color:white">
                
                


                <a href="#" onClick="ambilFotoKunjungan('1')" class="ambilFotoKunjungan col padding5">
                <i class="fa fa-camera  middleWhite"> </i>
                </a>


                <a href="#" onClick="ambilFotoGallery('1')" class="ambilFotoGallery col padding5">
                <i class="far fa-image  middleWhite"> </i>
                </a>

                </div>
                <div class="card-content card-content-padding">
                <img id="foto-kunjungan-1" name="fotoKunjunganUpload" class="1" height="150" width="100%">
                </div>
                </div>`);
        }
    }, function(xhr,status){
        PreloaderHide(status);
    });

    $$('.btnEditRencanaKirimanCollector').on('click',function(){
        myApp.preloader.show();
        var KETERANGAN = $$('.editKeteranganKirimanCollector').val();
        var KESIMPULAN = $$('.editKesimpulanKirimanCollector').val();
        var fotoKunjungan = [];
        var namaFotoKunjungan = [];
        $$('img[name^="fotoKunjunganUpload"]').each(function() {
            if($$(this).attr("src") !=null){
                fotoKunjungan.push($$(this).attr("src"));
                namaFotoKunjungan.push(this.className);
            }
        });

        var act = "EDIT_KIRIMAN_COLLECTOR";
        myApp.request.post(ipTujuan,{case:act,USERID:USERID,KETERANGAN:KETERANGAN,namaFotoKunjungan:namaFotoKunjungan,
            NAMAGAMBAR:gambarHapus,NOMORBUKTI:tampungEditNomorBuktiRencanaKirimanCollector,KESIMPULAN:KESIMPULAN},function(data){
                var hasil_json = JSON.parse(data);
                if(namaFotoKunjungan.length>0 ){
                    for(var i =0; i<fotoKunjungan.length;i++){
                       var toko = new FileUploadOptions();
                       toko.fileKey = "photo";
                       toko.fileName = fotoKunjungan[i].substr(fotoKunjungan[i].lastIndexOf('/') + 1);
                       toko.mimeType = "image/jpeg";
                       toko.chunkedMode = false;
                       toko.headers = {
                          Connection: "close"
                      };
                      toko.params = {
                        namaFile:tampungEditNomorBuktiRencanaKirimanCollector +'-'+namaFotoKunjungan[i]
                    }
                    var ft = new FileTransfer();
                    ft.upload(fotoKunjungan[i], 
                      encodeURI(ipUploadRencanaKunjungan),
                      win,
                      fail,
                      toko);

                    var win = function(r) {
                        console.log("Should not be called.");
                    }

                    var fail = function(error) {
                        myApp.dialog.alert("eror :" +error.code);
                        alert("An error has occurred: Code = " + error.code);
                        console.log("upload error source " + error.source);
                        console.log("upload error target " + error.target);
                    }
                }
                myApp.preloader.hide();
                myApp.dialog.alert("Berhasil Mengedit");
            //mainView.router.navigate("/hasil_laporan_kiriman_collector/");
            mainView.router.back("/hasil_laporan_kiriman_collector/",{force:true});
        } else {
            myApp.preloader.hide();
            myApp.dialog.alert("Berhasil Mengedit");
            mainView.router.back("/hasil_laporan_kiriman_collector/",{force:true});
            //mainView.router.navigate("/hasil_laporan_kiriman_collector/");
        }
    });
    });
});

var tampungDariSalesmanKirimanCollector;
var tampungSampaiSalesmanKirimanCollector;
var tampungDariTanggalKirimanCollector;
var tampungSampaiTanggalKirimanCollector;
//laporan_rencana_kiriman_collector
$$(document).on('page:init', '.page[data-name="laporan_rencana_kiriman_collector"]', function (page) {
    var searchbar3 = myApp.searchbar.create({
        el: '.searchKaryawanDari',
        searchContainer: '.listPopUpNamaKaryawanDari',
        searchIn: '.namaKaryawanDari',
        on: {
            search(sb, query, previousQuery) {
                console.log(query, previousQuery);
            }
        }
    });

    var searchbar4 = myApp.searchbar.create({
        el: '.searchKaryawanSampai',
        searchContainer: '.listPopUpNamaKaryawanSampai',
        searchIn: '.namaKaryawanSampai',
        on: {
            search(sb, query, previousQuery) {
                console.log(query, previousQuery);
            }
        }
    });


    var act ="TAMPIL_NAMA_KARYAWAN";
    myApp.request.post(ipTujuan,{case:act,USERID:USERID},function(data){
        $$('.namaDariSalesmanLaporan').val(data);
        $$('.namaSampaiSalesmanLaporan').val(data);
        $$('.kodeDariSalesmanLaporan').val(USERID);
        $$('.kodeSampaiSalesmanLaporan').val(USERID);
    });


    //myApp.preloader.hide();
    var calendarModal = myApp.calendar.create({
        inputEl: '#dariTanggalLaporanPerStaff',
        openIn: 'customModal',
        header: true,
        footer: true,
        dateFormat: 'MM dd yyyy',
    });

    var calendarModal = myApp.calendar.create({
        inputEl: '#sampaiTanggalLaporanPerStaff',
        openIn: 'customModal',
        header: true,
        footer: true,
        dateFormat: 'MM dd yyyy',
    });

    PopupLaporanKaryawanPerTanggalDari(KODEJABATAN,USERID);
    PopupLaporanKaryawanPerTanggalSampai(KODEJABATAN,USERID);

    

    $$('.popup-open-karyawanPelangganDari').on('click',function(){
        myApp.popup.open('.popup-karyawanDari'); 
    });

    $$('.popup-open-karyawanPelangganSampai').on('click',function(){
        myApp.popup.open('.popup-karyawanSampai');
    });

    $$('.btnCancel').on('click',function(){
        myApp.popup.close('.popup-karyawanDari');
        myApp.popup.close('.popup-karyawanSampai');
    });

    $$('.btnLaporanRencanaKirimanCollector').on('click',function(){
        tampungDariSalesmanKirimanCollector = $$('.kodeDariSalesmanLaporan').val();
        tampungSampaiSalesmanKirimanCollector = $$('.kodeSampaiSalesmanLaporan').val();
        tampungDariTanggalKirimanCollector = $$('#dariTanggalLaporanPerStaff').val();
        tampungSampaiTanggalKirimanCollector = $$('#sampaiTanggalLaporanPerStaff').val();
        mainView.router.navigate("/hasil_laporan_rencana_kiriman_collector/");
    });
});

//rekap_kiriman_collector
$$(document).on('page:init', '.page[data-name="rekap_kiriman_collector"]', function (page) {
    var judul = "";
    if(halamanGlobal == "REKAP_KIRIMAN"){
        judul = "Rekap Kiriman";
    } else {
        judul = "Rekap Collector";
    }
    $$("#titleRekapKirimanCollector").html(judul);


    var searchbar3 = myApp.searchbar.create({
        el: '.searchKaryawanDari',
        searchContainer: '.listPopUpNamaKaryawanDari',
        searchIn: '.namaKaryawanDari',
        on: {
            search(sb, query, previousQuery) {
                console.log(query, previousQuery);
            }
        }
    });

    var searchbar4 = myApp.searchbar.create({
        el: '.searchKaryawanSampai',
        searchContainer: '.listPopUpNamaKaryawanSampai',
        searchIn: '.namaKaryawanSampai',
        on: {
            search(sb, query, previousQuery) {
                console.log(query, previousQuery);
            }
        }
    });


    var act ="TAMPIL_NAMA_KARYAWAN";
    myApp.request.post(ipTujuan,{case:act,USERID:USERID},function(data){
        $$('.namaDariSalesmanLaporan').val(data);
        $$('.namaSampaiSalesmanLaporan').val(data);
        $$('.kodeDariSalesmanLaporan').val(USERID);
        $$('.kodeSampaiSalesmanLaporan').val(USERID);
    });


    //myApp.preloader.hide();
    var calendarModal = myApp.calendar.create({
        inputEl: '#dariTanggalLaporanPerStaff',
        openIn: 'customModal',
        header: true,
        footer: true,
        dateFormat: 'MM dd yyyy',
    });

    var calendarModal = myApp.calendar.create({
        inputEl: '#sampaiTanggalLaporanPerStaff',
        openIn: 'customModal',
        header: true,
        footer: true,
        dateFormat: 'MM dd yyyy',
    });

    PopupLaporanKaryawanPerTanggalDari(KODEJABATAN,USERID);
    PopupLaporanKaryawanPerTanggalSampai(KODEJABATAN,USERID);

    

    $$('.popup-open-karyawanPelangganDari').on('click',function(){
        myApp.popup.open('.popup-karyawanDari'); 
    });

    $$('.popup-open-karyawanPelangganSampai').on('click',function(){
        myApp.popup.open('.popup-karyawanSampai');
    });

    $$('.btnCancel').on('click',function(){
        myApp.popup.close('.popup-karyawanDari');
        myApp.popup.close('.popup-karyawanSampai');
    });

    $$('#btnLihatRekap').on('click',function(){
        tampungDariSalesmanKirimanCollector = $$('.kodeDariSalesmanLaporan').val();
        tampungSampaiSalesmanKirimanCollector = $$('.kodeSampaiSalesmanLaporan').val();
        tampungDariTanggalKirimanCollector = $$('#dariTanggalLaporanPerStaff').val();
        tampungSampaiTanggalKirimanCollector = $$('#sampaiTanggalLaporanPerStaff').val();
        mainView.router.navigate("/hasil_rekap_kiriman_collector/");
    });
});

//hasil_rekap_kiriman_collector
$$(document).on('page:init', '.page[data-name="hasil_rekap_kiriman_collector"]', function (page) {
    var act = "HASIL_REKAP";
    var params = {
        case:act,
        USERID:USERID,
        KODEJABATAN:KODEJABATAN,
        KODECABANG:KODECABANG,
        KODESALESMANDARI:tampungDariSalesmanKirimanCollector,
        KODESALESMANSAMPAI:tampungSampaiSalesmanKirimanCollector,
        TANGGALDARI:tampungDariTanggalKirimanCollector,
        TANGGALSAMPAI:tampungSampaiTanggalKirimanCollector,
        HALAMAN:halamanGlobal
    }


    myApp.request.post(ipTujuan,params,
        function(data){
            var response = JSON.parse(data);
            console.log(response);
            /*if(response.hasil == "ada"){
                var element = `<div class="row">`;
                var KODEKARYAWAN = "";
                var counterelement = 0;
                for(var i = 0; i<response.KODEPELANGGAN.length;i++){
                    if(KODEKARYAWAN != response.KODEKARYAWAN[i]){
                        if(counterelement != 0 && KODEKARYAWAN !=response.KODEKARYAWAN[i]){
                            element +=`</ul>
                            </div>
                            </div>
                            </div>
                            `;
                        }
                        element += `
                        <div class="card card-outline col-100 tablet-50 desktop-25 margin-top" style="margin:0 auto;">
                        <div class="card-header boldPutih" style="background-color:#e2552b;">${response.NAMAKARYAWAN[i]}</div>
                        <div class="card-content card-content-padding">
                        <div class="list links-list">
                        <ul>

                        <li><a class="link external" href="http://maps.google.com/maps?saddr=${latGlobal},${lngGlobal}&daddr=${response.LATITUDE[i]},${response.LONGITUDE[i]}">${response.NAMAPELANGGAN[i]}</a></li>`;
                        counterelement = 1;
                    } else {
                        element += `<li><a class="link external" href="http://maps.google.com/maps?saddr=${latGlobal},${lngGlobal}&daddr=${response.LATITUDE[i]},${response.LONGITUDE[i]}">${response.NAMAPELANGGAN[i]}</a></li>`;
                    }
                    KODEKARYAWAN = response.KODEKARYAWAN[i];
                    

                    
                }
                element +=`</div>`;
                $$("#pageHasilRekapKirimanCollector").html(element);
            } else {
                $$("#pageHasilRekapKirimanCollector").html("Tidak Ada Rekap");
            }*/

            if(response.hasil == "ada"){
                var element = `<div class="row">`;
                var KODEKARYAWAN = "";
                var counterelement = 0;
                var counterTanggal = "";
                for(var i = 0; i<response.KODEPELANGGAN.length;i++){
                    if(KODEKARYAWAN!= response.KODEKARYAWAN[i]){
                        if(counterelement != 0 && KODEKARYAWAN !=response.KODEKARYAWAN[i]){
                            element +=`</ul>
                            </div>
                            </div>
                            </div>
                            `;
                        }
                        element += `<div class="card card-outline  col-100 tablet-50 desktop-25 margin-top" style="margin:0 auto;">
                        <div class="card-header boldPutih" style="background-color:#e2552b;">${response.NAMAKARYAWAN[i]}  `;
                        var jumlah = 0;
                        response.PELANGGAN.forEach(function(obj,x){
                            if(response.KODEKARYAWAN[i] == obj.KODEKARYAWAN){
                                jumlah = parseInt(jumlah)+parseInt(obj.JUMLAH);
                            }
                        })

                        element+=`<span class="badge color-white text-align-right" style="color:red">${jumlah}</span></div>
                        <div class="card-content card-content-padding">
                        <div class="list links-list">
                        <ul>`;
                        KODEKARYAWAN = response.KODEKARYAWAN[i];
                    }

                    if(counterTanggal != response.TANGGAL[i]){
                        var today = new Date(response.DATETRANSACTION[i]);
                        var day = today.getDate();
                        var monthIndex = today.getMonth();
                        var year = today.getFullYear();
                        element+= `<li class="item-divider bold">${ConvertDateTimeToText(response.DATETRANSACTION[i],"dateday")}`;
                        var jumlahPerTanggal = 0;
                        response.PELANGGAN.forEach(function(obj,x){
                            if(response.KODEKARYAWAN[i] == obj.KODEKARYAWAN && response.TANGGAL[i] == obj.TANGGAL){
                                jumlahPerTanggal = parseInt(jumlahPerTanggal) + parseInt(obj.JUMLAH);
                            }
                        })
                        element +=` <span class="float-right" style="color:red">${jumlahPerTanggal}</span></li>
                        <li><a class="link external" href="http://maps.google.com/maps?saddr=${latGlobal},${lngGlobal}&daddr=${response.LATITUDE[i]},${response.LONGITUDE[i]}">${response.NAMAPELANGGAN[i]}</a></li>
                        `;
                        counterTanggal = response.TANGGAL[i];
                        counterelement = 1;
                    } else {
                        element +=`<li><a class="link external" href="http://maps.google.com/maps?saddr=${latGlobal},${lngGlobal}&daddr=${response.LATITUDE[i]},${response.LONGITUDE[i]}">${response.NAMAPELANGGAN[i]}</a></li>`;
                    }

                }
                element +=`</div>`;
                $$("#pageHasilRekapKirimanCollector").html(element);
            } else {
                $$("#pageHasilRekapKirimanCollector").html("Tidak Ada Rekap");
            }
        },
        function(xhr,status){
            PreloaderHide(status);
        })
});


//rekap_rencana_kiriman_collector
$$(document).on('page:init', '.page[data-name="rekap_rencana_kiriman_collector"]', function (page) {
    var judul = "";
    if(halamanGlobal == "REKAP_RENCANA_KIRIMAN"){
        judul = "Rekap Rencana Kiriman";
    } else {
        judul = "Rekap Rencana Collector";
    }
    $$("#titleRekapRencanaKirimanCollector").html(judul);
    var searchbar3 = myApp.searchbar.create({
        el: '.searchKaryawanDari',
        searchContainer: '.listPopUpNamaKaryawanDari',
        searchIn: '.namaKaryawanDari',
        on: {
            search(sb, query, previousQuery) {
                console.log(query, previousQuery);
            }
        }
    });

    var searchbar4 = myApp.searchbar.create({
        el: '.searchKaryawanSampai',
        searchContainer: '.listPopUpNamaKaryawanSampai',
        searchIn: '.namaKaryawanSampai',
        on: {
            search(sb, query, previousQuery) {
                console.log(query, previousQuery);
            }
        }
    });


    var act ="TAMPIL_NAMA_KARYAWAN";
    myApp.request.post(ipTujuan,{case:act,USERID:USERID},function(data){
        $$('.namaDariSalesmanLaporan').val(data);
        $$('.namaSampaiSalesmanLaporan').val(data);
        $$('.kodeDariSalesmanLaporan').val(USERID);
        $$('.kodeSampaiSalesmanLaporan').val(USERID);
    });


    //myApp.preloader.hide();
    var calendarModal = myApp.calendar.create({
        inputEl: '#dariTanggalLaporanPerStaff',
        openIn: 'customModal',
        header: true,
        footer: true,
        dateFormat: 'MM dd yyyy',
    });

    var calendarModal = myApp.calendar.create({
        inputEl: '#sampaiTanggalLaporanPerStaff',
        openIn: 'customModal',
        header: true,
        footer: true,
        dateFormat: 'MM dd yyyy',
    });

    PopupLaporanKaryawanPerTanggalDari(KODEJABATAN,USERID);
    PopupLaporanKaryawanPerTanggalSampai(KODEJABATAN,USERID);

    

    $$('.popup-open-karyawanPelangganDari').on('click',function(){
        myApp.popup.open('.popup-karyawanDari'); 
    });

    $$('.popup-open-karyawanPelangganSampai').on('click',function(){
        myApp.popup.open('.popup-karyawanSampai');
    });

    $$('.btnCancel').on('click',function(){
        myApp.popup.close('.popup-karyawanDari');
        myApp.popup.close('.popup-karyawanSampai');
    });

    $$('#btnLihatRekap').on('click',function(){
        tampungDariSalesmanKirimanCollector = $$('.kodeDariSalesmanLaporan').val();
        tampungSampaiSalesmanKirimanCollector = $$('.kodeSampaiSalesmanLaporan').val();
        tampungDariTanggalKirimanCollector = $$('#dariTanggalLaporanPerStaff').val();
        tampungSampaiTanggalKirimanCollector = $$('#sampaiTanggalLaporanPerStaff').val();
        mainView.router.navigate("/hasil_rekap_rencana_kiriman_collector/");
    });
});

//hasil_rekap_rencana_kiriman_collector
$$(document).on('page:init', '.page[data-name="hasil_rekap_rencana_kiriman_collector"]', function (page) {
    var act = "HASIL_REKAP_RENCANA";
    var params = {
        case:act,
        USERID:USERID,
        KODEJABATAN:KODEJABATAN,
        KODECABANG:KODECABANG,
        KODESALESMANDARI:tampungDariSalesmanKirimanCollector,
        KODESALESMANSAMPAI:tampungSampaiSalesmanKirimanCollector,
        TANGGALDARI:tampungDariTanggalKirimanCollector,
        TANGGALSAMPAI:tampungSampaiTanggalKirimanCollector,
        HALAMAN:halamanGlobal
    }


    myApp.request.post(ipTujuan,params,
        function(data){
            var response = JSON.parse(data);
            
            if(response.hasil == "ada"){
                var element = `<div class="row">`;
                var KODEKARYAWAN = "";
                var counterelement = 0;
                var counterTanggal = "";
                for(var i = 0; i<response.KODEPELANGGAN.length;i++){
                    if(KODEKARYAWAN!= response.KODEKARYAWAN[i]){
                        if(counterelement != 0 && KODEKARYAWAN !=response.KODEKARYAWAN[i]){
                            element +=`</ul>
                            </div>
                            </div>
                            </div>
                            `;
                        }
                        element += `<div class="card card-outline  col-100 tablet-50 desktop-25 margin-top" style="margin:0 auto;">
                        <div class="card-header boldPutih" style="background-color:#e2552b;">${response.NAMAKARYAWAN[i]}  `;
                        var jumlah = 0;
                        response.PELANGGAN.forEach(function(obj,x){
                            if(response.KODEKARYAWAN[i] == obj.KODEKARYAWAN){
                                jumlah = parseInt(jumlah)+parseInt(obj.JUMLAH);
                            }
                        })

                        element+=`<span class="badge color-white text-align-right" style="color:red">${jumlah}</span></div>
                        <div class="card-content card-content-padding">
                        <div class="list links-list">
                        <ul>`;
                        KODEKARYAWAN = response.KODEKARYAWAN[i];
                    }

                    if(counterTanggal != response.DATETRANSACTION[i]){
                        var today = new Date(response.DATETRANSACTION[i]);
                        var day = today.getDate();
                        var monthIndex = today.getMonth();
                        var year = today.getFullYear();
                        element+= `<li class="item-divider bold">${ConvertDateTimeToText(response.DATETRANSACTION[i],"dateday")}`;
                        var jumlahPerTanggal = 0;
                        response.PELANGGAN.forEach(function(obj,x){
                            if(response.KODEKARYAWAN[i] == obj.KODEKARYAWAN && response.DATETRANSACTION[i] == obj.TANGGAL){
                                jumlahPerTanggal = parseInt(jumlahPerTanggal) + parseInt(obj.JUMLAH);
                            }
                        })
                        element +=` <span class="float-right" style="color:red">${jumlahPerTanggal}</span></li>
                        <li><a class="link external" href="http://maps.google.com/maps?saddr=${latGlobal},${lngGlobal}&daddr=${response.LATITUDE[i]},${response.LONGITUDE[i]}">${response.NAMAPELANGGAN[i]}</a></li>
                        `;
                        counterTanggal = response.DATETRANSACTION[i];
                        counterelement = 1;
                    } else {
                        element +=`<li><a class="link external" href="http://maps.google.com/maps?saddr=${latGlobal},${lngGlobal}&daddr=${response.LATITUDE[i]},${response.LONGITUDE[i]}">${response.NAMAPELANGGAN[i]}</a></li>`;
                    }

                }
                element +=`</div>`;
                $$("#pageHasilRekapRencanaKirimanCollector").html(element);
            } else {
                $$("#pageHasilRekapRencanaKirimanCollector").html("Tidak Ada Rekap");
            }
        },
        function(xhr,status){
            PreloaderHide(status);
        })
});


//edit_rencana_kiriman_collector
$$(document).on('page:init', '.page[data-name="edit_rencana_kiriman_collector"]', function (page) {
    var act = "TAMPIL_EDIT_RENCANA_KIRIMAN_COLLECTOR";
    var gambarHapus =[];
    myApp.request.post(ipTujuan,{case:act,NOMORBUKTI:tampungEditNomorBuktiRencanaKirimanCollector},function(data){
        var hasil_json = JSON.parse(data);

        $$('.editKeteranganRencanaKirimanCollector').val(hasil_json.KETERANGAN);
        if(hasil_json.gambar == "ada"){
            var tampungGambarKunjungan = "";
            for(var i = 0;i<hasil_json.NAMAGAMBAR.length;i++){
                counter=hasil_json.counter[i];
                tampungGambarKunjungan +=`<div class="card">
                <div class="card-header row" style="background-color:#2196F3;color:white">
                <div class="col padding5">
                <a href="#" class="hapusFotoKunjungan col-50 padding5" id ="${counter}">
                <i class="fas fa-window-close  middleWhite" ></i>
                </a>
                </div>
                </div>
                <div class="card-content card-content-padding">
                <img src="`+ipGambarRencanaKunjungan+hasil_json.NAMAGAMBAR[i]+`.jpg?`+ new Date().getTime()+`" id="foto-kunjungan-${counter}" class="${counter}" height="150" width="100%">
                </div>
                </div>`;
            }
            $$('.spanFotoSemuaKunjunganAda').html(tampungGambarKunjungan);
            $$('.hapusFotoKunjungan').on('click',function(){

                var hapusId = $$(this).attr("id");
                var tampung = $$("#foto-kunjungan-"+hapusId).attr("src");

                if(tampung != null){
                    gambarHapus.push(hapusId);
                    $$(this).closest('.card').remove();
                }
            });
            counter++;
            $$('.spanFotoKunjungan').html(`
                <div class="card">
                <div class="card-header row" style="background-color:#2196F3;color:white">
                

                <a href="#" onClick="ambilFotoKunjungan('${counter}')" class="ambilFotoKunjungan col padding5">
                <i class="fa fa-camera  middleWhite"> </i>
                </a>


                <a href="#" onClick="ambilFotoGallery('${counter}')" class="ambilFotoGallery col padding5">
                <i class="far fa-image  middleWhite"> </i>
                </a>
                </div>
                <div class="card-content card-content-padding">
                <img id="foto-kunjungan-${counter}" name="fotoKunjunganUpload" class="${counter}" height="150" width="100%">
                </div>
                </div>`);
        } else {
            $$('.spanFotoSemuaKunjunganAda').remove();
            $$('.spanFotoKunjungan').html(`
                <div class="card">
                <div class="card-header row" style="background-color:#2196F3;color:white">
                
                


                <a href="#" onClick="ambilFotoKunjungan('1')" class="ambilFotoKunjungan col padding5">
                <i class="fa fa-camera  middleWhite"> </i>
                </a>


                <a href="#" onClick="ambilFotoGallery('1')" class="ambilFotoGallery col padding5">
                <i class="far fa-image  middleWhite"> </i>
                </a>

                </div>
                <div class="card-content card-content-padding">
                <img id="foto-kunjungan-1" name="fotoKunjunganUpload" class="1" height="150" width="100%">
                </div>
                </div>`);
        }
    }, function(xhr,status){
        PreloaderHide(status);
    });

    $$('.btnEditRencanaKirimanCollector').on('click',function(){
        myApp.preloader.show();
        var KETERANGAN = $$('.editKeteranganRencanaKirimanCollector').val();
        var fotoKunjungan = [];
        var namaFotoKunjungan = [];
        $$('img[name^="fotoKunjunganUpload"]').each(function() {
            if($$(this).attr("src") !=null){
                fotoKunjungan.push($$(this).attr("src"));
                namaFotoKunjungan.push(this.className);
            }
        });

        console.log(KETERANGAN);
        var act = "EDIT_RENCANA_KIRIMAN_COLLECTOR";
        myApp.request.post(ipTujuan,{case:act,USERID:USERID,KETERANGAN:KETERANGAN,namaFotoKunjungan:namaFotoKunjungan,
            NAMAGAMBAR:gambarHapus,NOMORBUKTI:tampungEditNomorBuktiRencanaKirimanCollector},function(data){
                var hasil_json = JSON.parse(data);
                if(namaFotoKunjungan.length>0 ){
                    for(var i =0; i<fotoKunjungan.length;i++){
                       var toko = new FileUploadOptions();
                       toko.fileKey = "photo";
                       toko.fileName = fotoKunjungan[i].substr(fotoKunjungan[i].lastIndexOf('/') + 1);
                       toko.mimeType = "image/jpeg";
                       toko.chunkedMode = false;
                       toko.headers = {
                          Connection: "close"
                      };
                      toko.params = {
                        namaFile:tampungEditNomorBuktiRencanaKirimanCollector +'-'+namaFotoKunjungan[i]
                    }
                    var ft = new FileTransfer();
                    ft.upload(fotoKunjungan[i], 
                      encodeURI(ipUploadRencanaKunjungan),
                      win,
                      fail,
                      toko);

                    var win = function(r) {
                        console.log("Should not be called.");
                    }

                    var fail = function(error) {
                        myApp.dialog.alert("eror :" +error.code);
                        alert("An error has occurred: Code = " + error.code);
                        console.log("upload error source " + error.source);
                        console.log("upload error target " + error.target);
                    }
                }
                myApp.preloader.hide();
                myApp.dialog.alert("Berhasil Mengedit");
            //mainView.router.navigate("/hasil_laporan_rencana_kiriman_collector/");
            mainView.router.back("/hasil_laporan_rencana_kiriman_collector/",{force:true});
        } else {
            myApp.preloader.hide();
            myApp.dialog.alert("Berhasil Mengedit");
            //mainView.router.navigate("/hasil_laporan_rencana_kiriman_collector/");
            mainView.router.back("/hasil_laporan_rencana_kiriman_collector/",{force:true});
        }
    });
    });
});

//hasil_laporan_rencana_kiriman_collector
$$(document).on('page:init', '.page[data-name="hasil_laporan_rencana_kiriman_collector"]', function (page) {
    var act = "TAMPIL_HASIL_LAPORAN_RENCANA_KIRIMAN_COLLECTOR";
    myApp.request.post(ipTujuan,{case:act,KODESALESMANDARI:tampungDariSalesmanKirimanCollector,KODESALESMANSAMPAI:tampungSampaiSalesmanKirimanCollector,
        TANGGALDARI:tampungDariTanggalKirimanCollector,TANGGALSAMPAI:tampungSampaiTanggalKirimanCollector,HALAMAN:halamanGlobal},function(data){
            var hasil_json = JSON.parse(data);
            
            if(hasil_json.hasil == "ada"){
                var tampungHalamanLaporanKunjunganFilter = `<div class="row">
                <div class="col-100" style="text-align: center"><span style="font-size:1.2em" class="badge color-red"><b>Jumlah Rencana : `+hasil_json.TOTJUMLAH+`</b></span></div>
                </div>`;
                for(var i = 0; i<hasil_json.NOMORBUKTI.length; i++){
                    var today = new Date(hasil_json.DATETRANSACTION[i]);
                    var day = today.getDate();
                    var monthIndex = today.getMonth();
                    var year = today.getFullYear();

                    tampungHalamanLaporanKunjunganFilter+=`

                    <div class="card">
                    <div class ="card-header cardHeaderBiru">`+hasil_json.NOMORBUKTI[i];

                    if(!userHakAksesArrayGlobal["laporanRencanaKiriman"]){

                    } else {
                        if(userHakAksesArrayGlobal['laporanRencanaKiriman']['UBAH'] == "T" && halamanGlobal == "LAPORAN_RENCANA_KIRIMAN" && hasil_json.STATUS[i] == "OPEN"){
                            tampungHalamanLaporanKunjunganFilter+=`
                            <a href="#" style="color:white" class="link right" onClick="editRencanaKirimanCollector('`+hasil_json.NOMORBUKTI[i]+`')">
                            <i class="fas fa-edit"></i>
                            </a>`;
                        }
                    }

                    if(!userHakAksesArrayGlobal["laporanRencanaCollector"]){

                    } else {
                        if(userHakAksesArrayGlobal['laporanRencanaCollector']['UBAH'] == "T" && halamanGlobal == "LAPORAN_RENCANA_COLLECTOR" && hasil_json.STATUS[i] == "OPEN"){
                            tampungHalamanLaporanKunjunganFilter+=`
                            <a href="#" style="color:white" class="link right" onClick="editRencanaKirimanCollector('`+hasil_json.NOMORBUKTI[i]+`')">
                            <i class="fas fa-edit"></i>
                            </a>`;
                        } 
                    }

                    tampungHalamanLaporanKunjunganFilter+=`</div>
                    <div class="card-content card-content-padding">
                    

                    <div class="row">
                    <div class="col-45 cardContentDetail" >Tanggal Rencana</div>
                    <div class="col-5 boldHitam"> : </div>
                    <div class="col-50 cardContentHasilDetail ">${ConvertDateTimeToText(hasil_json.DATETRANSACTION[i],'dateday')}</div>
                    </div>


                    <div class="row">
                    <div class="col-45 cardContentDetail" >Driver </div>
                    <div class="col-5 boldHitam"> : </div>
                    <div class="col-50 cardContentHasilDetail ">`+hasil_json.NAMAKARYAWANDRIVER[i]+`</div>
                    </div>

                    <div class="row">
                    <div class="col-45 cardContentDetail" >User ID </div>
                    <div class="col-5 boldHitam"> : </div>
                    <div class="col-50 cardContentHasilDetail ">`+hasil_json.NAMAKARYAWANUSERID[i]+`</div>
                    </div>

                    

                    <div class="row">
                    <div class="col-45 cardContentDetail" >Pelanggan</div>
                    <div class="col-5 boldHitam"> : </div>
                    <div class="col-50 cardContentHasilDetail ">`+hasil_json.NAMAPELANGGAN[i]+`</div>
                    </div>

                    
                    
                    <div class="row">
                    <div class="col-45 cardContentDetail" >Keterangan</div>
                    <div class="col-5 boldHitam"> : </div>
                    <div class="col-50 cardContentHasilDetail ">`;
                    if(hasil_json.KETERANGAN[i]){
                        tampungHalamanLaporanKunjunganFilter += hasil_json.KETERANGAN[i];
                    } else {
                        tampungHalamanLaporanKunjunganFilter +='-';
                    }
                    tampungHalamanLaporanKunjunganFilter+=`</div>
                    </div>


                    <div class="row">
                    <div class="col-45 cardContentDetail" >Permintaan Khusus</div>
                    <div class="col-5 boldHitam"> : </div>
                    <div class="col-50 cardContentHasilDetail ">`;
                    if(hasil_json.NAMAPERMINTAAN[i]){
                        tampungHalamanLaporanKunjunganFilter += hasil_json.NAMAPERMINTAAN[i];
                    } else {
                        tampungHalamanLaporanKunjunganFilter +='-';
                    }
                    tampungHalamanLaporanKunjunganFilter+=`</div>
                    </div>`

                    if(hasil_json.hasilgambar == "ada"){
                        counter = 0;
                        for(var j =0; j<hasil_json.COUNTERGAMBAR.length; j++){
                            if(hasil_json.COUNTERGAMBAR[j] == hasil_json.NOMORBUKTI[i]){
                                tampungHalamanLaporanKunjunganFilter +=`
                                <a href ="#" onClick="zoomInOutGambarRencanaKunjungan('${hasil_json.NOMORBUKTI[i]}','`+counter+`')">
                                <img src="`+ipGambarRencanaKunjungan+hasil_json.NAMAGAMBAR[j]+`.jpg?`+ new Date().getTime()+`" height="45px" width="45px">
                                </a>
                                `;
                                counter++;
                            } 
                        }
                    }

                    
                    tampungHalamanLaporanKunjunganFilter+=`</div>
                    </div>`;
                }
                $$('.semuaTampilLaporanRencanaKirimanCollector').html(tampungHalamanLaporanKunjunganFilter);

            } else {
                $$('.semuaTampilLaporanRencanaKirimanCollector').html("Tidak Ada Laporan");
            }
            myApp.preloader.hide();

        },function(xhr,status){
            PreloaderHide(status);
        });

$$('.editPostingHapusHasilLaporanRencanaKirimanCollector').on('click',function(){
    mainView.router.navigate("/halaman_posting_hapus_semua/");
});
});

//halaman_posting_hapus_ban
$$(document).on('page:init', '.page[data-name="halaman_posting_hapus_ban"]', function (page) {
    if(userHakAksesArrayGlobal['pemasanganBan']['POSTING'] == "F" && halamanGlobal == "PEMASANGAN_BAN"){
        $$('.btnPostingBan').remove();
    }

    if(userHakAksesArrayGlobal['pemasanganBan']['HAPUS'] == "F" && halamanGlobal == "PEMASANGAN_BAN"){
        $$('.btnHapusBan').remove();
    }

    var act = "TAMPIL_POSTING_HAPUS_BAN";
    myApp.request.post(ipTujuan,{case:act,HALAMAN:halamanGlobal,TANGGAL:tampungTanggalPemasanganBan},function(data){
        var hasil_json = JSON.parse(data);
        var tampungPostingHapus = "";
        if(hasil_json.hasil == "ada"){
            tampungPostingHapus +=`<div class="list">
            <ul>`;

            for(var i = 0; i<hasil_json.NOMORBUKTI.length; i++){
                tampungPostingHapus +=
                `<li>
                <label class="item-checkbox item-content">
                <input type="checkbox" name="postingHapusValue[]" value="`+hasil_json.NOMORBUKTI[i]+`"/>
                <i class="icon icon-checkbox"></i>
                <div class="item-inner">
                <div class="item-title">${hasil_json.NOMORPLAT[i]}</div>

                </div>
                </label>
                </li>`;
            }

            tampungPostingHapus +=`</ul>
            </div>
            `;
        } else {
            tampungPostingHapus += "TIDAK ADA";
        }

        $$('.tampilPostingHapus').html(tampungPostingHapus);
    });

    $$('.btnPostingTerpilih').on('click',function(){
        myApp.preloader.show();
        var postingHapusValue = [];
        $$('input[name^="postingHapusValue"]').each(function() {
            if($$(this).prop("checked")){
                postingHapusValue.push($$(this).val());
            }
        });

        if(postingHapusValue.length!=0){
            var act = "POSTING_BAN_TERPILIH";
            myApp.request.post(ipTujuan,{case:act,postingHapusValue:postingHapusValue,USERID:USERID,HALAMAN:halamanGlobal},function(data){
                myApp.dialog.alert("Sudah Berhasil Diposting");
                mainView.router.back("/master_pemasangan_ban_per_tanggal/",{force:true});
            });
        } else {
            myApp.dialog.alert("Pilih Terlebih Dahulu");
            myApp.preloader.hide();
        }
    });

    $$('.btnHapusTerpilih').on('click',function(){
        myApp.preloader.show();
        var postingHapusValue = [];
        $$('input[name^="postingHapusValue"]').each(function() {
            if($$(this).prop("checked")){
                postingHapusValue.push($$(this).val());
            }
        });

        if(postingHapusValue.length!=0){
            var act = "HAPUS_BAN_TERPILIH";
            myApp.request.post(ipTujuan,{case:act,postingHapusValue:postingHapusValue,USERID:USERID,HALAMAN:halamanGlobal},function(data){
                myApp.dialog.alert("Sudah Berhasil Dihapus");
                mainView.router.back("/master_pemasangan_ban_per_tanggal/",{force:true});
            });
        } else {
            myApp.dialog.alert("Pilih Terlebih Dahulu");
            myApp.preloader.hide();
        }
    });
});

//halaman_posting_hapus_semua
$$(document).on('page:init', '.page[data-name="halaman_posting_hapus_semua"]', function (page) {
    if(userHakAksesArrayGlobal['laporanRencanaKiriman']['POSTING'] == "F" && halamanGlobal == "LAPORAN_RENCANA_KIRIMAN"){
        $$('.btnPostingTerpilih').remove();
    }

    if(userHakAksesArrayGlobal['laporanRencanaKiriman']['HAPUS'] == "F" && halamanGlobal == "LAPORAN_RENCANA_KIRIMAN"){
        $$('.btnHapusTerpilih').remove();
    }

    if(userHakAksesArrayGlobal['laporanRencanaCollector']['POSTING'] == "F" && halamanGlobal == "LAPORAN_RENCANA_COLLECTOR"){
        $$('.btnPostingTerpilih').remove();
    }

    if(userHakAksesArrayGlobal['laporanRencanaCollector']['HAPUS'] == "F" && halamanGlobal == "LAPORAN_RENCANA_COLLECTOR"){
        $$('.btnHapusTerpilih').remove();
    }

    var act = "TAMPIL_POSTING_HAPUS_SEMUA";
    myApp.request.post(ipTujuan,{case:act,KODESALESMANDARI:tampungDariSalesmanKirimanCollector,KODESALESMANSAMPAI:tampungSampaiSalesmanKirimanCollector,
        TANGGALDARI:tampungDariTanggalKirimanCollector,TANGGALSAMPAI:tampungSampaiTanggalKirimanCollector,HALAMAN:halamanGlobal},function(data){
            var hasil_json = JSON.parse(data);
            var tampungPostingHapus = "";
            if(hasil_json.hasil == "ada"){
                tampungPostingHapus +=`<div class="list">
                <ul>`;

                for(var i = 0; i<hasil_json.NOMORBUKTI.length; i++){
                    tampungPostingHapus +=
                    `<li>
                    <label class="item-checkbox item-content">
                    <input type="checkbox" name="postingHapusValue[]" value="`+hasil_json.NOMORBUKTI[i]+`"/>
                    <i class="icon icon-checkbox"></i>
                    <div class="item-inner">
                    <div class="item-title"><u>`+hasil_json.NOMORBUKTI[i]+`</u><br><span class="boldHitam">`+hasil_json.NAMAPELANGGAN[i]+`</span><br> `+hasil_json.NAMAKARYAWANDRIVER[i]+`</div>

                    </div>
                    </label>
                    </li>`;
                }

                tampungPostingHapus +=`</ul>
                </div>
                `;
            } else {
                tampungPostingHapus += "TIDAK ADA";
            }

            $$('.tampilPostingHapus').html(tampungPostingHapus);
        });

    $$('.btnPostingTerpilih').on('click',function(){
        myApp.preloader.show();
        var postingHapusValue = [];
        $$('input[name^="postingHapusValue"]').each(function() {
            if($$(this).prop("checked")){
                postingHapusValue.push($$(this).val());
            }
        });

        if(postingHapusValue.length!=0){
            var act = "POSTING_TERPILIH_SEMUA";
            myApp.request.post(ipTujuan,{case:act,postingHapusValue:postingHapusValue,USERID:USERID,HALAMAN:halamanGlobal},function(data){
                myApp.dialog.alert("Sudah Berhasil Diposting");

                if(halamanGlobal == "LAPORAN_RENCANA_KIRIMAN" || halamanGlobal == "LAPORAN_RENCANA_COLLECTOR"){
                    //mainView.router.navigate("/hasil_laporan_rencana_kiriman_collector/");
                    mainView.router.back("/hasil_laporan_rencana_kiriman_collector/",{force:true});
                }
            });
        } else {
            myApp.dialog.alert("Pilih Terlebih Dahulu");
            myApp.preloader.hide();
        }
    });

    $$('.btnHapusTerpilih').on('click',function(){
        myApp.preloader.show();
        var postingHapusValue = [];
        $$('input[name^="postingHapusValue"]').each(function() {
            if($$(this).prop("checked")){
                postingHapusValue.push($$(this).val());
            }
        });

        if(postingHapusValue.length!=0){
            var act = "HAPUS_TERPILIH_SEMUA";
            myApp.request.post(ipTujuan,{case:act,postingHapusValue:postingHapusValue,USERID:USERID,HALAMAN:halamanGlobal},function(data){
                myApp.dialog.alert("Sudah Berhasil Dihapus");
                if(halamanGlobal == "LAPORAN_RENCANA_KIRIMAN" || halamanGlobal == "LAPORAN_RENCANA_COLLECTOR"){
                    mainView.router.back("/hasil_laporan_rencana_kiriman_collector/",{force:true});
                    //mainView.router.navigate("/hasil_laporan_rencana_kiriman_collector/");
                }
            });
        } else {
            myApp.dialog.alert("Pilih Terlebih Dahulu");
            myApp.preloader.hide();
        }
    });
});


//halaman_posting_hapus_kiriman_collector
$$(document).on('page:init', '.page[data-name="halaman_posting_hapus_kiriman_collector"]', function (page) {
    if(userHakAksesArrayGlobal['laporanKiriman']['POSTING'] == "F" && halamanGlobal == "LAPORAN_KIRIMAN"){
        $$('.btnPostingTerpilih').remove();
    }

    if(userHakAksesArrayGlobal['laporanKiriman']['HAPUS'] == "F" && halamanGlobal == "LAPORAN_KIRIMAN"){
        $$('.btnHapusTerpilih').remove();
    }

    if(userHakAksesArrayGlobal['laporanCollector']['POSTING'] == "F" && halamanGlobal == "LAPORAN_COLLECTOR"){
        $$('.btnPostingTerpilih').remove();
    }

    if(userHakAksesArrayGlobal['laporanCollector']['HAPUS'] == "F" && halamanGlobal == "LAPORAN_COLLECTOR"){
        $$('.btnHapusTerpilih').remove();
    }

    var act = "TAMPIL_POSTING_HAPUS_KIRIMAN_COLLECTOR";
    myApp.request.post(ipTujuan,{case:act,KODESALESMANDARI:tampungDariSalesmanKirimanCollector,KODESALESMANSAMPAI:tampungSampaiSalesmanKirimanCollector,
        TANGGALDARI:tampungDariTanggalKirimanCollector,TANGGALSAMPAI:tampungSampaiTanggalKirimanCollector,HALAMAN:halamanGlobal},function(data){
            var hasil_json = JSON.parse(data);
            var tampungPostingHapus = "";
            if(hasil_json.hasil == "ada"){
                tampungPostingHapus +=`<div class="list">
                <ul>`;

                for(var i = 0; i<hasil_json.NOMORBUKTI.length; i++){
                    tampungPostingHapus +=
                    `<li>
                    <label class="item-checkbox item-content">
                    <input type="checkbox" name="postingHapusValue[]" value="`+hasil_json.NOMORBUKTI[i]+`"/>
                    <i class="icon icon-checkbox"></i>
                    <div class="item-inner">
                    <div class="item-title"><u>`+hasil_json.NOMORBUKTI[i]+`</u><br><span class="boldHitam">`+hasil_json.NAMAPELANGGAN[i]+`</span><br> `+hasil_json.NAMAKARYAWANDRIVER[i]+`</div>

                    </div>
                    </label>
                    </li>`;
                }

                tampungPostingHapus +=`</ul>
                </div>
                `;
            } else {
                tampungPostingHapus += "TIDAK ADA";
            }

            $$('.tampilPostingHapus').html(tampungPostingHapus);
        });

    $$('.btnPostingTerpilih').on('click',function(){
        myApp.preloader.show();
        var postingHapusValue = [];
        $$('input[name^="postingHapusValue"]').each(function() {
            if($$(this).prop("checked")){
                postingHapusValue.push($$(this).val());
            }
        });

        if(postingHapusValue.length!=0){
            var act = "POSTING_TERPILIH_SEMUA";
            myApp.request.post(ipTujuan,{case:act,postingHapusValue:postingHapusValue,USERID:USERID,HALAMAN:halamanGlobal},function(data){
                myApp.dialog.alert("Sudah Berhasil Diposting");

                if(halamanGlobal == "LAPORAN_KIRIMAN" || halamanGlobal == "LAPORAN_COLLECTOR"){
                    //mainView.router.navigate("/hasil_laporan_kiriman_collector/");
                    mainView.router.back("/hasil_laporan_kiriman_collector/",{force:true});
                }
            });
        } else {
            myApp.dialog.alert("Pilih Terlebih Dahulu");
            myApp.preloader.hide();
        }
    });

    $$('.btnHapusTerpilih').on('click',function(){
        myApp.preloader.show();
        var postingHapusValue = [];
        $$('input[name^="postingHapusValue"]').each(function() {
            if($$(this).prop("checked")){
                postingHapusValue.push($$(this).val());
            }
        });

        if(postingHapusValue.length!=0){
            var act = "HAPUS_TERPILIH_SEMUA";
            myApp.request.post(ipTujuan,{case:act,postingHapusValue:postingHapusValue,USERID:USERID,HALAMAN:halamanGlobal},function(data){
                myApp.dialog.alert("Sudah Berhasil Dihapus");
                if(halamanGlobal == "LAPORAN_KIRIMAN" || halamanGlobal == "LAPORAN_COLLECTOR"){
                    //mainView.router.navigate("/hasil_laporan_kiriman_collector/");
                    mainView.router.back("/hasil_laporan_kiriman_collector/",{force:true});
                }
            });
        } else {
            myApp.dialog.alert("Pilih Terlebih Dahulu");
            myApp.preloader.hide();
        }
    });
});

//update_gps_pelanggan
$$(document).on('page:init', '.page[data-name="update_gps_pelanggan"]', function (page) {
    var items = [];
    var act = "TAMPIL_MASTER_PELANGGAN_TANPA_PENGECUALIAN";
    var semuaTampilMasterLaporanPelanggan = "";

    myApp.request.post(ipTujuan,{case:act,KODECABANG:KODECABANG,USERID:USERID,KODEJABATAN:KODEJABATAN},function(data){
        var hasil_json = JSON.parse(data);
        if(hasil_json.hasil == "ada"){

            for (var i = 0; i < hasil_json.KODEPELANGGAN.length; i++) {
              items.push({
                KODEPELANGGAN: hasil_json.KODEPELANGGAN[i],
                NAMA: hasil_json.NAMA[i],
                ALAMAT:hasil_json.ALAMAT[i],
                KOTA:hasil_json.KOTA[i],
                TELPON:hasil_json.TELPON[i],
                FAX:hasil_json.FAX[i],
                KREDITLIMIT:hasil_json.KREDITLIMIT[i],
                SYARATPIUTANG:hasil_json.SYARATPIUTANG[i],
                SYARATPIUTANGMAX:hasil_json.SYARATPIUTANGMAX[i],
                USERID: hasil_json.USERID[i],
                TERM:hasil_json.TERM[i],
                KATEGORIPELANGGAN:hasil_json.KATEGORIPELANGGAN[i],
                ALAMATKIRIM:hasil_json.ALAMATKIRIM[i]
            });
          }
          var virtualList = myApp.virtualList.create({
              el: '.virtual-list',
              items: items,
              searchAll: function (query, items) {
                var found = [];
                for (var i = 0; i < items.length; i++) {
                  if ( items[i].USERID.toLowerCase().indexOf(query.toLowerCase()) >= 0 || items[i].NAMA.toLowerCase().indexOf(query.toLowerCase()) >= 0 || query.trim() === '' ) found.push(i);
              }
              return found; 
          },
          itemTemplate:
          `<li>
          <a href="#" class="item-link item-content" onClick="UpdateGps('{{KODEPELANGGAN}}')">
          <div class="item-inner">
          <div class="item-title-row">
          <div class="item-text namaTokoSearch" style="color:black"><b>{{NAMA}}</b></div>
          </div>
          <div class="item-text" style="color:black">{{ALAMAT}}</div>        
          </div>
          </a>
          </li>`,
          height: myApp.theme === 'ios' ? 63 : 73,
      });
      } else {
        $$('.virtual-list').html("Belum Memiliki Daftar Pelanggan");
    }
    myApp.preloader.hide();
});
});


//detail_update_gps_pelanggan
$$(document).on('page:init', '.page[data-name="detail_update_gps_pelanggan"]', function (page) {
    var act = "TAMPIL_KUNJUNGAN_UPDATE_GPS_PELANGGAN";
    myApp.request.post(ipTujuan,{case:act,KODEPELANGGAN:tampungKodePelangganUpdateGps},function(data){
        var hasil_json = JSON.parse(data);
        var tampungHasilPemetaan = "";

        if(hasil_json.hasil == "ada"){
            $$('.titleUpdateGpsPelangganDetail').html(hasil_json.NAMA[0]);
            map = new google.maps.Map(document.getElementById('map'), {
                center: {lat: parseFloat(hasil_json.LATITUDE[0]), lng:parseFloat(hasil_json.LONGITUDE[0])},
                zoom: 10,
            });
            contentString = hasil_json.NAMA[0];
            addMarkerWithInfowindow(map, new google.maps.LatLng(parseFloat(hasil_json.LATITUDEPELANGGAN),parseFloat(hasil_json.LONGITUDEPELANGGAN)), contentString,0);
            tampungHasilPemetaan +=`
            <div class="row" style="text-align:center;font-size:1.2em">`+hasil_json.ALAMAT[0]+`</div>`;
            for(var i = 0; i<hasil_json.NOMORBUKTI.length;i++){
                tampungHasilPemetaan+=`<div class="card">
                <div class ="card-header cardHeaderBiru">`+(i+1)+` - ${hasil_json.NOMORBUKTI[i]}</div>
                <div class="card-content card-content-padding">


                <div class="row">
                <div class="col-45 cardContentDetail" >Berkunjung</div>
                <div class="col-5 boldHitam"> : </div>
                <div class="col-50 cardContentHasilDetail ">${hasil_json.KODESALESMAN[i]}</div>
                </div>
                
                <div class="row">
                <div class="col-45 cardContentDetail" >Waktu Kunjungan</div>
                <div class="col-5 boldHitam"> : </div>
                <div class="col-50 cardContentHasilDetail ">${hasil_json.DATETRANSACTION[i]}</div>
                </div>

                <div class="row">
                <div class="col-45 cardContentDetail" >LATITUDE</div>
                <div class="col-5 boldHitam"> : </div>
                <div class="col-50 cardContentHasilDetail ">${hasil_json.LATITUDE[i]}</div>
                </div>

                <div class="row">
                <div class="col-45 cardContentDetail" >LONGITUDE</div>
                <div class="col-5 boldHitam"> : </div>
                <div class="col-50 cardContentHasilDetail ">${hasil_json.LONGITUDE[i]}</div>
                </div>


                <button class="col button button-fill color-orange" onClick="ubahGpsPelanggan('`+tampungKodePelangganUpdateGps+`','`+hasil_json.NOMORBUKTI[i]+`',
                '`+hasil_json.LATITUDE[i]+`','`+hasil_json.LONGITUDE[i]+`')">Ubah Koordinat</button>

                </div>
                </div>`;

                var contentString = hasil_json.KODESALESMAN[i];
                addMarkerWithInfowindow(map, new google.maps.LatLng(parseFloat(hasil_json.LATITUDE[i]),parseFloat(hasil_json.LONGITUDE[i])), contentString,i+1);
            }

            $$('.semuaTampilDetailLaporanPelanggan').append(tampungHasilPemetaan);
        } else {
            $$('.semuaTampilDetailLaporanPelanggan').html("Belum Ada Kunjungan");
        }
        myApp.preloader.hide();
    });
});


var KODESALESMANDARIPELANGGAN;
var KODESALESMANSAMPAIPELANGGAN;
//pemetaan_pelanggan
$$(document).on('page:init', '.page[data-name="pemetaan_pelanggan"]', function (page) {
    var searchbar3 = myApp.searchbar.create({
        el: '.searchKaryawanDari',
        searchContainer: '.listPopUpNamaKaryawanDari',
        searchIn: '.namaKaryawanDari',
        on: {
            search(sb, query, previousQuery) {
                console.log(query, previousQuery);
            }
        }
    });

    var searchbar4 = myApp.searchbar.create({
        el: '.searchKaryawanSampai',
        searchContainer: '.listPopUpNamaKaryawanSampai',
        searchIn: '.namaKaryawanSampai',
        on: {
            search(sb, query, previousQuery) {
                console.log(query, previousQuery);
            }
        }
    });

    var act ="TAMPIL_NAMA_KARYAWAN";
    myApp.request.post(ipTujuan,{case:act,USERID:USERID},function(data){
        $$('.namaDariSalesmanLaporan').val(data);
        $$('.namaSampaiSalesmanLaporan').val(data);
        $$('.kodeDariSalesmanLaporan').val(USERID);
        $$('.kodeSampaiSalesmanLaporan').val(USERID);
    });


    //myApp.preloader.hide();
    var calendarModal = myApp.calendar.create({
        inputEl: '#dariTanggalLaporanPerStaff',
        openIn: 'customModal',
        header: true,
        footer: true,
        dateFormat: 'MM dd yyyy',
    });

    var calendarModal = myApp.calendar.create({
        inputEl: '#sampaiTanggalLaporanPerStaff',
        openIn: 'customModal',
        header: true,
        footer: true,
        dateFormat: 'MM dd yyyy',
    });

    PopupLaporanKaryawanPerTanggalDari(KODEJABATAN,USERID);
    PopupLaporanKaryawanPerTanggalSampai(KODEJABATAN,USERID);

    

    $$('.popup-open-karyawanDari').on('click',function(){
        myApp.popup.open('.popup-karyawanDari'); 
    });

    $$('.popup-open-karyawanSampai').on('click',function(){
        myApp.popup.open('.popup-karyawanSampai');
    });

    $$('.btnCancel').on('click',function(){
        myApp.popup.close('.popup-karyawanDari');
        myApp.popup.close('.popup-karyawanSampai');
    });

    $$('.btnSelanjutnyaPemetaanPelanggan').on('click',function(){
        myApp.preloader.show();
        KODESALESMANDARIPELANGGAN = $$('.kodeDariSalesmanLaporan').val();
        KODESALESMANSAMPAIPELANGGAN = $$('.kodeSampaiSalesmanLaporan').val();

        if(!KODESALESMANDARIPELANGGAN){
            alertKosong("Dari Staff");
        } else if(!KODESALESMANSAMPAIPELANGGAN){
            alertKosong("Sampai Staff");
        } else {
            mainView.router.navigate("/pemetaan_pelanggan_2/");
        }
    });
});

var KODEPELANGGANDARI;
var KODEPELANGGANSAMPAI;
var TANGGALPEMETAANDARI;
var TANGGALPEMETAANSAMPAI;
//pemetaan_pelanggan_2
$$(document).on('page:init', '.page[data-name="pemetaan_pelanggan_2"]', function (page) {
    var calendarModal = myApp.calendar.create({
        inputEl: '#dariTanggal',
        openIn: 'customModal',
        header: true,
        footer: true,
        dateFormat: 'MM dd yyyy',
    });

    var calendarModal = myApp.calendar.create({
        inputEl: '#sampaiTanggal',
        openIn: 'customModal',
        header: true,
        footer: true,
        dateFormat: 'MM dd yyyy',
    });

    var searchbar3 = myApp.searchbar.create({
        el: '.searchPelangganDari',
        searchContainer: '.listPopupPelangganDari',
        searchIn: '.namaKaryawanDari',
        on: {
            search(sb, query, previousQuery) {
                console.log(query, previousQuery);
            }
        }
    });

    var searchbar4 = myApp.searchbar.create({
        el: '.searchPelangganSampai',
        searchContainer: '.listPopupPelangganSampai',
        searchIn: '.namaKaryawanSampai',
        on: {
            search(sb, query, previousQuery) {
                console.log(query, previousQuery);
            }
        }
    });


    var act ="TAMPIL_POPUP_PELANGGAN_BERDASARKAN_KARYAWAN";
    myApp.request.post(ipTujuan,{case:act,KODEKARYAWANDARI:KODESALESMANDARIPELANGGAN,KODEKARYAWANSAMPAI:KODESALESMANSAMPAIPELANGGAN},function(data){
        var hasil_json = JSON.parse(data);
        var tampungPopupPelanggan ="Tidak Memiliki Pelanggan";
        if(hasil_json.hasil == "ada"){
            tampungPopupPelanggan = "";
            for(var i = 0; i<hasil_json.KODEPELANGGAN.length;i++){
                tampungPopupPelanggan += `<li>
                <a href="#" class="item-link item-content cobaKlik" onClick="pilihPelangganDari('`+hasil_json.KODEPELANGGAN[i]+`','`+hasil_json.NAMA[i]+`')">
                <div class="item-inner">
                <div class="item-text namaKaryawanDari" style="color:black">`+hasil_json.NAMA[i]+`</div>
                </div>
                </a>
                </li>`;
            }
            $$('.listPopupPelangganDari').html(tampungPopupPelanggan);
        } else {
            $$('.listPopupPelangganDari').html(tampungPopupPelanggan);
        }
        myApp.preloader.hide();
    });


    var act ="TAMPIL_POPUP_PELANGGAN_BERDASARKAN_KARYAWAN";
    myApp.request.post(ipTujuan,{case:act,KODEKARYAWANDARI:KODESALESMANDARIPELANGGAN,KODEKARYAWANSAMPAI:KODESALESMANSAMPAIPELANGGAN},function(data){
        var hasil_json = JSON.parse(data);
        var tampungPopupPelanggan ="Tidak Memiliki Pelanggan";
        if(hasil_json.hasil == "ada"){
            tampungPopupPelanggan = "";
            for(var i = 0; i<hasil_json.KODEPELANGGAN.length;i++){
                tampungPopupPelanggan += `<li>
                <a href="#" class="item-link item-content cobaKlik" onClick="pilihPelangganSampai('`+hasil_json.KODEPELANGGAN[i]+`','`+hasil_json.NAMA[i]+`')">
                <div class="item-inner">
                <div class="item-text namaKaryawanDari" style="color:black">`+hasil_json.NAMA[i]+`</div>
                </div>
                </a>
                </li>`;
            }
            $$('.listPopupPelangganSampai').html(tampungPopupPelanggan);
        } else {
            $$('.listPopupPelangganSampai').html(tampungPopupPelanggan);
        }
        myApp.preloader.hide();
    });

    $$('.popup-open-pelangganDari').on('click',function(){
        myApp.popup.open('.popup-pelangganDari'); 
    });

    $$('.popup-open-pelangganSampai').on('click',function(){
        myApp.popup.open('.popup-pelangganSampai');
    });

    $$('.btnCancel').on('click',function(){
        myApp.popup.close('.popup-pelangganDari');
        myApp.popup.close('.popup-pelangganSampai');
    });

    $$('.btnLihatPemetaanSemua').on('click',function(){
        myApp.preloader.show();
        KODEPELANGGANDARI = $$('.kodeDariPelanggan').val();
        KODEPELANGGANSAMPAI = $$('.kodeSampaiPelanggan').val();
        TANGGALPEMETAANDARI = $$('#dariTanggal').val();
        TANGGALPEMETAANSAMPAI = $$('#sampaiTanggal').val();

        mainView.router.navigate("/detail_pemetaan/");
        
    });
});

//detail_pemetaan
$$(document).on('page:init', '.page[data-name="detail_pemetaan"]', function (page) {
    myApp.preloader.hide();
    var act = "TAMPIL_PEMETAAN_PELANGGAN";
    myApp.request.post(ipTujuan,{case:act,KODESALESMANDARI:KODESALESMANDARIPELANGGAN,KODESALESMANSAMPAI:KODESALESMANSAMPAIPELANGGAN,
        KODEPELANGGANDARI:KODEPELANGGANDARI,KODEPELANGGANSAMPAI:KODEPELANGGANSAMPAI,KODECABANG:KODECABANG,TANGGALPEMETAANDARI:TANGGALPEMETAANDARI,TANGGALPEMETAANSAMPAI:TANGGALPEMETAANSAMPAI},function(data){
            var hasil_json = JSON.parse(data);
            var tampungHasilPemetaan = "";
            var kunjungan = [];
            var jumlah = {};
            if(hasil_json.hasil == "ada"){
                map = new google.maps.Map(document.getElementById('map'), {
                    center: {lat: parseFloat(hasil_json.LATITUDE[0]), lng:parseFloat(hasil_json.LONGITUDE[0])},
                    zoom: 16,
                });

                /*var trafficLayer = new google.maps.TrafficLayer();
                trafficLayer.setMap(map);*/

                var tampungNama ="";
                var counter = 0;
                for(var i = 0; i<hasil_json.KODEPELANGGAN.length;i++){
                    kunjungan[i] = {
                        'USERID':hasil_json.USERID[i],
                        'STATUSKUNJUNGAN':hasil_json.STATUSKUNJUNGAN[i],
                        'JENIS':hasil_json.JENISKUNJUNGAN[i]
                    };
                    counter++;
                    var today = new Date(hasil_json.DATETRANSACTION[i]);
                    var day = today.getDate();
                    var monthIndex = today.getMonth();
                    var year = today.getFullYear();
                    var hours = today.getHours();
                    hours = ("0" + hours).slice(-2);
                    var minutes = today.getMinutes();
                    minutes = ("0" + minutes).slice(-2);
                    var seconds = today.getSeconds();
                    seconds = ("0" + seconds).slice(-2);
                    if(hasil_json.NAMA[i] != tampungNama){
                        tampungNama = hasil_json.NAMA[i];      
                    }


                    tampungHasilPemetaan+=`<div class="card">
                    <div class ="card-header cardHeaderBiru">`+counter+` - ${hasil_json.KODEPELANGGAN[i]}</div>
                    <div class="card-content card-content-padding">


                    <div class="row">
                    <div class="col-45 cardContentDetail" >Pelanggan</div>
                    <div class="col-5 boldHitam"> : </div>
                    <div class="col-50 cardContentHasilDetail ">${hasil_json.NAMA[i]}</div>
                    </div>

                    <div class="row">
                    <div class="col-45 cardContentDetail" >Jam Kunjung</div>
                    <div class="col-5 boldHitam"> : </div>
                    <div class="col-50 cardContentHasilDetail ">${day + ' ' + monthNames[monthIndex] + ' ' + year+ '<br>' +hours+':'+minutes+':'+seconds}</div>
                    </div>

                    <div class="row">
                    <div class="col-45 cardContentDetail" >Alamat</div>
                    <div class="col-5 boldHitam"> : </div>
                    <div class="col-50 cardContentHasilDetail ">${hasil_json.ALAMAT[i]}</div>
                    </div>

                    <div class="row">
                    <div class="col-45 cardContentDetail" >Salesman</div>
                    <div class="col-5 boldHitam"> : </div>
                    <div class="col-50 cardContentHasilDetail ">${hasil_json.USERID[i]}</div>
                    </div>

                    </div>
                    </div>`;

                    var gambar;
                    if(hasil_json.JENISKUNJUNGAN[i] == "kunjungan"){
                        if(hasil_json.STATUSKUNJUNGAN[i] == "DALAM"){
                            gambar = `${imgFolder}kunjungan_dalam.png?`+ new Date().getTime();
                        } else if(hasil_json.STATUSKUNJUNGAN[i] == "LUAR"){
                            gambar = `${imgFolder}kunjungan_luar.png?`+ new Date().getTime();
                        } else {
                            gambar = `${imgFolder}kunjungan.png?`+ new Date().getTime();
                        }
                    } else if(hasil_json.JENISKUNJUNGAN[i] == "kiriman"){
                        gambar = `${imgFolder}kiriman.png?`+ new Date().getTime();
                    } else if(hasil_json.JENISKUNJUNGAN[i] == "collector"){
                        gambar = `${imgFolder}collector.png?`+ new Date().getTime();
                    }
                    var contentString = `
                    ${hasil_json.NAMA[i]}<br>
                    ${day + ' ' + monthNames[monthIndex] + ' ' + year+ '<br>' +hours+':'+minutes+':'+seconds}<br>
                    ${hasil_json.USERID[i]}`;
                    addMarkerWithInfowindow(map, new google.maps.LatLng(parseFloat(hasil_json.LATITUDE[i]),parseFloat(hasil_json.LONGITUDE[i])), contentString,counter,gambar);
                }

                $$('.semuaTampilDetailPemetaan').append(tampungHasilPemetaan);
                var element = '';
                kunjungan.forEach(function(obj,x){
                    if(!jumlah[obj.USERID]){
                        jumlah[obj.USERID] = {
                            'kunjungan':0,
                            'kunjungan_dalam':0,
                            'kunjungan_luar':0,
                            'collector':0,
                            'kiriman':0
                        }
                    }

                    if(obj.JENIS == "kunjungan"){
                        if(obj.STATUSKUNJUNGAN == "LUAR"){
                            jumlah[obj.USERID].kunjungan_luar++;
                        } else if(obj.STATUSKUNJUNGAN == "DALAM"){
                            jumlah[obj.USERID].kunjungan_dalam++;
                        } else {
                            jumlah[obj.USERID].kunjungan++;
                        }
                    } else if(obj.JENIS == "kiriman"){
                        jumlah[obj.USERID].kiriman++;
                    } else if(obj.JENIS == "collector"){
                        jumlah[obj.USERID].collector++;
                    }

                })

                var element = ``;
                for(var key in jumlah) {
                    element +=
                    `<div class="card col-90 desktop-50 tablet-50 align-self-center" style="margin:0 auto;margin-bottom:15px">
                    <div class="card-content card-content-padding text-align-center" >
                    <span style="font-size:1.5em;font-weight:bold">${key}
                    </span><br>
                    <span style="font-size:1.5em;font-weight:bold">${jumlah[key].kunjungan+jumlah[key].kunjungan_luar+jumlah[key].kunjungan_dalam+jumlah[key].kiriman+jumlah[key].collector}
                    </span>Total Kunjungan<br>
                    <span style="font-size:1.5em;font-weight:bold">${jumlah[key].kunjungan}
                    </span>Kunjungan <img width="25" height="25" src="${imgFolder}kunjungan.png?`+ new Date().getTime()+`"><br>
                    <span style="font-size:1.5em;font-weight:bold">${jumlah[key].kunjungan_dalam}
                    </span>Kunjungan Didalam <img width="25" height="25" src="${imgFolder}kunjungan_dalam.png?`+ new Date().getTime()+`"><br>
                    <span style="font-size:1.5em;font-weight:bold">${jumlah[key].kunjungan_luar}
                    </span>Kunjungan Diluar <img width="25" height="25" src="${imgFolder}kunjungan_luar.png?`+ new Date().getTime()+`"><br>
                    <span style="font-size:1.5em;font-weight:bold">${jumlah[key].kiriman}
                    </span>Kiriman <img width="25" height="25" src="${imgFolder}kiriman.png?`+ new Date().getTime()+`"><br>
                    <span style="font-size:1.5em;font-weight:bold">${jumlah[key].collector}
                    </span>Collector <img width="25" height="25" src="${imgFolder}collector.png?`+ new Date().getTime()+`"><br>
                    </div>
                    </div>`;
                }

                $$("#cardTampilPemetaanStaff").html(element);
            } else {
                $$('.semuaTampilDetailPemetaan').html("Belum Ada Lokasi GPS");
            }
        });
});

//detail_pemetaan_by_pelanggan
$$(document).on('page:init', '.page[data-name="detail_pemetaan_by_pelanggan"]', function (page) {
    myApp.preloader.hide();
    var params = {
        case:"PEMETAAN_BY_PELANGGAN",
        USERID:USERID,
        KODECABANG:KODECABANG,
        KODEJABATAN:KODEJABATAN
    }

    myApp.request.post(ipTujuan,params,
        function(data){
            var response = JSON.parse(data);
            if(response.hasil == "ada"){
                var element = `<div class="row">`
                var counter = 0;
                var jumlah = {};
                map = new google.maps.Map(document.getElementById('map'), {
                    center: {lat: parseFloat(response.KOORDINAT[0].LATITUDE), lng:parseFloat(response.KOORDINAT[0].LONGITUDE)},
                    zoom: 12,
                });
                var startcounter = 0;
                var endcounter = response.KOORDINAT.length -1;
                var gambar = `${imgFolder}flag_pelanggan.png?`+ new Date().getTime();
                AddMarkerPemetaanByPelangganLogo(response,map,startcounter,endcounter,gambar);
                response.KOORDINAT.forEach(function(obj,x){
                    /*jumlah[x] = {
                        'kategoripelanggan':obj.KATEGORIPELANGGAN
                    }*/
                    if(!jumlah[obj.KATEGORIPELANGGAN]){
                        jumlah[obj.KATEGORIPELANGGAN] = 0;
                    }
                    /*counter++;
                    var contentString = obj.NAMA;
                    addMarkerWithInfowindow(map, new google.maps.LatLng(parseFloat(obj.LATITUDE),parseFloat(obj.LONGITUDE)), contentString,counter);*/
                    element += `
                    <div class="col-100 desktop-25 tablet-33">
                    <div class="card">
                    <div class ="card-header cardHeaderBiru">${x+1} ${obj.KODEPELANGGAN}</div>
                    <div class="card-content card-content-padding">


                    

                    <div class="row">
                    <div class="col-45 cardContentDetail" >Nama</div>
                    <div class="col-5 boldHitam"> : </div>
                    <div class="col-50 cardContentHasilDetail namaJabatan">${obj.NAMA}</div>
                    </div>

                    <div class="row">
                    <div class="col-45 cardContentDetail" >Kota</div>
                    <div class="col-5 boldHitam"> : </div>
                    <div class="col-50 cardContentHasilDetail kodeJabatan">${obj.KOTA}</div>
                    </div>

                    <div class="row">
                    <div class="col-45 cardContentDetail" >Alamat</div>
                    <div class="col-5 boldHitam"> : </div>
                    <div class="col-50 cardContentHasilDetail kodeJabatan">${obj.ALAMAT}</div>
                    </div>

                    <div class="row">
                    <div class="col-45 cardContentDetail" >Kategori</div>
                    <div class="col-5 boldHitam"> : </div>
                    <div class="col-50 cardContentHasilDetail namaJabatan">${obj.KATEGORIPELANGGAN}</div>
                    </div>


                    <div class="row">
                    <div class="col-45 cardContentDetail" >Salesman</div>
                    <div class="col-5 boldHitam"> : </div>
                    <div class="col-50 cardContentHasilDetail namaJabatan">${obj.USERID}</div>
                    </div>


                    </div>
                    </div> 
                    </div>
                    `;
                    jumlah[obj.KATEGORIPELANGGAN]++;
                })
                element += `</div>`;

                
                $$(".semuaTampilDetailPemetaanByPelanggan").append(element);
                /*
                var jumlahTotal = 0;
                element = ``;
                for(var key in jumlah){
                    element += `<span style="font-size:1.5em;font-weight:bold">${jumlah[key]}</span>
                    ${key}<br>`;
                    jumlahTotal = jumlahTotal + jumlah[key];
                }
                element = `<span style="font-size:1.5em;font-weight:bold">${jumlahTotal}</span>
                Total Pelanggan<br>`;
                $$("#cardTampilPemetaanByPelanggan").prepend(element);
                */

                var jumlahTotal = [];
                jumlahTotal['total_pelanggan'] = 0;
                jumlahTotal['total_capel'] = 0;
                element = `<div class="container" id="containerKategoriPelanggan">
                <div class="row">`;
                for(var key in jumlah){
                    element += `<div class="col-33 tablet-20 desktop-20 rcorners" onClick="PemetaanPelangganVerifikasiByKategori('${key}')">
                    <div class="row justify-content-center" style="font-size:1.3em;font-weigt:bold"> 
                    ${jumlah[key]}
                    </div>
                    <div class="row justify-content-center text-align-center">
                    <span style="color:gray">${key}</span>
                    </div>
                    </div>`;
                    if(key.substring(0,5) == "CAPEL"){
                        jumlahTotal['total_capel'] = jumlahTotal['total_capel']+jumlah[key];

                    } else {
                        jumlahTotal['total_pelanggan'] = jumlahTotal['total_pelanggan']+jumlah[key];
                    }
                }
                element +=`</div>
                </div>`

                var element2 = `<div class="row" id="cardTampilPemetaanStaff" >
                <div class="card col-90 desktop-50 tablet-50 align-self-center" style="margin:0 auto;margin-bottom:15px">
                <div class="card-content card-content-padding text-align-center" >
                <span style="font-size:1.5em;font-weight:bold">${jumlahTotal['total_pelanggan']}
                </span>Pelanggan dan <span style="font-size:1.5em;font-weight:bold">${jumlahTotal['total_capel']}</span> Calon Pelanggan<br>
                </div>
                </div>

                </div>`;

                $$("#containerKategoriPelanggan").html(element2);
                $$("#containerKategoriPelanggan").append(element);

                console.log(response);

                element = `<div class="card col-90 desktop-50 tablet-50 align-self-center" style="margin:0 auto;margin-bottom:15px">
                <div class="card-content card-content-padding text-align-center" >`;
                response.karyawan.forEach(function(obj,x){
                    element += `
                    <span style="font-size:1.5em;font-weight:bold" > ${obj.USERID}
                    </span> <img width="25" height="25" src="${imgFolder}bendera/${obj.nama_gambar}?`+ new Date().getTime()+`"><br>`;
                });
                element += `
                </div>
                </div>`;
                $$(".containerSalesmanBendera").html(element);

                
            } else {
                myApp.dialog.alert("Pelanggan Belum Memiliki Koordinat");
            }
            myApp.preloader.hide();
        },
        function(xhr,status){
            PreloaderHide(status);
        })
});


//detail_pemetaan_by_pelanggan
$$(document).on('page:init', '.page[data-name="detail_pemetaan_by_pelanggan_verifikasi"]', function (page) {
    var params = {
        case:"PEMETAAN_BY_PELANGGAN_VERIFIKASI",
        USERID:USERID,
        KODECABANG:KODECABANG,
        KODEJABATAN:KODEJABATAN
    }

    myApp.request.post(ipTujuan,params,
        function(data){
            var response = JSON.parse(data);
            if(response.hasil == "ada"){
                var element = `<div class="row">`
                var counter = 0;
                var jumlah = {};
                map = new google.maps.Map(document.getElementById('map'), {
                    center: {lat: parseFloat(response.KOORDINAT[0].LATITUDE), lng:parseFloat(response.KOORDINAT[0].LONGITUDE)},
                    zoom: 12,
                });
                var startcounter = 0;
                var endcounter = response.KOORDINAT.length -1;
                var gambar = `${imgFolder}bendera/bendera-hijau.png?`+ new Date().getTime();
                AddMarkerPemetaanByPelangganLogo(response,map,startcounter,endcounter,gambar);
                response.KOORDINAT.forEach(function(obj,x){
                    /*jumlah[x] = {
                        'kategoripelanggan':obj.KATEGORIPELANGGAN
                    }*/
                    if(!jumlah[obj.KATEGORIPELANGGAN]){
                        jumlah[obj.KATEGORIPELANGGAN] = 0;
                    }
                    /*counter++;
                    var contentString = obj.NAMA;
                    addMarkerWithInfowindow(map, new google.maps.LatLng(parseFloat(obj.LATITUDE),parseFloat(obj.LONGITUDE)), contentString,counter);*/
                    element += `
                    <div class="col-100 desktop-25 tablet-33">
                    <div class="card">
                    <div class ="card-header cardHeaderBiru">${x+1} ${obj.KODEPELANGGAN}</div>
                    <div class="card-content card-content-padding">


                    

                    <div class="row">
                    <div class="col-45 cardContentDetail" >Nama</div>
                    <div class="col-5 boldHitam"> : </div>
                    <div class="col-50 cardContentHasilDetail namaJabatan">${obj.NAMA}</div>
                    </div>

                    <div class="row">
                    <div class="col-45 cardContentDetail" >Kota</div>
                    <div class="col-5 boldHitam"> : </div>
                    <div class="col-50 cardContentHasilDetail kodeJabatan">${obj.KOTA}</div>
                    </div>

                    <div class="row">
                    <div class="col-45 cardContentDetail" >Alamat</div>
                    <div class="col-5 boldHitam"> : </div>
                    <div class="col-50 cardContentHasilDetail kodeJabatan">${obj.ALAMAT}</div>
                    </div>

                    <div class="row">
                    <div class="col-45 cardContentDetail" >Kategori</div>
                    <div class="col-5 boldHitam"> : </div>
                    <div class="col-50 cardContentHasilDetail namaJabatan">${obj.KATEGORIPELANGGAN}</div>
                    </div>

                    <div class="row">
                    <div class="col-45 cardContentDetail" >Salesman</div>
                    <div class="col-5 boldHitam"> : </div>
                    <div class="col-50 cardContentHasilDetail namaJabatan">${obj.USERID}</div>
                    </div>


                    </div>
                    </div> 
                    </div>
                    `;
                    jumlah[obj.KATEGORIPELANGGAN]++;
                })
                element += `</div>`;

                
                $$(".semuaTampilDetailPemetaanByPelangganVerifikasi").append(element);

                var jumlahTotal = [];
                jumlahTotal['total_pelanggan'] = 0;
                jumlahTotal['total_capel'] = 0;
                element = `<div class="container" id="containerKategoriPelanggan">
                <div class="row">`;
                for(var key in jumlah){
                    element += `<div class="col-33 tablet-20 desktop-20 rcorners" onClick="PemetaanPelangganVerifikasiByKategori('${key}','T')">
                    <div class="row justify-content-center" style="font-size:1.3em;font-weigt:bold"> 
                    ${jumlah[key]}
                    </div>
                    <div class="row justify-content-center text-align-center">
                    <span style="color:gray">${key}</span>
                    </div>
                    </div>`;
                    if(key.substring(0,5) == "CAPEL"){
                        jumlahTotal['total_capel'] = jumlahTotal['total_capel']+jumlah[key];

                    } else {
                        jumlahTotal['total_pelanggan'] = jumlahTotal['total_pelanggan']+jumlah[key];
                    }
                }
                element +=`</div>
                </div>`

                var element2 = `<div class="row" id="cardTampilPemetaanStaff" >
                <div class="card col-90 desktop-50 tablet-50 align-self-center" style="margin:0 auto;margin-bottom:15px">
                <div class="card-content card-content-padding text-align-center" >
                <span style="font-size:1.5em;font-weight:bold">${jumlahTotal['total_pelanggan']}
                </span>Pelanggan dan <span style="font-size:1.5em;font-weight:bold">${jumlahTotal['total_capel']}</span> Calon Pelanggan<br>
                </div>
                </div>

                </div>`;

                $$("#containerKategoriPelanggan").html(element2);
                $$("#containerKategoriPelanggan").append(element);

                element = `<div class="card col-90 desktop-50 tablet-50 align-self-center" style="margin:0 auto;margin-bottom:15px">
                <div class="card-content card-content-padding text-align-center" >`;
                response.karyawan.forEach(function(obj,x){
                    element += `
                    <span style="font-size:1.5em;font-weight:bold" onClick="PemetaanPelangganVerifikasiByKategoriBySalesman('${obj.USERID}','awal')">${obj.USERID}
                    </span> <img width="25" height="25" src="${imgFolder}bendera/${obj.nama_gambar}?`+ new Date().getTime()+`"><br>`;
                });
                element += `
                </div>
                </div>`;
                $$(".containerSalesmanBendera").html(element);

                
            } else {
                myApp.dialog.alert("Pelanggan Belum Memiliki Koordinat");
            }
            myApp.preloader.hide();
        },
        function(xhr,status){
            PreloaderHide(status);
        })
});


//detail_pemetaan_by_pelanggan_verifikasi_by_kategori
$$(document).on('page:init', '.page[data-name="detail_pemetaan_by_pelanggan_verifikasi_by_kategori"]', function (page) {
    $$("input[type=text]").keyup(function(){
        $$(this).val( $$(this).val().toUpperCase() );
    });

    if(halamanGlobal == "PEMETAAN_BY_PELANGGAN"){
        $$(".judul_halaman").html("PEMETAAN PELANGGAN BELUM VERIFIKASI");
    } else {
        $$(".judul_halaman").html("PEMETAAN PELANGGAN SUDAH VERIFIKASI");
    }
    

    arrTampungSearchNamaPelangganVerifikasi = [];
    var params = {
        case:"PEMETAAN_BY_PELANGGAN_VERIFIKASI_BY_KATEGORI",
        USERID:USERID,
        KODECABANG:KODECABANG,
        KODEJABATAN:KODEJABATAN,
        KODEKATEGORIPELANGGAN:kodeKategoriPemetaanVerifikasiPelanggan,
        VERIFIKASI:verifikasiKategoriPemetaanVerifikasiPelanggan
    }

    myApp.request.post(ipTujuan,params,
        function(data){
            var response = JSON.parse(data);
            if(response.hasil == "ada"){
                var element = `<div class="row">`
                var counter = 0;
                var jumlah = {};
                map = new google.maps.Map(document.getElementById('map_by_kategori'), {
                    center: {lat: parseFloat(response.KOORDINAT[0].LATITUDE), lng:parseFloat(response.KOORDINAT[0].LONGITUDE)},
                    zoom: 12,
                });
                var startcounter = 0;
                var endcounter = response.KOORDINAT.length -1;
                var gambar = `${imgFolder}bendera/bendera-hijau.png?`+ new Date().getTime();
                AddMarkerPemetaanByPelangganLogo(response,map,startcounter,endcounter,gambar);
                response.KOORDINAT.forEach(function(obj,x){
                    arrTampungSearchNamaPelangganVerifikasi[x] = obj.NAMA;
                    /*jumlah[x] = {
                        'kategoripelanggan':obj.KATEGORIPELANGGAN
                    }*/
                    if(!jumlah[obj.KATEGORIPELANGGAN]){
                        jumlah[obj.KATEGORIPELANGGAN] = 0;
                    }
                    /*counter++;
                    var contentString = obj.NAMA;
                    addMarkerWithInfowindow(map, new google.maps.LatLng(parseFloat(obj.LATITUDE),parseFloat(obj.LONGITUDE)), contentString,counter);*/
                    element += `
                    <div class="col-100 desktop-25 tablet-33">
                    <div class="card">
                    <div class ="card-header cardHeaderBiru">${x+1} ${obj.KODEPELANGGAN}</div>
                    <div class="card-content card-content-padding">


                    

                    <div class="row">
                    <div class="col-45 cardContentDetail" >Nama</div>
                    <div class="col-5 boldHitam"> : </div>
                    <div class="col-50 cardContentHasilDetail namaJabatan">${obj.NAMA}</div>
                    </div>

                    <div class="row">
                    <div class="col-45 cardContentDetail" >Kota</div>
                    <div class="col-5 boldHitam"> : </div>
                    <div class="col-50 cardContentHasilDetail kodeJabatan">${obj.KOTA}</div>
                    </div>

                    <div class="row">
                    <div class="col-45 cardContentDetail" >Alamat</div>
                    <div class="col-5 boldHitam"> : </div>
                    <div class="col-50 cardContentHasilDetail kodeJabatan">${obj.ALAMAT}</div>
                    </div>

                    <div class="row">
                    <div class="col-45 cardContentDetail" >Kategori</div>
                    <div class="col-5 boldHitam"> : </div>
                    <div class="col-50 cardContentHasilDetail namaJabatan">${obj.KATEGORIPELANGGAN}</div>
                    </div>

                    <div class="row">
                    <div class="col-45 cardContentDetail" >Salesman</div>
                    <div class="col-5 boldHitam"> : </div>
                    <div class="col-50 cardContentHasilDetail namaJabatan">${obj.USERID}</div>
                    </div>


                    </div>
                    </div> 
                    </div>
                    `;
                    jumlah[obj.KATEGORIPELANGGAN]++;
                })
                element += `</div>`;

                
                $$(".semuaTampilDetailPemetaanByPelangganByKategori").append(element);

                var jumlahTotal = [];
                jumlahTotal['total_pelanggan'] = 0;
                jumlahTotal['total_capel'] = 0;
                element = `<div class="container" id="containerKategoriPelanggan">
                <div class="row">`;
                for(var key in jumlah){
                    element += `<div class="col-33 tablet-20 desktop-20 rcorners">
                    <div class="row justify-content-center" style="font-size:1.3em;font-weigt:bold"> 
                    ${jumlah[key]}
                    </div>
                    <div class="row justify-content-center text-align-center">
                    <span style="color:gray">${key}</span>
                    </div>
                    </div>`;
                    if(key.substring(0,5) == "CAPEL"){
                        jumlahTotal['total_capel'] = jumlahTotal['total_capel']+jumlah[key];

                    } else {
                        jumlahTotal['total_pelanggan'] = jumlahTotal['total_pelanggan']+jumlah[key];
                    }
                }
                element +=`</div>
                </div>`

                var element2 = `<div class="row" id="cardTampilPemetaanStaff" >
                <div class="card col-90 desktop-50 tablet-50 align-self-center" style="margin:0 auto;margin-bottom:15px">
                <div class="card-content card-content-padding text-align-center" >
                <span style="font-size:1.5em;font-weight:bold">${jumlahTotal['total_pelanggan']}
                </span>Pelanggan dan <span style="font-size:1.5em;font-weight:bold">${jumlahTotal['total_capel']}</span> Calon Pelanggan<br>
                </div>
                </div>

                </div>`;

                $$("#containerKategoriPelangganByKategori").html(element2);
                $$("#containerKategoriPelangganByKategori").append(element);

                element = `<div class="card col-90 desktop-50 tablet-50 align-self-center" style="margin:0 auto;margin-bottom:15px">
                <div class="card-content card-content-padding text-align-center" >`;
                response.karyawan.forEach(function(obj,x){
                    element += `
                    <span style="font-size:1.5em;font-weight:bold" onClick="PemetaanPelangganVerifikasiByKategoriBySalesman('${obj.USERID}','tidak_awal')">${obj.USERID}
                    </span> <img width="25" height="25" src="${imgFolder}bendera/${obj.nama_gambar}?`+ new Date().getTime()+`"><br>`;
                });
                element += `
                </div>
                </div>`;
                $$(".containerSalesmanBenderaByKategori").html(element);

                
            } else {
                myApp.dialog.alert("Pelanggan Belum Memiliki Koordinat");
            }
            myApp.preloader.hide();
        },
        function(xhr,status){
            PreloaderHide(status);
        })
});

//detail_pemetaan_by_pelanggan_verifikasi_by_kategori_by_salesman
$$(document).on('page:init', '.page[data-name="detail_pemetaan_by_pelanggan_verifikasi_by_kategori_by_salesman"]', function (page) {
    console.log(halamanGlobal);
    if(halamanGlobal == "PEMETAAN_BY_PELANGGAN"){
        $$(".judul_halaman").html("PEMETAAN PELANGGAN BELUM VERIFIKASI");
    } else {
        $$(".judul_halaman").html("PEMETAAN PELANGGAN SUDAH VERIFIKASI");
    }
    var params = {
        case:"PEMETAAN_BY_PELANGGAN_VERIFIKASI_BY_KATEGORI_BY_SALESMAN",
        USERID:USERID,
        KODECABANG:KODECABANG,
        KODEJABATAN:KODEJABATAN,
        KODEKATEGORIPELANGGAN:kodeKategoriPemetaanVerifikasiPelanggan,
        VERIFIKASI:verifikasiKategoriPemetaanVerifikasiPelanggan,
        KODESALESMAN:userIdPemetaanVerifikasiPelanggan
    }

    myApp.request.post(ipTujuan,params,
        function(data){
            var response = JSON.parse(data);
            if(response.hasil == "ada"){
                var element = `<div class="row">`
                var counter = 0;
                var jumlah = {};
                map = new google.maps.Map(document.getElementById('map_by_kategori_by_salesman'), {
                    center: {lat: parseFloat(response.KOORDINAT[0].LATITUDE), lng:parseFloat(response.KOORDINAT[0].LONGITUDE)},
                    zoom: 12,
                });
                var startcounter = 0;
                var endcounter = response.KOORDINAT.length -1;
                var gambar = `${imgFolder}bendera/bendera-hijau.png?`+ new Date().getTime();
                AddMarkerPemetaanByPelangganLogo(response,map,startcounter,endcounter,gambar);
                response.KOORDINAT.forEach(function(obj,x){
                    /*jumlah[x] = {
                        'kategoripelanggan':obj.KATEGORIPELANGGAN
                    }*/
                    if(!jumlah[obj.KATEGORIPELANGGAN]){
                        jumlah[obj.KATEGORIPELANGGAN] = 0;
                    }
                    /*counter++;
                    var contentString = obj.NAMA;
                    addMarkerWithInfowindow(map, new google.maps.LatLng(parseFloat(obj.LATITUDE),parseFloat(obj.LONGITUDE)), contentString,counter);*/
                    element += `
                    <div class="col-100 desktop-25 tablet-33">
                    <div class="card">
                    <div class ="card-header cardHeaderBiru">${x+1} ${obj.KODEPELANGGAN}</div>
                    <div class="card-content card-content-padding">


                    

                    <div class="row">
                    <div class="col-45 cardContentDetail" >Nama</div>
                    <div class="col-5 boldHitam"> : </div>
                    <div class="col-50 cardContentHasilDetail namaJabatan">${obj.NAMA}</div>
                    </div>

                    <div class="row">
                    <div class="col-45 cardContentDetail" >Kota</div>
                    <div class="col-5 boldHitam"> : </div>
                    <div class="col-50 cardContentHasilDetail kodeJabatan">${obj.KOTA}</div>
                    </div>

                    <div class="row">
                    <div class="col-45 cardContentDetail" >Alamat</div>
                    <div class="col-5 boldHitam"> : </div>
                    <div class="col-50 cardContentHasilDetail kodeJabatan">${obj.ALAMAT}</div>
                    </div>

                    <div class="row">
                    <div class="col-45 cardContentDetail" >Kategori</div>
                    <div class="col-5 boldHitam"> : </div>
                    <div class="col-50 cardContentHasilDetail namaJabatan">${obj.KATEGORIPELANGGAN}</div>
                    </div>

                    <div class="row">
                    <div class="col-45 cardContentDetail" >Salesman</div>
                    <div class="col-5 boldHitam"> : </div>
                    <div class="col-50 cardContentHasilDetail namaJabatan">${obj.USERID}</div>
                    </div>


                    </div>
                    </div> 
                    </div>
                    `;
                    jumlah[obj.KATEGORIPELANGGAN]++;
                })
                element += `</div>`;

                
                $$(".semuaTampilDetailPemetaanByPelangganByKategoriBySalesman").append(element);

                var jumlahTotal = [];
                jumlahTotal['total_pelanggan'] = 0;
                jumlahTotal['total_capel'] = 0;
                element = `<div class="container" id="containerKategoriPelanggan">
                <div class="row">`;
                for(var key in jumlah){
                    element += `<div class="col-33 tablet-20 desktop-20 rcorners" onClick="PemetaanPelangganVerifikasiBySalesmanEnd('${key}')">
                    <div class="row justify-content-center" style="font-size:1.3em;font-weigt:bold"> 
                    ${jumlah[key]}
                    </div>
                    <div class="row justify-content-center text-align-center">
                    <span style="color:gray">${key}</span>
                    </div>
                    </div>`;
                    if(key.substring(0,5) == "CAPEL"){
                        jumlahTotal['total_capel'] = jumlahTotal['total_capel']+jumlah[key];

                    } else {
                        jumlahTotal['total_pelanggan'] = jumlahTotal['total_pelanggan']+jumlah[key];
                    }
                }
                element +=`</div>
                </div>`

                var element2 = `<div class="row" id="cardTampilPemetaanStaff" >
                <div class="card col-90 desktop-50 tablet-50 align-self-center" style="margin:0 auto;margin-bottom:15px">
                <div class="card-content card-content-padding text-align-center" >
                <span style="font-size:1.5em;font-weight:bold">${jumlahTotal['total_pelanggan']}
                </span>Pelanggan dan <span style="font-size:1.5em;font-weight:bold">${jumlahTotal['total_capel']}</span> Calon Pelanggan<br>
                </div>
                </div>

                </div>`;

                $$("#containerKategoriPelangganByKategoriBySalesman").html(element2);
                $$("#containerKategoriPelangganByKategoriBySalesman").append(element);

                element = `<div class="card col-90 desktop-50 tablet-50 align-self-center" style="margin:0 auto;margin-bottom:15px">
                <div class="card-content card-content-padding text-align-center" >`;
                response.karyawan.forEach(function(obj,x){
                    element += `
                    <span style="font-size:1.5em;font-weight:bold">${obj.USERID}
                    </span> <img width="25" height="25" src="${imgFolder}bendera/${obj.nama_gambar}?`+ new Date().getTime()+`"><br>`;
                });
                element += `
                </div>
                </div>`;
                $$(".containerSalesmanBenderaByKategoriBySalesman").html(element);

                
            } else {
                myApp.dialog.alert("Pelanggan Belum Memiliki Koordinat");
            }
            myApp.preloader.hide();
        },
        function(xhr,status){
            PreloaderHide(status);
        })
});

//detail_pemetaan_by_pelanggan_verifikasi_by_kategori_by_salesman_end
$$(document).on('page:init', '.page[data-name="detail_pemetaan_by_pelanggan_verifikasi_by_kategori_by_salesman_end"]', function (page) {
    if(halamanGlobal == "PEMETAAN_BY_PELANGGAN"){
        $$(".judul_halaman").html("PEMETAAN PELANGGAN BELUM VERIFIKASI");
    } else {
        $$(".judul_halaman").html("PEMETAAN PELANGGAN SUDAH VERIFIKASI");
    }

    var params = {
        case:"PEMETAAN_BY_PELANGGAN_VERIFIKASI_BY_KATEGORI_BY_SALESMAN_END",
        USERID:USERID,
        KODECABANG:KODECABANG,
        KODEJABATAN:KODEJABATAN,
        KODEKATEGORIPELANGGAN:kodeKategoriPemetaanVerifikasiPelanggan,
        VERIFIKASI:verifikasiKategoriPemetaanVerifikasiPelanggan,
        KODESALESMAN:userIdPemetaanVerifikasiPelanggan
    }

    myApp.request.post(ipTujuan,params,
        function(data){
            var response = JSON.parse(data);
            if(response.hasil == "ada"){
                var element = `<div class="row">`
                var counter = 0;
                var jumlah = {};
                map = new google.maps.Map(document.getElementById('map_by_kategori_by_salesman_end'), {
                    center: {lat: parseFloat(response.KOORDINAT[0].LATITUDE), lng:parseFloat(response.KOORDINAT[0].LONGITUDE)},
                    zoom: 12,
                });
                var startcounter = 0;
                var endcounter = response.KOORDINAT.length -1;
                var gambar = `${imgFolder}bendera/bendera-hijau.png?`+ new Date().getTime();
                AddMarkerPemetaanByPelangganLogo(response,map,startcounter,endcounter,gambar);
                response.KOORDINAT.forEach(function(obj,x){
                    /*jumlah[x] = {
                        'kategoripelanggan':obj.KATEGORIPELANGGAN
                    }*/
                    if(!jumlah[obj.KATEGORIPELANGGAN]){
                        jumlah[obj.KATEGORIPELANGGAN] = 0;
                    }
                    /*counter++;
                    var contentString = obj.NAMA;
                    addMarkerWithInfowindow(map, new google.maps.LatLng(parseFloat(obj.LATITUDE),parseFloat(obj.LONGITUDE)), contentString,counter);*/
                    element += `
                    <div class="col-100 desktop-25 tablet-33">
                    <div class="card">
                    <div class ="card-header cardHeaderBiru">${x+1} ${obj.KODEPELANGGAN}</div>
                    <div class="card-content card-content-padding">


                    

                    <div class="row">
                    <div class="col-45 cardContentDetail" >Nama</div>
                    <div class="col-5 boldHitam"> : </div>
                    <div class="col-50 cardContentHasilDetail namaJabatan">${obj.NAMA}</div>
                    </div>

                    <div class="row">
                    <div class="col-45 cardContentDetail" >Kota</div>
                    <div class="col-5 boldHitam"> : </div>
                    <div class="col-50 cardContentHasilDetail kodeJabatan">${obj.KOTA}</div>
                    </div>

                    <div class="row">
                    <div class="col-45 cardContentDetail" >Alamat</div>
                    <div class="col-5 boldHitam"> : </div>
                    <div class="col-50 cardContentHasilDetail kodeJabatan">${obj.ALAMAT}</div>
                    </div>

                    <div class="row">
                    <div class="col-45 cardContentDetail" >Kategori</div>
                    <div class="col-5 boldHitam"> : </div>
                    <div class="col-50 cardContentHasilDetail namaJabatan">${obj.KATEGORIPELANGGAN}</div>
                    </div>

                    <div class="row">
                    <div class="col-45 cardContentDetail" >Salesman</div>
                    <div class="col-5 boldHitam"> : </div>
                    <div class="col-50 cardContentHasilDetail namaJabatan">${obj.USERID}</div>
                    </div>


                    </div>
                    </div> 
                    </div>
                    `;
                    jumlah[obj.KATEGORIPELANGGAN]++;
                })
                element += `</div>`;

                
                $$(".semuaTampilDetailPemetaanByPelangganByKategoriBySalesmanEnd").append(element);

                var jumlahTotal = [];
                jumlahTotal['total_pelanggan'] = 0;
                jumlahTotal['total_capel'] = 0;
                element = `<div class="container" id="containerKategoriPelanggan">
                <div class="row">`;
                for(var key in jumlah){
                    element += `<div class="col-33 tablet-20 desktop-20 rcorners">
                    <div class="row justify-content-center" style="font-size:1.3em;font-weigt:bold"> 
                    ${jumlah[key]}
                    </div>
                    <div class="row justify-content-center text-align-center">
                    <span style="color:gray">${key}</span>
                    </div>
                    </div>`;
                    if(key.substring(0,5) == "CAPEL"){
                        jumlahTotal['total_capel'] = jumlahTotal['total_capel']+jumlah[key];

                    } else {
                        jumlahTotal['total_pelanggan'] = jumlahTotal['total_pelanggan']+jumlah[key];
                    }
                }
                element +=`</div>
                </div>`

                var element2 = `<div class="row" id="cardTampilPemetaanStaff" >
                <div class="card col-90 desktop-50 tablet-50 align-self-center" style="margin:0 auto;margin-bottom:15px">
                <div class="card-content card-content-padding text-align-center" >
                <span style="font-size:1.5em;font-weight:bold">${jumlahTotal['total_pelanggan']}
                </span>Pelanggan dan <span style="font-size:1.5em;font-weight:bold">${jumlahTotal['total_capel']}</span> Calon Pelanggan<br>
                </div>
                </div>

                </div>`;

                $$("#containerKategoriPelangganByKategoriBySalesmanEnd").html(element2);
                $$("#containerKategoriPelangganByKategoriBySalesmanEnd").append(element);

                element = `<div class="card col-90 desktop-50 tablet-50 align-self-center" style="margin:0 auto;margin-bottom:15px">
                <div class="card-content card-content-padding text-align-center" >`;
                response.karyawan.forEach(function(obj,x){
                    element += `
                    <span style="font-size:1.5em;font-weight:bold">${obj.USERID}
                    </span> <img width="25" height="25" src="${imgFolder}bendera/${obj.nama_gambar}?`+ new Date().getTime()+`"><br>`;
                });
                element += `
                </div>
                </div>`;
                $$(".containerSalesmanBenderaByKategoriBySalesmanEnd").html(element);

                
            } else {
                myApp.dialog.alert("Pelanggan Belum Memiliki Koordinat");
            }
            myApp.preloader.hide();
        },
        function(xhr,status){
            PreloaderHide(status);
        })
});

/*history_tracking*/
$$(document).on('page:init', '.page[data-name="history_tracking"]', function (page) {
    var calendarModal = myApp.calendar.create({
        inputEl: '#dariTanggal',
        openIn: 'customModal',
        header: true,
        footer: true,
        dateFormat: 'MM dd yyyy',
    });

    var searchbar3 = myApp.searchbar.create({
        el: '.searchKaryawanDari',
        searchContainer: '.listPopUpNamaKaryawanDari',
        searchIn: '.namaKaryawanDari',
        on: {
            search(sb, query, previousQuery) {
            }
        }
    });

    PopupLaporanKaryawanDari("SEMUA");
    $$('.popup-open-karyawanPelangganDari').on('click',function(){
        myApp.popup.open('.popup-karyawanDari'); 
    });
});

/*parameter_laporan_bulanan_kunjungan*/
$$(document).on('page:init', '.page[data-name="parameter_laporan_bulanan_kunjungan"]', function (page) {
    var calendarModal = myApp.calendar.create({
        inputEl: '#dariTanggal',
        openIn: 'customModal',
        header: true,
        footer: true,
        dateFormat: 'MM dd yyyy',
    });

    var searchbar3 = myApp.searchbar.create({
        el: '.searchKaryawanDari',
        searchContainer: '.listPopUpNamaKaryawanDari',
        searchIn: '.namaKaryawanDari',
        on: {
            search(sb, query, previousQuery) {
            }
        }
    });

    PopupLaporanKaryawanBerdasarUserId(USERID);
    $$('.popup-open-karyawanPelangganDari').on('click',function(){
        myApp.popup.open('.popup-karyawanDari'); 
    });
});

/*parameter_laporan_bulanan_kunjungan*/
$$(document).on('page:init', '.page[data-name="hasil_laporan_bulanan_kunjungan"]', function (page) {
    var today = new Date(tanggalLaporanBulananKunjungan);
    var day = today.getDate();
    var monthIndex = today.getMonth();
    var year = today.getFullYear();
    var TANGGAL = year+'-'+(parseInt(monthIndex)+1)+'-'+day;
    var params = {
        case:"DASHBOARD_RENCANA",
        USERID:kodeSalesmanLaporanBulananKunjungan,
        KODECABANG:KODECABANG,
        KODEJABATAN:KODEJABATAN,
        DATETRANSACTION:TANGGAL
    }

    myApp.request.post(ipTujuan,params,
        function(data){
            myApp.preloader.hide();
            var response = JSON.parse(data);

            var title = `Total Point Kunjungan Anda ${response.total_point_kunjungan}`;
            total_point_kunjungan = response.total_point_kunjungan / 300 *100;
            standar_point_kunjungan = (response.standar_point_kunjungan - response.total_point_kunjungan)/ 300*100;
            HighChartDiagramTotalPointKunjungan(title,total_point_kunjungan,standar_point_kunjungan,"containerChartPointKunjungan");
            var total_kunjungan = 0;
            var total_sesuai_rencana = 0;
            var total_diluar_rencana = 0;

            if(response.hasil_point == "ada"){
                total_kunjungan = response.total_kunjungan;
            }

            if(response.total_sesuai_rencana){
                total_sesuai_rencana = response.total_sesuai_rencana;
            }

            total_diluar_rencana = total_kunjungan - total_sesuai_rencana;

            $$("#homeTitle").html(`Hi, ${response.PEMAKAI.NAMA}`)
            
            var element =`
            <span style="font-size:1.5em;font-weight:bold">${total_kunjungan}/150 (${PercentNumberFormat(Number(total_kunjungan/150*100),1)}%)</span>
            Total Kunjungan Anda<br>
            <span style="font-size:1.5em;font-weight:bold">${total_sesuai_rencana} (${PercentNumberFormat(Number(total_sesuai_rencana/150*100),1) }%)</span>
            Sesuai Rencana<br>
            <span style="font-size:1.5em;font-weight:bold">${total_diluar_rencana} (${PercentNumberFormat(Number(total_diluar_rencana/150*100),1)}%)</span>
            Diluar Rencana<br>
            `;

            var targetKunjungan = 150;
            var indexPresentaseKunjungan;
            response.presentase_kunjungan.forEach(function(obj,x){
                if(parseFloat(PercentNumberFormat(Number(total_kunjungan/targetKunjungan*100),1)) > parseFloat(obj.presentase_kunjungan)){
                    indexPresentaseKunjungan = x;
                }
            })

            /*Menghitung Total Bonus*/

            var jumlahBonusDiterima = 0;
            if(indexPresentaseKunjungan){
                var jumlahDariPresentaseTercapai = response.presentase_kunjungan[indexPresentaseKunjungan].presentase_kunjungan * targetKunjungan/100;
                console.log(jumlahDariPresentaseTercapai,total_sesuai_rencana);
                if(total_sesuai_rencana <= jumlahDariPresentaseTercapai){
                    jumlahBonusDiterima = total_sesuai_rencana * response.presentase_kunjungan[indexPresentaseKunjungan].harga_sesuai;
                    jumlahBonusDiterima = jumlahBonusDiterima + ((total_kunjungan - jumlahDariPresentaseTercapai) * response.presentase_kunjungan[indexPresentaseKunjungan].harga_tidak_sesuai );
                } else {
                    jumlahBonusDiterima = total_sesuai_rencana * response.presentase_kunjungan[indexPresentaseKunjungan].harga_sesuai;
                }
            }

            var element_bonus_kunjungan = `
            <span style="color:red;font-weight:bold">`;
            if(PercentNumberFormat(Number(total_kunjungan/targetKunjungan*100),1) >= 100){
                element_bonus_kunjungan += `Selamat !! Mencapai ${PercentNumberFormat(Number(total_sesuai_rencana/150*100),1) }% Kunjungan, anda mendapatkan uang Rp. ${FormatHarga(jumlahBonusDiterima)}`;
            } else if(PercentNumberFormat(Number(total_kunjungan/targetKunjungan*100),1) >= 90){
                element_bonus_kunjungan += `Kunjungan Mencapai ${PercentNumberFormat(Number(total_sesuai_rencana/150*100),1) }% Anda mendapatkan uang Rp. ${FormatHarga(jumlahBonusDiterima)} <br> Semangat sedikit lagi udah 100%`;
            } else if(PercentNumberFormat(Number(total_kunjungan/targetKunjungan*100),1) >= 80){
                element_bonus_kunjungan += `Kunjungan Mencapai ${PercentNumberFormat(Number(total_sesuai_rencana/150*100),1) }% Anda mendapatkan uang Rp. ${FormatHarga(jumlahBonusDiterima)} <br> Semangat yaaa kejar sampai 100%`;
            } else if(PercentNumberFormat(Number(total_kunjungan/targetKunjungan*100),1) >= 70){
                element_bonus_kunjungan += `Kunjungan Mencapai ${PercentNumberFormat(Number(total_sesuai_rencana/150*100),1) }% Anda mendapatkan uang Rp. ${FormatHarga(jumlahBonusDiterima)} <br> Yuk Buruan Kejar sampai 100%`;
            } else {
                element_bonus_kunjungan += `Yuk Kejar kunjunganmu sampai 100% semangat ya !!`;
            }
            element_bonus_kunjungan +=`</span>`;
            $$("#homeWelcome").html(element);
            $$("#homeWelcome").append(element_bonus_kunjungan);
        },
        function(xhr,status){

        })
});



/*detail_history_tracking*/
$$(document).on('page:init', '.page[data-name="detail_history_tracking"]', function (page) {
    var params = {
        case:"DETAIL_HISTORY_TRACKING",
        TANGGAL:tanggalHistoryTracking,
        KODESALESMAN:staffHistoryTracking,
        USERID:USERID,
        KODECABANG:KODECABANG,
        KODEJABATAN:KODEJABATAN
    }
    myApp.request.post(ipTujuan,params,
        function(data){
            var response = JSON.parse(data);
            var map;
            var gambar;
            var element = "";

            /*if(response.hasil == "ada" && response.tracking.length >0){

                map = new google.maps.Map(document.getElementById('map'), {
                    center: {lat: parseFloat(response.tracking[0].LATITUDE), lng:parseFloat(response.tracking[0].LONGITUDE)},
                    zoom: 16,
                });
                var startcounter = 0;
                var endcounter = response.tracking.length -1;

                var counterWarna = 0;
                var tampungCounterWarna = 0;
                RouteHistoryTracking(response,map,startcounter,endcounter,counterWarna,tampungCounterWarna);

                if(response.hasil_kunjungan == "ada" && response.kunjungan.length > 0){

                    var elementRute = 
                    `<div class="card col-90 desktop-50 tablet-50 align-self-center" style="margin:0 auto;margin-bottom:15px">
                    <div class="card-content card-content-padding text-align-center" >
                    <div>Waktu Seluruh Rute ${JarakWaktu(response.kunjungan[0].DATETRANSACTION,response.kunjungan[response.kunjungan.length-1].DATETRANSACTION)}</div><br>`;
                    var counterWarna = 0;
                    response.kunjungan.forEach(function(obj,x){
                        if(x+1 != response.kunjungan.length){
                            elementRute += ElementRute(x+1, counterWarna);
                        }
                        counterWarna++;
                        var jam = ConvertDateTimeToText(obj.DATETRANSACTION,'datetime');
                        if(obj.JENIS == "kunjungan"){
                            if(obj.STATUSKUNJUNGAN == "LUAR"){
                                gambar = `${imgFolder}kunjungan_luar.png?`+ new Date().getTime();
                            } else if(obj.STATUSKUNJUNGAN == "DALAM"){
                                gambar = `${imgFolder}kunjungan_dalam.png?`+ new Date().getTime();
                            } else {
                                gambar = `${imgFolder}kunjungan.png?`+ new Date().getTime();
                            }
                        } else if(obj.JENIS == "kiriman"){
                            gambar = `${imgFolder}kiriman.png?`+ new Date().getTime();
                        } else if(obj.JENIS == "collector"){
                            gambar = `${imgFolder}collector.png?`+ new Date().getTime();
                        }
                        addMarkerWithInfowindow(map, new google.maps.LatLng(parseFloat(obj.LATITUDE),parseFloat(obj.LONGITUDE)),obj.NAMAPELANGGAN,x+1,gambar);
                        element += `
                        <div class="col-100 desktop-25 tablet-33">
                        <div class="card">
                        <div class ="card-header cardHeaderBiru">${x+1} ${obj.KODEPELANGGAN}</div>
                        <div class="card-content card-content-padding">




                        <div class="row">
                        <div class="col-45 cardContentDetail" >Nama</div>
                        <div class="col-5 boldHitam"> : </div>
                        <div class="col-50 cardContentHasilDetail namaJabatan">${obj.NAMAPELANGGAN}</div>
                        </div>

                        <div class="row">
                        <div class="col-45 cardContentDetail" >Kota</div>
                        <div class="col-5 boldHitam"> : </div>
                        <div class="col-50 cardContentHasilDetail kodeJabatan">${obj.KOTA}</div>
                        </div>

                        <div class="row">
                        <div class="col-45 cardContentDetail" >Alamat</div>
                        <div class="col-5 boldHitam"> : </div>
                        <div class="col-50 cardContentHasilDetail kodeJabatan">${obj.ALAMAT}</div>
                        </div>

                        <div class="row">
                        <div class="col-45 cardContentDetail" >Jam</div>
                        <div class="col-5 boldHitam"> : </div>
                        <div class="col-50 cardContentHasilDetail namaJabatan">${jam}</div>
                        </div>


                        </div>
                        </div> 
                        </div>
                        `;
                    })
                    $$("#cardTampilPemetaanStaff").html(element);


                    elementRute+=`</div>
                    </div>`;
                    $$("#cardTampilDetailRute").html(elementRute);
                }
            } else {
                $$('.semuaTampilDetailPemetaan').html("Tidak Ada History Tracking");
            }*/

            if(response.kunjungan){

                map = new google.maps.Map(document.getElementById('map'), {
                    center: {lat: parseFloat(response.kunjungan[0].LATITUDE), lng:parseFloat(response.kunjungan[0].LONGITUDE)},
                    zoom: 16,
                });
            } else if(response.tracking){
                map = new google.maps.Map(document.getElementById('map'), {
                    center: {lat: parseFloat(response.tracking[0].LATITUDE), lng:parseFloat(response.tracking[0].LONGITUDE)},
                    zoom: 16,
                });
            } else {
                $$('.semuaTampilDetailPemetaan').html("Tidak Ada History Tracking");
            }
            if(response.tracking && response.tracking.length >0){


                var startcounter = 0;
                var endcounter = response.tracking.length -1;

                var counterWarna = 0;
                var tampungCounterWarna = 0;
                RouteHistoryTracking(response,map,startcounter,endcounter,counterWarna,tampungCounterWarna);
            }

            if(response.hasil_kunjungan == "ada" && response.kunjungan.length > 0){

                var elementRute = 
                `<div class="card col-90 desktop-50 tablet-50 align-self-center" style="margin:0 auto;margin-bottom:15px">
                <div class="card-content card-content-padding text-align-center" >
                <div>Waktu Seluruh Rute ${JarakWaktu(response.kunjungan[0].DATETRANSACTION,response.kunjungan[response.kunjungan.length-1].DATETRANSACTION)}</div><br>`;
                var counterWarna = 0;
                response.kunjungan.forEach(function(obj,x){
                    if(x+1 != response.kunjungan.length){
                        elementRute += ElementRute(x+1, counterWarna);
                    }
                    counterWarna++;
                    var jam = ConvertDateTimeToText(obj.DATETRANSACTION,'datetime');
                    if(obj.JENIS == "kunjungan"){
                        if(obj.STATUSKUNJUNGAN == "LUAR"){
                            gambar = `${imgFolder}kunjungan_luar.png?`+ new Date().getTime();
                        } else if(obj.STATUSKUNJUNGAN == "DALAM"){
                            gambar = `${imgFolder}kunjungan_dalam.png?`+ new Date().getTime();
                        } else {
                            gambar = `${imgFolder}kunjungan.png?`+ new Date().getTime();
                        }
                    } else if(obj.JENIS == "kiriman"){
                        gambar = `${imgFolder}kiriman.png?`+ new Date().getTime();
                    } else if(obj.JENIS == "collector"){
                        gambar = `${imgFolder}collector.png?`+ new Date().getTime();
                    }
                    addMarkerWithInfowindow(map, new google.maps.LatLng(parseFloat(obj.LATITUDE),parseFloat(obj.LONGITUDE)),obj.NAMAPELANGGAN,x+1,gambar);
                    element += `
                    <div class="col-100 desktop-25 tablet-33">
                    <div class="card">
                    <div class ="card-header cardHeaderBiru">${x+1} ${obj.KODEPELANGGAN}</div>
                    <div class="card-content card-content-padding">




                    <div class="row">
                    <div class="col-45 cardContentDetail" >Nama</div>
                    <div class="col-5 boldHitam"> : </div>
                    <div class="col-50 cardContentHasilDetail namaJabatan">${obj.NAMAPELANGGAN}</div>
                    </div>

                    <div class="row">
                    <div class="col-45 cardContentDetail" >Kota</div>
                    <div class="col-5 boldHitam"> : </div>
                    <div class="col-50 cardContentHasilDetail kodeJabatan">${obj.KOTA}</div>
                    </div>

                    <div class="row">
                    <div class="col-45 cardContentDetail" >Alamat</div>
                    <div class="col-5 boldHitam"> : </div>
                    <div class="col-50 cardContentHasilDetail kodeJabatan">${obj.ALAMAT}</div>
                    </div>

                    <div class="row">
                    <div class="col-45 cardContentDetail" >Jam</div>
                    <div class="col-5 boldHitam"> : </div>
                    <div class="col-50 cardContentHasilDetail namaJabatan">${jam}</div>
                    </div>


                    </div>
                    </div> 
                    </div>
                    `;
                })
                $$("#cardTampilPemetaanStaff").html(element);


                elementRute+=`</div>
                </div>`;
                $$("#cardTampilDetailRute").html(elementRute);
            }

            

            myApp.preloader.hide();
        },
        function(xhr,status){

        })
});

/*realisasi_kunjungan_semua*/
$$(document).on('page:init', '.page[data-name="realisasi_kunjungan_semua"]', function (page) {
    myApp.preloader.hide();
    var calendarModal = myApp.calendar.create({
        inputEl: '#dariTanggal',
        openIn: 'customModal',
        header: true,
        footer: true,
        dateFormat: 'MM dd yyyy',
    });

    var params = {

    }

})

/*realisasi_kunjungan*/
$$(document).on('page:init', '.page[data-name="realisasi_kunjungan"]', function (page) {
    var calendarModal = myApp.calendar.create({
        inputEl: '#dariTanggal',
        openIn: 'customModal',
        header: true,
        footer: true,
        dateFormat: 'MM dd yyyy',
    });

    var searchbar3 = myApp.searchbar.create({
        el: '.searchKaryawanDari',
        searchContainer: '.listPopUpNamaKaryawanDari',
        searchIn: '.namaKaryawanDari',
        on: {
            search(sb, query, previousQuery) {
            }
        }
    });

    PopupLaporanKaryawanDari("SEMUA");
    $$('.popup-open-karyawanPelangganDari').on('click',function(){
        myApp.popup.open('.popup-karyawanDari'); 
    });
});



/*detail_isi_realisasi_kunjungan*/
$$(document).on('page:init', '.page[data-name="detail_isi_realisasi_kunjungan"]', function (page) {
    myApp.preloader.hide();
    var params = {
        case:"DETAIL_ISI_REALISASI_KUNJUNGAN",
        USERID:USERID,
        KODEJABATAN:KODEJABATAN,
        KODECABANG:KODECABANG,
        NOMORBUKTI:tampungNomorBuktiRealisasiKunjungan
    }
    
    myApp.request.post(ipTujuan,params,
        function(data){
            var response = JSON.parse(data);
            console.log(response);
            if(response.hasil == "ada"){
                var element = `<div class="card">
                <div class ="card-header cardHeaderBiru">Data Kunjungan</div>
                <div class="card-content card-content-padding" style="font-size:1.2em">`;

                element += `
                <div class="row">
                <div class="col-45 cardContentDetail" >Pelanggan</div>
                <div class="col-5 boldHitam"> : </div>
                <div class="col-50 cardContentHasilDetail">${response.kunjungan.NAMAPELANGGAN}</div>
                </div>

                <div class="row">
                <div class="col-45 cardContentDetail" >Masuk</div>
                <div class="col-5 boldHitam"> : </div>
                <div class="col-50 cardContentHasilDetail">${ConvertDateTimeToText(response.kunjungan.WAKTUMASUK,'time')}</div>
                </div>


                <div class="row">
                <div class="col-45 cardContentDetail" >Report</div>
                <div class="col-5 boldHitam"> : </div>
                <div class="col-50 cardContentHasilDetail">${ConvertDateTimeToText(response.kunjungan.DATETRANSACTION,'time')}</div>
                </div>


                <div class="row">
                <div class="col-45 cardContentDetail" >Keterangan</div>
                <div class="col-5 boldHitam"> : </div>
                <div class="col-50 cardContentHasilDetail">${response.kunjungan.KETERANGAN}</div>
                </div>


                <div class="row">
                <div class="col-45 cardContentDetail" >Kesimpulan</div>
                <div class="col-5 boldHitam"> : </div>
                <div class="col-50 cardContentHasilDetail">${response.kunjungan.KESIMPULAN}</div>
                </div>


                <div class="row">
                <div class="col-45 cardContentDetail" >Permintaan Khusus</div>
                <div class="col-5 boldHitam"> : </div>
                <div class="col-50 cardContentHasilDetail">${response.kunjungan.PERMINTAANKHUSUS}</div>
                </div>


                `;
                element +=`</div>
                </div>`;
                $$("#detailIsiRealisasiKunjungan").append(element);

                if(response.gambar == "ada"){

                    var element =`<div  class="swiper-container demo-swiper">
                    <div class="swiper-pagination"></div>
                    <div class="swiper-wrapper">`;
                    response.NAMAGAMBAR.forEach(function(obj,x){
                        element +=`
                        <div class="swiper-slide" style="width:100%;text-align:center">
                        <a href="#" onClick="zoomInOutGambarKunjungan('${response.kunjungan.NOMORBUKTI}','${x}')">
                        <img src="${ipGambarKunjungan+obj.NAMAGAMBAR}.jpg?${new Date().getTime()}" style="max-width:100%" height="350px">
                        </a>
                        </div>`;
                    })
                    element +=`</div>
                    </div>`;
                    $$("#detailIsiRealisasiKunjungan").prepend(element);
                    var swiper = myApp.swiper.create('.swiper-container', {
                        speed: 400,
                        spaceBetween: 100,
                        pagination:{"el":".swiper-pagination"}
                    });
                }
            } else {

            }
            myApp.preloader.hide();
        },
        function(xhr,status){
            PreloaderHide(status);
        })
})

/*detail_realisasi_kunjungan*/
$$(document).on('page:init', '.page[data-name="detail_realisasi_kunjungan"]', function (page) {
    var params = {
        case:"DETAIL_REALISASI_KUNJUNGAN",
        TANGGAL:tanggalRealisasiKunjungan,
        KODESALESMAN:staffRealisasiKunjungan,
        USERID:USERID,
        KODECABANG:KODECABANG,
        KODEJABATAN:KODEJABATAN
    }
    myApp.request.post(ipTujuan,params,
        function(data){
            var response = JSON.parse(data);
            var element = ``;
            var jumlahRencana = {};
            var jumlahKunjungan = {};
            jumlahKunjungan['sesuai_rencana'] = 0;
            jumlahKunjungan['tambahan_kunjungan'] = 0;
            jumlahRencana['kunjungan'] = 0;
            jumlahRencana['collector'] = 0;
            jumlahRencana['kiriman'] = 0;
            if( response.rencana.length > 0){
                response.rencana.forEach(function(obj,x){

                    var jenis = "";
                    if(obj.jenis == "kunjungan"){
                        jenis = "kunjungan";
                    } else if(obj.jenis == "kiriman"){
                        jenis = "kiriman";
                    } else if(obj.jenis == "collector"){
                        jenis = "collector";
                    }
                    element = `<li>
                    <a href="#"`;
                    if(obj.jenis != "sudah_kunjungan" && obj.jenis != "sudah_kiriman"  && obj.jenis !="sudah_collector"){ 

                        element+=`onClick="DashboardKunjungan('${jenis}','${obj.KODEPELANGGAN}','${obj.NAMAPELANGGAN}')"`;
                    }
                    element+=`class="item-link item-content">
                    <div class="item-inner">
                    <div class="item-title" >${obj.NAMAPELANGGAN} - ${obj.KOTA}</div>
                    </div>
                    </a>
                    </li>`;
                    $$(".homeGroupRencanaKujungan").find("ul").append(element);

                    if(obj.jenis == "kunjungan" || obj.jenis == "kiriman" || obj.jenis == "collector"){
                        element = `
                        <div `;
                        element +=`class="card demo-card-header-pic col-50 desktop-25 tablet-33 marginCard">`;
                        if(obj.gambar_rencana_kunjungan == "ada"){
                            element +=`<div style="background-image:url('${ipGambarTokoPelanggan}${obj.nama_gambar}.jpg?`+ new Date().getTime() +`')"`;
                        } else {
                            element +=`<div style="background-image:url('${noPict}?`+ new Date().getTime() +`')"`;
                        }
                        element+=`class="card-header align-items-flex-end"></div>
                        <div class="card-content card-content-padding">
                        <p>${obj.NAMAPELANGGAN} - ${obj.KOTA}</p>
                        </div>`;
                        /*if(obj.KODEPELANGGAN == kodePelangganLoginDashboard){
                            element+=`<div class="card-footer"><a href="#" class="link" onClick="DashboardKunjungan('${jenis}','${obj.KODEPELANGGAN}','${obj.NAMAPELANGGAN}')">Report</a></div>`;
                        } else {
                            element+=`<div class="card-footer"><a href="#" class="link" onClick="LoginDashboardRencana(this,'${jenis}','${obj.KODEPELANGGAN}','${obj.NAMAPELANGGAN}')">Login</a></div>`;
                        }*/
                        
                        element+=`</div>
                        `;

                        $$("#homeRencanaKunjungan").append(element);
                    }
                    jumlahRencana['kunjungan']++;
                })
                
                var element = `Rencana Kunjungan - ${jumlahRencana['kunjungan']}`;
                $$("#blockRencanaKunjungan").html(element);


                if($$('.homeGroupRencanaKujungan li').length == 1){
                    $$('.homeGroupRencanaKujungan').remove();
                } else {
                    $$('.homeGroupRencanaKujungan').find('.list-group-title').html(`Rencana Kunjungan - ${jumlahRencana['kunjungan']}`);
                }

                if($$('.homeGroupKiriman li').length == 1){
                    $$('.homeGroupKiriman').remove();
                } else {
                    $$('.homeGroupKiriman').find('.list-group-title').html(`Rencana Kiriman - ${jumlahRencana['kiriman']}`);
                }

                if($$('.homeGroupCollector li').length == 1){
                    $$('.homeGroupCollector').remove();
                } else {
                    $$('.homeGroupCollector').find('.list-group-title').html(`Rencana Collector - ${jumlahRencana['collector']}`);
                }

            } else {
                $$("#homeListKunjungan").remove();
            }

            if(response.kunjungan.length > 0 ){
                var element =``;
                response.kunjungan.forEach(function(obj,x){
                    element = `<li>
                    <div class="item-content">
                    <div class="item-inner">
                    <div class="item-title" >${obj.NAMAPELANGGAN} - ${obj.KOTA} `;

                    if(obj.jenis =="sesuai_rencana"){
                        element += `<i class="fas fa-star" style="color:orange"></i>`;
                        jumlahKunjungan['sesuai_rencana']++;
                    } else {
                        jumlahKunjungan['tambahan_kunjungan']++;
                    }


                    var waktu = new Date(obj.DATETRANSACTION);
                    
                    var hours = waktu.getHours();
                    hours = ("0" + hours).slice(-2);
                    var minutes = waktu.getMinutes();
                    minutes = ("0" + minutes).slice(-2);
                    var seconds = waktu.getSeconds();
                    seconds = ("0" + seconds).slice(-2);

                    element+=`
                    <div class="item-footer">${hours+':'+minutes+':'+seconds}</div></div>
                    </div>
                    </div>
                    </li>`;
                    $$(".homeGroupKunjungan").find("ul").append(element);

                    element = `<div class="card demo-card-header-pic col-50 desktop-25 tablet-33 marginCard" onClick="DetailIsiRealisasiKunjungan('${obj.NOMORBUKTI}')">`;

                    if(obj.gambar_kunjungan == "ada"){
                        element +=`<div style="background-image:url('${ipGambarKunjungan}${obj.nama_gambar}.jpg?`+ new Date().getTime() +`')"`;
                    } else {
                        element +=`<div style="background-image:url('${noPict}?`+ new Date().getTime() +`')"`;
                    }

                    element +=`class="card-header align-items-flex-end"></div>
                    <div class="card-content card-content-padding">
                    <p class="date">Kunjungan Pukul ${hours+':'+minutes+':'+seconds}</p>
                    <p>`;
                    if(obj.jenis == "sesuai_rencana"){
                        element +=`<i class="fas fa-star" style="color:orange"></i>`;
                    }

                    if(obj.PERMINTAANKHUSUS == "SUPPORT STOK"){
                        element += `<span class="badge color-red">SS</span>`;
                    } else if(obj.PERMINTAANKHUSUS == "SUPPORT HARGA"){
                        element += `<span class="badge color-green">SH</span>`;
                    }
                    element+=` ${obj.NAMAPELANGGAN} - ${obj.KOTA}</p>
                    </div>
                    </div>`;

                    $$("#homeKunjungan").append(element);
                })
                var element = `<i class="fas fa-star" style="color:orange"></i> Sesuai Rencana - ${jumlahKunjungan['sesuai_rencana']}/${jumlahRencana['kunjungan']} /
                Tambahan Kunjungan - ${jumlahKunjungan['tambahan_kunjungan']}`;
                $$('.homeGroupKunjungan').find('.list-group-title').html(element);

                var element = `<i class="fas fa-star" style="color:orange"></i> Sesuai Rencana - ${jumlahKunjungan['sesuai_rencana']}/${jumlahRencana['kunjungan']} / Tambahan Kunjungan
                - ${jumlahKunjungan['tambahan_kunjungan']}`;
                $$("#blockKunjungan").html(element);
            }
            myApp.preloader.hide();
        },
        function(xhr,status){
            PreloaderHide(status);
        })
});

/*detail_realisasi_kunjungan_semua*/
$$(document).on('page:init', '.page[data-name="detail_realisasi_kunjungan_semua"]', function (page) {
    var params = {
        case:"DETAIL_REALISASI_KUNJUNGAN_SEMUA",
        TANGGAL:tanggalRealisasiKunjungan,
    }

    myApp.request.post(ipTujuan,params,
        function(data){
            var response = JSON.parse(data);
            console.log(response);
        },
        function(xhr,status){

        })

});

var divisiJabatan;
var kodeSalesmanDari;
var kodeSalesmanSampai;
var tanggalLaporanDari;
var tanggalLaporanSampai;
//laporan_kunjungan_follow_up_per_staff
$$(document).on('page:init', '.page[data-name="laporan_kunjungan_follow_up_per_staff"]', function (page) {
    myApp.preloader.hide();
    var calendarModal = myApp.calendar.create({
        inputEl: '#dariTanggalLaporanPerStaff',
        openIn: 'customModal',
        header: true,
        footer: true,
        dateFormat: 'MM dd yyyy',
    });

    var calendarModal = myApp.calendar.create({
        inputEl: '#sampaiTanggalLaporanPerStaff',
        openIn: 'customModal',
        header: true,
        footer: true,
        dateFormat: 'MM dd yyyy',
    });

    

    $$('.popup-open-karyawanPelangganDari').on('click',function(){
        myApp.popup.open('.popup-karyawanDari'); 
    });

    $$('.popup-open-karyawanPelangganSampai').on('click',function(){
        myApp.popup.open('.popup-karyawanSampai');
    });

    $$('.btnCancel').on('click',function(){
        myApp.popup.close('.popup-karyawanDari');
        myApp.popup.close('.popup-karyawanSampai');
    });

    

    var act = "TAMPIL_MASTER_JABATAN";
    myApp.request.post(ipTujuan,{case:act},function(data){
        var hasil_json  = JSON.parse(data);
        var tampungJabatan = `<option value="SEMUA">SEMUA</option>`;
        for(var i = 0; i<hasil_json.KODEJABATAN.length; i++){
            tampungJabatan +=`<option value="`+hasil_json.KODEJABATAN[i]+`">`+hasil_json.NAMA[i]+`</option>`;
        }
        $$('.divisiJabatan').html(tampungJabatan);
    });

    PopupLaporanKaryawanDari("SEMUA");
    PopupLaporanKaryawanSampai("SEMUA");
    var searchbar3 = myApp.searchbar.create({
        el: '.searchKaryawanDari',
        searchContainer: '.listPopUpNamaKaryawanDari',
        searchIn: '.namaKaryawanDari',
        on: {
            search(sb, query, previousQuery) {
                console.log(query, previousQuery);
            }
        }
    });

    var searchbar4 = myApp.searchbar.create({
        el: '.searchKaryawanSampai',
        searchContainer: '.listPopUpNamaKaryawanSampai',
        searchIn: '.namaKaryawanSampai',
        on: {
            search(sb, query, previousQuery) {
                console.log(query, previousQuery);
            }
        }
    });

    $$(".divisiJabatan").change(function(){
        PopupLaporanKaryawanDari($$('.divisiJabatan').val());
        PopupLaporanKaryawanSampai($$('.divisiJabatan').val());
        $$('.kodeDariSalesmanLaporan').val("");
        $$('.namaDariSalesmanLaporan').val("");
        $$('.kodeSampaiSalesmanLaporan').val("");
        $$('.namaSampaiSalesmanLaporan').val("");
    });


    

    

    $$('.btnLihatLaporanKunjunganFollowUpPerStaff').on('click',function(){
        divisiJabatan = $$('.divisiJabatan').val();
        kodeSalesmanDari = $$('.kodeDariSalesmanLaporan').val();
        kodeSalesmanSampai = $$('.kodeSampaiSalesmanLaporan').val();
        tanggalLaporanDari = $$('#dariTanggalLaporanPerStaff').val();
        tanggalLaporanSampai = $$('#sampaiTanggalLaporanPerStaff').val();
        
        mainView.router.navigate("/detail_laporan_kunjungan_follow_up_per_staff/");
        myApp.preloader.show();

    });
});


//detail_laporan_kunjungan_follow_up_per_staff
$$(document).on('page:init', '.page[data-name="detail_laporan_kunjungan_follow_up_per_staff"]', function (page) {
    var act = "TAMPIL_DETAIL_LAPORAN_KUNJUNGAN_FOLLOWUP_PER_STAFF";
    var tampungKunjungan = `<canvas id="myChart" width="400" height="400"></canvas>`;
    myApp.request.post(ipTujuan,{case:act,KODEJABATANUSERID:KODEJABATAN,KODECABANG:KODECABANG,KODEJABATAN:divisiJabatan,KODESALESMANDARI:kodeSalesmanDari,KODESALESMANSAMPAI:kodeSalesmanSampai,TANGGALDARI:tanggalLaporanDari,
        TANGGALSAMPAI:tanggalLaporanSampai},function(data){
            var hasil_json = JSON.parse(data);
            var arrNamaKaryawan = [];
            var arrJumlahKunjunganKaryawan = [];
            if(hasil_json.hasil == "ada"){
                for(var i = 0;i<hasil_json.KODEKARYAWANUTAMA.length; i++){
                    arrNamaKaryawan.push(hasil_json.NAMAKARYAWANUTAMA[i]);
                    arrJumlahKunjunganKaryawan.push(hasil_json.TOTALJUMLAHKUNJUNGAN[i]);
                    tampungKunjungan +=`
                    <div class="card">
                    <div class ="card-header cardHeaderBiru">`+hasil_json.NAMAKARYAWANUTAMA[i]+`</div>
                    <div class="card-content card-content-padding">


                    <div class="row">
                    <div class="col-45 cardContentDetail" >Total Kunjungan</div>
                    <div class="col-5 boldHitam"> : </div>
                    <div class="col-50 cardContentHasilDetail kodeJabatan">`+hasil_json.TOTALJUMLAHKUNJUNGAN[i]+`</div>
                    </div>`;

                    for(var j = 0;j<hasil_json.KODEKARYAWAN.length; j++){
                        if(hasil_json.KODEKARYAWAN[j] == hasil_json.KODEKARYAWANUTAMA[i]){
                            tampungKunjungan +=`<div class="row">
                            <div class="col-45 cardContentDetail" >`+hasil_json.PERMINTAANKHUSUS[j]+`</div>
                            <div class="col-5 boldHitam"> : </div>
                            <div class="col-50 cardContentHasilDetail kodeJabatan">`+hasil_json.JUMLAHPERMINTAANKHUSUS[j]+`</div>
                            </div>`;
                        }
                    }
                    tampungKunjungan+=`</div>
                    </div>`;
                }
                $$('.detailLaporanKunjunganFollowUpPerStaff').html(tampungKunjungan);
                ChartKaryawanVsKunjungan(arrNamaKaryawan,arrJumlahKunjunganKaryawan);
                
            } else {
                $$('.detailLaporanKunjunganFollowUpPerStaff').html("Tidak Ada Kunjungan / Follow Up");
            }
            myApp.preloader.hide();
        },function(xhr,status){
            PreloaderHide(status);
        });
});


var KODESALESMANDARIPELANGGANPERTANGGAL;
var KODESALESMANSAMPAIPELANGGANPERTANGGAL;
var TANGGALDARIPELANGGANPERTANGGAL;
var TANGGALSAMPAIPELANGGANPERTANGGAL;
//laporan_pelanggan_per_tanggal
$$(document).on('page:init', '.page[data-name="laporan_pelanggan_per_tanggal"]', function (page) {
    var searchbar3 = myApp.searchbar.create({
        el: '.searchKaryawanDari',
        searchContainer: '.listPopUpNamaKaryawanDari',
        searchIn: '.namaKaryawanDari',
        on: {
            search(sb, query, previousQuery) {
                console.log(query, previousQuery);
            }
        }
    });

    var searchbar4 = myApp.searchbar.create({
        el: '.searchKaryawanSampai',
        searchContainer: '.listPopUpNamaKaryawanSampai',
        searchIn: '.namaKaryawanSampai',
        on: {
            search(sb, query, previousQuery) {
                console.log(query, previousQuery);
            }
        }
    });


    var act ="TAMPIL_NAMA_KARYAWAN";
    myApp.request.post(ipTujuan,{case:act,USERID:USERID},function(data){
        $$('.namaDariSalesmanLaporan').val(data);
        $$('.namaSampaiSalesmanLaporan').val(data);
        $$('.kodeDariSalesmanLaporan').val(USERID);
        $$('.kodeSampaiSalesmanLaporan').val(USERID);
    });


    //myApp.preloader.hide();
    var calendarModal = myApp.calendar.create({
        inputEl: '#dariTanggalLaporanPerStaff',
        openIn: 'customModal',
        header: true,
        footer: true,
        dateFormat: 'MM dd yyyy',
    });

    var calendarModal = myApp.calendar.create({
        inputEl: '#sampaiTanggalLaporanPerStaff',
        openIn: 'customModal',
        header: true,
        footer: true,
        dateFormat: 'MM dd yyyy',
    });

    PopupLaporanKaryawanPerTanggalDari(KODEJABATAN,USERID);
    PopupLaporanKaryawanPerTanggalSampai(KODEJABATAN,USERID);

    

    $$('.popup-open-karyawanPelangganDari').on('click',function(){
        myApp.popup.open('.popup-karyawanDari'); 
    });

    $$('.popup-open-karyawanPelangganSampai').on('click',function(){
        myApp.popup.open('.popup-karyawanSampai');
    });

    $$('.btnCancel').on('click',function(){
        myApp.popup.close('.popup-karyawanDari');
        myApp.popup.close('.popup-karyawanSampai');
    });

    $$('.btnLihatLaporanPelangganPerTanggal').on('click',function(){
        myApp.preloader.show();
        KODESALESMANDARIPELANGGANPERTANGGAL = $$('.kodeDariSalesmanLaporan').val();
        KODESALESMANSAMPAIPELANGGANPERTANGGAL = $$('.kodeSampaiSalesmanLaporan').val();
        TANGGALDARIPELANGGANPERTANGGAL = $$('#dariTanggalLaporanPerStaff').val();
        TANGGALSAMPAIPELANGGANPERTANGGAL = $$('#sampaiTanggalLaporanPerStaff').val();
        if(!KODESALESMANDARIPELANGGANPERTANGGAL){
            alertKosong("Dari Staff");
        } else if(!KODESALESMANDARIPELANGGANPERTANGGAL){
            alertKosong("Sampai Staff");
        } else {
            mainView.router.navigate("/detail_laporan_pelanggan_per_tanggal/");
        }
    });
});

//detail_laporan_pelanggan_per_tanggal
$$(document).on('page:init', '.page[data-name="detail_laporan_pelanggan_per_tanggal"]', function (page) {
    var act = "TAMPIL_LAPORAN_PELANGGAN_PER_TANGGAL";
    myApp.request.post(ipTujuan,{case:act,KODESALESMANDARI:KODESALESMANDARIPELANGGANPERTANGGAL,KODESALESMANSAMPAI:KODESALESMANSAMPAIPELANGGANPERTANGGAL,
        TANGGALDARI:TANGGALDARIPELANGGANPERTANGGAL,TANGGALSAMPAI:TANGGALSAMPAIPELANGGANPERTANGGAL,KODECABANG:KODECABANG},function(data){
            var hasil_json = JSON.parse(data);
            var element_clipboard = "";
            if(hasil_json.hasil == "ada"){
                var tampungHalamanLaporanKunjunganFilter = `<div class="row" style="margin-bottom:5px;">
                <div class="col-100" style="text-align: center"><span style="font-size:1.2em" class="badge color-red"><b>Jumlah Kunjungan : `+hasil_json.TOTJUMLAH+`</b></span></div>
                </div>`;
                tampungHalamanLaporanKunjunganFilter += `<div class="row" style="margin-bottom:5px;">
                <div class="col-100" style="text-align: center"><span style="font-size:1.2em" class="badge color-red"><b>Kunjungan Rutin : `+hasil_json.JUMKUNJUNGAN+`</b></span></div>
                </div>`;
                tampungHalamanLaporanKunjunganFilter += `<div class="row">
                <div class="col-100" style="text-align: center"><span style="font-size:1.2em" class="badge color-red"><b>Follow Up Phone : `+hasil_json.JUMFOLLOW+`</b></span></div>
                </div>`;
                element_clipboard +=`Jumlah Kunjungan : ${hasil_json.TOTJUMLAH}\r\rJumlah Kunjungan Rutin : ${hasil_json.JUMKUNJUNGAN}\r\rJumlah Follow Up By Phone : ${hasil_json.JUMFOLLOW}\r\r`;
                for(var i = 0; i<hasil_json.NOMORBUKTIKUNJUNGAN.length; i++){
                    var today1 = new Date(hasil_json.JAMMASUK[i]);
                    var day1 = today1.getDate();
                    var monthIndex1 = today1.getMonth();
                    var year1 = today1.getFullYear();
                    var hours1 = today1.getHours();
                    hours1 = ("0" + hours1).slice(-2);
                    var minutes1 = today1.getMinutes();
                    minutes1 = ("0" + minutes1).slice(-2);
                    var seconds1 = today1.getSeconds();
                    seconds1 = ("0" + seconds1).slice(-2);


                    var today2 = new Date(hasil_json.JAMREPORT[i]);
                    var day2 = today2.getDate();
                    var monthIndex2 = today2.getMonth();
                    var year2 = today2.getFullYear();
                    var hours2 = today2.getHours();
                    hours2 = ("0" + hours2).slice(-2);
                    var minutes2 = today2.getMinutes();
                    minutes2 = ("0" + minutes2).slice(-2);
                    var seconds2 = today2.getSeconds();
                    seconds2 = ("0" + seconds2).slice(-2);

                    tampungHalamanLaporanKunjunganFilter+=`

                    <div class="card">
                    <div class ="card-header cardHeaderBiru">`+hasil_json.NOMORBUKTIKUNJUNGAN[i]+`</div>
                    <div class="card-content card-content-padding">
                    
                    <div class="row">
                    <div class="col-45 cardContentDetail" >Berkunjung</div>
                    <div class="col-5 boldHitam"> : </div>
                    <div class="col-50 cardContentHasilDetail ">`+hasil_json.NAMAKARYAWAN[i]+`</div>
                    </div>


                    <div class="row">
                    <div class="col-45 cardContentDetail" >Pelanggan</div>
                    <div class="col-5 boldHitam"> : </div>
                    <div class="col-50 cardContentHasilDetail "><a href="" onClick="detailPelanggan('MASTER_PELANGGAN','${hasil_json.KODEPELANGGAN[i]}','${hasil_json.NAMA[i]}',
                    '${hasil_json.ALAMAT[i].replace(/(["'])/g, "\\$1")}','${hasil_json.KOTA[i]}','${hasil_json.TELPON[i]}','${hasil_json.FAX[i]}','${hasil_json.KREDITLIMIT[i]}',
                    '${hasil_json.SYARATPIUTANG[i]}','${hasil_json.SYARATPIUTANGMAX[i]}','${hasil_json.USERID[i]}','${hasil_json.TERM[i]}',
                    '${hasil_json.KATEGORIPELANGGAN[i]}','${hasil_json.ALAMATKIRIM[i]}','TIDAK_MASTER')">` + hasil_json.NAMA[i] + `</a></div>
                    </div>
                    
                    <div class="row">
                    <div class="col-45 cardContentDetail" >Kategori</div>
                    <div class="col-5 boldHitam"> : </div>
                    <div class="col-50 cardContentHasilDetail ">`+hasil_json.KATEGORIPELANGGAN[i]+`</div>
                    </div>


                    <div class="row">
                    <div class="col-45 cardContentDetail" >Jam Login PT</div>
                    <div class="col-5 boldHitam"> : </div>
                    <div class="col-50 cardContentHasilDetail ">`;
                    if(new Date(hasil_json.JAMMASUK[i]) < new Date("1980-01-01")){
                        tampungHalamanLaporanKunjunganFilter += ` - `;
                    } else {
                        tampungHalamanLaporanKunjunganFilter +=day1 + ' ' + monthNames[monthIndex1] + ' ' + year1+ '<br>' +hours1+':'+minutes1+':'+seconds1;
                    }
                    tampungHalamanLaporanKunjunganFilter+=`
                    </div>
                    </div>

                    <div class="row">
                    <div class="col-45 cardContentDetail" >Jam Report Fleet/Toko</div>
                    <div class="col-5 boldHitam"> : </div>
                    <div class="col-50 cardContentHasilDetail ">`+day2 + ' ' + monthNames[monthIndex2] + ' ' + year2+ '<br>' +hours2+':'+minutes2+':'+seconds2+`</div>
                    </div>
                    
                    <div class="row">
                    <div class="col-45 cardContentDetail" >Keterangan</div>
                    <div class="col-5 boldHitam"> : </div>
                    <div class="col-50 cardContentHasilDetail ">`;
                    if(hasil_json.KETERANGAN[i]){
                        tampungHalamanLaporanKunjunganFilter += hasil_json.KETERANGAN[i];
                    } else {
                        tampungHalamanLaporanKunjunganFilter +='-';
                    }
                    tampungHalamanLaporanKunjunganFilter+=`</div>
                    </div>

                    <div class="row">
                    <div class="col-45 cardContentDetail" >Kesimpulan</div>
                    <div class="col-5 boldHitam"> : </div>
                    <div class="col-50 cardContentHasilDetail ">`;
                    if(hasil_json.KESIMPULAN[i]){
                        tampungHalamanLaporanKunjunganFilter += hasil_json.KESIMPULAN[i];
                    } else {
                        tampungHalamanLaporanKunjunganFilter +='-';
                    }
                    tampungHalamanLaporanKunjunganFilter+=`</div>
                    </div>

                    <div class="row">
                    <div class="col-45 cardContentDetail" >Permintaan Khusus</div>
                    <div class="col-5 boldHitam"> : </div>
                    <div class="col-50 cardContentHasilDetail ">`;
                    if(hasil_json.PERMINTAANKHUSUS[i]){
                        tampungHalamanLaporanKunjunganFilter += hasil_json.PERMINTAANKHUSUS[i];
                    } else {
                        tampungHalamanLaporanKunjunganFilter +='-';
                    }
                    tampungHalamanLaporanKunjunganFilter+=`</div>
                    </div>`
                    
                    tampungHalamanLaporanKunjunganFilter += `
                    <div class="row">
                    <div class="col-45 cardContentDetail" >Status Kunjungan</div>
                    <div class="col-5 boldHitam"> : </div>
                    <div class="col-50 cardContentHasilDetail ">`+hasil_json.STATUSKUNJUNGAN[i]+`</div>
                    </div>`;

                    if(hasil_json.hasilgambar == "ada"){
                        counter = 0;
                        for(var j =0; j<hasil_json.COUNTERGAMBAR.length; j++){
                            if(hasil_json.COUNTERGAMBAR[j] == hasil_json.NOMORBUKTIKUNJUNGAN[i]){
                                tampungHalamanLaporanKunjunganFilter +=`
                                <a href ="#" onClick="zoomInOutGambar('${hasil_json.NOMORBUKTIKUNJUNGAN[i]}','`+counter+`')">
                                <img src="`+ipGambarKunjungan+hasil_json.NAMAGAMBAR[j]+`.jpg?`+ new Date().getTime()+`" height="45px" width="45px">
                                </a>
                                `;
                                counter++;
                            } 
                        }
                    }
                    
                    tampungHalamanLaporanKunjunganFilter+=`</div>
                    </div>`;
                    element_clipboard += `Berkunjung : ${hasil_json.NAMAKARYAWAN[i]}\rPelanggan : ${hasil_json.NAMA[i]} \rTanggal : ${ConvertDateTimeToText(hasil_json.JAMMASUK[i],'date')} ${ConvertDateTimeToText(hasil_json.JAMMASUK[i],'timeWithoutSecond')} - ${ConvertDateTimeToText(hasil_json.JAMREPORT[i],'timeWithoutSecond')} \rKeterangan :  ${hasil_json.KETERANGAN[i]} \rKesimpulan : ${hasil_json.KESIMPULAN[i]} \rPermintaan Khusus : ${hasil_json.PERMINTAANKHUSUS[i]} \rStatus Kunjungan : ${hasil_json.STATUSKUNJUNGAN[i]}\r \r`;
                    
                }
                $$('.semuaTampilDetailLaporanPelangganPerTanggal').append(tampungHalamanLaporanKunjunganFilter);
                $$("#clipboard-laporan-pelanggan-pertanggal-semua").val(element_clipboard);

            } else {
                $$('.semuaTampilDetailLaporanPelangganPerTanggal').append("Tidak Ada Laporan");
            }
            myApp.preloader.hide();

        },function(xhr,status){
            PreloaderHide(status);
        });
});




var namaSalesmanRencanaVsKunjunganGlobal = "";
var tanggalSalesmanRencanaVsKunjunganGlobal = "";
//master_rencana_vs_kunjungan
$$(document).on('page:init', '.page[data-name="master_rencana_vs_kunjungan"]', function (page) {
    var calendarModal = myApp.calendar.create({
        inputEl: '#demo-calendar-modal',
        openIn: 'customModal',
        header: true,
        footer: true,
        dateFormat: 'MM dd yyyy',
    });

    var act = "TAMPIL_POPUP_KARYAWAN_PELANGGAN";
    myApp.request.post(ipTujuan,{case:act,KODECABANG:KODECABANG,USERID:USERID},function(data){
        var hasil_json = JSON.parse(data);
        var tampungPopUpKaryawan ="Tidak Memiliki Karyawan Internal";
        if(hasil_json.hasil == "ada"){
            tampungPopUpKaryawan = "";
            for(var i = 0; i<hasil_json.KODEKARYAWAN.length;i++){
                tampungPopUpKaryawan += `<li>
                <a href="#" class="item-link item-content cobaKlik" onClick="pilihFilterKaryawan('`+hasil_json.KODEKARYAWAN[i]+`','`+hasil_json.NAMA[i]+`')">
                <div class="item-inner">
                <div class="item-text namaKaryawan" style="color:black">`+hasil_json.NAMA[i]+`</div>
                </div>
                </a>
                </li>`;
            }
            $$('.listPopUpNamaKaryawan').html(tampungPopUpKaryawan);
        } else {
            $$('.listPopUpNamaKaryawan').html(tampungPopUpKaryawan);
        }
        myApp.preloader.hide();
    });

    $$('.popup-open-karyawanPelanggan').on('click',function(){
        myApp.popup.open('.popup-karyawan'); 
    });

    $$('.btnCancel').on('click',function(){
        myApp.popup.close('.popup-karyawan');
    });

    var searchbar3 = myApp.searchbar.create({
        el: '.searchKaryawan',
        searchContainer: '.list',
        searchIn: '.namaKaryawan',
        on: {
            search(sb, query, previousQuery) {
                console.log(query, previousQuery);
            }
        }
    });

    $$('.btnRencanaVsKunjungan').on('click',function(){
        myApp.preloader.show();
        namaSalesmanRencanaVsKunjunganGlobal = $$('.kodeSalesmanFilterRencanaKunjungan').val();
        tanggalSalesmanRencanaVsKunjunganGlobal = $$('#demo-calendar-modal').val();
        if(!namaSalesmanRencanaVsKunjunganGlobal){
            alertKosong("Salesman");
        } else if(!tanggalSalesmanRencanaVsKunjunganGlobal) {
            alertKosong("Tanggal Kunjungan");
        } else {
            mainView.router.navigate("/detail_rencana_vs_kunjungan/");
        }
    });
});


//detail_rencana_vs_kunjungan
$$(document).on('page:init', '.page[data-name="detail_rencana_vs_kunjungan"]', function(page) {
    myApp.preloader.hide();
    var act = "TAMPIL_DETAIL_RENCANA_VS_KUNJUNGAN";
    myApp.request.post(ipTujuan, { case: act, KODESALESMAN: namaSalesmanRencanaVsKunjunganGlobal, DATETRANSACTION: tanggalSalesmanRencanaVsKunjunganGlobal }, function(data) {
        var hasil_json = JSON.parse(data);

        if (hasil_json.hasil == "ada" || hasil_json.hasilkunjungan == "ada") {
            var jum_tidak_sesuai = 0;
            var jum_sesuai_rencana = 0;
            var jum_tidak_terealisasi = 0;
            var jum_aktivitas_lain = 0;
            var jum_realisasi_phone = 0;
            var jum_luar_rencana_phone = 0;

            for (var i = 0; i < hasil_json.NOMORBUKTI.length; i++) {
                if (hasil_json.STATUSBERKUNJUNG[i] == "TIDAK SESUAI") {
                    jum_tidak_terealisasi++;
                } else if (hasil_json.STATUSBERKUNJUNG[i] == "SESUAI RENCANA") {
                    if (hasil_json.PERMINTAANKHUSUS[i].match(/BY PHONE.*/)) {
                        jum_realisasi_phone++;
                    } else {
                        jum_sesuai_rencana++;
                    }
                } else {
                    if (hasil_json.KODEPELANGGAN[i].match(/AKTIVITAS.*/)) {
                        jum_aktivitas_lain++;
                    } else if (hasil_json.PERMINTAANKHUSUS[i].match(/BY PHONE.*/)) {
                        jum_luar_rencana_phone++;
                    } else {
                        jum_tidak_sesuai++;
                    }
                }

            }
            var res = tanggalSalesmanRencanaVsKunjunganGlobal.split(" ");

            var tampungDetailRencanaVsKunjungan = `<div class="row" style="margin-top:10px;">
            <div class="card col-90 desktop-70 tablet-60 align-self-center" style="margin:0 auto">
                <div class="card-content card-content-padding text-align-center">
                    <div class="card-header">${namaSalesmanRencanaVsKunjunganGlobal} - ${res[1]} ${res[0]} ${res[2]}</div><br>
                    Rencana Kunjungan<span style="font-size:1.5em;font-weight:bold;padding-left:10px;" class="">${jum_sesuai_rencana + jum_tidak_terealisasi + jum_realisasi_phone}</span><br>            
                    Realisasi Kunjungan<span style="font-size:1.5em;font-weight:bold;padding-left:10px;">${jum_sesuai_rencana}</span><br>
                    Realisasi BY PHONE<span style="font-size:1.5em;font-weight:bold;padding-left:10px;">${jum_realisasi_phone}</span><br>
                    Tidak Terealisasi<span style="font-size:1.5em;font-weight:bold;padding-left:10px;" class="">${jum_tidak_terealisasi}</span><br>            
                    Di luar Rencana Kunjungan<span style="font-size:1.5em;font-weight:bold;padding-left:10px;">${jum_tidak_sesuai}</span><br>
                    Di luar Rencana BY PHONE<span style="font-size:1.5em;font-weight:bold;padding-left:10px;">${jum_luar_rencana_phone}</span><br>
                    Aktivitas Lain<span style="font-size:1.5em;font-weight:bold;padding-left:10px;">${jum_aktivitas_lain}</span><br>
                    Start Kunjungan<span style="font-size:1.5em;font-weight:bold;padding-left:10px;">${hasil_json.start}</span><br>
                </div>
            </div></div>
            <div class="row" style="margin-top:10px;">
                <button class="button button-fill col-90 desktop-70 tablet-60 " onClick="ExportRencanaVsKunjungan()" style="margin:0 auto">EXPORT TO EXCEL</button>
            </div>
            <div class="row" style="margin-top:10px;">
                <div class="card col-90 desktop-70 tablet-60 align-self-center" style="margin:0 auto">
                    <div class="card-content card-content-padding text-align-center">
                Realisasi <span style="font-size:0.5em;background-color:green;padding-left:10px;position:relative; bottom:2.5px;margin-right: 10px;" class=""> </span> 
                Di luar Rencana <span style="font-size:0.5em;background-color:#2196F3;padding-left:10px;position:relative; bottom:2.5px;margin-right: 10px;" class=""> </span> 
                Tidak Terealisasi <span style="font-size:0.5em;background-color:red;padding-left:10px;position:relative; bottom:2.5px;margin-right: 10px;" class=""> </span>
                Aktivitas Lain <span style="font-size:0.5em;background-color:#F4511E;padding-left:10px;position:relative; bottom:2.5px;margin-left:5px;" class=""> </span>
                    </div>
            </div></div>`;
            for (var i = 0; i < hasil_json.NOMORBUKTI.length; i++) {
                tampungDetailRencanaVsKunjungan += `<div class="card">
                <div class="accordion-item"><a href="#" class="item-content item-link"><div class ="card-header `;

                if (hasil_json.STATUSBERKUNJUNG[i] == "TIDAK SESUAI" && hasil_json.KODEPELANGGAN[i] != "AKTIVITAS" && hasil_json.KODEPELANGGAN[i] != "AKTIVITAS LAIN") {
                    tampungDetailRencanaVsKunjungan += `cardHeaderMerah`;
                } else if (hasil_json.STATUSBERKUNJUNG[i] == "SESUAI RENCANA" && hasil_json.KODEPELANGGAN[i] != "AKTIVITAS" && hasil_json.KODEPELANGGAN[i] != "AKTIVITAS LAIN") {
                    tampungDetailRencanaVsKunjungan += `cardHeaderHijau`;

                } else {
                    if (hasil_json.KODEPELANGGAN[i].match(/AKTIVITAS.*/)) {
                        tampungDetailRencanaVsKunjungan += `cardHeaderOrange`;
                    } else {
                        tampungDetailRencanaVsKunjungan += `cardHeaderBiru`;
                    }
                }


                tampungDetailRencanaVsKunjungan += `">${hasil_json.NOMORBUKTI[i]} - ${hasil_json.NAMAPELANGGAN[i]} ( ${hasil_json.WAKTUKUNJUNGAN[i]} )</div></a>
                <div class="accordion-item-content">
                <div class="block">
                <div class="card-content card-content-padding">

                <div class="row">
                <div class="col-45 cardContentDetail" >Kode Pelanggan</div>
                <div class="col-5 boldHitam"> : </div>
                <div class="col-50 cardContentHasilDetail kodeJabatan">${hasil_json.KODEPELANGGAN[i]}</div>
                </div>

                <div class="row">
                <div class="col-45 cardContentDetail" >Nama Pelanggan</div>
                <div class="col-5 boldHitam"> : </div>
                <div class="col-50 cardContentHasilDetail namaJabatan">${hasil_json.NAMAPELANGGAN[i]}</div>
                </div>`

                if (hasil_json.STATUSBERKUNJUNG[i] == "TIDAK SESUAI") {
                    tampungDetailRencanaVsKunjungan += `<div class="row">
                    <div class="col-45 cardContentDetail" >Berkunjung</div>
                    <div class="col-5 boldHitam"> : </div>
                    <div class="col-50 cardContentHasilDetail detailCabangJabatan">TIDAK BERKUNJUNG</div>
                    </div>`;
                } else if (hasil_json.STATUSBERKUNJUNG[i] == "SESUAI RENCANA") {
                    tampungDetailRencanaVsKunjungan += `<div class="row">
                    <div class="col-45 cardContentDetail" >Berkunjung</div>
                    <div class="col-5 boldHitam"> : </div>
                    <div class="col-50 cardContentHasilDetail detailCabangJabatan">SESUAI RENCANA</div>
                    </div>`;
                }

                tampungDetailRencanaVsKunjungan += `
                <div class="row">
                <div class="col-45 cardContentDetail" >Salesman</div>
                <div class="col-5 boldHitam"> : </div>
                <div class="col-50 cardContentHasilDetail statusJabatan">${hasil_json.NAMAKARYAWAN[i]}</div>
                </div>


                <div class="row">
                <div class="col-45 cardContentDetail" >Keterangan</div>
                <div class="col-5 boldHitam"> : </div>
                <div class="col-50 cardContentHasilDetail userIdJabatan">`;
                if (hasil_json.KETERANGAN[i]) {
                    tampungDetailRencanaVsKunjungan += hasil_json.KETERANGAN[i];
                } else {
                    tampungDetailRencanaVsKunjungan += ` - `;
                }

                tampungDetailRencanaVsKunjungan += `</div>
                </div>`;


                if (hasil_json.KETERANGANKUNJUNGAN[i]) {
                    tampungDetailRencanaVsKunjungan += `<div class="row">
                    <div class="col-45 cardContentDetail" >Ket Kunjungan</div>
                    <div class="col-5 boldHitam"> : </div>
                    <div class="col-50 cardContentHasilDetail detailCabangJabatan">`;
                    if (hasil_json.KETERANGANKUNJUNGAN[i] == null || hasil_json.KETERANGANKUNJUNGAN[i] == "") {

                        tampungDetailRencanaVsKunjungan += ` - `;
                    } else {
                        tampungDetailRencanaVsKunjungan += hasil_json.KETERANGANKUNJUNGAN[i];
                    }
                    tampungDetailRencanaVsKunjungan += `</div>
                    </div>`;
                }

                if (hasil_json.KESIMPULAN[i]) {
                    tampungDetailRencanaVsKunjungan += `<div class="row">
                    <div class="col-45 cardContentDetail" >Kesimpulan</div>
                    <div class="col-5 boldHitam"> : </div>
                    <div class="col-50 cardContentHasilDetail detailCabangJabatan">`;
                    if (hasil_json.KESIMPULAN[i] == null || hasil_json.KESIMPULAN[i] == "") {
                        tampungDetailRencanaVsKunjungan += ` - `;
                    } else {
                        tampungDetailRencanaVsKunjungan += hasil_json.KESIMPULAN[i];
                    }
                    tampungDetailRencanaVsKunjungan += `</div>
                 </div>`;
                }

                if (hasil_json.PERMINTAANKHUSUS[i]) {
                    tampungDetailRencanaVsKunjungan += `<div class="row">
                <div class="col-45 cardContentDetail" >Permintaan Khusus</div>
                <div class="col-5 boldHitam"> : </div>
                <div class="col-50 cardContentHasilDetail detailCabangJabatan">${hasil_json.PERMINTAANKHUSUS[i]}</div>
                </div>`;
                }




                tampungDetailRencanaVsKunjungan += `
            </div></div>
            </div>
            </div>
            </div>`;
            }
            $$('.semuaDetailRencanaVsKunjungan').html(tampungDetailRencanaVsKunjungan);

        } else {
            $$('.semuaDetailRencanaVsKunjungan').html('Tidak Ada Rencana Kunjungan / Kunjungan');
        }
    });


});


//ubah_password
$$(document).on('page:init', '.page[data-name="ubah_password"]', function (page) {
    myApp.preloader.hide();
    $$("input[type=password]").keyup(function(){
        $$(this).val( $$(this).val().toUpperCase() );
    });

    $$('.usernameUbahPassword').val(USERID);

    $$('.btnSimpanUbahPassword').on('click',function(){

        myApp.preloader.show();
        var act = "UBAH_PASSWORD";
        var PASSWORDLAMA = $$('.passwordLamaUbahPassword').val();
        var PASSWORDBARU = $$('.passwordBaruUbahPassword').val();
        var VERIFIKASIPASSWORDBARU = $$('.verifikasiUbahPassword').val();
        console.log(PASSWORDLAMA);
        if(PASSWORDBARU == VERIFIKASIPASSWORDBARU){
            myApp.request.post(ipTujuan,{case:act,USERID:USERID,PASSWORDLAMA:PASSWORDLAMA,PASSWORDBARU:PASSWORDBARU},function(data){
                var hasil_json = JSON.parse(data);
                if(hasil_json.hasil == "ada"){
                    myApp.dialog.alert("Password Anda Berhasil Diubah");
                    myApp.preloader.hide();
                    mainView.router.navigate("/home/");
                } else {
                    myApp.preloader.hide();
                    myApp.dialog.alert("Password Lama Anda Salah");
                }
            });
        } else if(PASSWORDBARU == "" || VERIFIKASIPASSWORDBARU == ""){
            myApp.preloader.hide();
            myApp.dialog.alert("Password Baru Tidak Boleh Kosong");
        } else {
            myApp.preloader.hide();
            myApp.dialog.alert("Password dan Verifikasi Password Tidak Sama");
        }
    });
});

gmarkers = [];

//halaman_coba_coba
$$(document).on('page:init', '.page[data-name="halaman_coba_coba2"]', function (page) {
    myApp.preloader.hide();
    marker = [];
    /*var position = {
        lat: parseFloat(hasil_json.LATITUDE[0]),
        lng: parseFloat(hasil_json.LONGITUDE[0])
    }
    map = new google.maps.Map(document.getElementById('map'), {
        center: position,
        zoom: 8,
    });*/

    var positionz = [-7.599, 111.584,-7.5199, 112.584];

    var latz = [-7.599,-7.5199];
    var lngz = [111.584,112.584];


    var position = {
        lat: parseFloat(latz[0]),
        lng: parseFloat(lngz[0])
    }


    map = new google.maps.Map(document.getElementById('map'), {
        center: position,
        zoom: 8,
    });

    marker[0] = new google.maps.Marker({
        position: {
            lat: parseFloat(latz[0]),
            lng: parseFloat(lngz[0])
        },
        map: map,
        label: "COBA AJA",
        title: "Latitude:"+positionz[0]+" | Longitude:"+positionz[1]
    });

    marker[1] = new google.maps.Marker({
        position:  {
            lat: parseFloat(latz[1]),
            lng: parseFloat(lngz[1])
        },
        map: map,
        label: "COBA 2",
        title: "Latitude:"+positionz[2]+" | Longitude:"+positionz[3]
    });

    /*marker = new google.maps.Marker({
        position: {
            lat: parseFloat(8.1),
            lng: parseFloat(112)
        },
        map: map,
        label: "zCOBA AJA",
        title: "Latitude:"+positionz[0]+" | Longitude:"+positionz[1]
    });*/

    var a = 0;
    var resultLat = [-7.15002, -7.15002];
    var resultLng = [111.45, 111.45];


    /*var numDeltas = 100;
    var delay = 10; 
    var i = 0;
    var deltaLat;
    var deltaLng;*/

    var i = [];
    var deltaLat = [];
    var deltaLng = [];

    var latlng = {};

    var numDeltas = 100;
    var delay = 10;


    i[0] = 0;
    deltaLat[0];
    deltaLng[0];


    i[1] = 0;
    deltaLat[1];
    deltaLng[1];

    var cc = 0;

    $$('.klikcobadonk').on('click',function(){
        /*for(var i = 0; i<marker.length;i++){
            transition(resultLat,resultLng,i);
        }  */

        console.log(cc);
        if(cc == 0){
            resultLat = [-7.699, -7.5199];
            resultLng = [111.584, 112.584];
        } else if(cc == 1){
            resultLat = [-7.799, -7.5199];
            resultLng = [111.584, 112.584];
        } else {
            resultLat = [-7.1511106, -7.15002];
            resultLng = [111.8829158, 111.45];
        }
        cc++;
        transition(resultLat,resultLng,i);  
    });

    /*var numDeltas = 100;
    var delay = 10; 
    var i = 0;
    var deltaLat;
    var deltaLng;*/

    function transition(resultLat,resultLng,idx){
        for(j = 0; j<marker.length;j++){
            i[j] = 0;
            deltaLat[j] = (resultLat[j] - latz[j])/numDeltas;
            deltaLng[j] = (resultLng[j] - lngz[j])/numDeltas;
        }

        moveMarker();
        /*i[a] = 0;
        deltaLat[a] = (resultLat[a] - latz[a])/numDeltas;
        deltaLng[a] = (resultLng[a] - lngz[a])/numDeltas;
        moveMarker();*/
    }

    function moveMarker(){
        for(j = 0; j<marker.length;j++){
            latz[j] += deltaLat[j];
            lngz[j] += deltaLng[j];
            latlng[j] = new google.maps.LatLng(latz[j], lngz[j]);
            marker[j].setTitle("Latitude:"+positionz[j]+" | Longitude:"+positionz[j]);
            marker[j].setPosition(latlng[j]);
        }

        if((i[a] + 1)!=numDeltas){
            i[a]++;
            
            setTimeout(moveMarker, delay);
        }


               /* setTimeout(moveMarker, delay);

        if(i[a]!=numDeltas){
                i[a]++;
                if(a!=(marker.length-1)){
                    a++;
                    transition(resultLat,resultLng,a);      
                }
                setTimeout(moveMarker, delay);
            } */

        /*latz[a] += deltaLat[a];
        lngz[a] += deltaLng[a];
        latlng[a] = new google.maps.LatLng(latz[a], lngz[a]);
        marker[a].setTitle("Latitude:"+positionz[a]+" | Longitude:"+positionz[a]);
        marker[a].setPosition(latlng[a]);*/

        /*if(i[a]!=numDeltas){
            i[a]++;
            if(a!=(marker.length-1)){
                a++;
                transition(resultLat,resultLng,a);      
            }
            setTimeout(moveMarker, delay);
        } */


        /*else {
            console.log(a);
            
            if(a!=(marker.length-1)){
                a++;
                console.log(a);
                transition(resultLat,resultLng,a);      
            }
        }*/
    }

    /*var act = "PEMANTAUAN_SEMUA_USER_LATITUDE_LONGITUDE";
    myApp.request.post(ipTujuan,{case:act},function(data){
        var hasil_json = JSON.parse(data);
        if(hasil_json.hasil == "ada"){
            var position = {
                lat: parseFloat(position[0]),
                lng: parseFloat(position[1])
            }
            map = new google.maps.Map(document.getElementById('map'), {
                center: position,
                zoom: 8,
            });
        } else {
            myApp.dialog.alert("Maaf Hubungi Admin Terlebih Dahulu");
        }
    });
    */



    /*setInterval(function(){

        var act = "PEMANTAUAN_SEMUA_USER_LATITUDE_LONGITUDE";
        myApp.request.post(ipTujuan,{case:act},function(data){
            var hasil_json = JSON.parse(data);
            if(hasil_json.hasil == "ada"){
                console.log("peta");
                for(var i = 0; i<gmarkers.length; i++){
                    gmarkers[i].setMap(null);
                }
                for(var i = 0; i<hasil_json.USERID.length;i++){
                    setPositionPetaByLatLong(hasil_json.LATITUDE[i],hasil_json.LONGITUDE[i],hasil_json.USERID[i]);
                }
            } else {
                myApp.dialog.alert("Maaf Hubungi Admin Terlebih Dahulu");
            }
        });
    }, 3000);*/

    

    /*arrLat = ['-7.1499','-7.599','-7.9499'];
    arrLong = ['111.884','111.584','111.184'];
    var position = {
        lat: parseFloat(-7.1499),
        lng: parseFloat(111.884)
    }
    

    marker = new google.maps.Marker({
        position: position,
        label: counter.toString(),
        map: map
    });
    i=0;
    setInterval(function(){ 
        if(i>2){
            i=0;
        }
        var position = {
            lat: parseFloat(arrLat[i]),
            lng: parseFloat(arrLong[i])
        }
        marker.setPosition(position);
        i++;
    }, 3000);*/
});


//halaman_coba_coba
$$(document).on('page:init', '.page[data-name="halaman_coba_coba"]', function (page) {
    $$('.back').on('click',function(){
        clearInterval(interval);
    });
    
    myApp.preloader.hide();
    marker = [];
    var latz = [];
    var lngz = [];
    var resultLat = [];
    var resultLng = [];
    

    var act = "PEMANTAUAN_SEMUA_USER_LATITUDE_LONGITUDE";
    myApp.request.post(ipTujuan,{case:act,KODECABANG:KODECABANG},function(data){
        var hasil_json = JSON.parse(data);
        if(hasil_json.hasil == "ada"){
            var position = {
                lat: parseFloat(hasil_json.LATITUDE[0]),
                lng: parseFloat(hasil_json.LONGITUDE[0])
            }
            map = new google.maps.Map(document.getElementById('map'), {
                center: position,
                zoom: 8,
            });

            for(var i = 0; i<hasil_json.USERID.length;i++){
                marker[i] = new google.maps.Marker({
                    position: {
                        lat: parseFloat(hasil_json.LATITUDE[i]),
                        lng: parseFloat(hasil_json.LONGITUDE[i])
                    },
                    map: map,
                    label: {
                        text:hasil_json.USERID[i],
                        x:'200',
                        y:'35',
                        color: "black",
                        fontWeight:"bold",
                    },
                    icon: {
                        url:iconCar,
                        scaledSize: new google.maps.Size(32, 32),
                        labelOrigin: new google.maps.Point(14, -5)
                    }
                });

                latz[i] = parseFloat(hasil_json.LATITUDE[i]);
                lngz[i] = parseFloat(hasil_json.LONGITUDE[i]);


            }

            myApp.preloader.hide();
        } else {
            myApp.dialog.alert("Maaf Hubungi Admin Terlebih Dahulu");
        }
        myApp.preloader.hide();
    });


    var a = 0;
    

    var i = [];
    var deltaLat = [];
    var deltaLng = [];

    var latlng = {};

    var numDeltas = 100;
    var delay = 10;


    i[0] = 0;
    deltaLat[0];
    deltaLng[0];


    i[1] = 0;
    deltaLat[1];
    deltaLng[1];

    var cc = 0;



    interval = setInterval(function(){
        console.log("peta");
        var act = "PEMANTAUAN_SEMUA_USER_LATITUDE_LONGITUDE";
        myApp.request.post(ipTujuan,{case:act,KODECABANG:KODECABANG},function(data){
            var hasil_json = JSON.parse(data);
            for(var i = 0; i<hasil_json.USERID.length;i++){
             resultLat[i] = hasil_json.LATITUDE[i];
             resultLng[i] = hasil_json.LONGITUDE[i];
         }
         transition(resultLat,resultLng,i);
     });
    }, 5000)

    function transition(resultLat,resultLng,idx){
        for(j = 0; j<marker.length;j++){
            i[j] = 0;
            deltaLat[j] = (resultLat[j] - latz[j])/numDeltas;
            deltaLng[j] = (resultLng[j] - lngz[j])/numDeltas;
        }

        moveMarker();
    }

    function moveMarker(){
        for(j = 0; j<marker.length;j++){
            latz[j] += deltaLat[j];
            lngz[j] += deltaLng[j];
            latlng[j] = new google.maps.LatLng(latz[j], lngz[j]);
            marker[j].setPosition(latlng[j]);
        }

        if((i[a] + 1)!=numDeltas){
            i[a]++;
            
            setTimeout(moveMarker, delay);
        }
    }
});

//pemantauan_lokasi
$$(document).on('page:init', '.page[data-name="pemantauan_lokasi"]', function (page) {
    var position = {
        lat: parseFloat(latitudePemantauanLokasi),
        lng: parseFloat(longitudePemantauanLokasi)
    }

    map = new google.maps.Map(document.getElementById('map'), {
        center: position,
        zoom: 8,
    });

    marker = new google.maps.Marker({
        position: {
            lat: parseFloat(latitudePemantauanLokasi),
            lng: parseFloat(longitudePemantauanLokasi)
        },
        map: map,
    });
});


//pemantauan_user
$$(document).on('page:init', '.page[data-name="pemantauan_user"]', function (page) {
    /*$$('.back').on('click',function(){
        clearInterval(interval);
    });

    var act = "PEMANTAUAN_SEMUA_USER_LATITUDE_LONGITUDE";
    myApp.request.post(ipTujuan,{case:act},function(data){
        var hasil_json = JSON.parse(data);
        if(hasil_json.hasil == "ada"){
            var position = {
                lat: parseFloat(hasil_json.LATITUDE[0]),
                lng: parseFloat(hasil_json.LONGITUDE[0])
            }
            map = new google.maps.Map(document.getElementById('map'), {
                center: position,
                zoom: 16,
            });

            for(var i = 0; i<hasil_json.USERID.length;i++){
                setPositionPetaByLatLong(hasil_json.LATITUDE[i],hasil_json.LONGITUDE[i],hasil_json.USERID[i]);
            }

            myApp.preloader.hide();
        } else {
            myApp.dialog.alert("Maaf Hubungi Admin Terlebih Dahulu");
        }
        myApp.preloader.hide();
    });


    interval = setInterval(function(){

        var act = "PEMANTAUAN_SEMUA_USER_LATITUDE_LONGITUDE";
        myApp.request.post(ipTujuan,{case:act},function(data){
            var hasil_json = JSON.parse(data);
            if(hasil_json.hasil == "ada"){
                console.log("peta");
                for(var i = 0; i<gmarkers.length; i++){
                    gmarkers[i].setMap(null);
                }
                for(var i = 0; i<hasil_json.USERID.length;i++){
                    setPositionPetaByLatLong(hasil_json.LATITUDE[i],hasil_json.LONGITUDE[i],hasil_json.USERID[i]);
                    tampungLatLama = hasil_json.LATITUDE[i];
                    tampungLngLama = hasil_json.LONGITUDE[i];
                }
            } else {
                myApp.dialog.alert("Maaf Hubungi Admin Terlebih Dahulu");
            }
        });
    }, 10000);*/

    $$('.back').on('click',function(){
        clearInterval(interval);
    });
    
    myApp.preloader.hide();
    marker = [];
    var latz = [];
    var lngz = [];
    var resultLat = [];
    var resultLng = [];
    

    var act = "PEMANTAUAN_SEMUA_USER_LATITUDE_LONGITUDE";
    myApp.request.post(ipTujuan,{case:act,KODECABANG:KODECABANG},function(data){
        var hasil_json = JSON.parse(data);
        if(hasil_json.hasil == "ada"){
            var position = {
                lat: parseFloat(hasil_json.LATITUDE[19]),
                lng: parseFloat(hasil_json.LONGITUDE[19])
            }

            map = new google.maps.Map(document.getElementById('map'), {
                center: position,
                zoom: 8,
            });

            for(var i = 0; i<hasil_json.USERID.length;i++){
                marker[i] = new google.maps.Marker({
                    position: {
                        lat: parseFloat(hasil_json.LATITUDE[i]),
                        lng: parseFloat(hasil_json.LONGITUDE[i])
                    },
                    map: map,
                    label: {
                        text:hasil_json.USERID[i],
                        x:'200',
                        y:'35',
                        color: "black",
                        fontWeight:"bold",
                    },
                    icon: {
                        url:iconCar,
                        scaledSize: new google.maps.Size(32, 32),
                        labelOrigin: new google.maps.Point(14, -5)
                    }
                });

                latz[i] = parseFloat(hasil_json.LATITUDE[i]);
                lngz[i] = parseFloat(hasil_json.LONGITUDE[i]);


            }

            myApp.preloader.hide();
        } else {
            myApp.dialog.alert("Maaf Hubungi Admin Terlebih Dahulu");
        }
        myApp.preloader.hide();
    });


    var a = 0;
    

    var i = [];
    var deltaLat = [];
    var deltaLng = [];

    var latlng = {};

    var numDeltas = 100;
    var delay = 10;


    i[0] = 0;
    deltaLat[0];
    deltaLng[0];


    i[1] = 0;
    deltaLat[1];
    deltaLng[1];

    var cc = 0;



    interval = setInterval(function(){
        console.log("peta");
        var act = "PEMANTAUAN_SEMUA_USER_LATITUDE_LONGITUDE";
        myApp.request.post(ipTujuan,{case:act,KODECABANG:KODECABANG},function(data){
            var hasil_json = JSON.parse(data);
            for(var i = 0; i<hasil_json.USERID.length;i++){
                resultLat[i] = hasil_json.LATITUDE[i];
                resultLng[i] = hasil_json.LONGITUDE[i];
            }
            transition(resultLat,resultLng,i);
        });
    }, 5000)

    function transition(resultLat,resultLng,idx){
        for(j = 0; j<marker.length;j++){
            i[j] = 0;
            deltaLat[j] = (resultLat[j] - latz[j])/numDeltas;
            deltaLng[j] = (resultLng[j] - lngz[j])/numDeltas;
        }

        moveMarker();
    }

    function moveMarker(){
        for(j = 0; j<marker.length;j++){
            latz[j] += deltaLat[j];
            lngz[j] += deltaLng[j];
            latlng[j] = new google.maps.LatLng(latz[j], lngz[j]);
            marker[j].setPosition(latlng[j]);
        }

        if((i[a] + 1)!=numDeltas){
            i[a]++;
            
            setTimeout(moveMarker, delay);
        }
    }
    
});



//master_laporan_pelanggan
$$(document).on('page:init', '.page[data-name="master_laporan_pelanggan"]', function (page) {
    //try items virtual list
    var items = [];
    var act = "TAMPIL_MASTER_PELANGGAN";
    var semuaTampilMasterLaporanPelanggan = "";

    myApp.request.post(ipTujuan,{case:act,KODECABANG:KODECABANG,USERID:USERID,KODEJABATAN:KODEJABATAN},function(data){
        var hasil_json = JSON.parse(data);
        if(hasil_json.hasil == "ada"){
            for (var i = 0; i < hasil_json.KODEPELANGGAN.length; i++) {
              items.push({
                KODEPELANGGAN: hasil_json.KODEPELANGGAN[i],
                NAMA: hasil_json.NAMA[i],
                ALAMAT:hasil_json.ALAMAT[i],
                KOTA:hasil_json.KOTA[i],
                TELPON:hasil_json.TELPON[i],
                FAX:hasil_json.FAX[i],
                KREDITLIMIT:hasil_json.KREDITLIMIT[i],
                SYARATPIUTANG:hasil_json.SYARATPIUTANG[i],
                SYARATPIUTANGMAX:hasil_json.SYARATPIUTANGMAX[i],
                USERID: hasil_json.USERID[i],
                TERM:hasil_json.TERM[i],
                KATEGORIPELANGGAN:hasil_json.KATEGORIPELANGGAN[i],
                ALAMATKIRIM:hasil_json.ALAMATKIRIM[i]
            });
          }
          var virtualList = myApp.virtualList.create({
              el: '.virtual-list',
              items: items,
              searchAll: function (query, items) {
                var found = [];
                for (var i = 0; i < items.length; i++) {
                  if ( items[i].USERID.toLowerCase().indexOf(query.toLowerCase()) >= 0 || items[i].NAMA.toLowerCase().indexOf(query.toLowerCase()) >= 0 || query.trim() === '' ) found.push(i);
              }
              return found; 
          },
          itemTemplate:
          `<li>
          <a href="#" class="item-link item-content" onClick="detailLaporanPelanggan('MASTER_LAPORAN_PELANGGAN','{{KODEPELANGGAN}}')">
          <div class="item-inner">
          <div class="item-title-row">

          <div class="item-text namaTokoSearch" style="color:black"><b>{{NAMA}}</b></div>

          </div>
          <div class="item-text" style="color:black">{{ALAMAT}}</div>        
          </div>
          </a>
          </li>`,
          height: myApp.theme === 'ios' ? 63 : 73,
      });

      } else {
        $$('.virtual-list').html("Belum Memiliki Laporan Pelanggan");
    }

    myApp.preloader.hide();
});
    /*var act = "TAMPIL_MASTER_PELANGGAN";
    var semuaTampilMasterLaporanPelanggan = "";

    myApp.request.post(ipTujuan,{case:act,KODECABANG:KODECABANG,USERID:USERID,KODEJABATAN:KODEJABATAN},function(data){
        var hasil_json = JSON.parse(data);
        
        if(hasil_json.hasil == "ada"){
            semuaTampilMasterLaporanPelanggan += `<ul>`;
            for(var i = 0; i<hasil_json.KODEPELANGGAN.length; i++){
                semuaTampilMasterLaporanPelanggan+=`
                <li>
                <a href="#" class="item-link item-content" onClick="detailLaporanPelanggan('MASTER_LAPORAN_PELANGGAN','`+hasil_json.KODEPELANGGAN[i]+`')">
                <div class="item-inner">
                <div class="item-title-row">

                <div class="item-text namaTokoSearch" style="color:black"><b>`+hasil_json.NAMA[i]+`</b>  <span class="badge color-green">  `+hasil_json.USERID[i]+`</span></div>

                </div>
                <div class="item-text" style="color:black">`+hasil_json.ALAMAT[i]+`</div>        
                </div>
                </a>
                </li>`;
            }
            semuaTampilMasterLaporanPelanggan += `</ul>`;
        } else {
            $$('.semuaTampilMasterLaporanPelanggan').html("Belum Memiliki Daftar Pelanggan");
        }
        $$('.semuaTampilMasterLaporanPelanggan').html(semuaTampilMasterLaporanPelanggan);
        myApp.preloader.hide();
    });

    var searchbar = myApp.searchbar.create({
        el: '.searchMasterLaporanPelanggan',
        searchContainer: '.list',
        searchIn: '.namaTokoSearch',
        on: {
            search(sb, query, previousQuery) {
                console.log(query, previousQuery);
            }
        }
    });*/
});

//detail_laporan_pelanggan
$$(document).on('page:init', '.page[data-name="detail_laporan_pelanggan"]', function (page) {
    myApp.preloader.hide();
    var act = "TAMPIL_SEMUA_LAPORAN_PELANGGAN";
    myApp.request.post(ipTujuan,{case:act,KODEPELANGGAN:tampungKodeDetailLaporanPelanggan},function(data){
        var hasil_json = JSON.parse(data);
        var tampungSemuaLaporanPelanggan = "";

        if(hasil_json.hasil == "ada"){
            //var tampungSemuaLaporanPelanggan = "";
            
            for(var i = 0;i<hasil_json.NOMORBUKTI.length;i++){

                var today1 = new Date(hasil_json.JAMMASUK[i]);
                var day1 = today1.getDate();
                var monthIndex1 = today1.getMonth();
                var year1 = today1.getFullYear();
                var hours1 = today1.getHours();
                hours1 = ("0" + hours1).slice(-2);
                var minutes1 = today1.getMinutes();
                minutes1 = ("0" + minutes1).slice(-2);
                var seconds1 = today1.getSeconds();
                seconds1 = ("0" + seconds1).slice(-2);

                var today2 = new Date(hasil_json.DATETRANSACTION[i]);
                var day2 = today2.getDate();
                var monthIndex2 = today2.getMonth();
                var year2 = today2.getFullYear();
                var hours2 = today2.getHours();
                hours2 = ("0" + hours2).slice(-2);
                var minutes2 = today2.getMinutes();
                minutes2 = ("0" + minutes2).slice(-2);
                var seconds2 = today2.getSeconds();
                seconds2 = ("0" + seconds2).slice(-2);

                tampungSemuaLaporanPelanggan +=`
                <div class="card">
                <div class =" card-header cardHeaderBiru">${hasil_json.NOMORBUKTI[i]}</div>
                <div class="card-content card-content-padding">


                <div class="row">
                <div class="col-45 cardContentDetail" >Pelanggan</div>
                <div class="col-5 boldHitam"> : </div>
                <div class="col-50 cardContentHasilDetail ">${hasil_json.NAMA[i]}</div>
                </div>

                <div class="row">
                <div class="col-45 cardContentDetail" >Alamat</div>
                <div class="col-5 boldHitam"> : </div>
                <div class="col-50 cardContentHasilDetail ">${hasil_json.ALAMAT[i]}</div>
                </div>

                <div class="row">
                <div class="col-45 cardContentDetail" >Berkunjung</div>
                <div class="col-5 boldHitam"> : </div>
                <div class="col-50 cardContentHasilDetail ">${hasil_json.NAMAKARYAWAN[i]}</div>
                </div>
                
                <div class="row">
                <div class="col-45 cardContentDetail" >Jam Login PT</div>
                <div class="col-5 boldHitam"> : </div>
                <div class="col-50 cardContentHasilDetail ">`;
                if(new Date(hasil_json.JAMMASUK[i]) < new Date("1980-01-01")){
                    tampungSemuaLaporanPelanggan += ` - `;
                } else {
                    tampungSemuaLaporanPelanggan +=day1 + ' ' + monthNames[monthIndex1] + ' ' + year1+ '<br>' +hours1+':'+minutes1+':'+seconds1;
                }
                

                tampungSemuaLaporanPelanggan+=`</div>
                </div>

                <div class="row">
                <div class="col-45 cardContentDetail" >Jam Report Fleet/Toko</div>
                <div class="col-5 boldHitam"> : </div>
                <div class="col-50 cardContentHasilDetail ">`+day2 + ' ' + monthNames[monthIndex2] + ' ' + year2+ '<br>' +hours2+':'+minutes2+':'+seconds2+`</div>
                </div>

                <div class="row">
                <div class="col-45 cardContentDetail" >Keterangan</div>
                <div class="col-5 boldHitam"> : </div>
                <div class="col-50 cardContentHasilDetail ">`+hasil_json.KETERANGAN[i]+`</div>
                </div>

                <div class="row">
                <div class="col-45 cardContentDetail" >Kesimpulan</div>
                <div class="col-5 boldHitam"> : </div>
                <div class="col-50 cardContentHasilDetail ">`+hasil_json.KESIMPULAN[i]+`</div>
                </div>

                <div class="row">
                <div class="col-45 cardContentDetail" >Permintaan Khusus</div>
                <div class="col-5 boldHitam"> : </div>
                <div class="col-50 cardContentHasilDetail ">`+hasil_json.PERMINTAANKHUSUS[i]+`</div>
                </div>`;

                if(hasil_json.hasilgambar == "ada"){
                    counter = 0;
                    for(var j =0; j<hasil_json.COUNTERGAMBAR.length; j++){
                        if(hasil_json.COUNTERGAMBAR[j] == hasil_json.NOMORBUKTI[i]){
                            tampungSemuaLaporanPelanggan +=`
                            <a href ="#" onClick="zoomInOutGambar('${hasil_json.NOMORBUKTI[i]}','`+counter+`')">
                            <img src="`+ipGambarKunjungan+hasil_json.NAMAGAMBAR[j]+`.jpg?`+ new Date().getTime()+`" height="45px" width="45px">
                            </a>
                            `;
                            counter++;
                        } 
                    }
                }
                
                tampungSemuaLaporanPelanggan+=`</div>
                </div>`;

            }
            $$('.semuaTampilDetailLaporanPelanggan').append(tampungSemuaLaporanPelanggan);
        } else{
            myApp.dialog.alert("Tidak Ada Kunjungan");
            $$('.semuaTampilDetailLaporanPelanggan').html("Belum Ada Kunjungan");
        }
        
        myApp.preloader.hide();
    });
});

//master_laporan_rencana_kunjungan
$$(document).on('page:init', '.page[data-name="master_laporan_rencana_kunjungan"]', function (page) {
    filterRencanaKunjunganSalesmanGlobal = "";
    myApp.preloader.hide();
    /*var act = "TAMPIL_SEMUA_LAPORAN_RENCANA_KUNJUNGAN";
    var tampungMasterLaporanRencanaKunjungan = "";
    myApp.request.post(ipTujuan,{case:act,KODEJABATAN:KODEJABATAN,USERID:USERID,KODECABANG:KODECABANG},function(data){
        var hasil_json = JSON.parse(data);
        if(hasil_json.hasil == "ada"){
            tampungMasterLaporanRencanaKunjungan = "<ul>";
            for(var i = 0; i<hasil_json.DATETRANSACTION.length;i++){
                var today = new Date(hasil_json.DATETRANSACTION[i]);
                var day = today.getDate();
                var monthIndex = today.getMonth();
                var year = today.getFullYear();

                tampungMasterLaporanRencanaKunjungan += `<li>
                <a href="#" onClick="klikListLaporanRencanaKunjungan('`+hasil_json.DATETRANSACTION[i]+`')" class="item-link item-content">
                <div class="item-inner">
                <div class="item-title">`+day + ' ' + monthNames[monthIndex] + ' ' + year+`</div>
                <div class="item-after">`+hasil_json.JUMLAHKUNJUNGAN[i]+`</div>
                </div>
                </a>
                </li>`;    
            }

            tampungMasterLaporanRencanaKunjungan += "</ul>";
        } else {
            tampungMasterLaporanRencanaKunjungan = "Belum Ada Laporan Rencana Kunjungan";
        }
        $$('.semuaTampilMasterLaporanRencanaKunjungan').html(tampungMasterLaporanRencanaKunjungan);
    });*/

    var maxItems;
    var TANGGAL = [];
    var JUMLAHKUNJUNGAN = [];
    var total = 0;
    var itemsPerLoad = 20;
    var act = "TAMPIL_SEMUA_LAPORAN_RENCANA_KUNJUNGAN";
    var tampungMasterLaporanRencanaKunjungan = "";
    myApp.request.post(ipTujuan,{case:act,KODEJABATAN:KODEJABATAN,USERID:USERID,KODECABANG:KODECABANG},function(data){
        var hasil_json = JSON.parse(data);
        if(hasil_json.hasil == "ada"){
            maxItems = hasil_json.DATETRANSACTION.length;
            TANGGAL = hasil_json.DATETRANSACTION;
            JUMLAHKUNJUNGAN = hasil_json.JUMLAHKUNJUNGAN;
            if(TANGGAL.length < itemsPerLoad){
                total = TANGGAL.length;
            } else {
                total = itemsPerLoad;
            }
            tampungMasterLaporanRencanaKunjungan = "<ul>";
            for(var i = 0; i<total;i++){
                var today = new Date(hasil_json.DATETRANSACTION[i]);
                var day = today.getDate();
                var monthIndex = today.getMonth();
                var year = today.getFullYear();

                tampungMasterLaporanRencanaKunjungan += `<li>
                <a href="#" onClick="klikListLaporanRencanaKunjungan('`+hasil_json.DATETRANSACTION[i]+`')" class="item-link item-content">
                <div class="item-inner">
                <div class="item-title">`+day + ' ' + monthNames[monthIndex] + ' ' + year+`</div>
                <div class="item-after">`+hasil_json.JUMLAHKUNJUNGAN[i]+`</div>
                </div>
                </a>
                </li>`;    
            }

            tampungMasterLaporanRencanaKunjungan += "</ul>";
        } else {
            tampungMasterLaporanRencanaKunjungan = "Belum Ada Laporan Rencana Kunjungan";
        }
        $$('.semuaTampilMasterLaporanRencanaKunjungan').html(tampungMasterLaporanRencanaKunjungan);
        var allowInfinite = true;
        var lastItemIndex = $$('.semuaTampilMasterLaporanRencanaKunjungan li').length;


        if(total < itemsPerLoad){
            myApp.infiniteScroll.destroy('.infinite-scroll-content');
            $$('.infinite-scroll-preloader').remove();
        } 


        $$('.infinite-scroll-content').on('infinite', function () {
          if (!allowInfinite){
            return;
        }  
        allowInfinite = false;

        setTimeout(function () {
            allowInfinite = true;
            if(maxItems - $$('.semuaTampilMasterLaporanRencanaKunjungan li').length > itemsPerLoad){
                itemsPerLoad = itemsPerLoad;
            } else {
                itemsPerLoad = maxItems - $$('.semuaTampilMasterLaporanRencanaKunjungan li').length;
            }

            var html = '';
            for (var i = lastItemIndex; i < lastItemIndex + itemsPerLoad; i++) {
                var today = new Date(TANGGAL[i]);
                var day = today.getDate();
                var monthIndex = today.getMonth();
                var year = today.getFullYear();
                html += `<li>
                <a href="#" onClick="klikListLaporanRencanaKunjungan('`+TANGGAL[i]+`')" class="item-link item-content">
                <div class="item-inner">
                <div class="item-title">`+day + ' ' + monthNames[monthIndex] + ' ' + year+`</div>
                <div class="item-after">`+JUMLAHKUNJUNGAN[i]+`</div>
                </div>
                </a>
                </li>`;
            }

            $$('.semuaTampilMasterLaporanRencanaKunjungan ul').append(html);
            lastItemIndex = $$('.semuaTampilMasterLaporanRencanaKunjungan li').length;

            if (lastItemIndex >= maxItems) {
              myApp.infiniteScroll.destroy('.infinite-scroll-content');
              $$('.infinite-scroll-preloader').remove();
              return;
          }
      }, 1000);
    });
    });
});

var filterRencanaKunjunganSalesmanGlobal = "";
//filter_master_laporan_rencana_kunjungan
$$(document).on('page:init', '.page[data-name="filter_master_laporan_rencana_kunjungan"]', function (page) {
    var act = "TAMPIL_POPUP_KARYAWAN_PELANGGAN";
    myApp.request.post(ipTujuan,{case:act,KODECABANG:KODECABANG,USERID:USERID},function(data){
        var hasil_json = JSON.parse(data);
        var tampungPopUpKaryawan ="Tidak Memiliki Karyawan Internal";
        if(hasil_json.hasil == "ada"){
            tampungPopUpKaryawan = "";
            for(var i = 0; i<hasil_json.KODEKARYAWAN.length;i++){
                tampungPopUpKaryawan += `<li>
                <a href="#" class="item-link item-content cobaKlik" onClick="pilihFilterKaryawan('`+hasil_json.KODEKARYAWAN[i]+`','`+hasil_json.NAMA[i]+`')">
                <div class="item-inner">
                <div class="item-text namaKaryawan" style="color:black">`+hasil_json.NAMA[i]+`</div>
                </div>
                </a>
                </li>`;
            }
            $$('.listPopUpNamaKaryawan').html(tampungPopUpKaryawan);
        } else {
            $$('.listPopUpNamaKaryawan').html(tampungPopUpKaryawan);
        }
        myApp.preloader.hide();
    });

    $$('.popup-open-karyawanPelanggan').on('click',function(){
        myApp.popup.open('.popup-karyawan'); 
    });

    $$('.btnCancel').on('click',function(){
        myApp.popup.close('.popup-karyawan');
    });

    var searchbar3 = myApp.searchbar.create({
        el: '.searchKaryawan',
        searchContainer: '.list',
        searchIn: '.namaKaryawan',
        on: {
            search(sb, query, previousQuery) {
                console.log(query, previousQuery);
            }
        }
    });

    $$('.btnFilterLaporan').on('click',function(){
        filterRencanaKunjunganSalesmanGlobal = $$('.kodeSalesmanFilterRencanaKunjungan').val();
        //mainView.router.navigate("/halaman_laporan_rencana_kunjungan/");
        mainView.router.back("/halaman_laporan_rencana_kunjungan/",{force:true});
    });
});



var namaSalesmanMasterGpsGlobal = "";
var tanggalSalesmanMasterGpsGlobal = "";
//master_gps
$$(document).on('page:init', '.page[data-name="master_gps"]', function (page) {
    var calendarModal = myApp.calendar.create({
        inputEl: '#demo-calendar-modal',
        openIn: 'customModal',
        header: true,
        footer: true,
        dateFormat: 'MM dd yyyy',
    });

    var act = "TAMPIL_POPUP_KARYAWAN_PELANGGAN";
    myApp.request.post(ipTujuan,{case:act,KODECABANG:KODECABANG,USERID:USERID},function(data){
        var hasil_json = JSON.parse(data);
        var tampungPopUpKaryawan ="Tidak Memiliki Karyawan Internal";
        if(hasil_json.hasil == "ada"){
            tampungPopUpKaryawan = "";
            for(var i = 0; i<hasil_json.KODEKARYAWAN.length;i++){
                tampungPopUpKaryawan += `<li>
                <a href="#" class="item-link item-content cobaKlik" onClick="pilihFilterKaryawan('`+hasil_json.KODEKARYAWAN[i]+`','`+hasil_json.NAMA[i]+`')">
                <div class="item-inner">
                <div class="item-text namaKaryawan" style="color:black">`+hasil_json.NAMA[i]+`</div>
                </div>
                </a>
                </li>`;
            }
            $$('.listPopUpNamaKaryawan').html(tampungPopUpKaryawan);
        } else {
            $$('.listPopUpNamaKaryawan').html(tampungPopUpKaryawan);
        }
        myApp.preloader.hide();
    });

    $$('.popup-open-karyawanPelanggan').on('click',function(){
        myApp.popup.open('.popup-karyawan'); 
    });

    $$('.btnCancel').on('click',function(){
        myApp.popup.close('.popup-karyawan');
    });

    var searchbar3 = myApp.searchbar.create({
        el: '.searchKaryawan',
        searchContainer: '.list',
        searchIn: '.namaKaryawan',
        on: {
            search(sb, query, previousQuery) {
                console.log(query, previousQuery);
            }
        }
    });

    $$('.btnLacakKunjunganGps').on('click',function(){
        myApp.preloader.show();
        namaSalesmanMasterGpsGlobal = $$('.kodeSalesmanFilterRencanaKunjungan').val();
        tanggalSalesmanMasterGpsGlobal = $$('#demo-calendar-modal').val();
        if(!namaSalesmanMasterGpsGlobal){
            alertKosong("Salesman");
        } else if(!tanggalSalesmanMasterGpsGlobal) {
            alertKosong("Tanggal Kunjungan");
        } else {
            mainView.router.navigate("/detail_master_gps/");
        }
    });
});

//detail_master_gps
$$(document).on('page:init', '.page[data-name="detail_master_gps"]', function (page) {

    var act = "TAMPIL_DETAIL_MASTER_GPS_HARIAN";
    myApp.request.post(ipTujuan,{case:act,KODESALESMAN:namaSalesmanMasterGpsGlobal,DATETRANSACTION:tanggalSalesmanMasterGpsGlobal},function(data){
        var hasil_json = JSON.parse(data);
        //var uluru = {lat: latGlobal, lng: lngGlobal};
        

        if(hasil_json.hasil == "ada"){
            var tampungSemuaDetailGps = "";
            map = new google.maps.Map(document.getElementById('map'), {
                center: {lat: parseFloat(hasil_json.LATITUDE[0]), lng:parseFloat(hasil_json.LONGITUDE[0])},
                zoom: 16,
            });
            for(var i = 0;i<hasil_json.NOMORBUKTI.length;i++){
                var today1 = new Date(hasil_json.JAMMASUK[i]);
                var day1 = today1.getDate();
                var monthIndex1 = today1.getMonth();
                var year1 = today1.getFullYear();
                var hours1 = today1.getHours();
                var minutes1 = today1.getMinutes();
                var seconds1 = today1.getSeconds();

                var today2 = new Date(hasil_json.JAMREPORT[i]);
                var day2 = today2.getDate();
                var monthIndex2 = today2.getMonth();
                var year2 = today2.getFullYear();
                var hours2 = today2.getHours();
                var minutes2 = today2.getMinutes();
                var seconds2 = today2.getSeconds();

                tampungSemuaDetailGps +=`
                <div class="card">
                <div class ="card-header cardHeaderBiru">${hasil_json.NOMORBUKTI[i]}</div>
                <div class="card-content card-content-padding">


                <div class="row">
                <div class="col-45 cardContentDetail" >Pelanggan</div>
                <div class="col-5 boldHitam"> : </div>
                <div class="col-50 cardContentHasilDetail ">${hasil_json.NAMAPELANGGAN[i]}</div>
                </div>

                <div class="row">
                <div class="col-45 cardContentDetail" >ALAMAT</div>
                <div class="col-5 boldHitam"> : </div>
                <div class="col-50 cardContentHasilDetail ">${hasil_json.ALAMAT[i]}</div>
                </div>

                <div class="row">
                <div class="col-45 cardContentDetail" >Berkunjung</div>
                <div class="col-5 boldHitam"> : </div>
                <div class="col-50 cardContentHasilDetail ">${hasil_json.NAMAKARYAWAN[i]}</div>
                </div>
                
                <div class="row">
                <div class="col-45 cardContentDetail" >Jam Login PT</div>
                <div class="col-5 boldHitam"> : </div>
                <div class="col-50 cardContentHasilDetail ">`+day1 + ' ' + monthNames[monthIndex1] + ' ' + year1+ '<br>' +hours1+':'+minutes1+':'+seconds1+`</div>
                </div>

                <div class="row">
                <div class="col-45 cardContentDetail" >Jam Report Fleet/Toko</div>
                <div class="col-5 boldHitam"> : </div>
                <div class="col-50 cardContentHasilDetail ">`+day2 + ' ' + monthNames[monthIndex2] + ' ' + year2+ '<br>' +hours2+':'+minutes2+':'+seconds2+`</div>
                </div>

                <div class="row">
                <div class="col-45 cardContentDetail" >Status Kunjungan</div>
                <div class="col-5 boldHitam"> : </div>
                <div class="col-50 cardContentHasilDetail ">${hasil_json.STATUSKUNJUNGAN[i]}</div>
                </div>
                </div>
                </div>`;


                var contentString = hasil_json.NAMAPELANGGAN[i]+`<br>`+hasil_json.NOMORBUKTI[i];

                addMarkerWithInfowindow(map, new google.maps.LatLng(parseFloat(hasil_json.LATITUDE[i]),parseFloat(hasil_json.LONGITUDE[i])), contentString,i+1);
                
            }


            $$('.semuaTampilDetailLaporanPelanggan').append(tampungSemuaDetailGps);

        } else{
            myApp.dialog.alert("Tidak Ada Kunjungan");
            $$('.semuaTampilDetailLaporanPelanggan').html("Belum Ada Kunjungan");
        }
        myApp.preloader.hide();
    });
});

//halaman_laporan_rencana_kunjungan
$$(document).on('page:init', '.page[data-name="halaman_laporan_rencana_kunjungan"]', function (page) {
    myApp.preloader.hide();
    var act = "TAMPIL_SEMUA_NOTA_LAPORAN_RENCANA_KUNJUNGAN";
    myApp.request.post(ipTujuan,{case:act,KODECABANG:KODECABANG,FILTER:filterRencanaKunjunganSalesmanGlobal,KODEJABATAN:KODEJABATAN,DATETRANSACTION:tampungTanggalListLaporanRencanaKunjungan,
        USERID:USERID},function(data){
            var hasil_json = JSON.parse(data);
            var tampungLaporanRencanaKunjungan = "";
            if(hasil_json.hasil == "ada"){
                for(var i = 0;i<hasil_json.NOMORBUKTI.length; i++){
                    var today = new Date(hasil_json.DATETRANSACTION[i]);
                    var day = today.getDate();
                    var monthIndex = today.getMonth();
                    var year = today.getFullYear();
                    tampungLaporanRencanaKunjungan+=`
                    <div class="card">
                    <div class ="card-header cardHeaderBiru">`+hasil_json.NOMORBUKTI[i]+`</div>
                    <div class="card-content card-content-padding">
                    
                    <div class="row">
                    <div class="col-45 cardContentDetail" >Berkunjungan</div>
                    <div class="col-5 boldHitam"> : </div>
                    <div class="col-50 cardContentHasilDetail ">`+hasil_json.NAMAKARYAWAN[i]+`</div>
                    </div>

                    <div class="row">
                    <div class="col-45 cardContentDetail" >Tanggal</div>
                    <div class="col-5 boldHitam"> : </div>
                    <div class="col-50 cardContentHasilDetail ">`+day + ' ' + monthNames[monthIndex] + ' ' + year+`</div>
                    </div>

                    <div class="row">
                    <div class="col-45 cardContentDetail" >Pelanggan</div>
                    <div class="col-5 boldHitam"> : </div>
                    <div class="col-50 cardContentHasilDetail ">`+hasil_json.NAMAPELANGGAN[i]+`</div>
                    </div>
                    
                    <div class="row">
                    <div class="col-45 cardContentDetail" >Keterangan</div>
                    <div class="col-5 boldHitam"> : </div>
                    <div class="col-50 cardContentHasilDetail ">`;
                    if(hasil_json.KETERANGAN[i]){
                        tampungLaporanRencanaKunjungan += hasil_json.KETERANGAN[i];
                    } else {
                        tampungLaporanRencanaKunjungan +='-';
                    }
                    tampungLaporanRencanaKunjungan+=`</div>
                    </div>
                    
                    </div>
                    </div>
                    `;

                    
                }
                $$('.semuaTampilLaporanRencanaKunjungan').append(tampungLaporanRencanaKunjungan);
            } else {
                $$('.semuaTampilLaporanRencanaKunjungan').html("Belum Ada Laporan Rencana Kunjungan");
            }
        });


    $$('.filterLaporanRencanaKujungan').on('click',function(){
        mainView.router.navigate("/filter_master_laporan_rencana_kunjungan/");
        myApp.preloader.show();
    });
});

//master_pricelist
$$(document).on('page:init', '.page[data-name="master_kendaraan"]', function (page) {
    $$('.fabInputMasterKendaraan').on('click',function(){
        mainView.router.navigate("/input_master_kendaraan/");
    });
    var searchbar = myApp.searchbar.create({
        el: '.searchMasterPelanggan',
        searchContainer: '.list',
        searchIn: '.searchMasterPricelist',
        on: {
            search(sb, query, previousQuery) {
            }
        }
    });

    $$('.fabInputMasterPricelist').on('click',function(){
        mainView.router.navigate("/input_pricelist/");
        myApp.preloader.hide();
    });

    //try items virtual list
    var items = [];
    var act = "TAMPIL_MASTER_KENDARAAN";
    var semuaTampilMasterLaporanPelanggan = "";

    myApp.request.post(ipTujuan,{case:act,USERID:USERID,KODEJABATAN:KODEJABATAN,KODECABANG:KODECABANG},function(data){
        var hasil_json = JSON.parse(data);
        if(hasil_json.hasil == "ada"){
            for (var i = 0; i < hasil_json.KODEPELANGGAN.length; i++) {
                items.push({
                    KODEPELANGGAN: hasil_json.KODEPELANGGAN[i],
                    NAMA: hasil_json.NAMA[i]
                });
            }
            var virtualList = myApp.virtualList.create({
                el: '.virtual-list',
                items: items,
                searchAll: function (query, items) {
                    var found = [];
                    for (var i = 0; i < items.length; i++) {
                        if ( items[i].KODEPELANGGAN.toLowerCase().indexOf(query.toLowerCase()) >= 0 || items[i].NAMA.toLowerCase().indexOf(query.toLowerCase()) >= 0 || query.trim() === '' ) found.push(i);
                    }
                    return found; 
                },
                itemTemplate:
                `<li>
                <a href="#" class="item-link item-content" onClick="detailMasterKendaraan('{{KODEPELANGGAN}}')">
                <div class="item-inner">
                <div class="item-title-row">

                <div class="item-text searchMasterPricelist" style="color:black">{{NAMA}}</div>

                </div>

                </div>
                </a>
                </li>`,
                height: myApp.theme === 'ios' ? 63 : 73,
            });
        } else {
            $$('.virtual-list').html("Daftarkan Terlebih Dahulu Plat Nomor berdasarkan Pelanggan");
        }
        myApp.preloader.hide();
    });
});

//isi_master_kendaraan
$$(document).on('page:init', '.page[data-name="isi_master_kendaraan"]', function (page) {
    var act = "TAMPIL_ISI_KENDARAAN";
    myApp.request.post(ipTujuan,{case:act,USERID:USERID,KODEJABATAN:KODEJABATAN,KODECABANG:KODECABANG,KODEPELANGGAN:tampungKodepelangganNomorPlat},function(data){
        var hasil_json = JSON.parse(data);
        if(hasil_json.hasil == "ada"){
            var tampungIsiMasterKendaraan ="<ul>";
            for(var i = 0;i<hasil_json.NOMORPLAT.length;i++){
                tampungIsiMasterKendaraan +=`<li>
                <a href="#" class="item-link item-content">
                <div class="item-inner">
                <div class="item-text" style="color:black">`+hasil_json.NOMORPLAT[i]+`</div>
                </div>
                </a>
                </li>`;
            }

            tampungIsiMasterKendaraan +="</ul>";
        } else {
            tampungIsiMasterKendaraan = "Tidak ada Nomor Plat yang Terdaftar";
        }
        $$('.semuaIsiKendaraan').html(tampungIsiMasterKendaraan);
    });
});

//input_master_kendaraan
$$(document).on('page:init', '.page[data-name="input_master_kendaraan"]', function (page) {
    $$("input").keyup(function(){
        $$(this).val( $$(this).val().toUpperCase() );
    });

    var act = "TAMPIL_KONFIGURASI_TRUK_DAN_KAROSERI";
    myApp.request.post(ipTujuan,{case:act},function(data){
        var hasil_json = JSON.parse(data);
        if(hasil_json.karoseri == "ada"){
            for(var i = 0; i<hasil_json.KODEKAROSERI.length; i++){
                $$('.karoseriInputKendaraan').append(`<option value="${hasil_json.KODEKAROSERI[i]}">${hasil_json.KODEKAROSERI[i]}</option>`)
            }
        } else {
            mainView.router.navigate("/home/");
        }

        if(hasil_json.konfigurasi == "ada"){
            for(var i = 0; i<hasil_json.KODEKONFIGURASI.length; i++){
                $$('.konfigurasiTrukInputKendaraan').append(`<option value="${hasil_json.KODEKONFIGURASI[i]}">${hasil_json.KODEKONFIGURASI[i]}</option>`)
            }
        } else {
            mainView.router.navigate("/home/");
        }
        myApp.preloader.hide();
    });

    var act = "POPUP_TAMPIL_NAMA_TOKO";
    myApp.request.post(ipTujuan,{case:act,USERID:USERID,KODECABANG:KODECABANG},function(data){
        var hasil_json = JSON.parse(data);
        tampungPopupNamaToko = "";
        if(hasil_json.hasil=="ada"){
            for(var i = 0; i<hasil_json.KODEPELANGGAN.length;i++){
                tampungPopupNamaToko +=`
                <li>
                <a href="#" class="item-link item-content" onClick="pilihTokoUntukKendaraan('`+hasil_json.KODEPELANGGAN[i]+`','`+hasil_json.NAMA[i]+`')">
                <div class="item-inner">
                <div class="item-text namaToko" style="color:black">`+hasil_json.KODEPELANGGAN[i]+` - `+hasil_json.NAMA[i]+`</div>
                </div>
                </a>
                </li>`;
            }
        } else {
            $$('.listPopupNamaTokoPelanggan').html("");
        }
        $$('.listPopupNamaTokoPelanggan').html(tampungPopupNamaToko);
    });

    $$('.btnTambahNomorPlat').on('click',function(){
        var element = `<div class="item-content item-input">
        <div class="item-inner">
        <div class="item-title item-label" style="color:#2196F3"><b>Nomor Plat</b></div>
        <div class="item-input-wrap">
        <input type="text" name="nomorPlatInputKendaraan" placeholder="Nomor Plat">
        <span class="input-clear-button"></span>
        </div>
        </div>
        </div>`;

        $$('.generateTambahNomorPlat').append(element);
        $$("input").keyup(function(){
            $$(this).val( $$(this).val().toUpperCase() );
        });
    });

    $$('.popup-open-toko').on('click',function(){
        var tampungCounter = $(this).attr('id');
        myApp.popup.open('.popup-toko');
    });

    var searchbar = myApp.searchbar.create({
        el: '.searchMasterKendaraan',
        searchContainer: '.list',
        searchIn: '.namaToko',
        on: {
            search(sb, query, previousQuery) {
                console.log(query, previousQuery);
            }
        }
    });

    $$('.btnCancel').on('click',function(){
        myApp.popup.close('.popup-toko');
    });

    $$('.btnInputKendaraan').on('click',function(){
        var act = "INPUT_MASTER_KENDARAAN";
        var KODEPELANGGAN = $$('.kunjunganKodeToko').val();
        var KONFIGURASITRUK = $$('.konfigurasiTrukInputKendaraan').val();
        var KAROSERI = $$('.karoseriInputKendaraan').val();
        var NOMORPLAT = [];
        $$('input[name^="nomorPlatInputKendaraan"]').each(function() {
            if($$(this).val() != ""){
                NOMORPLAT.push($$(this).val());
            }
        });

        if(!KODEPELANGGAN){
            alertKosong("Pelanggan");
        } else if(!NOMORPLAT[0]){
            alertKosong("Nomor Plat");
        } else {

            myApp.request.post(ipTujuan,{case:act,USERID:USERID,KODEJABATAN:KODEJABATAN,KODECABANG:KODECABANG,KODEPELANGGAN:KODEPELANGGAN,
                NOMORPLAT:NOMORPLAT,KAROSERI:KAROSERI,KONFIGURASITRUK:KONFIGURASITRUK},function(data){
                    var hasil_json = JSON.parse(data);
                    if(hasil_json.hasil == "berhasil"){
                        myApp.dialog.alert("Berhasil Menambahkan Nomor Plat");
                        mainView.router.back("/master_kendaraan/",{force:true});
                    } else if(hasil_json.hasil == "duplicate_nomorplat"){
                        myApp.dialog.alert("Nomor Plat Tersebut Sudah Terdaftar");
                    } else {
                        myApp.dialog.alert("Terjadi Error, Silahkan Hubungi Admin");
                    }
                });
        }
    });
});

//master_pricelist
$$(document).on('page:init', '.page[data-name="master_pricelist"]', function (page) {
    if(userHakAksesArrayGlobal['masterPricelist']['TAMBAH'] == "F"){
        $$('.fabInputMasterPricelist').remove();
    }

    /*var act = "TAMPIL_MASTER_PRICELIST";
    myApp.request.post(ipTujuan,{case:act},function(data){
        var hasil_json = JSON.parse(data);
        var tampungMasterPricelist = "";
        if(hasil_json.hasil == "ada"){
            tampungMasterPricelist =`<ul>`;
            for(var i = 0; i<hasil_json.kodebarang.length ;i++){
                tampungMasterPricelist +=`<li>
                <a href="#" class="item-link item-content" onClick="detailPricelist('`+hasil_json.kodebarang[i]+`','`+hasil_json.nama[i]+`','`+hasil_json.pricelistj1[i]+`',
                '`+hasil_json.pricelistj2[i]+`','`+hasil_json.pricelistj3[i]+`')">
                <div class="item-inner">
                <div class="item-title-row">

                <div class="item-text searchMasterPricelist" style="color:black"><b>`+hasil_json.kodebarang[i]+`<br>`+hasil_json.nama[i]+`</b></div>

                </div>

                </div>
                </a>
                </li>`;
            }
            tampungMasterPricelist +=`</ul>`;
            $$('.semuaMasterPricelist').html(tampungMasterPricelist);
        } else {
            $$('.semuaMasterPricelist').html("Belum Ada Barang");
        }
        myApp.preloader.hide();
    });*/

    var searchbar = myApp.searchbar.create({
        el: '.searchMasterPelanggan',
        searchContainer: '.list',
        searchIn: '.searchMasterPricelist',
        on: {
            search(sb, query, previousQuery) {
            }
        }
    });

    $$('.fabInputMasterPricelist').on('click',function(){
        mainView.router.navigate("/input_pricelist/");
        myApp.preloader.hide();
    });

    //try items virtual list
    var items = [];
    var act = "TAMPIL_MASTER_PRICELIST";
    var semuaTampilMasterLaporanPelanggan = "";

    myApp.request.post(ipTujuan,{case:act},function(data){
        var hasil_json = JSON.parse(data);
        if(hasil_json.LOG.WAKTUUBAHSTOK){
            var logmbrg = new Date(hasil_json.LOG.WAKTUUBAHSTOK);
            var day1 = logmbrg.getDate();
            var monthIndex1 = logmbrg.getMonth();
            var year1 = logmbrg.getFullYear();
            var hours1 = logmbrg.getHours();
            hours1 = ("0" + hours1).slice(-2);
            var minutes1 = logmbrg.getMinutes();
            minutes1 = ("0" + minutes1).slice(-2);
            var seconds1 = logmbrg.getSeconds();
            seconds1 = ("0" + seconds1).slice(-2);
            waktu = day1 + ' ' + monthNames[monthIndex1] + ' ' + year1+ ' ' +hours1+':'+minutes1+':'+seconds1;
            $$("#waktuUbahStokMbrg").html(waktu);
        }

        if(hasil_json.hasil == "ada"){
            for (var i = 0; i < hasil_json.kodebarang.length; i++) {
                items.push({
                    kodebarang: hasil_json.kodebarang[i],
                    nama: hasil_json.nama[i],
                    pricelistj1:hasil_json.pricelistj1[i],
                    pricelistj2:hasil_json.pricelistj2[i],
                    pricelistj3:hasil_json.pricelistj3[i],
                });
            }
            var virtualList = myApp.virtualList.create({
                el: '.virtual-list',
                items: items,
                searchAll: function (query, items) {
                    var found = [];
                    for (var i = 0; i < items.length; i++) {
                        if ( items[i].kodebarang.toLowerCase().indexOf(query.toLowerCase()) >= 0 || items[i].nama.toLowerCase().indexOf(query.toLowerCase()) >= 0 || query.trim() === '' ) found.push(i);
                    }
                    return found; 
                },
                itemTemplate:
                `<li>
                <a href="#" class="item-link item-content" onClick="detailPricelist('{{kodebarang}}','{{nama}}','{{pricelistj1}}',
                '{{pricelistj2}}','{{pricelistj3}}')">
                <div class="item-inner">
                <div class="item-title-row">

                <div class="item-text searchMasterPricelist" style="color:black"><b>{{kodebarang}}<br></b>{{nama}}</div>

                </div>

                </div>
                </a>
                </li>`,
                height: myApp.theme === 'ios' ? 63 : 73,
            });
        } else {
            $$('.virtual-list').html("Belum Memiliki Daftar Pricelist");
        }
        myApp.preloader.hide();
    });
});


//detail_pricelist
$$(document).on('page:init', '.page[data-name="detail_pricelist"]', function (page) {
    if(!userHakAksesArrayGlobal["masterPricelist"]){
    } else {
        if(userHakAksesArrayGlobal["masterPricelist"]["UBAH"] == "F"){
            $$('.editPricelist').remove();
        }
    }


    $$('.editPricelist').on('click',function(){
        mainView.router.navigate("/edit_pricelist/");
    });

    var act = "DETAIL_PRICELIST";
    myApp.request.post(ipTujuan,{case:act,kodebarang:tampungKodeBarangPricelist},function(data){
        var hasil_json = JSON.parse(data);

        $$('.detailKodePricelist').html(hasil_json.kodebarang);
        $$('.detailNamaPricelist').html(hasil_json.nama);

        var element = "";
        if(hasil_json.stok >0){
            element = `<span><a href="#" onClick="TampilStok(this,'${hasil_json.stok}')">Tersedia</a></span>`;
        } else {
            element = `<span><a href="#" onClick="TampilStok(this,'${hasil_json.stok}')">Tidak Tersedia</a></span>`;
        }
        $$('.detailStokPricelist').html(element);

        $$('.detailP1').html(hasil_json.pricelistj1);
        $$('.detailP2').html(hasil_json.pricelistj2);
        $$('.detailP3').html(hasil_json.pricelistj3);
        $$('.detailKategoriPricelist').html(hasil_json.kodekategori);
        $$('.detailKeteranganPricelist').html(hasil_json.keterangan);

        if(hasil_json.gambar == "ada"){
            var tampungFotoDetailPricelist ="";

            var element = "";
            for(var i = 0; i<hasil_json.NAMAGAMBAR.length;i++){
                element +=`<div class="swiper-slide" style="width:100%;text-align:center">
                <a href ="#" onClick="zoomInOutGambarPricelist('${hasil_json.kodebarang}','`+i+`')">
                <img src="${ipGambarPricelist+hasil_json.NAMAGAMBAR[i]}.jpg?${new Date().getTime()}" style="max-width:100%" height="350px">
                </a></div>`;
            }
            $$('.swiperDetailPricelist').html(element);
            var swiper = myApp.swiper.create('.swiper-container', {
                speed: 400,
                spaceBetween: 100,
                pagination:{"el":".swiper-pagination"}
            });
        } else {
            $$('.swiperDetailPricelist').closest('.swiper-container').remove();
        }

        if(hasil_json.merkmobil == "ada"){
            for(var i = 0; i<hasil_json.NAMA.length;i++){
                var tampungMerkMobil = `<li><div class="item-content">
                <div class="item-inner">
                <div class="item-title">${hasil_json.NAMA[i]}</div>
                <div class="item-after"><span class="badge `;
                if((i+1)%2 == 0){
                    tampungMerkMobil +=`color-green`;
                } else {
                    tampungMerkMobil +=`color-blue`;
                }
                tampungMerkMobil +=`">${i+1}</span></div>
                </div>
                </div>
                </li>`;
                $$('.listMerkMobil').append(tampungMerkMobil);
            }
        } else {
            $$('.cardMerkMobil').remove();
        }
        myApp.preloader.hide();
    });
});

//edit_pricelist
$$(document).on('page:init', '.page[data-name="edit_pricelist"]', function (page) {
    if(myApp.device.desktop){
        element = `<input type="file" multiple class="fileGambar">`;
        $$(".generateFotoPricelist").html(element);

    }

    var searchbarMerkMobil = myApp.searchbar.create({
        el: '.searchMerkMobil',
        searchContainer: '.listPopupMerkMobil',
        searchIn: '.namaMerkMobil',
        on: {
            search(sb, query, previousQuery) {
            }
        }
    });


    $$('.pilihPopUpMerkMobil').on('click',function(){
        myApp.popup.close('.popup-merkmobil');
        listMerkMobilChecked = [];
        $$('input[name^="checked-merkMobil"]').each(function() {
            if($$(this).prop("checked")){
                listMerkMobilChecked.push($$(this).val());
            }
        });

        if(listMerkMobilChecked.length >0){
            var cardMerkMobil = `<div class="card">
            <div class ="card-header cardHeaderBiru">Data Merk Mobil</div>
            <div class="card-content card-content-padding">


            <div class="list ">
            <ul class="listMerkMobil">`;
            for(var i = 0; i<listMerkMobilChecked.length;i++){
                cardMerkMobil+=`<li>
                <div class="item-content">
                <div class="item-inner">
                <div class="item-title">${listMerkMobilChecked[i]}</div>
                </div>
                </div>
                </li>`;
            }
            cardMerkMobil+=`</ul>
            </div>
            </div>
            </div>`;
            $$('.cardMerkMobilEdit').html(cardMerkMobil);
        } else {
            $$('.cardMerkMobilEdit').html("");
        }
    });


    var act = "TAMPIL_DETAIL_BARANG_MERK_MOBIL";
    listMerkMobilChecked = [];
    myApp.request.post(ipTujuan,{case:act,kodebarang:tampungKodeBarangPricelist},
        function(data){
            var hasil_json = JSON.parse(data);
            if(hasil_json.hasil == "ada"){

                var cardMerkMobil = `<div class="card">
                <div class ="card-header cardHeaderBiru">Data Merk Mobil</div>
                <div class="card-content card-content-padding">


                <div class="list ">
                <ul class="listMerkMobil">`;
                for(var i = 0; i<hasil_json.KODEMOBIL.length;i++){
                    listMerkMobilChecked.push(hasil_json.KODEMOBIL[i]);
                    cardMerkMobil+=`<li>
                    <div class="item-content">
                    <div class="item-inner">
                    <div class="item-title namaMerkMobil">${hasil_json.NAMA[i]}</div>
                    </div>
                    </div>
                    </li>`;
                }
                cardMerkMobil+=`</ul>
                </div>
                </div>
                </div>`;
                $$('.cardMerkMobilEdit').html(cardMerkMobil);
            } else {
                $$('.cardMerkMobilEdit').html("");
            }
        },
        function(xhr,status){
            PreloaderHide(status);
        });

    

    $$('.popup-open-merkMobil').on('click',function(){
        myApp.popup.open('.popup-merkmobil');
    });

    $$("input[type=text]").keyup(function(){
        $$(this).val( $$(this).val().toUpperCase() );
    });

    $('.inputKeteranganPricelist').keyup(function(){
        $(this).val($(this).val().toUpperCase());
    });

    /*var act = "TAMPIL_MASTER_MERK_MOBIL";
    myApp.request.post(ipTujuan,{case:act},
        function(data){
            var hasil_json = JSON.parse(data);
            var tampungMerkMobil = "";
            if(hasil_json.hasil == "ada"){
                for(var i = 0; i<hasil_json.KODEMOBIL.length;i++){
                    tampungMerkMobil +=`
                    <li>
                    <label class="item-checkbox item-content">
                    <input type="checkbox" name="checked-merkMobil" value="${hasil_json.KODEMOBIL[i]}" `;
                    
                    if($.inArray(hasil_json.KODEMOBIL[i], listMerkMobilChecked) === -1){
                        tampungMerkMobil += "";
                    } else {
                        tampungMerkMobil += "checked";
                    }
                    tampungMerkMobil+=`/>
                    <i class="icon icon-checkbox"></i>
                    <div class="item-inner">
                    <div class="item-title namaMerkMobil">${hasil_json.NAMA[i]}</div>
                    </div>
                    </label>
                    </li>`;
                }
                $$('.listPopupMerkMobil').html(tampungMerkMobil);
            } else {
                $$('.listPopupMerkMobil').html("Tidak Ada Merk Mobil");
            }

        }, 
        function(xhr,status){
            PreloaderHide(status);
        });*/

        var act = "TAMPIL_MASTER_KATEGORI_BARANG";
        myApp.request.post(ipTujuan,{case:act},function(data){
            var hasil_json = JSON.parse(data);
            var tampungPopupKategoriBarang = "";
            if(hasil_json.hasil == "ada"){
                for(var i = 0;i<hasil_json.KODEKATEGORI.length;i++){
                    tampungPopupKategoriBarang+= `<li>
                    <a href="#" class="item-link item-content cobaKlik" onClick="pilihKategoriBarang('`+hasil_json.KODEKATEGORI[i]+`','`+hasil_json.NAMA[i]+`')">
                    <div class="item-inner">
                    <div class="item-text namaKategoriBarang" style="color:black"><b>`+hasil_json.KODEKATEGORI[i]+`</b> - `+hasil_json.NAMA[i]+`</div>
                    </div>
                    </a>
                    </li>`;
                }
                $$('.popupSemuaKategoriBarang').html(tampungPopupKategoriBarang);
            } else {
                $$('.popupSemuaKategoriBarang').html("");
            }
            myApp.preloader.hide();
        });

        $$('.popup-open-kategoriBarang').on('click',function(){
            myApp.popup.open('.popup-kategoriBarang');
        });

        $$('.btnCancel').on('click',function(){
            myApp.popup.close('.popup-kategoriBarang');
            myApp.popup.close('.popup-merkmobil');
        });

        var searchbar = myApp.searchbar.create({
            el: '.searchKategoriBarang',
            searchContainer: '.list',
            searchIn: '.namaKategoriBarang',
            on: {
                search(sb, query, previousQuery) {
                }
            }
        });

        var gambarHapus = [];

        var act = "EDIT_PRICELIST";
        myApp.request.post(ipTujuan,{case:act,kodebarang:tampungKodeBarangPricelist},function(data){
            var hasil_json = JSON.parse(data);
            $$('.editNamaPalsuKategoriBarangPricelist').val(hasil_json.namakategori);
            $$('.editKategoriBarangPricelist').val(hasil_json.kodekategori);
            $$('.editKodeBarangPricelist').val(hasil_json.kodebarang);
            $$('.editNamaPricelistBarang').val(hasil_json.nama);
            $$('.editSatuanPricelist').val(hasil_json.satuan);
            $$('.editHargaTempoPricelist').val(hasil_json.pricelistj1);
            $$('.editHargaCashPricelist').val(hasil_json.pricelistj2);
            $$('.editHargaPricelistPricelist').val(hasil_json.pricelistj3);
            $$('.editKeteranganPricelist').val(hasil_json.keterangan);
            if(hasil_json.gambar == "ada"){
                var tampungGambarPricelist = "";
                for(var i = 0;i<hasil_json.NAMAGAMBAR.length;i++){
                    counter=hasil_json.counter[i];
                    tampungGambarPricelist +=`<div class="card">
                    <div class="card-header row" style="background-color:#2196F3;color:white">
                    <div class="col padding5">
                    <a href="#" class="hapusFotoKunjungan col-50 padding5" id ="${hasil_json.ID[i]}">
                    <i class="fas fa-window-close  middleWhite" ></i>
                    </a>
                    </div>
                    </div>
                    <div class="card-content card-content-padding">
                    <img src="`+ipGambarPricelist+hasil_json.NAMAGAMBAR[i]+`.jpg?`+ new Date().getTime()+`"  class="${counter}" id="foto-pricelist-${hasil_json.ID[i]}" height="150" width="100%">
                    </div>
                    </div>`;

                }
                $$('.spanFotoPricelist').html(tampungGambarPricelist);
                $$('.hapusFotoKunjungan').on('click',function(){
                    var hapusId = $$(this).attr("id");
                    var tampung = $$("#foto-pricelist-"+hapusId).attr("src");
                    if(tampung != null){
                        gambarHapus.push(hapusId);
                        $$(this).closest('.card').remove();
                    }
                });
                counter++;
            } else {
                $$('.spanFotoPricelist').remove();
            }
        });

        $$('.btnBatalBatalPricelist').on('click',function(){
            mainView.router.back();
        });

        $$('.btnSimpanEditPricelist').on('click',function(){
            myApp.preloader.show();
            var act ="SIMPAN_EDIT_PRICELIST";
            var kodekategori = $$('.editKategoriBarangPricelist').val();
            var kodebarang = $$('.editKodeBarangPricelist').val();
            var nama = $$('.editNamaPricelistBarang').val();
            var satuan = $$('.editSatuanPricelist').val();
            var pricelistj1 = $$('.editHargaTempoPricelist').val();
            var pricelistj2 = $$('.editHargaCashPricelist').val();
            var pricelistj3 = $$('.editHargaPricelistPricelist').val();
            var keterangan = $$('.editKeteranganPricelist').val();
            var fotoPricelist = [];
            var namaFotoPricelist = [];
            $$('img[name^="fotoTokoPricelist"]').each(function() {
                if($$(this).attr("src") !=null){
                    fotoPricelist.push($$(this).attr("src"));
                    namaFotoPricelist.push(this.className);
                }
            });

            var image = $$(".fileGambar");
            if(image.length >0){ 
                for(var i = 0;i<image[0].files.length;i++){
                    namaFotoPricelist.push(i+1);
                }
            }



            myApp.request.post(ipTujuan,{case:act,USERID:USERID,kodekategori:kodekategori,kodebarang:kodebarang,nama:nama,satuan:satuan,pricelistj1:pricelistj1,
                pricelistj2:pricelistj2,pricelistj3:pricelistj3,keterangan:keterangan,namaFotoPricelist:namaFotoPricelist,gambarHapus:gambarHapus,listMerkMobilChecked:listMerkMobilChecked},function(data){
                    var hasil_json = JSON.parse(data);
                    if(hasil_json.uploadgambar == "ada" && !myApp.device.desktop){
                        for(var i =0; i<fotoPricelist.length;i++){
                           var toko = new FileUploadOptions();
                           toko.fileKey = "photo";
                           toko.fileName = fotoPricelist[i].substr(fotoPricelist[i].lastIndexOf('/') + 1);
                           toko.mimeType = "image/jpeg";
                           toko.chunkedMode = false;
                           toko.headers = {
                              Connection: "close"
                          };
                          toko.params = {
                            namaFile:hasil_json.NAMAFOTOPRICELIST[i]
                        }
                        var ft = new FileTransfer();
                        ft.upload(fotoPricelist[i], 
                          encodeURI(ipUploadPricelist),
                          win,
                          fail,
                          toko);

                        var win = function(r) {
                            console.log("Should not be called.");
                        }

                        var fail = function(error) {
                            myApp.dialog.alert("eror :" +error.code);
                            alert("An error has occurred: Code = " + error.code);
                            console.log("upload error source " + error.source);
                            console.log("upload error target " + error.target);
                        }
                    }

                    myApp.preloader.hide();
                    myApp.dialog.alert("Berhasil Mengedit Pricelist");
                    mainView.router.back("/detail_pricelist/",{force:true});
                } else if(hasil_json.uploadgambar == "ada" && myApp.device.desktop){
                    var data = new FormData();
                    if(image[0].files.length > 0){
                        for(var i = 0; i<image[0].files.length;i++){
                            data.append('file[]',image[0].files[i]);
                        }
                    }
                    data.append('nama',hasil_json.NAMAFOTOPRICELIST);
                    myApp.request({
                        url: ipUploadDesktopGambarPricelist,
                        method: "POST",
                        data: data,
                        cache: false,
                        mimeType: "multipart/form-data",
                        processData: true,
                        success: function( data ) {
                            if(data == "tipe_file"){
                                myApp.dialog.alert("Pastikan Format Gambar JPG");
                                myApp.preloader.hide();
                            } else {   
                                myApp.dialog.alert("Berhasil Mengedit Pricelist"); 
                                mainView.router.back("/detail_pricelist/",{force:true});
                            }
                        },
                        error: function( error ) {
                            myApp.dialog.alert("Laporkan Admin Terjadi Kendala");
                            myApp.preloader.hide();
                        }
                    });
                } else { 
                    myApp.preloader.hide();
                    myApp.dialog.alert("Berhasil Mengedit Pricelist");
                    mainView.router.back("/detail_pricelist/",{force:true});
                }
            });
        });

});

var listMerkMobilChecked;
var listNamaMobilChecked;
//input_pricelist
$$(document).on('page:init', '.page[data-name="input_pricelist"]', function (page) {
    if(myApp.device.desktop){
        element = `<input type="file" multiple class="fileGambar">`;
        $$(".generateFotoPricelist").html(element);
    }

    var searchbarMerkMobil = myApp.searchbar.create({
        el: '.searchMerkMobil',
        searchContainer: '.listPopupMerkMobil',
        searchIn: '.namaMerkMobil',
        on: {
            search(sb, query, previousQuery) {
            }
        }
    });

    $$('.pilihPopUpMerkMobil').on('click',function(){
        myApp.popup.close('.popup-merkmobil');
        listMerkMobilChecked = [];
        listNamaMobilChecked = {};
        $$('input[name^="checked-merkMobil"]').each(function() {
            if($$(this).prop("checked")){
                listMerkMobilChecked.push($$(this).val());
                listNamaMobilChecked[$$(this).val()] = this.className;
            }
        });

        if(listMerkMobilChecked.length >0){
            var cardMerkMobil = `<div class="card">
            <div class ="card-header cardHeaderBiru">Data Merk Mobil</div>
            <div class="card-content card-content-padding">


            <div class="list ">
            <ul class="listMerkMobil">`;
            for(var i = 0; i<listMerkMobilChecked.length;i++){
                cardMerkMobil+=`<li>
                <div class="item-content">
                <div class="item-inner">
                <div class="item-title namaMerkMobil">${listNamaMobilChecked[listMerkMobilChecked[i]]}</div>
                </div>
                </div>
                </li>`;
            }
            cardMerkMobil+=`</ul>
            </div>
            </div>
            </div>`;
            $$('.cardMerkMobil').html(cardMerkMobil);

        } else {
            $$('.cardMerkMobil').html("");
        }
    });

    $$('.popup-open-merkMobil').on('click',function(){
        myApp.popup.open('.popup-merkmobil'); 
    });

    $$("input[type=text]").keyup(function(){
        $$(this).val( $$(this).val().toUpperCase() );
    });

    $('.inputKeteranganPricelist').keyup(function(){
        $(this).val($(this).val().toUpperCase());
    });

    var act = "TAMPIL_MASTER_KATEGORI_BARANG";
    myApp.request.post(ipTujuan,{case:act},function(data){
        var hasil_json = JSON.parse(data);
        var tampungPopupKategoriBarang = "";
        if(hasil_json.hasil == "ada"){
            for(var i = 0;i<hasil_json.KODEKATEGORI.length;i++){
                tampungPopupKategoriBarang+= `<li>
                <a href="#" class="item-link item-content cobaKlik" onClick="pilihKategoriBarang('`+hasil_json.KODEKATEGORI[i]+`','`+hasil_json.NAMA[i]+`')">
                <div class="item-inner">
                <div class="item-text namaKategoriBarang" style="color:black"><b>`+hasil_json.KODEKATEGORI[i]+`</b> - `+hasil_json.NAMA[i]+`</div>
                </div>
                </a>
                </li>`;
            }
            $$('.popupSemuaKategoriBarang').html(tampungPopupKategoriBarang);
        } else {
            $$('.popupSemuaKategoriBarang').html("");
        }
        myApp.preloader.hide();
    });

    var act = "TAMPIL_MASTER_MERK_MOBIL";
    myApp.request.post(ipTujuan,{case:act},
        function(data){
            var hasil_json = JSON.parse(data);
            var tampungMerkMobil = "";
            if(hasil_json.hasil == "ada"){
                for(var i = 0; i<hasil_json.KODEMOBIL.length;i++){
                    tampungMerkMobil +=`
                    <li>
                    <label class="item-checkbox item-content">
                    <input type="checkbox" name="checked-merkMobil" class="${hasil_json.NAMA[i]}" value="${hasil_json.KODEMOBIL[i]}"/>
                    <i class="icon icon-checkbox"></i>
                    <div class="item-inner">
                    <div class="item-title namaMerkMobil">${hasil_json.NAMA[i]}</div>
                    </div>
                    </label>
                    </li>`;
                }
                $$('.listPopupMerkMobil').html(tampungMerkMobil);
            } else {
                $$('.listPopupMerkMobil').html("Tidak Ada Merk Mobil");
            }

        }, 
        function(xhr,status){
            PreloaderHide(status);
        });

    $$('.popup-open-kategoriBarang').on('click',function(){
        myApp.popup.open('.popup-kategoriBarang');
    });

    $$('.btnCancel').on('click',function(){
        myApp.popup.close('.popup-kategoriBarang');
        myApp.popup.close('.popup-merkmobil');
    });

    var searchbar = myApp.searchbar.create({
        el: '.searchKategoriBarang',
        searchContainer: '.list',
        searchIn: '.namaKategoriBarang',
        on: {
            search(sb, query, previousQuery) {
            }
        }
    });

    $$('.btnSimpanInputPricelist').on('click',function(){
        myApp.preloader.show();
        var act = "INPUT_PRICELIST";
        var kodekategori = $$('.inputKategoriBarangPricelist').val();
        var kodebarang = $$('.inputKodeBarangPricelist').val();
        var nama = $$('.inputNamaPricelistBarang').val();
        var keterangan = $$('.inputKeteranganPricelist').val();
        var satuan = $$('.inputSatuanPricelist').val();
        var pricelistj1 = $$('.inputHargaTempoPricelist').val();
        var pricelistj2 = $$('.inputHargaCashPricelist').val();
        var pricelistj3 = $$('.inputHargaPricelistPricelist').val();

        var fotoPricelist= [];
        var namaFotoPricelist = [];

        $$('img[name^="fotoTokoPricelist"]').each(function() {
            if($$(this).attr("src") !=null){
                fotoPricelist.push($$(this).attr("src"));
                namaFotoPricelist.push(this.className);
            }
        });

        var image = $$(".fileGambar");
        for(var i = 0;i<image[0].files.length;i++){
            namaFotoPricelist.push(i+1);
        }

        if(!kodekategori){
            alertKosong("Kode Kategori");
        } else if(!kodebarang){
            alertKosong("Kode Barang")
        } else if(!nama){
            alertKosong("Nama Barang");
        } else if(!keterangan){
            alertKosong("Keterangan");
        } else if(!satuan){
            alertKosong("Satuan");
        } else if(!pricelistj1){
            alertKosong("Harga Tempo");
        } else if(!pricelistj2){
            alertKosong("Harga Cash");
        } else if(!pricelistj3){
            alertKosong("Harga Pricelist");
        } else {
            myApp.request.post(ipTujuan,{case:act,listMerkMobilChecked:listMerkMobilChecked,USERID:USERID,kodekategori:kodekategori,kodebarang:kodebarang,nama:nama,keterangan:keterangan,
                satuan:satuan,pricelistj1:pricelistj1,pricelistj2:pricelistj2,pricelistj3:pricelistj3,namaFotoPricelist:namaFotoPricelist},function(data){
                    var hasil_json = JSON.parse(data);
                    if(hasil_json.hasil == "ada"){
                        myApp.preloader.hide();
                        myApp.dialog.alert("Kode Barang Sudah Terdaftar");
                    } else {
                        if(hasil_json.uploadgambar == "ada" && !myApp.device.desktop){
                            for(var i =0; i<fotoPricelist.length;i++){
                               var toko = new FileUploadOptions();
                               toko.fileKey = "photo";
                               toko.fileName = fotoPricelist[i].substr(fotoPricelist[i].lastIndexOf('/') + 1);
                               toko.mimeType = "image/jpeg";
                               toko.chunkedMode = false;
                               toko.headers = {
                                  Connection: "close"
                              };
                              toko.params = {
                                namaFile:hasil_json.NAMAFOTOPRICELIST[i]
                            }
                            var ft = new FileTransfer();
                            ft.upload(fotoPricelist[i], 
                              encodeURI(ipUploadPricelist),
                              win,
                              fail,
                              toko);

                            var win = function(r) {
                                console.log("Should not be called.");
                            }

                            var fail = function(error) {
                                myApp.dialog.alert("eror :" +error.code);
                                alert("An error has occurred: Code = " + error.code);
                                console.log("upload error source " + error.source);
                                console.log("upload error target " + error.target);
                            }
                        }

                        myApp.preloader.hide();
                        myApp.dialog.alert("Berhasil Menginput Pricelist");
                        mainView.router.back("/master_pricelist/",{force:true});
                    } else if(hasil_json.uploadgambar == "ada" && myApp.device.desktop){
                        var data = new FormData();
                        if(image[0].files.length > 0){
                            for(var i = 0; i<image[0].files.length;i++){
                                data.append('file[]',image[0].files[i]);
                            }
                        }
                        data.append('nama',hasil_json.NAMAFOTOPRICELIST);
                        myApp.request({
                            url: ipUploadDesktopGambarPricelist,
                            method: "POST",
                            data: data,
                            cache: false,
                            mimeType: "multipart/form-data",
                            processData: true,
                            success: function( data ) {
                                if(data == "tipe_file"){
                                    myApp.dialog.alert("Pastikan Format Gambar JPG");
                                    myApp.preloader.hide();
                                } else {   
                                    myApp.dialog.alert("Berhasil Mengedit Pricelist"); 
                                    mainView.router.back("/master_pricelist/",{force:true});
                                }
                            },
                            error: function( error ) {
                                myApp.dialog.alert("Laporkan Admin Terjadi Kendala");
                                myApp.preloader.hide();
                            }
                        });
                    } else { 
                        myApp.preloader.hide();
                        myApp.dialog.alert("Berhasil Menginput Pricelist");
                    //mainView.router.navigate("/master_pricelist/",{reloadAll:true});
                    mainView.router.back("/master_pricelist/",{force:true});
                }
            }
        });
}
});

$$('.btnBatalInputPricelist').on('click',function(){
    mainView.router.back();
});
});

var filterKunjunganGlobal = "";
var filterPermintaanKhususGlobal = "";
var filterDariTanggalGlobal = "";
var filterSampaiTanggalGlobal = "";
//filter_master_laporan
$$(document).on('page:init', '.page[data-name="filter_master_laporan"]', function (page) {
    var act = "TAMPIL_MASTER_PERMINTAAN_KHUSUS";
    myApp.request.post(ipTujuan,{case:act},function(data){
        var hasil_json = JSON.parse(data);
        var tampungPopupPermintaanKhusus = "";
        if(hasil_json.hasil == "ada"){
            for(var i = 0;i<hasil_json.NAMA.length;i++){
                tampungPopupPermintaanKhusus+= `<li>
                <a href="#" class="item-link item-content cobaKlik" onClick="pilihPermintaanKhusus('`+hasil_json.NAMA[i]+`')">
                <div class="item-inner">
                <div class="item-text namaPermintaanKhusus" style="color:black">`+hasil_json.NAMA[i]+`</div>
                </div>
                </a>
                </li>`;
            }
            $$('.popupSemuaPermintaanKhusus').html(tampungPopupPermintaanKhusus);
        } else {
            $$('.popupSemuaPermintaanKhusus').html("");
        }
        myApp.preloader.hide();
    });

    $$('.popup-open-permintaanKhusus').on('click',function(){
        myApp.popup.open('.popup-permintaanKhusus');

        
    });

    $$('.btnCancel').on('click',function(){
        myApp.popup.close('.popup-permintaanKhusus');
    });

    var searchbar = myApp.searchbar.create({
        el: '.searchPermintaanKhusus',
        searchContainer: '.list',
        searchIn: '.namaPermintaanKhusus',
        on: {
            search(sb, query, previousQuery) {
            }
        }
    });

    var calendarModal = myApp.calendar.create({
        inputEl: '#dariTanggalFilterLaporan',
        openIn: 'customModal',
        header: true,
        footer: true,
        dateFormat: 'MM dd yyyy',
    });

    var calendarModal = myApp.calendar.create({
        inputEl: '#sampaiTanggalFilterLaporan',
        openIn: 'customModal',
        header: true,
        footer: true,
        dateFormat: 'MM dd yyyy',
    });

    $$('.btnFilterLaporan').on('click',function(){
        filterKunjunganGlobal = $$('.kunjunganFilterLaporan').val();
        filterPermintaanKhususGlobal = $$('.permintaanKhususFilterLaporan').val();
        filterDariTanggalGlobal = $$('#dariTanggalFilterLaporan').val();
        filterSampaiTanggalGlobal = $$('#sampaiTanggalFilterLaporan').val();
        mainView.router.navigate("/halaman_laporan_kunjungan_filter/");
    });
});

//halaman_laporan_kunjungan_filter
$$(document).on('page:init', '.page[data-name="halaman_laporan_kunjungan_filter"]', function (page) {
    var act = "TAMPIL_SEMUA_NOTA_LAPORAN_FILTER";
    myApp.request.post(ipTujuan,{case:act,filterDariTanggalGlobal:filterDariTanggalGlobal,filterSampaiTanggalGlobal:filterSampaiTanggalGlobal,KODEJABATAN:KODEJABATAN,USERID:USERID,filterPermintaanKhususGlobal:filterPermintaanKhususGlobal,
        filterKunjunganGlobal:filterKunjunganGlobal,KODECABANG:KODECABANG},function(data){
            var hasil_json = JSON.parse(data);
            if(hasil_json.hasil == "ada"){
                var tampungHalamanLaporanKunjunganFilter = `<div class="row">
                <div class="col-100" style="text-align: center"><span style="font-size:1.2em" class="badge color-red"><b>Jumlah Kunjungan : `+hasil_json.TOTJUMLAH+`</b></span></div>
                </div>`;
                for(var i = 0; i<hasil_json.NOMORBUKTIKUNJUNGAN.length; i++){
                    var today1 = new Date(hasil_json.JAMMASUK[i]);
                    var day1 = today1.getDate();
                    var monthIndex1 = today1.getMonth();
                    var year1 = today1.getFullYear();
                    var hours1 = today1.getHours();
                    hours1 = ("0" + hours1).slice(-2);
                    var minutes1 = today1.getMinutes();
                    minutes1 = ("0" + minutes1).slice(-2);
                    var seconds1 = today1.getSeconds();
                    seconds1 = ("0" + seconds1).slice(-2);


                    var today2 = new Date(hasil_json.JAMREPORT[i]);
                    var day2 = today2.getDate();
                    var monthIndex2 = today2.getMonth();
                    var year2 = today2.getFullYear();
                    var hours2 = today2.getHours();
                    hours2 = ("0" + hours2).slice(-2);
                    var minutes2 = today2.getMinutes();
                    minutes2 = ("0" + minutes2).slice(-2);
                    var seconds2 = today2.getSeconds();
                    seconds2 = ("0" + seconds2).slice(-2);

                    tampungHalamanLaporanKunjunganFilter+=`

                    <div class="card">
                    <div class ="card-header cardHeaderBiru">`+hasil_json.NOMORBUKTIKUNJUNGAN[i]+`</div>
                    <div class="card-content card-content-padding">
                    
                    <div class="row">
                    <div class="col-45 cardContentDetail" >Berkunjung</div>
                    <div class="col-5 boldHitam"> : </div>
                    <div class="col-50 cardContentHasilDetail ">`+hasil_json.NAMAKARYAWAN[i]+`</div>
                    </div>

                    

                    <div class="row">
                    <div class="col-45 cardContentDetail" >Pelanggan</div>
                    <div class="col-5 boldHitam"> : </div>
                    <div class="col-50 cardContentHasilDetail ">`+hasil_json.NAMA[i]+`</div>
                    </div>

                    <div class="row">
                    <div class="col-45 cardContentDetail" >Jam Login PT</div>
                    <div class="col-5 boldHitam"> : </div>
                    <div class="col-50 cardContentHasilDetail ">`;
                    if(new Date(hasil_json.JAMMASUK[i]) < new Date("1980-01-01")){
                        tampungHalamanLaporanKunjunganFilter += ` - `;
                    } else {
                        tampungHalamanLaporanKunjunganFilter +=day1 + ' ' + monthNames[monthIndex1] + ' ' + year1+ '<br>' +hours1+':'+minutes1+':'+seconds1;
                    }
                    tampungHalamanLaporanKunjunganFilter+=`
                    </div>
                    </div>

                    <div class="row">
                    <div class="col-45 cardContentDetail" >Jam Report Fleet/Toko</div>
                    <div class="col-5 boldHitam"> : </div>
                    <div class="col-50 cardContentHasilDetail ">`+day2 + ' ' + monthNames[monthIndex2] + ' ' + year2+ '<br>' +hours2+':'+minutes2+':'+seconds2+`</div>
                    </div>
                    
                    <div class="row">
                    <div class="col-45 cardContentDetail" >Keterangan</div>
                    <div class="col-5 boldHitam"> : </div>
                    <div class="col-50 cardContentHasilDetail ">`;
                    if(hasil_json.KETERANGAN[i]){
                        tampungHalamanLaporanKunjunganFilter += hasil_json.KETERANGAN[i];
                    } else {
                        tampungHalamanLaporanKunjunganFilter +='-';
                    }
                    tampungHalamanLaporanKunjunganFilter+=`</div>
                    </div>

                    <div class="row">
                    <div class="col-45 cardContentDetail" >Kesimpulan</div>
                    <div class="col-5 boldHitam"> : </div>
                    <div class="col-50 cardContentHasilDetail ">`;
                    if(hasil_json.KESIMPULAN[i]){
                        tampungHalamanLaporanKunjunganFilter += hasil_json.KESIMPULAN[i];
                    } else {
                        tampungHalamanLaporanKunjunganFilter +='-';
                    }
                    tampungHalamanLaporanKunjunganFilter+=`</div>
                    </div>

                    <div class="row">
                    <div class="col-45 cardContentDetail" >Permintaan Khusus</div>
                    <div class="col-5 boldHitam"> : </div>
                    <div class="col-50 cardContentHasilDetail ">`;
                    if(hasil_json.PERMINTAANKHUSUS[i]){
                        tampungHalamanLaporanKunjunganFilter += hasil_json.PERMINTAANKHUSUS[i];
                    } else {
                        tampungHalamanLaporanKunjunganFilter +='-';
                    }
                    tampungHalamanLaporanKunjunganFilter+=`</div>
                    </div>
                    
                    </div>
                    </div>`;
                }
                $$('.semuaTampilLaporanKunjunganFilter').html(tampungHalamanLaporanKunjunganFilter);

            } else {
                $$('.semuaTampilLaporanKunjunganFilter').html("Tidak Ada Laporan");
            }
            myApp.preloader.hide();
        });


});

//detail_laporan_berdasarkan_pelanggan
$$(document).on('page:init', '.page[data-name="detail_laporan_berdasarkan_pelanggan"]', function (page) {
    var today = new Date(tampungTanggalListLaporanBerdasarkanPelanggan);
    var day = today.getDate();
    var monthIndex = today.getMonth();
    var year = today.getFullYear();

    
    var act = "TAMPIL_SEMUA_NOTA_LAPORAN_BERDASARKAN_PELANGGAN";
    myApp.request.post(ipTujuan,{case:act,KODEPELANGGAN:editKodePelanggan,DATETRANSACTION:tampungTanggalListLaporanBerdasarkanPelanggan},function(data){
        var hasil_json = JSON.parse(data);
        console.log(hasil_json);
        var tampungNotaLaporanBerdasarkanPelanggan = "";
        $$('.titleLaporanBerdasarkanPelanggan').html(hasil_json.NAMAPELANGGAN[0]);
        if(hasil_json.hasil == "ada"){
            for(var i = 0; i<hasil_json.NOMORBUKTI.length; i++){

                tampungNotaLaporanBerdasarkanPelanggan +=`
                <div class="card">
                <div class ="card-header cardHeaderBiru">`+hasil_json.NOMORBUKTI[i]+`</div>
                <div class="card-content card-content-padding">

                <div class="row">
                <div class="col-45 cardContentDetail">Kode Salesman</div>
                <div class="col-5 boldHitam"> : </div>
                <div class="col-50 cardContentHasilDetail">`+hasil_json.KODESALESMAN[i]+`</div>
                </div>

                <div class="row">
                <div class="col-45 cardContentDetail">Jam Login PT</div>
                <div class="col-5 boldHitam"> : </div>
                <div class="col-50 cardContentHasilDetail">`+hasil_json.JAMMASUK[i]+`</div>
                </div>

                <div class="row">
                <div class="col-45 cardContentDetail">Jam Report Fleet/Toko</div>
                <div class="col-5 boldHitam"> : </div>
                <div class="col-50 cardContentHasilDetail">`+hasil_json.JAMREPORT[i]+`</div>
                </div>

                <div class="row">
                <div class="col-45 cardContentDetail" >Keterangan</div>
                <div class="col-5 boldHitam"> : </div>
                <div class="col-50 cardContentHasilDetail">`+hasil_json.KETERANGAN[i]+`</div>
                </div>

                <div class="row">
                <div class="col-45 cardContentDetail" >Kesimpulan</div>
                <div class="col-5 boldHitam"> : </div>
                <div class="col-50 cardContentHasilDetail">`+hasil_json.KESIMPULAN[i]+`</div>
                </div>
                
                <div class="row">
                <div class="col-45 cardContentDetail" >Permintaan Khusus</div>
                <div class="col-5 boldHitam"> : </div>
                <div class="col-50 cardContentHasilDetail">`+hasil_json.PERMINTAANKHUSUS[i]+`</div>
                </div>

                <div class="row">
                <div class="col-45 cardContentDetail" >Transfer</div>
                <div class="col-5 boldHitam"> : </div>
                <div class="col-50 cardContentHasilDetail">`;
                if(hasil_json.TRANSFER[i] == null){
                    tampungNotaLaporanBerdasarkanPelanggan += "Tidak Ada";
                } else {
                    tampungNotaLaporanBerdasarkanPelanggan +=hasil_json.TRANSFER[i];
                }
                tampungNotaLaporanBerdasarkanPelanggan+=`</div>
                </div>

                <div class="row">
                <div class="col-45 cardContentDetail" >Giro</div>
                <div class="col-5 boldHitam"> : </div>
                <div class="col-50 cardContentHasilDetail">`;
                if(hasil_json.GIRO[i] == null){
                    tampungNotaLaporanBerdasarkanPelanggan += "Tidak Ada";
                } else {
                    tampungNotaLaporanBerdasarkanPelanggan +=hasil_json.GIRO[i];
                }
                tampungNotaLaporanBerdasarkanPelanggan+=`</div>
                </div>

                <div class="row">
                <div class="col-45 cardContentDetail" >Tunai</div>
                <div class="col-5 boldHitam"> : </div>
                <div class="col-50 cardContentHasilDetail">`;
                if(hasil_json.TUNAI[i] == null){
                    tampungNotaLaporanBerdasarkanPelanggan += "Tidak Ada";
                } else {
                    tampungNotaLaporanBerdasarkanPelanggan +=hasil_json.TUNAI[i];
                }
                tampungNotaLaporanBerdasarkanPelanggan+=`</div>
                </div>`;

                if(hasil_json.hasilgambar == "ada"){
                    counter = 0;
                    hasil_json.GAMBAR.forEach(function(obj,x){
                        if(obj.NOMORBUKTI == hasil_json.NOMORBUKTI[i]){
                            tampungNotaLaporanBerdasarkanPelanggan +=`
                            <a href ="#" onClick="zoomInOutGambar('${obj.NOMORBUKTI}','`+counter+`')">
                            <img src="`+ipGambarKunjungan+obj.NAMAGAMBAR+`.jpg?`+ new Date().getTime()+`" height="45px" width="45px">
                            </a>
                            `;
                            counter++;
                        }
                    })
                    /*counter = 0;
                    for(var j =0; j<hasil_json.COUNTERGAMBAR.length; j++){
                        if(hasil_json.COUNTERGAMBAR[j] == hasil_json.NOMORBUKTI[i]){
                            tampungNotaLaporanBerdasarkanPelanggan +=`
                            <a href ="#" onClick="zoomInOutGambar('${hasil_json.NOMORBUKTI[i]}','`+counter+`')">
                            <img src="`+ipGambarKunjungan+hasil_json.NAMAGAMBAR[j]+`.jpg?`+ new Date().getTime()+`" height="45px" width="45px">
                            </a>
                            `;
                            counter++;
                        } 
                    }*/

                }

                tampungNotaLaporanBerdasarkanPelanggan+=`</div>
                </div>
                `;
                
            }

        } else {
            tampungNotaLaporanBerdasarkanPelanggan = "Belum Ada Laporan";
        }
        $$('.semuaTampilDetailLaporanPelanggan').html(tampungNotaLaporanBerdasarkanPelanggan);
        myApp.preloader.hide();
    });
});


//master_laporan
$$(document).on('page:init', '.page[data-name="master_laporan"]', function (page) {
    /*var act = "TAMPIL_SEMUA_LAPORAN";
    var tampungMasterLaporan = "";
    myApp.request.post(ipTujuan,{case:act,KODEJABATAN:KODEJABATAN,USERID:USERID,KODECABANG:KODECABANG},function(data){
        var hasil_json = JSON.parse(data);
        if(hasil_json.hasil == "ada"){
            tampungMasterLaporan = "<ul>";
            for(var i = 0; i<hasil_json.DATETRANSACTION.length;i++){
                var today = new Date(hasil_json.DATETRANSACTION[i]);
                var day = today.getDate();
                var monthIndex = today.getMonth();
                var year = today.getFullYear();

                tampungMasterLaporan += `<li>
                <a href="#" onClick="klikListLaporan('`+hasil_json.DATETRANSACTION[i]+`')" class="item-link item-content">
                <div class="item-inner">
                <div class="item-title">`+day + ' ' + monthNames[monthIndex] + ' ' + year+`</div>
                <div class="item-after">`+hasil_json.JUMLAHKUNJUNGAN[i]+`</div>
                </div>
                </a>
                </li>`;    
            }

            tampungMasterLaporan += "</ul>";
        } else {
            tampungMasterLaporan = "Belum Ada Laporan";
        }
        $$('.semuaTampilMasterLaporan').html(tampungMasterLaporan);
        myApp.preloader.hide();
    });*/

    var maxItems;
    var TANGGAL = [];
    var JUMLAHKUNJUNGAN = [];
    var total = 0;
    var itemsPerLoad = 20;
    var act = "TAMPIL_SEMUA_LAPORAN";
    var tampungMasterLaporan = "";
    myApp.request.post(ipTujuan,{case:act,KODEJABATAN:KODEJABATAN,USERID:USERID,KODECABANG:KODECABANG},function(data){
        var hasil_json = JSON.parse(data);
        if(hasil_json.hasil == "ada"){
            maxItems = hasil_json.DATETRANSACTION.length;
            TANGGAL = hasil_json.DATETRANSACTION;
            JUMLAHKUNJUNGAN = hasil_json.JUMLAHKUNJUNGAN;
            if(TANGGAL.length < itemsPerLoad){
                total = TANGGAL.length;
            } else {
                total = itemsPerLoad;
            }
            tampungMasterLaporan = "<ul>";
            for(var i = 0; i<total;i++){
                var today = new Date(hasil_json.DATETRANSACTION[i]);
                var day = today.getDate();
                var monthIndex = today.getMonth();
                var year = today.getFullYear();

                tampungMasterLaporan += `<li>
                <a href="#" onClick="klikListLaporan('`+hasil_json.DATETRANSACTION[i]+`')" class="item-link item-content">
                <div class="item-inner">
                <div class="item-title">${ConvertDateTimeToText(hasil_json.DATETRANSACTION[i],'dateday')}</div>
                <div class="item-after">`+hasil_json.JUMLAHKUNJUNGAN[i]+`</div>
                </div>
                </a>
                </li>`;    
            }

            tampungMasterLaporan += "</ul>";
        } else {
            tampungMasterLaporan = "Belum Ada Laporan";
        }
        $$('.semuaTampilMasterLaporan').html(tampungMasterLaporan);

        var allowInfinite = true;
        var lastItemIndex = $$('.semuaTampilMasterLaporan li').length;


        if(total < itemsPerLoad){
            myApp.infiniteScroll.destroy('.infinite-scroll-content');
            $$('.infinite-scroll-preloader').remove();
        } 


        $$('.infinite-scroll-content').on('infinite', function () {
          if (!allowInfinite){
            return;
        }  
        allowInfinite = false;

        setTimeout(function () {
            allowInfinite = true;
            if(maxItems - $$('.semuaTampilMasterLaporan li').length > itemsPerLoad){
                itemsPerLoad = itemsPerLoad;
            } else {
                itemsPerLoad = maxItems - $$('.semuaTampilMasterLaporan li').length;
            }

            var html = '';
            for (var i = lastItemIndex; i < lastItemIndex + itemsPerLoad; i++) {
                var today = new Date(TANGGAL[i]);
                var day = today.getDate();
                var monthIndex = today.getMonth();
                var year = today.getFullYear();
                html += `<li>
                <a href="#" onClick="klikListLaporan('`+TANGGAL[i]+`')" class="item-link item-content">
                <div class="item-inner">
                <div class="item-title">${ConvertDateTimeToText(TANGGAL[i],'dateday')}</div>
                <div class="item-after">`+JUMLAHKUNJUNGAN[i]+`</div>
                </div>
                </a>
                </li>`;
            }

            $$('.semuaTampilMasterLaporan ul').append(html);
            lastItemIndex = $$('.semuaTampilMasterLaporan li').length;

            if (lastItemIndex >= maxItems) {
              myApp.infiniteScroll.destroy('.infinite-scroll-content');
              $$('.infinite-scroll-preloader').remove();
              return;
          }
      }, 1000);
    });
        myApp.preloader.hide();
    });

    $$('.filterMasterLaporan').on('click',function(){
        mainView.router.navigate("/filter_master_laporan/");
    });
});

$$(document).on('page:init', '.page[data-name="halaman_laporan"]', function (page) {
    var searchbar = myApp.searchbar.create({
        el: '.searchbar',
        searchContainer: '.list',
        searchIn: '.namaSearchLaporan',
        on: {
            search(sb, query, previousQuery) {
            }
        }
    });


    if(userHakAksesArrayGlobal["masterLaporan"]["UBAH"] == "F"){
        $$('.editPostingHapus').remove();
        $$('.editMasterTmKunjungan').remove();
    }

    $$('.editPostingHapus').on('click',function(){
        halamanPostingHapus = "tmkunjungan";
        mainView.router.navigate("/halaman_posting_hapus/");
    });

    var today = new Date(tampungTanggalListLaporan);
    var day = today.getDate();
    var monthIndex = today.getMonth();
    var year = today.getFullYear();

    $$('.title').html(day + ' ' + monthNames[monthIndex] + ' ' + year);

    var act = "TAMPIL_SEMUA_NOTA_LAPORAN";
    myApp.request.post(ipTujuan,{case:act,DATETRANSACTION:tampungTanggalListLaporan,KODEJABATAN:KODEJABATAN,USERID:USERID,filterPermintaanKhususGlobal:filterPermintaanKhususGlobal,
        filterKunjunganGlobal:filterKunjunganGlobal,KODECABANG:KODECABANG},function(data){
            var hasil_json = JSON.parse(data);
            var tampungSemuaKunjungan ="";
            if(hasil_json.hasil == "ada"){
                tampungSemuaKunjungan += "<ul>";
                for(var i = 0; i<hasil_json.KODEPELANGGAN.length;i++){
                    tampungSemuaKunjungan+= `
                    <li>
                    <a href="#" onClick="detailPelanggan('MASTER_LAPORAN','`+hasil_json.KODEPELANGGAN[i]+`','`+hasil_json.NAMA[i]+`',
                    '`+hasil_json.ALAMAT[i].replace(/(["'])/g, "\\$1")+`','`+hasil_json.KOTA[i]+`','`+hasil_json.TELPON[i]+`','`+hasil_json.FAX[i]+`','`+hasil_json.KREDITLIMIT[i]+`',
                    '`+hasil_json.SYARATPIUTANG[i]+`','`+hasil_json.SYARATPIUTANGMAX[i]+`','`+hasil_json.USERID[i]+`','`+hasil_json.TERM[i]+`',
                    '`+hasil_json.NAMAKATEGORIPELANGGAN[i]+`','`+hasil_json.ALAMATKIRIM[i]+`','`+hasil_json.NOMORBUKTIKUNJUNGAN[i]+`')" class="item-link item-content">
                    <div class="item-inner">
                    <div class="item-title-row">
                    <div class="item-text namaSearchLaporan" style="color:black"><b>`+hasil_json.KODEPELANGGAN[i]+`</b>   <span class="badge color-green">`+hasil_json.KODESALESMAN[i]+`</span><Br>`+hasil_json.NAMA[i]+`</div>

                    </div>      
                    </div>
                    </a>
                    </li>`;
                }
                tampungSemuaKunjungan += "</ul>";

                $$('.listLaporan').html(tampungSemuaKunjungan);
            } else {
                $$('.listLaporan').html("Belum Ada Laporan");
            }
            myApp.preloader.hide();
        });
});

//halaman_pilih_login_report
$$(document).on('page:init', '.page[data-name="halaman_pilih_login_report"]', function (page) {
    if(userHakAksesArrayGlobal["masterKunjungan"]){
        if(userHakAksesArrayGlobal["masterKunjungan"]["TAMBAH"] == "F" && halamanGlobal == "MASTER_KUNJUNGAN"){
            $$('.spanLoginToko').remove();
        }
    }

    if(userHakAksesArrayGlobal["masterCollector"]){
        if(userHakAksesArrayGlobal["masterCollector"]["TAMBAH"] == "F" && halamanGlobal == "MASTER_COLLECTOR"){
            $$('.spanLoginToko').remove();
        }
    }

    if(userHakAksesArrayGlobal["masterKiriman"]){
        if(userHakAksesArrayGlobal["masterKiriman"]["TAMBAH"] == "F" && halamanGlobal == "MASTER_KIRIMAN"){
            $$('.spanLoginToko').remove();
        }
    }



    if(halamanGlobal == "MASTER_KUNJUNGAN"){
        if(kodeLoginTokoKunjungan == ""){
            $$('.spanReportToko').html("");
        } else {
            $$('.spanLoginToko').html("");
        }
    } 
    
    if(halamanGlobal == "MASTER_COLLECTOR"){
        if(kodeLoginTokoCollector == ""){
            $$('.spanReportToko').html("");
        } else {
            $$('.spanLoginToko').html("");
        }
    } 
    
    if(halamanGlobal == "MASTER_KIRIMAN"){
        if(kodeLoginTokoKiriman == ""){
            $$('.spanReportToko').html("");
        } else {
            $$('.spanLoginToko').html("");
        }
    }



    myApp.preloader.hide();
    $$('.loginTokoMasuk').on('click',function(){
        mainView.router.navigate("/login_toko/");
        myApp.preloader.show();
    });

    $$('.laporanTokoMasuk').on('click',function(){
        if(halamanGlobal == "MASTER_KUNJUNGAN"){
            mainView.router.navigate("/master_kunjungan/");
        } else if(halamanGlobal == "MASTER_COLLECTOR"){
            mainView.router.navigate("/master_collector/");
        } else if(halamanGlobal == "MASTER_KIRIMAN"){
            mainView.router.navigate("/master_kiriman/");
        }
    });

    $$('.reportTokoMasuk').on('click',function(){
        if(halamanGlobal == "MASTER_KUNJUNGAN"){
            mainView.router.navigate("/input_kunjungan/");
        } else if(halamanGlobal == "MASTER_COLLECTOR"){
            mainView.router.navigate("/input_follow_collector/");
        } else if(halamanGlobal == "MASTER_KIRIMAN"){
            mainView.router.navigate("/input_follow_collector/");
        }

    });
});

//login_toko
$$(document).on('page:init', '.page[data-name="login_toko"]', function (page) {

    var act = "POPUP_TAMPIL_NAMA_TOKO";
    console.log(KODECABANG);
    myApp.request.post(ipTujuan,{case:act,KODECABANG:KODECABANG,USERID:USERID},function(data){
        console.log(data);
        var hasil_json = JSON.parse(data);
        tampungPopupNamaToko = "";
        if(hasil_json.hasil=="ada"){
            for(var i = 0; i<hasil_json.KODEPELANGGAN.length;i++){
                tampungPopupNamaToko +=`
                <li>
                <a href="#" class="item-link item-content" onClick="pilihTokoKunjungan('`+hasil_json.KODEPELANGGAN[i]+`','`+hasil_json.NAMA[i]+`')">
                <div class="item-inner">
                <div class="item-text namaToko" style="color:black"><b>`+hasil_json.KODEPELANGGAN[i]+`</b> - `+hasil_json.NAMA[i] +` <span class="badge color-green"> `+hasil_json.KODESALESMAN[i]+`</span> </div>
                </div>
                </a>
                </li>`;
            }
        } else {
            $$('.listPopupNamaTokoRencanaKunjungan').html("");
        }
        $$('.listPopupNamaTokoRencanaKunjungan').html(tampungPopupNamaToko);
        myApp.preloader.hide();
    });


    $$('.popup-open-toko').on('click',function(){
        myApp.popup.open('.popup-toko');
    });

    var searchbar = myApp.searchbar.create({
        el: '.searchbar',
        searchContainer: '.list',
        searchIn: '.namaToko',
        on: {
            search(sb, query, previousQuery) {
            }
        }
    });

    $$('.btnCancel').on('click',function(){
        myApp.popup.close('.popup-toko');
    });

    $$('.btnInputLoginToko').on('click',function(){
        var tampungWaktuLogin = "";
        var act = "WAKTU_SERVER";
        myApp.request.post(ipTujuan,{case:act},function(data){
            if(halamanGlobal == "MASTER_KUNJUNGAN"){
                namaLoginTokoKunjungan = $$('.kunjunganNamaToko').val();
                localStorage.setItem('namaLoginTokoKunjungan',namaLoginTokoKunjungan);
                kodeLoginTokoKunjungan = $$('.kunjunganKodeToko').val();
                localStorage.setItem('kodeLoginTokoKunjungan',kodeLoginTokoKunjungan);
                waktuMasukLoginTokoKunjungan = data;
                localStorage.setItem('waktuMasukLoginTokoKunjungan',waktuMasukLoginTokoKunjungan);
            } else if (halamanGlobal == "MASTER_COLLECTOR"){
                namaLoginTokoCollector = $$('.kunjunganNamaToko').val();
                localStorage.setItem('namaLoginTokoCollector',namaLoginTokoCollector);
                kodeLoginTokoCollector = $$('.kunjunganKodeToko').val();
                localStorage.setItem('kodeLoginTokoCollector',kodeLoginTokoCollector);
                waktuMasukLoginTokoCollector = data;
                localStorage.setItem('waktuMasukLoginTokoCollector',waktuMasukLoginTokoCollector);
            } else if (halamanGlobal == "MASTER_KIRIMAN"){
                namaLoginTokoKiriman = $$('.kunjunganNamaToko').val();
                localStorage.setItem('namaLoginTokoKiriman',namaLoginTokoKiriman);
                kodeLoginTokoKiriman = $$('.kunjunganKodeToko').val();
                localStorage.setItem('kodeLoginTokoKiriman',kodeLoginTokoKiriman);
                waktuMasukLoginTokoKiriman = data;
                localStorage.setItem('waktuMasukLoginTokoKiriman',waktuMasukLoginTokoKiriman);
            }
            //mainView.router.navigate("/halaman_pilih_login_report/");
            mainView.router.back("/halaman_pilih_login_report/",{force:true});
        });
    });
});

//master_rencana_tagihan_admin
$$(document).on('page:init', '.page[data-name="master_rencana_tagihan_admin"]', function (page) {
    var act = "TAMPIL_MASTER_RENCANA_TAGIHAN";
    myApp.request.post(ipTujuan,{case:act,USERID:USERID,KODECABANG:KODECABANG},function(data){
        var hasil_json = JSON.parse(data);
        var tampungRencanaTagihan = "";

        if(hasil_json.hasil == "ada"){
            tampungRencanaTagihan += `<ul>`;
            for(var i = 0; i<hasil_json.DATETRANSACTION.length; i++){
                var today = new Date(hasil_json.DATETRANSACTION[i]);
                var day = today.getDate();
                var monthIndex = today.getMonth();
                var year = today.getFullYear();

                tampungRencanaTagihan += `
                <li>
                <a href="#" onClick="klikListRencanaKunjungan('`+day + ' ' + monthNames[monthIndex] + ' ' + year+`')" class="item-link item-content detailRencanaKunjungan">
                <div class="item-inner">
                <div class="item-title">${ConvertDateTimeToText(hasil_json.DATETRANSACTION[i],"dateday")}</div>
                <div class="item-after">`+hasil_json.JUMLAHOUTLET[i]+` Outlet</div>
                </div>
                </a>
                </li>`;
            }
            tampungRencanaTagihan += `</ul>`;
        } else {
            $$('.semuaMasterRencanaTagihanAdmin').html("Belum Pernah Memiliki Rencana Kunjungan");
        }

        $$('.semuaMasterRencanaTagihanAdmin').html(tampungRencanaTagihan);
        myApp.preloader.hide();
    });
});

//input_rencana_tagihan_admin
$$(document).on('page:init', '.page[data-name="input_rencana_tagihan_admin"]', function (page) {
    myApp.preloader.hide();
    var act = "POPUP_TAMPIL_NAMA_TOKO";
    myApp.request.post(ipTujuan,{case:act,USERID:USERID,KODECABANG:KODECABANG},function(data){
        var hasil_json = JSON.parse(data);
        tampungPopupNamaToko = "";
        if(hasil_json.hasil=="ada"){
            for(var i = 0; i<hasil_json.KODEPELANGGAN.length;i++){
                tampungPopupNamaToko +=`
                <li>
                <a href="#" class="item-link item-content" onClick="pilihToko('`+hasil_json.KODEPELANGGAN[i]+`','`+hasil_json.NAMA[i]+`')">
                <div class="item-inner">
                <div class="item-text namaToko" style="color:black">`+hasil_json.KODEPELANGGAN[i]+` - `+hasil_json.NAMA[i]+`</div>
                </div>
                </a>
                </li>`;
            }
        } else {
            $$('.listPopupNamaTokoRencanaKunjungan').html("");
        }
        $$('.listPopupNamaTokoRencanaKunjungan').html(tampungPopupNamaToko);
    });

    var counter = 1;
    $$('.btnTambahToko').on('click',function(){
        var element = `<div class="card">
        <div class="card-header" style="background-color:#2196F3;color:white">

        <span style="font-size:0.9em"><b>Toko</b></span>
        <a href="#" class="hapusToko"><span style="font-size:0.9em;text-align: right"><i class="fas fa-window-close " style="color:white"></i></span></a>

        </div>
        <div class="card-content card-content-padding">
        <div class="list form-store-data" >
        <div class="item-content item-input">
        <div class="item-inner">
        <div class="item-input-wrap">
        <a href="#" class="popup-open-toko" id ="`+counter+`">
        <input type="text" class="toko`+counter+`" placeholder="" readonly="readonly"/>
        <input type="hidden" name ="kodePelanggan" class="valueToko`+counter+`"/>
        </a>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>`;

        $$('.generateTambahToko').append(element);
        $$('.hapusToko').on('click',function(){
            $$(this).closest('.card').remove()
        });

        $$('.popup-open-toko').on('click',function(){
            tampungCounter = $(this).attr('id');
            
            myApp.popup.open('.popup-toko');
        });
        counter++;

    });

    $$('.hapusToko').on('click',function(){
        $$(this).closest('.card').remove()
    });

    $$('.popup-open-toko').on('click',function(){
        var tampungCounter = $(this).attr('id');
        console.log(tampungCounter);
        myApp.popup.open('.popup-toko');
    });


    $$('.btnInputRencanaTagihan').on('click',function(){
        var act = "INPUT_RENCANA_ADMIN";
        var DATETRANSACTION = $$('#demo-calendar-modal').val();
        var KODEPELANGGAN = [];
        
        $$('input[name^="kodePelanggan"]').each(function() {
            if($$(this).val()!=""){
                KODEPELANGGAN.push($$(this).val());
            }
        });

        if( DATETRANSACTION && KODEPELANGGAN.length !=0){
            myApp.request.post(ipTujuan,{case:act,DATETRANSACTION:DATETRANSACTION, KODEPELANGGAN:KODEPELANGGAN, USERID:USERID},function(data){
                var response = JSON.parse(data);
                if(response.hasil == "berhasil"){
                    mainView.router.back({force:true});
                    myApp.dialog.alert("Berhasil Menginput Rencana Tagihan");
                } else {
                    myApp.dialog.alert(response.hasil);
                }
            });   
        } else {
            myApp.dialog.alert("Isi Semua Data Terlebih Dahulu");
        }
    });

    var today = new Date();
    today = new Date().setDate(today.getDate() - 1);

    var calendarModal = myApp.calendar.create({
        inputEl: '#demo-calendar-modal',
        openIn: 'customModal',
        header: true,
        footer: true,
        dateFormat: 'MM dd yyyy',
        minDate: today,
    });

    var searchbar = myApp.searchbar.create({
        el: '.searchbar',
        searchContainer: '.list',
        searchIn: '.namaToko',
        on: {
            search(sb, query, previousQuery) {
                console.log(query, previousQuery);
            }
        }
    });

});

$$(document).on('page:init', '.page[data-name="halaman_posting_hapus_tagihan"]', function (page) {
    var today = new Date(editTanggalRencanaKunjungan);
    var day = today.getDate();
    var monthIndex = today.getMonth();
    var year = today.getFullYear();


    $$('.title').html(day + ' ' + monthNames[monthIndex] + ' ' + year);
    
    var act = "TAMPIL_POSTING_HAPUS_TAGIHAN";
    myApp.request.post(ipTujuan,{case:act,KODEJABATAN:KODEJABATAN,USERID:USERID,DATETRANSACTION:editTanggalRencanaKunjungan,halamanPostingHapus:halamanPostingHapus,tampungHalamanFollowDanCollector:tampungHalamanFollowDanCollector,
        parameter_rencana:parameter_rencana,TANGGALDARI:tanggalDariRencana,TANGGALSAMPAI:tanggalSampaiRencana,
        STAFFDARI:staffDariRencana,STAFFSAMPAI:staffSampaiRencana,KODECABANG:KODECABANG},function(data){
            var hasil_json = JSON.parse(data);
            var tampungPostingHapus = "";
            if(hasil_json.hasil == "ada"){
                tampungPostingHapus +=`<div class="list">
                <ul>`;

                for(var i = 0; i<hasil_json.NOMORBUKTI.length; i++){
                    tampungPostingHapus +=
                    `<li>
                    <label class="item-checkbox item-content">
                    <input type="checkbox" name="postingHapusValue[]" value="`+hasil_json.NOMORBUKTI[i]+`"/>
                    <i class="icon icon-checkbox"></i>
                    <div class="item-inner">
                    <div class="item-title">`+hasil_json.NAMA[i]+`</div>
                    </div>
                    </label>
                    </li>`;
                }

                tampungPostingHapus +=`</ul>
                </div>
                `;
            } else {
                tampungPostingHapus += "TIDAK ADA";
            }

            $$('.tampilPostingHapus').html(tampungPostingHapus);
        });


    $$('.btnPostingTerpilih').on('click',function(){
        myApp.preloader.show();
        var postingHapusValue = [];
        $$('input[name^="postingHapusValue"]').each(function() {
            if($$(this).prop("checked")){
                postingHapusValue.push($$(this).val());
            }
        });

        if(postingHapusValue.length!=0){
            var act = "POSTING_TERPILIH_TAGIHAN";
            myApp.request.post(ipTujuan,{case:act,postingHapusValue:postingHapusValue,USERID:USERID,halamanPostingHapus:halamanPostingHapus},function(data){
                myApp.dialog.alert("Sudah Berhasil Diposting");
                mainView.router.back();
            });
        } else {
            myApp.dialog.alert("Pilih Terlebih Dahulu");
            myApp.preloader.hide();
        }
    });

    $$('.btnHapusTerpilih').on('click',function(){
        myApp.preloader.show();
        var postingHapusValue = [];
        $$('input[name^="postingHapusValue"]').each(function() {
            if($$(this).prop("checked")){
                postingHapusValue.push($$(this).val());
            }
        });

        if(postingHapusValue.length!=0){
            var act = "HAPUS_TERPILIH_TAGIHAN";
            myApp.request.post(ipTujuan,{case:act,postingHapusValue:postingHapusValue,USERID:USERID,halamanPostingHapus:halamanPostingHapus},function(data){
                myApp.dialog.alert("Sudah Berhasil Dihapus");
                mainView.router.back({force:true});
            });
        } else {
            myApp.dialog.alert("Pilih Terlebih Dahulu");
            myApp.preloader.hide();
        }
    });
});

//master pesanan
$$(document).on('page:init', '.page[data-name="master_pesanan"]', function (page) {
    
    var act = "POPUP_TAMPIL_NAMA_TOKO";
    console.log(KODECABANG);
    myApp.request.post(ipTujuan,{case:act,KODECABANG:KODECABANG,USERID:USERID},function(data){
        console.log(data);
        var hasil_json = JSON.parse(data);
        tampungPopupNamaToko = "";
        if(hasil_json.hasil=="ada"){
            for(var i = 0; i<hasil_json.KODEPELANGGAN.length;i++){
                tampungPopupNamaToko +=`
                <li>
                <a href="#" class="item-link item-content" onClick="pilihTokoKunjungan('`+hasil_json.KODEPELANGGAN[i]+`','`+hasil_json.NAMA[i]+`')">
                <div class="item-inner">
                <div class="item-text namaToko" style="color:black"><b>`+hasil_json.KODEPELANGGAN[i]+`</b> - `+hasil_json.NAMA[i] +` <span class="badge color-green"> `+hasil_json.KODESALESMAN[i]+`</span> </div>
                </div>
                </a>
                </li>`;
            }
        } else {
            $$('.listPopupNamaTokoPesanan').html("");
        }
        $$('.listPopupNamaTokoPesanan').html(tampungPopupNamaToko);
        myApp.preloader.hide();
    });
    
    var act = "POPUP_TAMPIL_BARANG";
    myApp.request.post(ipTujuan,{case:act,KODECABANG:KODECABANG,USERID:USERID},function(data){
        var hasil_json = JSON.parse(data);
        tampungPopupNamaBarang = "";
        if(hasil_json.hasil=="ada"){
            for(var i = 0; i<hasil_json.KODEBARANG.length;i++){
                tampungPopupNamaBarang +=`
                <li>
                <a href="#" class="item-link item-content" onClick="pilihBarang('`+hasil_json.KODEBARANG[i]+`','`+hasil_json.NAMA[i]+`','`+hasil_json.HARGAJUAL[i]+`')">
                <div class="item-inner">
                <div class="item-text namaBarang" style="color:black"><b>`+hasil_json.KODEBARANG[i]+`</b> - `+hasil_json.NAMA[i] +`</div>
                </div>
                </a>
                </li>`;
            }
        } else {
            $$('.listPopupBarang').html("");
        }
        $$('.listPopupBarang').html(tampungPopupNamaBarang);
        myApp.preloader.hide();
    });

    var GRAND_TOTAL = 0;
    $$('.tambah_pesanan').on('click',function(){
        
        var BARANG = $$('.namaBarang').val();
        var JUMLAH = $$('.jumlahBarang').val();
        var HARGA = $$('.hargaPemasanganBan').val();
        
        var TOTAL_BARANG = JUMLAH * HARGA;
        GRAND_TOTAL += TOTAL_BARANG;
        
        var tampungDaftar =`<li class = "item-content"><div class = "item-inner"><div class = "item-title-row"><div class = "item-title">`+BARANG+`</div><span>Rp`+TOTAL_BARANG+`</span></div><div class = "item-subtitle">`+
        JUMLAH +`xRp`+ HARGA +`</div></div></li>`;
        $$('.daftar_pesanan').append(tampungDaftar);
        myApp.preloader.hide();
    });

    $$('.popup-open-toko').on('click',function(){
        myApp.popup.open('.popup-toko');
    });
    
    $$('.popup-open-barang').on('click',function(){
        myApp.popup.open('.popup-barang');
    });

    var searchbar_toko = myApp.searchbar.create({
        el: '.searchbar',
        searchContainer: '.list',
        searchIn: '.namaToko',
        on: {
            search(sb, query, previousQuery) {
            }
        }
    });

    var searchbar_barang = myApp.searchbar.create({
        el: '.searchbar',
        searchContainer: '.list',
        searchIn: '.namaBarang',
        on: {
            search(sb, query, previousQuery) {
            }
        }
    });
    
    $$('.btnCancel').on('click',function(){
        myApp.popup.close('.popup-toko');
        myApp.popup.close('.popup-barang');
    });
    
});

//master_rencana_kunjungan
$$(document).on('page:init', '.page[data-name="master_rencana_kunjungan"]', function (page) {
    tampungHalamanFollowDanCollector = "RENCANA_KUNJUNGAN";
    if(userHakAksesArrayGlobal["masterRencanaKunjungan"]["TAMBAH"] == "F"){
        $$('.fabBuatRencanaKunjungan').remove();
    }

    if(parameter_rencana == "tidakada"){
        var act = "TAMPIL_MASTER_RENCANA_KUNJUNGAN";
        myApp.request.post(ipTujuan,{case:act,USERID:USERID,KODECABANG:KODECABANG},function(data){
            var hasil_json = JSON.parse(data);
            var tampungRencanaKunjungan = "";

            if(hasil_json.hasil == "ada"){
                tampungRencanaKunjungan += `<ul>`;
                for(var i = 0; i<hasil_json.DATETRANSACTION.length; i++){
                    var today = new Date(hasil_json.DATETRANSACTION[i]);
                    var day = today.getDate();
                    var monthIndex = today.getMonth();
                    var year = today.getFullYear();

                    tampungRencanaKunjungan += `
                    <li>
                    <a href="#" onClick="klikListRencanaKunjungan('`+day + ' ' + monthNames[monthIndex] + ' ' + year+`')" class="item-link item-content detailRencanaKunjungan">
                    <div class="item-inner">
                    <div class="item-title">${ConvertDateTimeToText(hasil_json.DATETRANSACTION[i],"dateday")}</div>
                    <div class="item-after">`+hasil_json.JUMLAHOUTLET[i]+` Outlet</div>
                    </div>
                    </a>
                    </li>`;
                }
                tampungRencanaKunjungan += `</ul>`;
            } else {
                $$('.semuaMasterRencanaKunjungan').html("Belum Pernah Memiliki Rencana Kunjungan");
            }

            $$('.semuaMasterRencanaKunjungan').html(tampungRencanaKunjungan);
            myApp.preloader.hide();
        });
    } else {
        var params = {
            case:"TAMPIL_MASTER_RENCANA_KUNJUNGAN_PARAMETER",
            USERID:USERID,
            KODEJABATAN:KODEJABATAN,
            KODECABANG:KODECABANG,
            STAFFDARI:staffDariRencana,
            STAFFSAMPAI:staffSampaiRencana,
            TANGGALDARI:tanggalDariRencana,
            TANGGALSAMPAI:tanggalSampaiRencana
        }
        myApp.request.post(ipTujuan,params,
            function(data){
                var hasil_json = JSON.parse(data);
                var tampungRencanaKunjungan = "";

                if(hasil_json.hasil == "ada"){
                    tampungRencanaKunjungan += `<ul>`;
                    for(var i = 0; i<hasil_json.DATETRANSACTION.length; i++){
                        var today = new Date(hasil_json.DATETRANSACTION[i]);
                        var day = today.getDate();
                        var monthIndex = today.getMonth();
                        var year = today.getFullYear();

                        tampungRencanaKunjungan += `
                        <li>
                        <a href="#" onClick="klikListRencanaKunjungan('`+day + ' ' + monthNames[monthIndex] + ' ' + year+`')" class="item-link item-content detailRencanaKunjungan">
                        <div class="item-inner">
                        <div class="item-title">${ConvertDateTimeToText(TANGGAL[i],"dateday")}</div>
                        <div class="item-after">`+hasil_json.JUMLAHOUTLET[i]+` Outlet</div>
                        </div>
                        </a>
                        </li>`;
                    }
                    tampungRencanaKunjungan += `</ul>`;
                } else {
                    $$('.semuaMasterRencanaKunjungan').html("Belum Pernah Memiliki Rencana Kunjungan");
                }

                $$('.semuaMasterRencanaKunjungan').html(tampungRencanaKunjungan);
                myApp.preloader.hide();
            },
            function(xhr,status){
                PreloaderHide(status);
            })
    }

    $$('.fabBuatRencanaKunjungan').on('click',function(){
        mainView.router.navigate("/input_rencana_kunjungan/"); 
    });
});

var monthNames = [
"January", "February", "March",
"April", "May", "June", "July",
"August", "September", "October",
"November", "December"
];

//master_kunjungan
$$(document).on('page:init', '.page[data-name="master_kunjungan"]', function (page) {
    var maxItems;
    var TANGGAL = [];
    var total = 0;
    var itemsPerLoad = 20;
    var JUMLAHKUNJUNGAN = [];
    var JUMLAHRENCANAKUNJUNGAN = [];
    tampungHalamanFollowDanCollector = "";
    if(userHakAksesArrayGlobal["masterKunjungan"]["TAMBAH"] == "F"){
        $$('.fabInputKunjungan').remove();
    }

    var act = "TAMPIL_MASTER_KUNJUNGAN";
    myApp.request.post(ipTujuan,{case:act,USERID:USERID,KODEJABATAN:KODEJABATAN,KODECABANG:KODECABANG},function(data){
        var hasil_json = JSON.parse(data);
        var tampungMasterKunjungan = "Belum Pernah Melakukan Kunjungan";

        if(hasil_json.hasil == "ada"){
            maxItems = hasil_json.DATETRANSACTION.length;
            TANGGAL = hasil_json.DATETRANSACTION;
            JUMLAHKUNJUNGAN = hasil_json.JUMLAHKUNJUNGAN;
            JUMLAHRENCANAKUNJUNGAN = hasil_json.JUMLAHRENCANAKUNJUNGAN;
            if(TANGGAL.length < itemsPerLoad){
                total = TANGGAL.length;
            } else {
                total = itemsPerLoad;
            }

            tampungMasterKunjungan ="<ul>";
            for(var i = 0; i<total; i++){
                var today = new Date(hasil_json.DATETRANSACTION[i]);
                var day = today.getDate();
                var monthIndex = today.getMonth();
                var year = today.getFullYear();
                var tampung = hasil_json.DATETRANSACTION[0];
                tampungMasterKunjungan += `
                <li>
                <a href="#" onClick="klikListKunjungan('`+day + ' ' + monthNames[monthIndex] + ' ' + year+`')" class="item-link item-content detailRencanaKunjungan">
                <div class="item-inner">
                <div class="item-title">${ConvertDateTimeToText(hasil_json.DATETRANSACTION[i],'dateday')}</div>
                <div class="item-after">`+hasil_json.JUMLAHKUNJUNGAN[i]+`/`+hasil_json.JUMLAHRENCANAKUNJUNGAN[i]+` Outlet</div>
                </div>
                </a>
                </li>`;
            }
            tampungMasterKunjungan +="</ul>";
        } else {
            $$('.semuaTampilMasterKunjungan').html("Belum Pernah Melakukan Kunjungan");

        }

        $$('.semuaTampilMasterKunjungan').html(tampungMasterKunjungan);
        var allowInfinite = true;
        var lastItemIndex = $$('.semuaTampilMasterKunjungan li').length;


        if(total < itemsPerLoad){
            myApp.infiniteScroll.destroy('.infinite-scroll-content');
            $$('.infinite-scroll-preloader').remove();
        } 


        $$('.infinite-scroll-content').on('infinite', function () {
          if (!allowInfinite){
            return;
        }  
        allowInfinite = false;

        setTimeout(function () {
            allowInfinite = true;
            if(maxItems - $$('.semuaTampilMasterKunjungan li').length > itemsPerLoad){
                itemsPerLoad = itemsPerLoad;
            } else {
                itemsPerLoad = maxItems - $$('.semuaTampilMasterKunjungan li').length;
            }

            var html = '';
            for (var i = lastItemIndex; i < lastItemIndex + itemsPerLoad; i++) {
                var today = new Date(TANGGAL[i]);
                var day = today.getDate();
                var monthIndex = today.getMonth();
                var year = today.getFullYear();
                html += `<li>
                <a href="#" onClick="klikListKunjungan('`+day + ' ' + monthNames[monthIndex] + ' ' + year+`')" class="item-link item-content detailRencanaKunjungan">
                <div class="item-inner">
                <div class="item-title">${ConvertDateTimeToText(TANGGAL[i],'dateday')}</div>
                <div class="item-after">`+JUMLAHKUNJUNGAN[i]+`/`+JUMLAHRENCANAKUNJUNGAN[i]+` Outlet</div>
                </div>
                </a>
                </li>`;
            }

            $$('.semuaTampilMasterKunjungan ul').append(html);
            lastItemIndex = $$('.semuaTampilMasterKunjungan li').length;

            if (lastItemIndex >= maxItems) {
              myApp.infiniteScroll.destroy('.infinite-scroll-content');
              $$('.infinite-scroll-preloader').remove();
              return;
          }
      }, 1000);
    });
        myApp.preloader.hide();

    });

    $$('.fabInputKunjungan').on('click',function(){
        mainView.router.navigate("/input_kunjungan/");
    });
});

//master_followup
$$(document).on('page:init', '.page[data-name="master_followup"]', function (page) {
    if(userHakAksesArrayGlobal["masterFollowUp"]["TAMBAH"] == "F"){
        $$('.fabInputFollowUp').remove();
    }

    /*var act = "TAMPIL_MASTER_FOLLOWUP";
    myApp.request.post(ipTujuan,{case:act,USERID:USERID,KODEJABATAN:KODEJABATAN,KODECABANG:KODECABANG},function(data){
        var hasil_json = JSON.parse(data);
        var tampungMasterKunjungan = "";

        if(hasil_json.hasil == "ada"){
            tampungMasterKunjungan +="<ul>";
            for(var i = 0; i<hasil_json.DATETRANSACTION.length; i++){
                var today = new Date(hasil_json.DATETRANSACTION[i]);
                var day = today.getDate();
                var monthIndex = today.getMonth();
                var year = today.getFullYear();
                var tampung = hasil_json.DATETRANSACTION[0];
                console.log(hasil_json.DATETRANSACTION[0]);
                tampungMasterKunjungan += `
                <li>
                <a href="#" onClick="klikListFollowDanCollector('FOLLOWUP','`+day + ' ' + monthNames[monthIndex] + ' ' + year+`')" class="item-link item-content detailRencanaKunjungan">
                <div class="item-inner">
                <div class="item-title">`+day + ' ' + monthNames[monthIndex] + ' ' + year+`</div>
                <div class="item-after">`+hasil_json.JUMLAHKUNJUNGAN[i]+`/`+hasil_json.JUMLAHRENCANAKUNJUNGAN[i]+` Outlet</div>
                </div>
                </a>
                </li>`;
            }
            tampungMasterKunjungan +="</ul>";
        } else {
            $$('.semuaTampilMasterFollowUp').html("Belum Pernah Melakukan Follow Up");
        }

        $$('.semuaTampilMasterFollowUp').html(tampungMasterKunjungan);
        myApp.preloader.hide();
    });*/


    var maxItems;
    var TANGGAL = [];
    var total = 0;
    var itemsPerLoad = 20;
    var JUMLAHKUNJUNGAN = [];
    var JUMLAHRENCANAKUNJUNGAN = [];
    var act = "TAMPIL_MASTER_FOLLOWUP";
    myApp.request.post(ipTujuan,{case:act,USERID:USERID,KODEJABATAN:KODEJABATAN,KODECABANG:KODECABANG},function(data){
        var hasil_json = JSON.parse(data);
        var tampungMasterKunjungan = "";

        if(hasil_json.hasil == "ada"){
            maxItems = hasil_json.DATETRANSACTION.length;
            TANGGAL = hasil_json.DATETRANSACTION;
            JUMLAHKUNJUNGAN = hasil_json.JUMLAHKUNJUNGAN;
            JUMLAHRENCANAKUNJUNGAN = hasil_json.JUMLAHRENCANAKUNJUNGAN;
            if(TANGGAL.length < itemsPerLoad){
                total = TANGGAL.length;
            } else {
                total = itemsPerLoad;
            }
            tampungMasterKunjungan +="<ul>";
            for(var i = 0; i<total; i++){
                var today = new Date(hasil_json.DATETRANSACTION[i]);
                var day = today.getDate();
                var monthIndex = today.getMonth();
                var year = today.getFullYear();
                var tampung = hasil_json.DATETRANSACTION[0];
                tampungMasterKunjungan += `
                <li>
                <a href="#" onClick="klikListFollowDanCollector('FOLLOWUP','`+day + ' ' + monthNames[monthIndex] + ' ' + year+`')" class="item-link item-content detailRencanaKunjungan">
                <div class="item-inner">
                <div class="item-title">${ConvertDateTimeToText(hasil_json.DATETRANSACTION[i],"dateday")}</div>
                <div class="item-after">`+hasil_json.JUMLAHKUNJUNGAN[i]+`/`+hasil_json.JUMLAHRENCANAKUNJUNGAN[i]+` Outlet</div>
                </div>
                </a>
                </li>`;
            }
            tampungMasterKunjungan +="</ul>";
        } else {
            $$('.semuaTampilMasterFollowUp').html("Belum Pernah Melakukan Follow Up");
        }

        $$('.semuaTampilMasterFollowUp').html(tampungMasterKunjungan);
        var allowInfinite = true;
        var lastItemIndex = $$('.semuaTampilMasterFollowUp li').length;

        if(total < itemsPerLoad){
            myApp.infiniteScroll.destroy('.infinite-scroll-content');
            $$('.infinite-scroll-preloader').remove();
        } 


        $$('.infinite-scroll-content').on('infinite', function () {
          if (!allowInfinite){
            return;
        }  
        allowInfinite = false;

        setTimeout(function () {
            allowInfinite = true;
            if(maxItems - $$('.semuaTampilMasterFollowUp li').length > itemsPerLoad){
                itemsPerLoad = itemsPerLoad;
            } else {
                itemsPerLoad = maxItems - $$('.semuaTampilMasterFollowUp li').length;
            }

            var html = '';
            for (var i = lastItemIndex; i < lastItemIndex + itemsPerLoad; i++) {
                var today = new Date(TANGGAL[i]);
                var day = today.getDate();
                var monthIndex = today.getMonth();
                var year = today.getFullYear();
                html += `<li>
                <a href="#" onClick="klikListFollowDanCollector('FOLLOWUP','`+day + ' ' + monthNames[monthIndex] + ' ' + year+`')" class="item-link item-content detailRencanaKunjungan">
                <div class="item-inner">
                <div class="item-title">${ConvertDateTimeToText(TANGGAL[i],"dateday")}</div>
                <div class="item-after">`+JUMLAHKUNJUNGAN[i]+`/`+JUMLAHRENCANAKUNJUNGAN[i]+` Outlet</div>
                </div>
                </a>
                </li>`;
            }

            $$('.semuaTampilMasterFollowUp ul').append(html);
            lastItemIndex = $$('.semuaTampilMasterFollowUp li').length;

            if (lastItemIndex >= maxItems) {
              myApp.infiniteScroll.destroy('.infinite-scroll-content');
              $$('.infinite-scroll-preloader').remove();
              return;
          }
      }, 1000);
    });
        myApp.preloader.hide();
    });



    $$('.fabInputFollowUp').on('click',function(){
        mainView.router.navigate("/input_follow_collector/");
    });
});


//master_collector
$$(document).on('page:init', '.page[data-name="master_collector"]', function (page) {
    if(userHakAksesArrayGlobal["masterCollector"]["TAMBAH"] == "F"){
        $$('.fabInputCollector').remove();
    }

    var act = "TAMPIL_MASTER_COLLECTOR";
    myApp.request.post(ipTujuan,{case:act,USERID:USERID,KODEJABATAN:KODEJABATAN,KODECABANG:KODECABANG},function(data){
        var hasil_json = JSON.parse(data);
        var tampungMasterKunjungan = "";

        if(hasil_json.hasil == "ada"){
            tampungMasterKunjungan +="<ul>";
            for(var i = 0; i<hasil_json.DATETRANSACTION.length; i++){
                var today = new Date(hasil_json.DATETRANSACTION[i]);
                var day = today.getDate();
                var monthIndex = today.getMonth();
                var year = today.getFullYear();
                var tampung = hasil_json.DATETRANSACTION[0];
                console.log(hasil_json.DATETRANSACTION[0]);
                tampungMasterKunjungan += `
                <li>
                <a href="#" onClick="klikListFollowDanCollector('COLLECTOR','`+day + ' ' + monthNames[monthIndex] + ' ' + year+`')" class="item-link item-content detailRencanaKunjungan">
                <div class="item-inner">
                <div class="item-title">${ConvertDateTimeToText(hasil_json.DATETRANSACTION[i],"dateday")}</div>
                </div>
                </a>
                </li>`;
            }
            tampungMasterKunjungan +="</ul>";
        } else {
            tampungMasterKunjungan="Belum Pernah Melakukan Collector";
        }

        $$('.semuaTampilMasterCollector').html(tampungMasterKunjungan);
        myApp.preloader.hide();
    });

    $$('.fabInputCollector').on('click',function(){
        mainView.router.navigate("/input_follow_collector/");
    });
});

//master_kiriman
$$(document).on('page:init', '.page[data-name="master_kiriman"]', function (page) {
    /*var act = "TAMPIL_MASTER_KIRIMAN";
    myApp.request.post(ipTujuan,{case:act,USERID:USERID,KODEJABATAN:KODEJABATAN,KODECABANG:KODECABANG},function(data){
        var hasil_json = JSON.parse(data);
        var tampungMasterKunjungan = "";

        if(hasil_json.hasil == "ada"){
            tampungMasterKunjungan +="<ul>";
            for(var i = 0; i<hasil_json.DATETRANSACTION.length; i++){
                var today = new Date(hasil_json.DATETRANSACTION[i]);
                var day = today.getDate();
                var monthIndex = today.getMonth();
                var year = today.getFullYear();
                var tampung = hasil_json.DATETRANSACTION[0];
                console.log(hasil_json.DATETRANSACTION[0]);
                tampungMasterKunjungan += `
                <li>
                <a href="#" onClick="klikListFollowDanCollector('KIRIMAN','`+day + ' ' + monthNames[monthIndex] + ' ' + year+`')" class="item-link item-content detailRencanaKunjungan">
                <div class="item-inner">
                <div class="item-title">`+day + ' ' + monthNames[monthIndex] + ' ' + year+`</div>
                
                </div>
                </a>
                </li>`;
            }
            tampungMasterKunjungan +="</ul>";
            $$('.semuaTampilMasterKiriman').html(tampungMasterKunjungan);
        } else {
            $$('.semuaTampilMasterKiriman').html("Belum Pernah Melakukan Kiriman");
        }

        myApp.preloader.hide();
    });*/
    var maxItems;
    var TANGGAL = [];
    var total = 0;
    var itemsPerLoad = 20;
    var act = "TAMPIL_MASTER_KIRIMAN";
    myApp.request.post(ipTujuan,{case:act,USERID:USERID,KODEJABATAN:KODEJABATAN,KODECABANG:KODECABANG},function(data){
        var hasil_json = JSON.parse(data);
        var tampungMasterKunjungan = "";

        if(hasil_json.hasil == "ada"){
            maxItems = hasil_json.DATETRANSACTION.length;
            TANGGAL = hasil_json.DATETRANSACTION;
            if(TANGGAL.length < itemsPerLoad){
                total = TANGGAL.length;
            } else {
                total = itemsPerLoad;
            }
            tampungMasterKunjungan +="<ul>";
            for(var i = 0; i<total; i++){
                var today = new Date(hasil_json.DATETRANSACTION[i]);
                var day = today.getDate();
                var monthIndex = today.getMonth();
                var year = today.getFullYear();
                var tampung = hasil_json.DATETRANSACTION[0];
                tampungMasterKunjungan += `
                <li>
                <a href="#" onClick="klikListFollowDanCollector('KIRIMAN','`+day + ' ' + monthNames[monthIndex] + ' ' + year+`')" class="item-link item-content detailRencanaKunjungan">
                <div class="item-inner">
                <div class="item-title">${ConvertDateTimeToText(hasil_json.DATETRANSACTION[i],"dateday")}</div>
                
                </div>
                </a>
                </li>`;
            }
            tampungMasterKunjungan +="</ul>";
            $$('.semuaTampilMasterKiriman').html(tampungMasterKunjungan);
        } else {
            $$('.semuaTampilMasterKiriman').html("Belum Pernah Melakukan Kiriman");
        }

        var allowInfinite = true;
        var lastItemIndex = $$('.semuaTampilMasterKiriman li').length;


        if(total < itemsPerLoad){
            myApp.infiniteScroll.destroy('.infinite-scroll-content');
            $$('.infinite-scroll-preloader').remove();
        } 


        $$('.infinite-scroll-content').on('infinite', function () {
          if (!allowInfinite){
            return;
        }  
        allowInfinite = false;

        setTimeout(function () {
            allowInfinite = true;
            if(maxItems - $$('.semuaTampilMasterKiriman li').length > itemsPerLoad){
                itemsPerLoad = itemsPerLoad;
            } else {
                itemsPerLoad = maxItems - $$('.semuaTampilMasterKiriman li').length;
            }

            var html = '';
            for (var i = lastItemIndex; i < lastItemIndex + itemsPerLoad; i++) {
                var today = new Date(TANGGAL[i]);
                var day = today.getDate();
                var monthIndex = today.getMonth();
                var year = today.getFullYear();
                html += `<li>
                <a href="#" onClick="klikListFollowDanCollector('KIRIMAN','`+day + ' ' + monthNames[monthIndex] + ' ' + year+`')" class="item-link item-content detailRencanaKunjungan">
                <div class="item-inner">
                <div class="item-title">${ConvertDateTimeToText(TANGGAL[i],"dateday")}</div>
                </div>
                </a>
                </li>`;
            }

            $$('.semuaTampilMasterKiriman ul').append(html);
            lastItemIndex = $$('.semuaTampilMasterKiriman li').length;

            if (lastItemIndex >= maxItems) {
              myApp.infiniteScroll.destroy('.infinite-scroll-content');
              $$('.infinite-scroll-preloader').remove();
              return;
          }
      }, 1000);
    });

        myApp.preloader.hide();
    });

    
});

//master_rencana_kiriman_collector
$$(document).on('page:init', '.page[data-name="master_rencana_kiriman_collector"]', function (page) {
    var act = "TAMPIL_RENCANA_KIRIMAN_COLLECTOR";
    myApp.request.post(ipTujuan,{case:act,USERID:USERID,KODEJABATAN:KODEJABATAN,HALAMAN:halamanGlobal},function(data){
        var hasil_json = JSON.parse(data);
        var tampungMasterKunjungan = "";

        if(hasil_json.hasil == "ada"){
            tampungMasterKunjungan +="<ul>";
            for(var i = 0; i<hasil_json.DATETRANSACTION.length; i++){
                var today = new Date(hasil_json.DATETRANSACTION[i]);
                var day = today.getDate();
                var monthIndex = today.getMonth();
                var year = today.getFullYear();
                var tampung = hasil_json.DATETRANSACTION[0];
                console.log(hasil_json.DATETRANSACTION[0]);
                tampungMasterKunjungan += `
                <li>
                <a href="#" onClick="klikListRencana('`+day + ' ' + monthNames[monthIndex] + ' ' + year+`')" class="item-link item-content detailRencanaKunjungan">
                <div class="item-inner">
                <div class="item-title">`+day + ' ' + monthNames[monthIndex] + ' ' + year+`</div>
                <div class="item-after">`+hasil_json.JUMLAHOUTLET[i]+` Outlet</div>
                </div>
                </a>
                </li>`;
            }
            tampungMasterKunjungan +="</ul>";
            $$('.semuaRencanaKiriman').html(tampungMasterKunjungan);
        } else {
            $$('.semuaRencanaKiriman').html("Belum Ada Rencana");
        }

        myApp.preloader.hide();
    });

    $$('.fabBuatRencana').on('click',function(){
        mainView.router.navigate("/input_rencana_kiriman_collector/");
    });
});

//input_rencana_kiriman_collector
$$(document).on('page:init', '.page[data-name="input_rencana_kiriman_collector"]', function (page) {
    var searchbarToko = [];
    $$('.userIdInputRencanaKirimanCollector').val(USERID);
    PopupKaryawan('DRIVER','listPopUpNamaKaryawan');
    /*$$('.backInputRencanaKirimanCollector').on('click',function(){
        if(halamanGlobal == "RENCANA_KIRIMAN" || halamanGlobal == "RENCANA_COLLECTOR"){
            mainView.router.navigate("/master_rencana_kiriman_collector/");
        } else {
            mainView.router.navigate("/home/");
        }
    });*/

    if(halamanGlobal == "RENCANA_KIRIMAN"){
        $$('.spanMilikCollector').remove();
    }

    var act = "TAMPIL_PERMINTAAN_KHUSUS";
    myApp.request.post(ipTujuan,{case:act},function(data){
        myApp.preloader.show();
        var hasil_json = JSON.parse(data);
        var tampungPermintaanKhusus = "";
        console.log(halamanGlobal);
        for(var i = 0; i<hasil_json.NAMA.length; i++){
            if(halamanGlobal == "RENCANA_KIRIMAN" && hasil_json.NAMA[i] == "KIRIMAN"){
                tampungPermintaanKhusus +=`<option value="`+hasil_json.KODEPERMINTAANKHUSUS[i]+`" selected>`+hasil_json.NAMA[i]+`</option>`;
            } else if(halamanGlobal == "RENCANA_COLLECTOR" && hasil_json.NAMA[i] == "TAGIHAN RUTIN"){
                tampungPermintaanKhusus +=`<option value="`+hasil_json.KODEPERMINTAANKHUSUS[i]+`" selected>`+hasil_json.NAMA[i]+`</option>`;
            } else {
                tampungPermintaanKhusus +=`<option value="`+hasil_json.KODEPERMINTAANKHUSUS[i]+`">`+hasil_json.NAMA[i]+`</option>`;
            }
            //tampungPermintaanKhusus +=`<option value="`+hasil_json.KODEPERMINTAANKHUSUS[i]+`">`+hasil_json.NAMA[i]+`</option>`;
        }
        $$('.inputPermintaanKhususRencanaKirimanCollector').html(tampungPermintaanKhusus);
        myApp.preloader.hide();
    });

    var calendarModal = myApp.calendar.create({
        inputEl: '#demo-calendar-rencana-kunjungan',
        openIn: 'customModal',
        header: true,
        footer: true,
        dateFormat: 'dd MM yyyy',
    });

    var searchbar = myApp.searchbar.create({
        el: '.searchToko',
        searchContainer: '.listPopupNamaTokoRencanaKunjungan',
        searchIn: '.namaToko',
        on: {
            search(sb, query, previousQuery) {
            }
        }
    });

    $$('.btnCancel').on('click',function(){
        myApp.popup.close('.popup-karyawan');
    });

    var searchbar2 = myApp.searchbar.create({
        el: '.searchKaryawan',
        searchContainer: '.listPopUpNamaKaryawan',
        searchIn: '.namaKaryawan',
        on: {
            search(sb, query, previousQuery) {
                console.log(query, previousQuery);
            }
        }
    });

    $$('.popup-open-karyawanPelanggan').on('click',function(){
        myApp.popup.open('.popup-karyawan'); 
    });

    var counter = 1;
    $$('.btnTambahToko').on('click',function(){
        element = `<div class="card">
        <div class="card-header" style="background-color:#2196F3;color:white">

        <span style="font-size:0.9em"><b>Toko</b></span>
        <a href="#" class="hapusToko"><span style="font-size:0.9em;text-align: right"><i class="fas fa-window-close " style="color:white"></i></span></a>

        </div>
        <div class="card-content card-content-padding">
        <div class="list form-store-data" >
        <div class="item-content item-input">
        <div class="item-inner">
        <div class="item-input-wrap">
        <div class="item-title item-label" style="color:#2196F3;font-weight: bold">Nama PT/Toko</div>
        <a href="#" onClick="popupOpenToko('${counter}')" class="popup-open-toko-${counter}" id ="${counter}">
        <input type="text" class="toko${counter}" placeholder="" readonly="readonly"/>
        <input type="hidden" name ="kodePelanggan" class="valueToko${counter}"/>
        </a>
        </div>
        </div>
        </div>

        <div class="item-content item-input">
        <div class="item-inner">
        <div class="item-title item-label" style="color:#2196F3;font-weight: bold">Keterangan</div>
        <div class="item-input-wrap">
        <textarea class="inputKeteranganRencanaKirimanCollector"></textarea> 
        </div>
        </div>
        </div>

        </div>



        <span class="spanFotoKunjungan">
        <div class="card">
        <div class="card-header row" style="background-color:#2196F3;color:white">

        <a href="#" onClick="ambilFotoKunjunganz('${counter}','1')" class="ambilFotoKunjungan-${counter}-1 col padding5">
        <i class="fa fa-camera  middleWhite"> </i>
        </a>

        <a href="#" onClick="ambilFotoGalleryz('${counter}','1')" class="ambilFotoGallery-${counter}-1 col padding5">
        <i class="far fa-image  middleWhite"> </i>
        </a>
        </div>
        <div class="card-content card-content-padding">

        
        
        <img id="foto-kunjungan-${counter}-1" name="fotoKunjunganUpload[${counter}][]" class="1" height="150" width="100%">


        </div>
        </div>
        </span>

        </div>
        </div>`;
        $$('.generateTambahToko').append(element);
        $$('.popup-open-toko').on('click',function(){ 
            tampungCounter = $(this).attr('id');
            myApp.popup.open('.popup-toko');
        });

        /*<img id="foto-kunjungan-${counter}-1" name="fotoKunjunganUpload[${counter}][]" class="1" height="150" width="100%">*/


        /*<img `;
        if(counter % 2 = 0){
            src = "www.com";
        }
        element+=`id="foto-kunjungan-${counter}-1" name="fotoKunjunganUpload[${counter}][]" class="1" height="150" width="100%">*/


        element = `<div class="popup popup-toko-${counter}" style="background-color:white" data-ajax="false">
        <form class="searchbar searchToko${counter}">
        <div class="searchbar-inner">
        <div class="searchbar-input-wrap">
        <input type="search" placeholder="Search">
        <i class="searchbar-icon"></i>
        <span class="input-clear-button"></span>
        </div>
        <span class="searchbar-disable-button" >Cancel</span>
        </div>

        </form>
        <div class="judul" style="font-size:1.3em;text-align: center"></div>

        <div class="searchbar-backdrop"></div>
        <div class="block">
        <div class="row">
        <button class="col button button-fill btnCancel" onClick="popupCancel('${counter}')">Cancel</button>
        </div>
        </div>
        <div class="list inset searchbar-found">
        <ul class="listPopupNamaTokoRencanaKunjungan${counter}">
        </ul>
        </div>
        <div class="block searchbar-not-found">
        <div class="block-inner">Nothing found</div>
        </div>
        </div>`;

        
        $$('.spanTambahPopupToko').append(element);
        
        searchbar[counter] = myApp.searchbar.create({
            el: '.searchToko'+counter,
            searchContainer: '.listPopupNamaTokoRencanaKunjungan'+counter,
            searchIn: '.namaToko'+counter,
            on: {
                search(sb, query, previousQuery) {

                }
            }
        });

        var act = "POPUP_TAMPIL_NAMA_TOKO";
        myApp.request.post(ipTujuan,{case:act,USERID:USERID,KODECABANG:KODECABANG},function(data){
            var hasil_json = JSON.parse(data);
            tampungPopupNamaToko = "";
            if(hasil_json.hasil=="ada"){
                for(var i = 0; i<hasil_json.KODEPELANGGAN.length;i++){
                    tampungPopupNamaToko +=`
                    <li>
                    <a href="#" class="item-link item-content" onClick="pilihTokoPopup('`+hasil_json.KODEPELANGGAN[i]+`','`+hasil_json.NAMA[i]+`','${counter}')">
                    <div class="item-inner">
                    <div class="item-text namaToko${counter}" style="color:black">`+hasil_json.KODEPELANGGAN[i]+` - `+hasil_json.NAMA[i]+`</div>
                    </div>
                    </a>
                    </li>`;
                }
            } else {
                $$('.listPopupNamaTokoRencanaKunjungan'+counter).html("");
            }
            $$('.listPopupNamaTokoRencanaKunjungan'+counter).html(tampungPopupNamaToko);
            counter++;
        });

        $$('.hapusToko').on('click',function(){
            $$(this).closest('.card').remove()
        });
    });

$$('.namaDriverInputRencanaKirimanCollector').val(USERID);
$$('.kodeDriverInputRencanaKirimanCollector').val(USERID);

$$('.btnInputRencanaKirimanCollector').on('click',function(){
    myApp.preloader.show();
    var act = "INPUT_RENCANA_KIRIMAN_COLLECTOR";
    var tanggal = $$('#demo-calendar-rencana-kunjungan').val();
    var kode = [];
    var keterangan = $$('.inputKeteranganKunjungan').val();
    var permintaan = $$('.inputPermintaanKhususRencanaKirimanCollector').val();
    var kodesalesman = $$('.kodeDriverInputRencanaKirimanCollector').val();

    var fotoKunjungan= {};
    var namaFotoKunjungan = {};

    var keteranganRencanaKirimanCollector = [];


    i=1;
    $$('input[name^="kodePelanggan"]').each(function() {
        fotoKunjungan[$$(this).val()] = new Array();
        namaFotoKunjungan[$$(this).val()] = new Array();
        kode.push($$(this).val());
        kodePelanggan = $$(this).val();

        $$('img[name^="fotoKunjunganUpload['+i+']"]').each(function() {
            //namaFotoKunjungan[kodePelanggan].push(this.className);
            if($$(this).attr("src") !=null){
                fotoKunjungan[kodePelanggan].push($$(this).attr("src"));
                namaFotoKunjungan[kodePelanggan].push(this.className);
            }
        });
        i++;
    });

    $$('textarea[class^="inputKeteranganRencanaKirimanCollector"]').each(function() {
        keteranganRencanaKirimanCollector.push($$(this).val());
    });

    var uniqueNames = [];
    var unique;

    $.each(kode,function(i,el){
        if($.inArray(el, uniqueNames) === -1){
            uniqueNames.push(el)
            unique = "tidaksama"
        } else {
            unique = "sama";
        }
    });

    if(!tanggal){
        alertKosong("Tanggal");
    } else if(kode.length==0 || $.inArray("", kode) == 0) {
        alertKosong("PT / Toko");
    } else if(unique == "sama"){
        myApp.dialog.alert("PT / Toko tidak boleh sama");
        myApp.preloader.hide();
    } else {
        myApp.request.post(ipTujuan,{case:act,HALAMAN:halamanGlobal,DATETRANSACTION:tanggal,KODEPELANGGAN:kode,KETERANGAN:keterangan,
            PERMINTAANKHUSUS:permintaan,KODESALESMAN:kodesalesman,namaFotoKunjungan:namaFotoKunjungan,USERID:USERID,KETERANGAN:keteranganRencanaKirimanCollector},function(data){
                var hasil_json = JSON.parse(data);
                if(hasil_json.hasil == "ada"){
                    myApp.dialog.alert("Berhasil Menginput");
                    console.log(fotoKunjungan[kodePelanggan]);
                    if(hasil_json.adafoto == "ada"){
                        hasil_json.KODEPELANGGAN.forEach(function(e){
                            if(fotoKunjungan[e].length !=0){
                                console.log("asd");
                                hasil_json[e].forEach(function(x,idx){
                                    var toko = new FileUploadOptions();
                                    toko.fileKey = "photo";
                                    toko.fileName = fotoKunjungan[e][idx].substr(fotoKunjungan[e][idx].lastIndexOf('/') + 1);
                                    toko.mimeType = "image/jpeg";
                                    toko.chunkedMode = false;
                                    toko.headers = {
                                        Connection: "close"
                                    };
                                    toko.params = {
                                        namaFile:x
                                    }
                                    var ft = new FileTransfer();
                                    ft.upload(fotoKunjungan[e][idx], 
                                        encodeURI(ipUploadRencanaKunjungan),
                                        win,
                                        fail,
                                        toko);

                                    var win = function(r) {
                                        console.log("Should not be called.");
                                    }

                                    var fail = function(error) {
                                        myApp.dialog.alert("eror :" +error.code);
                                        alert("An error has occurred: Code = " + error.code);
                                        console.log("upload error source " + error.source);
                                        console.log("upload error target " + error.target);
                                    }


                                });
                            }
                        });
                    }
                    mainView.router.navigate("/home/");
                    myApp.preloader.hide();


                } else if(hasil_json.hasil == "sudahpernah"){
                    myApp.preloader.hide();
                    myApp.dialog.alert(hasil_json.alert);
                } else {
                    myApp.dialog.alert("Silahkan Hubungi Admin");
                    mainView.router.navigate("/home/");
                    myApp.preloader.hide();
                }


            });
    }
});


});


//master_inbox
$$(document).on('page:init', '.page[data-name="master_inbox"]', function (page) {

    var items = [];
    var params = {
        case:"TAMPIL_MASTER_INBOX",
        KODECABANG:KODECABANG,
        USERID:USERID,
        KODEJABATAN:KODEJABATAN
    };
    var maxItems;
    var TANGGAL = [];
    var total = 0;
    var itemsPerLoad = 20;

    var act = "TAMPIL_MASTER_INBOX";
    myApp.request.post(ipTujuan,params,function(data){
        var response = JSON.parse(data);
        var tampilMasterInbox = "Belum Pernah Melakukan Kunjungan";

        if(response.hasil == "ada"){
            maxItems = response.inbox.length;
            TANGGAL = response.inbox;
            JUMLAHKUNJUNGAN = response.JUMLAHKUNJUNGAN;
            JUMLAHRENCANAKUNJUNGAN = response.JUMLAHRENCANAKUNJUNGAN;
            if(TANGGAL.length < itemsPerLoad){
                total = TANGGAL.length;
            } else {
                total = itemsPerLoad;
            }

            tampilMasterInbox ="<ul>";
            response.inbox.forEach(function(obj,x){
                if(x < total){
                    tampilMasterInbox += `
                    <li onClick="OpenInbox('${obj.id}',this)" class="`;
                    if(obj.status == "sudah_dibaca"){
                        tampilMasterInbox += `inboxBackground`;
                    }
                    tampilMasterInbox+=`
                    "><a href="#" class="item-link item-content">`;
                    if(obj.status == "terkirim"){
                        tampilMasterInbox += `<div class="item-media"><i class="far fa-envelope"></i></div>`;
                    } else {
                        tampilMasterInbox += `<div class="item-media"><i class="far fa-envelope-open"></i></div>`;
                    }

                    tampilMasterInbox+=`<div class="item-inner">
                    <div class="item-title-row">
                    <div class="item-title"><b>`;
                    if(!obj.NAMA){
                        tampilMasterInbox += "PESAN OTOMATIS";
                    } else {
                        tampilMasterInbox += obj.NAMA;
                    }
                    tampilMasterInbox+=`</b></div>
                    <div class="item-after">${ConvertDateTimeToText(obj.created_at,'date')}</div>
                    </div>
                    <div class="item-subtitle">${obj.title}</div>
                    <div class="item-text">${obj.isi}</div>
                    </div>
                    </a>
                    </li>`;
                }
            })

            
            tampilMasterInbox +="</ul>";
        } else if(response.hasil == "tidakada"){
            $$('.semuaTampilMasterInbox').html("Tidak Ada Inbox");
            myApp.preloader.hide();
        } else {
            myApp.preloader.hide();
            $$('.semuaTampilMasterInbox').html(response.hasil);
        }

        $$('.semuaTampilMasterInbox').html(tampilMasterInbox);
        var allowInfinite = true;
        var lastItemIndex = $$('.semuaTampilMasterInbox li').length;


        if(total < itemsPerLoad){
            myApp.infiniteScroll.destroy('.infinite-scroll-content');
            $$('.infinite-scroll-preloader').remove();
        } 


        $$('.infinite-scroll-content').on('infinite', function () {
          if (!allowInfinite){
            return;
        }  
        allowInfinite = false;

        setTimeout(function () {
            allowInfinite = true;
            if(maxItems - $$('.semuaTampilMasterInbox li').length > itemsPerLoad){
                itemsPerLoad = itemsPerLoad;
            } else {
                itemsPerLoad = maxItems - $$('.semuaTampilMasterInbox li').length;
            }

            var html = '';
            response.inbox.forEach(function(obj,x){
                if(x >= lastItemIndex && x < lastItemIndex + itemsPerLoad){
                    html += `
                    <li onClick="OpenInbox('${obj.id}',this)" class="`;
                    if(obj.status == "sudah_dibaca"){
                        html += `inboxBackground`;
                    }
                    html+=`"><a href="#" class="item-link item-content">`;
                    
                    if(obj.status == "terkirim"){
                        html += `<div class="item-media"><i class="far fa-envelope"></i></div>`;
                    } else {
                        html += `<div class="item-media"><i class="far fa-envelope-open"></i></div>`;
                    }

                    html +=`<div class="item-inner">
                    <div class="item-title-row">
                    <div class="item-title"><b>${obj.NAMA}</b></div>
                    <div class="item-after">${ConvertDateTimeToText(obj.created_at,'date')}</div>
                    </div>
                    <div class="item-subtitle">${obj.title}</div>
                    <div class="item-text">${obj.isi}</div>
                    </div>
                    </a>
                    </li>`;
                }

            })

            $$('.semuaTampilMasterInbox ul').append(html);
            lastItemIndex = $$('.semuaTampilMasterInbox li').length;

            if (lastItemIndex >= maxItems) {
              myApp.infiniteScroll.destroy('.infinite-scroll-content');
              $$('.infinite-scroll-preloader').remove();
              return;
          }
      }, 1000);
    });
        myApp.preloader.hide();

    });
});

//edit_inbox
$$(document).on('page:init', '.page[data-name="edit_inbox"]', function (page) {
    var params = {
        case:"TAMPIL_MASTER_INBOX",
        KODECABANG:KODECABANG,
        USERID:USERID,
        KODEJABATAN:KODEJABATAN
    };

    var act = "TAMPIL_MASTER_INBOX";
    myApp.request.post(ipTujuan,params,function(data){
        var response = JSON.parse(data);
        var tampilMasterInbox = "Tidak Ada Inbox";

        if(response.hasil == "ada"){

            tampilMasterInbox ="<ul>";
            response.inbox.forEach(function(obj,x){
                tampilMasterInbox += `
                <li class="`;
                if(obj.status == "sudah_dibaca"){
                    tampilMasterInbox += `inboxBackground`;
                }
                tampilMasterInbox+=`
                "><label class="item-checkbox item-content">
                <input type="checkbox" name="CheckHapusInbox[]" value="${obj.id}"/>
                <i class="icon icon-checkbox"></i>`;
                if(obj.status == "terkirim"){
                    tampilMasterInbox += `<div class="item-media"><i class="far fa-envelope"></i></div>`;
                } else {
                    tampilMasterInbox += `<div class="item-media"><i class="far fa-envelope-open"></i></div>`;
                }

                tampilMasterInbox+=`<div class="item-inner">
                <div class="item-title-row">
                <div class="item-title"><b>`;
                if(!obj.NAMA){
                    tampilMasterInbox += "PESAN OTOMATIS";
                } else {
                    tampilMasterInbox += obj.NAMA;
                }
                tampilMasterInbox+=`</b></div>
                <div class="item-after">${ConvertDateTimeToText(obj.created_at,'date')}</div>
                </div>
                <div class="item-subtitle">${obj.title}</div>
                <div class="item-text">${obj.isi}</div>
                </div>
                </label>
                </li>`;
                
            })

            
            tampilMasterInbox +="</ul>";
        } else if(response.hasil == "tidakada"){
            $$('.semuaTampilEditInbox').html("Tidak Ada Inbox");
            myApp.preloader.hide();
        } else {
            myApp.preloader.hide();
            $$('.semuaTampilEditInbox').html(response.hasil);
        }

        $$('.semuaTampilEditInbox').html(tampilMasterInbox);
        

        myApp.preloader.hide();

    });
});


//detail_inbox
$$(document).on('page:init', '.page[data-name="detail_inbox"]', function (page) {
    var params = {
        case:"DETAIL_INBOX",
        id:detailIdInbox,
        USERID:USERID,
        KODECABANG:KODECABANG,
        KODEJABATAN:KODEJABATAN
    };

    myApp.request.post(ipTujuan,params,
        function(data){
            var response = JSON.parse(data);
            if(response.hasil == "ada"){
                myApp.preloader.hide();
                var element = `
                <div class="cardContentDetail">Pengirim : `;
                if(!response.inbox[0].NAMA){
                    element += `PESAN OTOMATIS`;
                } else {
                    element += response.inbox[0].NAMA;
                }
                element +=`</div>
                <div>Waktu : ${ConvertDateTimeToText(response.inbox[0].created_at,'datetimedaywithoutbr')}</div>
                <div class="card card-outline">
                <div class="card-header"><b>Judul : ${response.inbox[0].title}</b></div>
                <div class="card-content card-content-padding" style="font-size:0.9em">${response.inbox[0].isi}</div>
                </div>`;
                $$("#detailInboxPage").html(element);
            } else if(response.hasil == "tidakada") {
                myApp.preloader.hide();
                $$("#detailInboxPage").html("Message Tidak Ada");
            } else {
                myApp.preloader.hide();
                myApp.dialog.alert(response.hasil);
            }
        },
        function(xhr,status){
            PreloaderHide(status);
        })
})


//input_inbox
$$(document).on('page:init', '.page[data-name="input_inbox"]', function (page) {
    myApp.preloader.hide();
    PilihTipeTujuanMessage();
    $$("input[name='inbox-radio']").change(function(){
        PilihTipeTujuanMessage();
    })
})



//master_pelanggan
$$(document).on('page:init', '.page[data-name="master_pelanggan"]', function (page) {
    console.log(userHakAksesArrayGlobal["masterPelanggan"]["TAMBAH"]);
    if(userHakAksesArrayGlobal["masterPelanggan"]["TAMBAH"] == "F"){
        $$('.fabInputMasterPelanggan').remove();
    }

    if(userHakAksesArrayGlobal["masterPelanggan"]["CARI"] == "F"){
        $$('.searchMasterPelanggan').remove();
    }

    /*var act = "TAMPIL_MASTER_PELANGGAN";
    var tampungPelanggan = "";

    myApp.request.post(ipTujuan,{case:act,KODECABANG:KODECABANG,USERID:USERID,KODEJABATAN:KODEJABATAN},function(data){
        var hasil_json = JSON.parse(data);
        
        if(hasil_json.hasil == "ada"){
            tampungPelanggan += `<ul>`;
            for(var i = 0; i<hasil_json.KODEPELANGGAN.length; i++){
                tampungPelanggan+=`
                <li>
                <a href="#" class="item-link item-content" onClick="detailPelanggan('MASTER_PELANGGAN','`+hasil_json.KODEPELANGGAN[i]+`','`+hasil_json.NAMA[i]+`',
                '`+hasil_json.ALAMAT[i]+`','`+hasil_json.KOTA[i]+`','`+hasil_json.TELPON[i]+`','`+hasil_json.FAX[i]+`','`+hasil_json.KREDITLIMIT[i]+`',
                '`+hasil_json.SYARATPIUTANG[i]+`','`+hasil_json.SYARATPIUTANGMAX[i]+`','`+hasil_json.USERID[i]+`','`+hasil_json.TERM[i]+`',
                '`+hasil_json.KATEGORIPELANGGAN[i]+`','`+hasil_json.ALAMATKIRIM[i]+`','TIDAK_MASTER')">
                <div class="item-inner">
                <div class="item-title-row">

                <div class="item-text namaTokoSearch" style="color:black"><b>`+hasil_json.NAMA[i]+`</b>  <span class="badge color-green">  `+hasil_json.USERID[i]+`</span></div>

                </div>
                <div class="item-text" style="color:black">`+hasil_json.ALAMAT[i]+`</div>        
                </div>
                </a>
                </li>`;
            }
            tampungPelanggan += `</ul>`;
        } else {
            $$('.semuaMasterPelanggan').html("Belum Memiliki Daftar Pelanggan");
        }
        $$('.semuaMasterPelanggan').html(tampungPelanggan);
        myApp.preloader.hide();
    });*/

    var searchbar = myApp.searchbar.create({
        el: '.searchMasterPelanggan',
        searchContainer: '.list',
        searchIn: '.namaTokoSearch',
        on: {
            search(sb, query, previousQuery) {
                console.log(query, previousQuery);
            }
        }
    });

    $$('.fabInputMasterPelanggan').on('click',function(){
        mainView.router.navigate("/input_pelanggan/");
    });

    //try items virtual list
    var items = [];
    var act = "TAMPIL_MASTER_PELANGGAN";
    var semuaTampilMasterLaporanPelanggan = "";

    myApp.request.post(ipTujuan,{case:act,KODECABANG:KODECABANG,USERID:USERID,KODEJABATAN:KODEJABATAN},function(data){
        var hasil_json = JSON.parse(data);
        console.log('hasil user : ' + hasil_json.USER);
        console.log('hasil sql : ' + hasil_json.SQL);
        console.log('cabang : ' +hasil_json.CABANG);
        console.log('cabang asli : ' + KODECABANG);
        if(hasil_json.hasil == "ada"){

            for (var i = 0; i < hasil_json.KODEPELANGGAN.length; i++) {
              items.push({
                KODEPELANGGAN: hasil_json.KODEPELANGGAN[i],
                NAMA: hasil_json.NAMA[i],
                ALAMAT_CETAK:hasil_json.ALAMAT[i],
                ALAMAT:hasil_json.ALAMAT[i].replace(/(["'])/g, "\\$1"),
                KOTA:hasil_json.KOTA[i],
                TELPON:hasil_json.TELPON[i],
                FAX:hasil_json.FAX[i],
                KREDITLIMIT:hasil_json.KREDITLIMIT[i],
                SYARATPIUTANG:hasil_json.SYARATPIUTANG[i],
                SYARATPIUTANGMAX:hasil_json.SYARATPIUTANGMAX[i],
                USERID: hasil_json.USERID[i],
                TERM:hasil_json.TERM[i],
                KATEGORIPELANGGAN:hasil_json.KATEGORIPELANGGAN[i],
                ALAMATKIRIM:hasil_json.ALAMATKIRIM[i]
            });
          }
          
          var virtualList = myApp.virtualList.create({
              el: '.virtual-list',
              items: items,
              searchAll: function (query, items) {
                var found = [];
                for (var i = 0; i < items.length; i++) {
                  if ( items[i].USERID.toLowerCase().indexOf(query.toLowerCase()) >= 0 || items[i].NAMA.toLowerCase().indexOf(query.toLowerCase()) >= 0 || query.trim() === '' ) found.push(i);
              }
              return found; 
          },
          itemTemplate:
          `<li>
          <a href="#" class="item-link item-content" onClick="detailPelanggan('MASTER_PELANGGAN','{{KODEPELANGGAN}}','{{NAMA}}',
          '{{ALAMAT}}','{{KOTA}}','{{TELPON}}','{{FAX}}','{{KREDITLIMIT}}',
          '{{SYARATPIUTANG}}','{{SYARATPIUTANGMAX}}','{{USERID}}','{{TERM}}',
          '{{KATEGORIPELANGGAN}}','{{ALAMATKIRIM}}','TIDAK_MASTER')">
          <div class="item-inner">
          <div class="item-title-row">

          <div class="item-text namaTokoSearch" style="color:black"><b>{{NAMA}}</b>  </div>

          </div>
          <div class="item-text" style="color:black">{{ALAMAT_CETAK}}</div>       
          </div>
          </a>
          </li>`,
          height: myApp.theme === 'ios' ? 63 : 73,
      });
      
      } else {
        $$('.virtual-list').html("Belum Memiliki Daftar Pelanggan");
    }
    myApp.preloader.hide();
});

});

$$(document).on('page:init', '.page[data-name="master_kategori_pelanggan"]', function (page) {
    if(userHakAksesArrayGlobal["masterKategori"]['TAMBAH'] == "F"){
        $$('.fabInputKategori').remove();
    }

    if(userHakAksesArrayGlobal["masterKategori"]['CARI'] == "F"){
        $$('.searchMasterKategori').remove();
    }

    var act = "TAMPIL_MASTER_KATEGORI_PELANGGAN";
    myApp.request.post(ipTujuan,{case:act},function(data){
        var tampungKodeKategoriPelanggan = "";
        var hasil_json = JSON.parse(data);
        if(hasil_json.hasil == "ada"){
            tampungKodeKategoriPelanggan = `<ul>`;
            for(var i = 0; i<hasil_json.KODEKATEGORIPELANGGAN.length; i++){
                tampungKodeKategoriPelanggan +=`
                <li>
                <a href="#" class="item-link item-content"  onClick="detailKategoriPelanggan('`+hasil_json.KODEKATEGORIPELANGGAN[i]+`','`+hasil_json.NAMA[i]+`','`+hasil_json.USERID[i]+`','`+hasil_json.STATUS[i]+`')">
                <div class="item-inner">
                <div class="item-text namaKategoriSearch" style="color:black">
                ${hasil_json.NAMA[i]}
                </div>
                </div>
                </a>
                </li>
                `;
            }
            tampungKodeKategoriPelanggan += `</ul>`;
            $$('.semuaMasterKategoriPelanggan').html(tampungKodeKategoriPelanggan);
        } else {
            $$('.semuaMasterKategoriPelanggan').html("Belum Ada Kategori Pelanggan");
        }
        myApp.preloader.hide();
        
    });

    var searchbar = myApp.searchbar.create({
        el: '.searchMasterKategori',
        searchContainer: '.list',
        searchIn: '.namaKategoriSearch',
        on: {
            search(sb, query, previousQuery) {
                console.log(query, previousQuery);
            }
        }
    });

    $$('.fabInputKategori').on('click',function(){
        mainView.router.navigate("/input_kategori_pelanggan/");
    });
});

$$(document).on('page:init', '.page[data-name="input_kategori_pelanggan"]', function (page) {
    $$("input[type=text]").keyup(function(){
        $$(this).val( $$(this).val().toUpperCase() );
    });


    $$('.inputUserIdKategoriPelanggan').val(USERID);
    $$('.btnInputKategoriPelanggan').on('click',function(){
        var act = "INPUT_KATEGORI_PELANGGAN";
        var KODEKATEGORIPELANGGAN = $$('.inputKodeKategoriPelanggan').val();
        var NAMA = $$('.inputNamaKategoriPelanggan').val();

        if(KODEKATEGORIPELANGGAN == ""){
            myApp.dialog.alert("Kode Harus Diisi");
        } else if(NAMA == ""){
            myApp.dialog.alert("Nama Harus Diisi");
        }
        else {
            myApp.request.post(ipTujuan,{case:act,KODEKATEGORIPELANGGAN:KODEKATEGORIPELANGGAN,NAMA:NAMA,USERID:USERID},function(data){
                var hasil_json = JSON.parse(data);
                if(hasil_json.hasil == "ada"){
                    myApp.dialog.alert("Kode Kategori Sudah Terdaftar");
                } else {
                    //mainView.router.navigate("/master_kategori_pelanggan/");
                    mainView.router.back("/master_kategori_pelanggan/",{force:true});
                }
            });
        }
    });
    
    $$('.btnBatalInputKategoriPelanggan').on('click',function(){
        //mainView.router.navigate("/master_kategori_pelanggan/");
        mainView.router.back();
    });

});

//detail_kategori_pelanggan
$$(document).on('page:init', '.page[data-name="detail_kategori_pelanggan"]', function (page) {
    $$('.detailKodeKategoriPelanggan').html(tampungKodeKategoriPelanggan);
    $$('.detailNamaKategoriPelanggan').html(tampungNamaKategoriPelanggan);
    $$('.detailUserIdKategoriPelanggan').html(tampungUserIdKategoriPelanggan);
    $$('.detailStatusKategoriPelanggan').html(tampungStatusKategoriPelanggan);

    if(userHakAksesArrayGlobal["masterKategori"]["POSTING"] == "F"){
        $$('.btnPostingKategoriPelanggan').remove();
    }

    if(userHakAksesArrayGlobal["masterKategori"]["HAPUS"] == "F"){
        $$('.btnHapusKategoriPelanggan').remove();
    }

    if(userHakAksesArrayGlobal["masterKategori"]["UBAH"] == "F"){
        $$('.editKategoriPelanggan').remove();
    }

    var KODEKATEGORIPELANGGAN = tampungKodeKategoriPelanggan;


    if(tampungStatusKategoriPelanggan == "CLOSE"){
        $$('.hidePostingKategoriPelanggan').html("");
        $$('.right').html("");
    }

    $$('.btnPostingKategoriPelanggan').on('click',function(){
        var act = "POSTING_KATEGORI_PELANGGAN"
        myApp.dialog.confirm("Posting Kategori Pelanggan "+tampungNamaKategoriPelanggan +" ?",function(){

            myApp.request.post(ipTujuan,{case:act,KODEKATEGORIPELANGGAN:KODEKATEGORIPELANGGAN,USERID:USERID},function(data){
                //var hasil_json = JSON.parse(data);
                myApp.dialog.alert("Data Kategori Pelanggan "+tampungNamaKategoriPelanggan+" Sudah Diposting");
                //mainView.router.navigate("/master_kategori_pelanggan/");
                mainView.router.back("/master_kategori_pelanggan/",{force:true});
            });
        });
    });

    $$('.btnHapusKategoriPelanggan').on('click',function(){
        var act = "HAPUS_KATEGORI_PELANGGAN";
        myApp.dialog.confirm("Hapus Kategori Pelanggan "+tampungNamaKategoriPelanggan +" ?",function(){

            myApp.request.post(ipTujuan,{case:act,KODEKATEGORIPELANGGAN:KODEKATEGORIPELANGGAN},function(data){
                //var hasil_json = JSON.parse(data);
                myApp.dialog.alert("Data Kategori Pelanggan Sudah Dihapus");
                //mainView.router.navigate("/master_kategori_pelanggan/");
                mainView.router.back("/master_kategori_pelanggan/",{force:true});
            });
        });
    });

    $$('.editKategoriPelanggan').on('click',function(){
        mainView.router.navigate("/edit_kategori_pelanggan/");
    });
});

//edit_kategori_pelanggan
$$(document).on('page:init', '.page[data-name="edit_kategori_pelanggan"]', function (page) {
    $$("input").keyup(function(){
        $$(this).val( $$(this).val().toUpperCase() );
    });

    $$('.editKodeKategoriPelanggan').val(tampungKodeKategoriPelanggan);
    $$('.editNamaKategoriPelanggan').val(tampungNamaKategoriPelanggan);
    $$('.editUserIdKategoriPelanggan').val(USERID);

    $$('.btnSimpanKategoriPelanggan').on('click',function(){
        var NAMA = $$('.editNamaKategoriPelanggan').val();
        var KODEKATEGORIPELANGGAN = tampungKodeKategoriPelanggan;
        if(NAMA == ""){
            myApp.dialog.alert("Nama Harus Diisi");
        } else {
            var act = "EDIT_KATEGORI_PELANGGAN";
            myApp.request.post(ipTujuan,{case:act,USERID:USERID, NAMA:NAMA,KODEKATEGORIPELANGGAN:KODEKATEGORIPELANGGAN},function(data){
                var hasil_json = JSON.parse(data);
                if(hasil_json.hasil == "ada"){
                    myApp.dialog.alert("Nama Kategori Sudah Terdaftar");
                } else {
                    myApp.dialog.alert("Nama Berhasil Diubah");
                    //mainView.router.navigate("/master_kategori_pelanggan/");
                    mainView.router.back({force:true});
                }
            });
        }
    });

    $$('.btnBatalKategoriPelanggan').on('click',function(){
        mainView.router.back();
        //mainView.router.navigate("/detail_kategori_pelanggan/");
    });
});






$$(document).on('page:init', '.page[data-name="master_jenis_pelanggan"]', function (page) {

    var searchbar = myApp.searchbar.create({
        el: '.searchMasterJenisPelanggan',
        searchContainer: '.list',
        searchIn: '.namaJenisPelangganSearch',
        on: {
            search(sb, query, previousQuery) {
                console.log(query, previousQuery);
            }
        }
    });

    $$('.fabInputJenisPelanggan').on('click',function(){
        mainView.router.navigate("/input_jenis_pelanggan/");
    });
});

$$(document).on('page:init', '.page[data-name="master_jabatan"]', function (page) {
    if(userHakAksesArrayGlobal["masterJabatan"]["TAMBAH"] == "F"){
        $$('.fabInputMasterJabatan').remove();
    }

    var act = "TAMPIL_MASTER_JABATAN";
    //REQUEST SELECT JABATAN YANG SUDAH ADA
    myApp.request.post(ipTujuan,{case:act},function(data){
        var hasil_json = JSON.parse(data);
        var tampungJabatan = "";

        tampungJabatan = `<ul>`;
        for(var i = 0; i<hasil_json.KODEJABATAN.length; i++){
            tampungJabatan += `
            <li>
            <a href="#" class="item-link item-content searchNamaJabatan" onClick="detailJabatan('`+hasil_json.KODEJABATAN[i]+`','`+hasil_json.NAMA[i]+`','`+hasil_json.USERID[i]+`','`+hasil_json.STATUS[i]+`','`+hasil_json.KODECABANG[i]+`')">
            <div class="item-inner">
            <div class="item-title-row">
            <div class="item-text" style="color:black"><b>${hasil_json.NAMA[i]}</b></div>
            </div>
            </div>
            </a>
            </li>`;
        }
        tampungJabatan += `</ul>`;
        if(hasil_json.hasil == "ada"){
            $$('.semuaMasterJabatan').html(tampungJabatan);
        } else {
            $$('.semuaMasterJabatan').html("Belum Ada Jabatan");
        }
        myApp.preloader.hide();
    });  


    var searchbar = myApp.searchbar.create({
        el: '.searchMasterJabatan',
        searchContainer: '.list',
        searchIn: '.searchNamaJabatan',
        on: {
            search(sb, query, previousQuery) {
                console.log(query, previousQuery);
            }
        }
    });

    

    $$('.fabInputMasterJabatan').on('click',function(){
        mainView.router.navigate("/input_jabatan/");
    });
});

$$(document).on('page:init', '.page[data-name="detail_jabatan"]', function (page) {

    if(userHakAksesArrayGlobal["masterJabatan"]["POSTING"] == "F"){
        $$('.btnPostingJabatan').remove();
    }

    if(userHakAksesArrayGlobal["masterJabatan"]["HAPUS"] == "F"){
        $$('.btnHapusJabatan').remove();
    }

    if(userHakAksesArrayGlobal["masterJabatan"]["UBAH"] == "F"){
        $$('.editJabatan').remove();
    }

    $$('.editJabatan').on('click',function(){
        mainView.router.navigate('/edit_jabatan/');
    });

    $$('.kodeJabatan').html(KODEJABATAN);
    $$('.namaJabatan').html(NAMA);
    $$('.userIdJabatan').html(editJabataneditJabatanUserId);
    $$('.detailCabangJabatan').html(TAMPUNGKODECABANG);
    $$('.statusJabatan').html(STATUS);

    if(STATUS =="CLOSE"){
        $$('.right').html("");
        $$('.hidePostingJabatan').html("");
    }

    $$('.btnHapusJabatan').on('click',function(){
        var act = "HAPUS_JABATAN";
        myApp.dialog.confirm("Hapus Jabatan "+NAMA +" ?",function(){

            myApp.request.post(ipTujuan,{case:act,KODEJABATAN:KODEJABATAN},function(data){
                //var hasil_json = JSON.parse(data);
                myApp.dialog.alert("Data Jabatan "+NAMA+" Sukses Dihapus");
                /*mainView.router.navigate("/master_jabatan/");*/
                mainView.router.back("/master_jabatan/",{force:true});
            });
        });
    });

    $$('.btnPostingJabatan').on('click',function(){
        var act = "POSTING_JABATAN";
        myApp.dialog.confirm("Posting Jabatan "+NAMA +" ?",function(){

            myApp.request.post(ipTujuan,{case:act,KODEJABATAN:KODEJABATAN,USERID:USERID},function(data){
                //var hasil_json = JSON.parse(data);

                myApp.dialog.alert("Data Jabatan "+NAMA+" Sukses Diposting");
                /*mainView.router.navigate("/master_jabatan/");*/
                mainView.router.back("/master_jabatan/",{force:true});
            });
        });
    });
});


//edit_jabatan
$$(document).on('page:init', '.page[data-name="edit_jabatan"]', function (page) {
    $$("input[type=text]").keyup(function(){
        $$(this).val( $$(this).val().toUpperCase() );
    });

    $$('.kodeJabatan').val(KODEJABATAN);
    $$('.editNamaJabatan').val(NAMA);
    $$('.userIdJabatan').val(USERID);
    $$('.editCabangJabatan').val(KODECABANG);
    $$('.statusJabatan').val(STATUS);

    $$('.btnSimpanJabatan').on('click',function(){
        var NAMA = $$('.editNamaJabatan').val();
        var act = "EDIT_JABATAN";
        if(NAMA ==""){
            myApp.dialog.alert("Nama Tidak Boleh Kosong");
        } else {

            myApp.request.post(ipTujuan,{case:act,NAMA:NAMA,KODEJABATAN:KODEJABATAN},function(data){
                /*mainView.router.navigate("/master_jabatan/");*/
                mainView.router.back("/detail_jabatan/",{force:true});
                myApp.dialog.alert("Jabatan "+NAMA +" Sukses Disimpan");
            });

        }
    });

    $$('.btnBatalJabatan').on('click',function(){
        /*mainView.router.navigate("/detail_jabatan/");*/
        mainView.router.back();
    });
});


//input_jabatan
$$(document).on('page:init', '.page[data-name="input_jabatan"]', function (page) {
    $$("input[type=text]").keyup(function(){
        $$(this).val( $$(this).val().toUpperCase() );
    });

    $$('.userIdJabatan').val(USERID);
    $$('.cabangJabatan').val(KODECABANG);
    //$$('.statusJabatan').val(STATUS);

    $$('.btnInputJabatan').on('click',function(){
        var act = "INPUT_MASTER_JABATAN";
        var KODEJABATAN = $$('.kodeJabatan').val();
        var NAMA = $$('.namaJabatan').val();
        if(KODEJABATAN == ""){
            myApp.dialog.alert("Kode Jabatan Tidak Boleh Dikosongkan");
        }else if(NAMA == ""){
            myApp.dialog.alert("Nama Jabatan Tidak Boleh Dikosongkan");
        } else {
            myApp.request.post(ipTujuan,{case:act,KODEJABATAN:KODEJABATAN,NAMA:NAMA,KODECABANG:KODECABANG,USERID:USERID},function(data){
                var hasil_json = JSON.parse(data);
                if(hasil_json.hasil == "ada"){
                   myApp.dialog.alert("Kode Jabatan Sudah Terdaftar");
               } else {
                myApp.dialog.alert("Jabatan "+NAMA +" Sukses Disimpan");/*
                mainView.router.navigate("/master_jabatan/");*/
                mainView.router.back("/master_jabatan/",{force:true});
            }
        });   
        }
    });

    $$('.btnBatalJabatan').on('click',function(){
        /*mainView.router.navigate("/master_jabatan/");*/
        mainView.router.back();
    });
});

//input_merk_mobil
$$(document).on('page:init', '.page[data-name="input_merk_mobil"]', function (page) {
    $$("input[type=text]").keyup(function(){
        $$(this).val( $$(this).val().toUpperCase() );
    });

    $$('.btnInputMerkMobil').on('click',function(){
        var act = "INPUT_MERK_MOBIL";
        var KODEMOBIL = $$('.kodeMerkMobil').val();
        var NAMA = $$('.namaMerkMobil').val();
        if(!KODEMOBIL){
            alertKosong("Kode Mobil");
        } else if(!NAMA){
            alertKosong("Nama Mobil");
        } else {
            myApp.request.post(ipTujuan,{case:act,KODEMOBIL:KODEMOBIL,NAMA:NAMA},function(data){
                var hasil_json = JSON.parse(data);
                if(hasil_json.hasil == "berhasil"){
                    myApp.dialog.alert("Merk Mobil Berhasil Diinput");
                    mainView.router.navigate("/home/");
                } else if(hasil_json.hasil == "duplicate_primary_key"){
                    myApp.dialog.alert("Kode Mobil Sudah Terdaftar");
                } else {
                    myApp.dialog.alert("Terjadi Error, Silahkan Hubungi Admin beserta inputannya");
                }
            },function(xhr,status){
                PreloaderHide(status);
            });
        }
        
    });
});


$$(document).on('page:init', '.page[data-name="edit_ganti_screen"]', function (page) {
    $$("#NOMOR").val(response_edit_ganti_screen.menu.NOMOR);
    $$("#SCREEN").val(response_edit_ganti_screen.menu.SCREEN);
    $$("#SCREEN_LAMA").val(response_edit_ganti_screen.menu.SCREEN);
    $$("#MENU").val(response_edit_ganti_screen.menu.MENU);

    myApp.preloader.hide();
})

$$(document).on('page:init', '.page[data-name="master_ganti_screen"]', function (page) {
    var params = {
        case:"TAMPIL_MASTER_GANTI_SCREEN",
        USERID:USERID,
    }

    myApp.request.post(ipTujuan,params,
        function(data){
            var response = JSON.parse(data);
            if(response.menu.length > 0){
                var element = `
                <div class="list">
                <ul>`;

                response.menu.forEach(function(obj,x){
                    element += `<li onClick="EditGantiScreen('${obj.NOMOR}','${obj.SCREEN}')">
                    <a href="#" class="item-link item-content">
                    <div class="item-inner">
                    <div class="item-title">${obj.MENU}</div>
                    <div class="item-after">${obj.SCREEN}</div>
                    </div>
                    </a>
                    </li>`;
                });
                element += `
                </ul>
                </div>`;
            }
            $$(".list-view-menu").html(element);
        },
        function(xhr,status){

        })
});


$$(document).on('page:init', '.page[data-name="master_hak_akses"]', function (page) {
    if(userHakAksesArrayGlobal["masterHakAkses"]["TAMBAH"] == "F"){
        $$('.fabInputMasterHakAkses').remove();
    }

    $$('.fabInputMasterHakAkses').on('click',function(){
        mainView.router.navigate("/edit_hak_akses/");
        halaman_hak_akses = "INPUT_USER_HAK_AKSES";
    });

    var act = "TAMPIL_MASTER_HAK_AKSES";
    //REQUEST SELECT JABATAN YANG SUDAH ADA
    myApp.request.post(ipTujuan,{case:act,KODECABANG:KODECABANG},function(data){
        myApp.preloader.hide();
        var hasil_json = JSON.parse(data);

        if(hasil_json.hasil == "ada"){

            var tampungHakAkses = "";

            tampungHakAkses = `<ul>`;
            for(var i = 0; i<hasil_json.USERID.length; i++){
                tampungHakAkses += `
                <li>
                <a href="#" class="item-link item-content searchNamaJabatan" onClick="detailHakAkses('`+hasil_json.KODEJABATAN[i]+`','`+hasil_json.USERID[i]+`','`+hasil_json.KODECABANG[i]+`','EDIT_USER_HAK_AKSES')">
                <div class="item-inner">
                <div class="item-title-row">
                <div class="item-text" style="color:black"><b>${hasil_json.USERID[i]}</b></div>
                <div class="item-subtitle">${hasil_json.KODEJABATAN[i]}</div>
                </div>
                </div>
                </a>
                </li>`;
            }
            tampungHakAkses += `</ul>`;
            $$('.semuaMasterHakAkses').html(tampungHakAkses);
        } else {
            $$('.semuaMasterHakAkses').html("Belum Ada User Id");
        }
    }); 
});

$$(document).on('page:init', '.page[data-name="detail_hak_akses"]', function (page) {
    if(userHakAksesArrayGlobal["masterHakAkses"]["UBAH"] == "F"){
        $$('.editHakAkses').closest('.right').remove();
    }
    var act = "TAMPIL_HAK_AKSES_USERMENU";
    $$('.kodeJabatanHakAkses').html(editKodeJabatanHakAkses);
    $$('.userIdHakAkses').html(editUserIdHakAkses);
    $$('.cabangHakAkses').html(editCabangHakAkses);


    myApp.request.post(ipTujuan,{case:act,USERID:editUserIdHakAkses},function(data){
        var hasil_json = JSON.parse(data);
        var tampungHakAkses = "";

        if(hasil_json.hasil == "ada"){
            tampungHakAkses = `<ul>`;


            for(var i = 0; i<hasil_json.NOMOR.length; i++){
                tampungHakAkses +=`
                <li>
                <div class="item-inner item-content">
                <div class="item-title-row">
                <div class="item-text" style="color:black"><b>${hasil_json.SCREEN[i]}. `;

                if(hasil_json.SCREEN[i].length>1){
                    for(var counter = 0; counter<hasil_json.SCREEN[i].length; counter++){
                        tampungHakAkses+=`&nbsp `;
                    }
                    tampungHakAkses +=hasil_json.MENU[i];
                } else {
                    tampungHakAkses+=hasil_json.MENU[i];
                }

                tampungHakAkses+=`</b></div>
                </div>
                </div>
                </li>
                `;
            }
            tampungHakAkses +=`</ul>`;
            $$('.semuaHakAksesUserMenu').html(tampungHakAkses);
            myApp.preloader.hide();
        } else {
            myApp.preloader.hide();
            $$('.semuaHakAksesUserMenu').html("Tidak Mempunyai Hak Akses");
        }
    });

    $$('.editHakAkses').on('click',function(){
        mainView.router.navigate("/edit_hak_akses/");
    });
});



$$(document).on('page:init', '.page[data-name="edit_hak_akses"]', function (page) {
    $$("input[type=text]").keyup(function(){
        $$(this).val( $$(this).val().toUpperCase() );
    });

    $$("input[type=password]").keyup(function(){
        $$(this).val( $$(this).val().toUpperCase() );
    });
    
    if(halaman_hak_akses == "INPUT_USER_HAK_AKSES"){
        //$$('.dataJabatanHakAkses').html("");
        $$('.dataJabatanHakAkses').remove();
        editUserIdHakAkses = "";

        //popup kode jabatan
        $$('.popup-open-kodeJabatan').on('click',function(){
            myApp.preloader.show();
            var act = "TAMPIL_POPUP_JABATAN";
            var tampungKodeJabatanHakAkses = "";
            myApp.request.post(ipTujuan,{case:act,KODECABANG:KODECABANG},function(data){
                var hasil_json = JSON.parse(data);
                console.log(data);
                if(hasil_json.hasil == "ada"){
                    for(var i = 0; i<hasil_json.KODEJABATAN.length; i++){
                        tampungKodeJabatanHakAkses +=`<li>
                        <a href="#" class="item-link item-content cobaKlik" onClick="pilihJabatanHakAkses('`+hasil_json.KODEJABATAN[i]+`','`+hasil_json.NAMA[i]+`')">
                        <div class="item-inner">
                        <div class="item-text namaToko" style="color:black">`+hasil_json.NAMA[i]+`</div>
                        </div>
                        </a>
                        </li>`;
                    }
                    
                    $$('.listPopupKodeJabatan').html(tampungKodeJabatanHakAkses);
                } else {
                    myapp.dialog.alert("Maaf Tidak Mempunyai Jabatan, Silahkan Membuat Jabatan Terlebih Dahulu");
                }
                myApp.preloader.hide();
            });
            myApp.popup.open('.popup-jabatan');
        });

        //popup kode karyawan
        $$('.popup-open-kodeKaryawan').on('click',function(){
            myApp.preloader.show();
            var act = "TAMPIL_POPUP_KARYAWAN";
            var tampungKodeKaryawanHakAkses = "";
            myApp.request.post(ipTujuan,{case:act,KODECABANG:KODECABANG},function(data){
                var hasil_json = JSON.parse(data);
                if(hasil_json.hasil == "ada"){
                    for(var i = 0; i<hasil_json.KODEKARYAWAN.length; i++){
                        tampungKodeKaryawanHakAkses +=`<li>
                        <a href="#" class="item-link item-content cobaKlik" onClick="pilihKaryawanHakAkses('`+hasil_json.KODEKARYAWAN[i]+`','`+hasil_json.NAMA[i]+`')">
                        <div class="item-inner">
                        <div class="item-text namaToko" style="color:black">`+hasil_json.NAMA[i]+`</div>
                        </div>
                        </a>
                        </li>`;
                    }
                    
                    $$('.listPopupKodeKaryawan').html(tampungKodeKaryawanHakAkses);
                } else {
                    myApp.dialog.alert("Maaf Semua Karyawan Sudah Terdaftar, Silahkan Membuat Karyawan Terlebih Dahulu");
                }
                myApp.preloader.hide();
            });
            myApp.popup.open('.popup-kodeKaryawan');
        });

        $$('.btnCancel').on('click',function(){ 
            myApp.popup.close('.popup-jabatan');
        });

        $$('.btnCancelPopUpKodeKaryawan').on('click',function(){ 
            myApp.popup.close('.popup-kodeKaryawan');
        });
    } else {
        $$('.dataUserBaruHakAkses').html("");
    }

    $$('.btnCancel').on('click',function(){ 
        myApp.popup.close('.popup-usermenu');
    });

    $$('.hapusHakAksesUserMenu').on('click',function(){
        $$(this).closest('.card').remove()
    });

    
    $$('.btnSimpanEditHakAkses').on('click',function(){
        var VARIABEL_SIMPAN_PASSWORD = "T";
        console.log(editUserIdHakAkses)
        myApp.preloader.show();
        var act = "SIMPAN_EDIT_HAK_AKSES";
        if(halaman_hak_akses == "INPUT_USER_HAK_AKSES"){  
            editUserIdHakAkses = $$('.userIdHakAkses').val();
            var PASSWORD = $$('.passwordHakAkses').val();
            var VERIFIKASIPASSWORD = $$('.verifikasiPasswordHakAkses').val();
            if(PASSWORD != VERIFIKASIPASSWORD){
                VARIABEL_SIMPAN_PASSWORD = "F";
            }
            var KODEJABATANHAKAKSES = $$('.kodeJabatanHakAkses').val();
        }

        var VARIABEL_SIMPAN_HAK_AKSES ="T";
        var SCREEN_USERMENU = [];

        var TAMBAH_USERMENU = [];
        var UBAH_USERMENU = [];
        var HAPUS_USERMENU = [];
        var CETAK_USERMENU = [];
        var POSTING_USERMENU = [];
        var CARI_USERMENU = [];

        i =0;
        $$('input[name^="screenMenuUserMenu"]').each(function() {
            if($(this).val() != ""){
                SCREEN_USERMENU.push($(this).val());
            } else {
                VARIABEL_SIMPAN_HAK_AKSES = "F";
            }
        });

        $$('input[name^="usermenu_tambah"]').each(function() {
            if($$(this).prop("checked")){
                TAMBAH_USERMENU.push("T");
            } else {
                TAMBAH_USERMENU.push("F");
            }
        });

        $$('input[name^="usermenu_ubah"]').each(function() {
            if($$(this).prop("checked")){
                UBAH_USERMENU.push("T");
            } else {
                UBAH_USERMENU.push("F");
            }
        });

        $$('input[name^="usermenu_hapus"]').each(function() {
            if($$(this).prop("checked")){
                HAPUS_USERMENU.push("T");
            } else {
                HAPUS_USERMENU.push("F");
            }
        });

        $$('input[name^="usermenu_cetak"]').each(function() {
            if($$(this).prop("checked")){
                CETAK_USERMENU.push("T");
            } else {
                CETAK_USERMENU.push("F");
            }
        });

        $$('input[name^="usermenu_posting"]').each(function() {
            if($$(this).prop("checked")){
                POSTING_USERMENU.push("T");
            } else {
                POSTING_USERMENU.push("F");
            }
        });

        $$('input[name^="usermenu_cari"]').each(function() {
            if($$(this).prop("checked")){
                CARI_USERMENU.push("T");
            } else {
                CARI_USERMENU.push("F");
            }
        });
        
        if(VARIABEL_SIMPAN_HAK_AKSES == "T" && VARIABEL_SIMPAN_PASSWORD == "T"){
            myApp.request.post(ipTujuan,{case:act,SCREEN_USERMENU:SCREEN_USERMENU,TAMBAH_USERMENU:TAMBAH_USERMENU,UBAH_USERMENU:UBAH_USERMENU,
                HAPUS_USERMENU:HAPUS_USERMENU,CETAK_USERMENU:CETAK_USERMENU,POSTING_USERMENU:POSTING_USERMENU,CARI_USERMENU:CARI_USERMENU,USERID:editUserIdHakAkses,
                PASSWORD:PASSWORD,KODECABANG:KODECABANG,halaman_hak_akses:halaman_hak_akses,KODEJABATAN:KODEJABATANHAKAKSES},function(data){

                    myApp.dialog.alert("Berhasil Menyimpan Hak Akses");
                    if(halaman_hak_akses == "INPUT_USER_HAK_AKSES"){
                        //mainView.router.navigate("/master_hak_akses/");
                        mainView.router.back("/master_hak_akses/",{force:true});
                    } else {
                        //mainView.router.navigate("/detail_hak_akses/");
                        mainView.router.back("/master_hak_akses/",{force:true});
                    }
                });
        } else if(VARIABEL_SIMPAN_PASSWORD == "F"){
            myApp.preloader.hide();
            myApp.dialog.alert("Password yang anda masukkan tidak sama");
        }
        else {
            myApp.preloader.hide();
            myApp.dialog.alert("Isi atau Hapus Hak Akses Terlebih Dahulu");
        }
    });

    if(halaman_hak_akses == "EDIT_USER_HAK_AKSES"){
        //MENAMPILKAN SAAT EDIT SUDAH ADA BARU TAMPIL
        var act = "TAMPIL_EDIT_USERMENU";
        myApp.request.post(ipTujuan,{case:act,USERID:editUserIdHakAkses},function(data){
            var hasil_json = JSON.parse(data);
            var tampungUserMenu = ``;
            if(hasil_json.HASIL_USERMENU == "ada"){
                tampungCounterClassScreenMenu = hasil_json.SCREEN.length;

                for(var i = 0;i<hasil_json.SCREEN.length;i++){
                    tampungUserMenu +=`
                    <div class="card">
                    <div class ="card-header cardHeaderBiru">Hak Akses
                    <a href="#" class="hapusHakAksesUserMenu"><span style="font-size:0.9em;text-align: right"><i class="fas fa-window-close " style="color:white"></i></span></a>
                    </div>

                    <div class="card-content card-content-padding">
                    <div class="list media-list searchbar-found semuaHakAksesJabatan">
                    <ul>

                    <li>
                    <div class="item-content item-input">
                    <div class="item-inner">
                    <div class="item-title item-label" style="color:#2196F3"><b>Menu</b></div>
                    <div class="item-input-wrap">
                    <a href="#" class="popup-open-usermenu" id="`+i+`">
                    <input type="text" class="namaMenuUserMenu`+i+`" value="`+hasil_json.MENU[i]+`" placeholder="Tekan Untuk Menambah Menu" readonly="readonly"/>
                    <input type="hidden" class="screenMenuUserMenu`+i+`" name="screenMenuUserMenu[]" value="`+hasil_json.SCREEN[i]+`"/>
                    </a>
                    </div>
                    </div>
                    </div>
                    </li>

                    <li>
                    <label class="item-checkbox item-content">
                    <input type="checkbox" name="usermenu_tambah[]" `;
                    if(hasil_json.TAMBAH[i]=="T"){
                        tampungUserMenu+="checked";
                    }
                    tampungUserMenu+=`/>
                    <i class="icon icon-checkbox"></i>
                    <div class="item-inner">
                    <div class="item-title">Tambah</div>
                    </div>
                    </label>
                    </li>

                    <li>
                    <label class="item-checkbox item-content">
                    <input type="checkbox" name="usermenu_ubah[]" `;
                    if(hasil_json.UBAH[i] == "T"){
                        tampungUserMenu+="checked";
                    }
                    tampungUserMenu+=`/>
                    <i class="icon icon-checkbox"></i>
                    <div class="item-inner">
                    <div class="item-title">Ubah</div>
                    </div>
                    </label>
                    </li>

                    <li>
                    <label class="item-checkbox item-content">
                    <input type="checkbox" name="usermenu_hapus[]" `;
                    if(hasil_json.HAPUS[i] == "T"){
                        tampungUserMenu+="checked";
                    }
                    tampungUserMenu+=`/>
                    <i class="icon icon-checkbox"></i>
                    <div class="item-inner">
                    <div class="item-title">Hapus</div>
                    </div>
                    </label>
                    </li>

                    <li>
                    <label class="item-checkbox item-content">
                    <input type="checkbox" name="usermenu_cetak[]"`;
                    if(hasil_json.CETAK[i] == "T"){
                        tampungUserMenu+="checked";
                    }
                    tampungUserMenu+=`/>
                    <i class="icon icon-checkbox"></i>
                    <div class="item-inner">
                    <div class="item-title">Cetak</div>
                    </div>
                    </label>
                    </li>

                    <li>
                    <label class="item-checkbox item-content">
                    <input type="checkbox" name="usermenu_posting[]"  `;
                    if(hasil_json.POSTING[i] == "T"){
                        tampungUserMenu+="checked";
                    }
                    tampungUserMenu+=`/>
                    <i class="icon icon-checkbox"></i>
                    <div class="item-inner">
                    <div class="item-title">Posting</div>
                    </div>
                    </label>
                    </li>

                    <li>
                    <label class="item-checkbox item-content">
                    <input type="checkbox" name="usermenu_cari[]"  `;
                    if(hasil_json.CARI[i] == "T"){
                        tampungUserMenu+="checked";
                    }
                    tampungUserMenu+=`/>
                    <i class="icon icon-checkbox"></i>
                    <div class="item-inner">
                    <div class="item-title">Cari</div>
                    </div>
                    </label>
                    </li>
                    </ul>
                    </div>
                    </div>
                    </div>`;
                }
                $$('.generateTambahHakAkses').html(tampungUserMenu);

                $$('.hapusHakAksesUserMenu').on('click',function(){
                    $$(this).closest('.card').remove()
                });

                $$('.popup-open-usermenu').on('click',function(){
                    var tampungCounterIdScreenMenu = ($(this).attr('id'));
                    tampungScreenMenu = "";
                    myApp.preloader.show();
                    var act = "TAMPIL_POPUP_MENU";
                    myApp.request.post(ipTujuan,{case:act,tampungCounterScreenMenu:tampungCounterScreenMenu},function(data){
                        var hasil_json = JSON.parse(data);
                        if(hasil_json.hasil == "ada"){
                            for(var i = 0; i<hasil_json.SCREEN.length; i++){
                                tampungScreenMenu +=`<li>
                                <a href="#" class="item-link" onClick="PilihMenuUserMenu('`+hasil_json.SCREEN[i]+`','`+hasil_json.MENU[i]+`','`+tampungCounterClassScreenMenu+`','`+tampungCounterIdScreenMenu+`')">
                                <div class="item-inner">
                                <div class="item-text namaToko" style="color:black">`+hasil_json.MENU[i]+`</div>
                                </div>
                                <input type="hidden" class="valueScreen" value="`+hasil_json.SCREEN[i]+`">
                                </a>
                                </li>`;
                            }
                        }


                        $$('.listPopupNamaMenuUserMenu').html(tampungScreenMenu);
                        myApp.preloader.hide();
                    });
                    myApp.popup.open('.popup-usermenu');
                });
            }
        });
}


    var tampungCounterClassScreenMenu = 1; //counter untuk classnya biar beda-beda
    var tampungCounterScreenMenu = 0; //untuk counter popupnya lebih dalam >10
    var tampungScreenMenu = "";
    $$('.popup-open-usermenu').on('click',function(){

        var tampungCounterIdScreenMenu = ($(this).attr('id'));
        tampungScreenMenu = "";
        myApp.preloader.show();
        var act = "TAMPIL_POPUP_MENU";
        myApp.request.post(ipTujuan,{case:act,tampungCounterScreenMenu:tampungCounterScreenMenu},function(data){
            var hasil_json = JSON.parse(data);
            console.log(data);
            if(hasil_json.hasil == "ada"){
                for(var i = 0; i<hasil_json.SCREEN.length; i++){
                    console.log(i);
                    tampungScreenMenu +=`<li>
                    <a href="#" class="item-link" onClick="PilihMenuUserMenu('`+hasil_json.SCREEN[i]+`','`+hasil_json.MENU[i]+`','`+tampungCounterClassScreenMenu+`','`+tampungCounterIdScreenMenu+`')">
                    <div class="item-inner">
                    <div class="item-text namaToko" style="color:black">`+hasil_json.MENU[i]+`</div>
                    </div>
                    <input type="hidden" class="valueScreen" value="`+hasil_json.SCREEN[i]+`">
                    </a>
                    </li>`;
                }
            }
            

            $$('.listPopupNamaMenuUserMenu').html(tampungScreenMenu);
            myApp.preloader.hide();
        });
        myApp.popup.open('.popup-usermenu');
    });

    
    $$('.kodeJabatanHakAkses').html(editKodeJabatanHakAkses);
    $$('.userIdHakAkses').html(editUserIdHakAkses);
    $$('.cabangHakAkses').html(editCabangHakAkses);


    $$('.btnTambahHakAkses').on('click',function(){
        tampungCounterClassScreenMenu++;
        element = `<div class="card">
        <div class ="card-header cardHeaderBiru">Hak Akses
        <a href="#" class="hapusHakAksesUserMenu"><span style="font-size:0.9em;text-align: right"><i class="fas fa-window-close " style="color:white"></i></span></a>
        </div>
        <div class="card-content card-content-padding">
        <div class="list media-list searchbar-found semuaHakAksesJabatan">
        <ul>

        <li>
        <div class="item-content item-input">
        <div class="item-inner">
        <div class="item-title item-label" style="color:#2196F3"><b>Menu</b></div>
        <div class="item-input-wrap">
        <a href="#" class="popup-open-usermenu" id="`+tampungCounterClassScreenMenu+`">
        <input type="text" class="namaMenuUserMenu`+tampungCounterClassScreenMenu+`" placeholder="Tekan Untuk Menambah Menu" readonly="readonly"/>
        <input type="hidden" class="screenMenuUserMenu`+tampungCounterClassScreenMenu+`" name="screenMenuUserMenu[]" value=""/>
        </a>
        </div>
        </div>
        </div>
        </li>

        <li>
        <label class="item-checkbox item-content">
        <input type="checkbox" name="usermenu_tambah[]"  />
        <i class="icon icon-checkbox"></i>
        <div class="item-inner">
        <div class="item-title">Tambah</div>
        </div>
        </label>
        </li>

        <li>
        <label class="item-checkbox item-content">
        <input type="checkbox" name="usermenu_ubah[]" />
        <i class="icon icon-checkbox"></i>
        <div class="item-inner">
        <div class="item-title">Ubah</div>
        </div>
        </label>
        </li>

        <li>
        <label class="item-checkbox item-content">
        <input type="checkbox" name="usermenu_hapus[]" />
        <i class="icon icon-checkbox"></i>
        <div class="item-inner">
        <div class="item-title">Hapus</div>
        </div>
        </label>
        </li>

        <li>
        <label class="item-checkbox item-content">
        <input type="checkbox" name="usermenu_cetak[]"  />
        <i class="icon icon-checkbox"></i>
        <div class="item-inner">
        <div class="item-title">Cetak</div>
        </div>
        </label>
        </li>

        <li>
        <label class="item-checkbox item-content">
        <input type="checkbox" name="usermenu_posting[]"  />
        <i class="icon icon-checkbox"></i>
        <div class="item-inner">
        <div class="item-title">Posting</div>
        </div>
        </label>
        </li>

        <li>
        <label class="item-checkbox item-content">
        <input type="checkbox" name="usermenu_cari[]"  />
        <i class="icon icon-checkbox"></i>
        <div class="item-inner">
        <div class="item-title">Cari</div>
        </div>
        </label>
        </li>
        </ul>
        </div>
        </div>
        </div>`;

        $$('.generateTambahHakAkses').append(element);
        $$('.hapusHakAksesUserMenu').on('click',function(){
            $$(this).closest('.card').remove()
        });

        $$('.popup-open-usermenu').on('click',function(){

            var tampungCounterIdScreenMenu = ($(this).attr('id'));
            tampungScreenMenu = "";
            myApp.preloader.show();
            var act = "TAMPIL_POPUP_MENU";
            myApp.request.post(ipTujuan,{case:act,tampungCounterScreenMenu:tampungCounterScreenMenu},function(data){
                tampungScreenMenu = "";
                var hasil_json = JSON.parse(data);
                if(hasil_json.hasil == "ada"){
                    for(var i = 0; i<hasil_json.SCREEN.length; i++){
                        tampungScreenMenu +=`<li>
                        <a href="#" class="item-link" onClick="PilihMenuUserMenu('`+hasil_json.SCREEN[i]+`','`+hasil_json.MENU[i]+`','`+tampungCounterClassScreenMenu+`','`+tampungCounterIdScreenMenu+`')">
                        <div class="item-inner">
                        <div class="item-text namaToko" style="color:black">`+hasil_json.MENU[i]+`</div>
                        </div>
                        <input type="hidden" class="valueScreen" value="`+hasil_json.SCREEN[i]+`">
                        </a>
                        </li>`;
                    }
                }


                $$('.listPopupNamaMenuUserMenu').html(tampungScreenMenu);
                myApp.preloader.hide();
            });
            myApp.popup.open('.popup-usermenu');
            
        });
    });


});



$$(document).on('page:init', '.page[data-name="master_detail_pajak"]', function (page) {
    var searchbar = myApp.searchbar.create({
        el: '.searchMasterDetailPajak',
        searchContainer: '.list',
        searchIn: '.namaDetailPajakSearch',
        on: {
            search(sb, query, previousQuery) {
                console.log(query, previousQuery);
            }
        }
    });

    $$('.fabInputDetailPajak').on('click',function(){
        mainView.router.navigate("/input_detail_pajak/");
    });
});




//master_menu
$$(document).on('page:init', '.page[data-name="master_menu"]', function (page) {
    if(userHakAksesArrayGlobal["masterMenu"]["TAMBAH"] == "F"){
        $$('.fabInputMasterMenu').remove();
    }
    myApp.preloader.hide();
    //myApp.preloader.show();
    var act = "TAMPIL_MASTER_MENU";
    myApp.request.post(ipTujuan,{case:act},function(data){
        var hasil_json = JSON.parse(data);
        myApp.preloader.hide();
        if(hasil_json.hasil == "ada"){
            var tampungMasterMenu = "";

            tampungMasterMenu = "<ul>";

            for(var i = 0; i<hasil_json.MENU.length; i++){
                var tampungNamaMenu = hasil_json.MENU[i];
                console.log(hasil_json.SCREEN[i].length);
                tampungMasterMenu+= `
                <li>
                <a href="#" class="item-link item-content">
                <div class="item-inner">
                <div class="item-title-row">
                <div class="item-text" style="color:black"><b>${hasil_json.NOMOR[i]}.
                `;

                if(hasil_json.SCREEN[i].length>1){
                    for(var counter = 0; counter<hasil_json.SCREEN[i].length; counter++){
                        tampungMasterMenu+=`&nbsp &nbsp &nbsp`;
                    }
                    tampungMasterMenu +=tampungNamaMenu;
                } else {
                    tampungMasterMenu+=tampungNamaMenu;
                }

                tampungMasterMenu+=`</b></div>
                </div>
                </div>
                </a>
                </li>
                `;
            }
            tampungMasterMenu +="</ul>";
            $$('.semuaMasterMenu').html(tampungMasterMenu);

        } else {
            $$('.semuaMasterMenu').html("Belum Ada Menu");
        }
        
    });

    $$('.fabInputMasterMenu').on('click',function(){
        mainView.router.navigate("/input_master_menu/");
    });
});


$$(document).on('page:init', '.page[data-name="input_master_menu"]', function (page) {

    $$('.btnInputMasterMenu').on('click',function(){
        var act = "INPUT_MASTER_MENU";
        var NOMOR = $$('.nomorMenu').val();
        var SCREEN = $$('.screenMenu').val();
        var MENU = $$('.namaMenu').val();
        var ICON = $$('.iconMenu').val();
        var TAG = $$('.tagMenu').val();
        myApp.request.post(ipTujuan,{case:act,NOMOR:NOMOR,SCREEN:SCREEN,MENU:MENU,ICON:ICON,TAG:TAG},function(data){
            var hasil_json = JSON.parse(data);
            if(hasil_json.hasil == "ada"){
                myApp.dialog.alert("Nomor / Screen / Menu Sudah Terdaftar");
            } else {
                //mainView.router.navigate("/master_menu/");
                mainView.router.back("/master_menu/",{force:true});
            }
        });
    });


});

//edit_pelanggan
$$(document).on('page:init', '.page[data-name="edit_pelanggan"]', function (page) {
    var counterGambarKtp = 0;
    var counterGambarNpwp = 0;

    var searchbar3 = myApp.searchbar.create({
        el: '.searchKaryawan',
        searchContainer: '.list',
        searchIn: '.namaToko',
        on: {
            search(sb, query, previousQuery) {
                console.log(query, previousQuery);
            }
        }
    });

    $$("input[type=text]").keyup(function(){
        $$(this).val( $$(this).val().toUpperCase() );
    });

    

    $$('.bukaKameraKtpDetailPajak').on('click',function(page){
        navigator.camera.getPicture(onSuccess,onFail,{
            quality:30,
            destinationType : Camera.DestinationType.FILE_URI,
            
            correctOrientation: true,
            sourceType : Camera.PictureSourceType.CAMERA,
            cameraDirection: Camera.Direction.BACK
        });

        function onSuccess(imageData){
            var image = document.getElementById('gambarKameraKtpDetailPajak');
            image.src = imageData;
            counterGambarKtp = 1;
        }

        function onFail(message){
            myApp.alert('Failed because: ' +message);
        }

    });


    $$('.bukaKameraNpwpDetailPajak').on('click',function(page){
        navigator.camera.getPicture(onSuccess,onFail,{
            quality:30,
            destinationType : Camera.DestinationType.FILE_URI,
            
            correctOrientation: true,
            sourceType : Camera.PictureSourceType.CAMERA,
            cameraDirection: Camera.Direction.BACK
        });

        function onSuccess(imageData){
            var image = document.getElementById('gambarKameraNpwpDetailPajak');
            image.src = imageData;
            counterGambarNpwp = 1;
        }

        function onFail(message){
            myApp.alert('Failed because: ' +message);
        }

    });

    $$('.editKodePelanggan').val(editKodePelanggan);
    $$('.editNamaPelanggan').val(editNamaPelanggan);
    $$('.editAlamatPelanggan').val(editAlamatPelanggan);
    $$('.editKotaPelanggan').val(editKotaPelanggan);
    $$('.editTelponPelanggan').val(editTeleponPelanggan);
    $$('.editFaxPelanggan').val(editFaxPelanggan);
    $$('.editKreditLimitInternalPelanggan').val(editKreditLimitPelanggan);
    $$('.editSyaratBayarCetakInternalPelanggan').val(editSyaratPiutangPelanggan);
    $$('.editSyaratBayarMaxInternalPelanggan').val(editSyaratPiutangMaxPelanggan);
    $$('.editTermInternalPelanggan').val(editTermPelanggan);
    $$('.editAlamatKirimPelanggan').val(editAlamatKirimPelanggan);
    $$('.editAreaPelanggan').val(editAreaPelanggan);
    $$('.editNpwpPajakPelanggan').val(editNpwpPajakPelanggan);
    $$('.editKtpPajakPelanggan').val(editKtpPajakPelanggan);
    $$('.editNamaFakturPelanggan').val(editNamaFakturPelanggan);
    $$('.editAlamatFakturPelanggan').val(editAlamatFakturPelanggan);
    var counterPerusahaan="";
    var counterInternal = "";
    var counterFotoToko = 1;
    var hapusFotoToko = [];
    

    $$('.btnBatalEditPelanggan').on('click',function(){
        //mainView.router.navigate("/detail_pelanggan/");
        mainView.router.back();
    }); 



    $$('.btnSimpanEditPelanggan').on('click',function(){
        //myApp.preloader.show();
        var act = "EDIT_PELANGGAN";
        var KODEPELANGGAN = $$('.editKodePelanggan').val();
        var NAMA = $$('.editNamaPelanggan').val();
        var ALAMAT = $$('.editAlamatPelanggan').val();
        var KOTA = $$('.editKotaPelanggan').val();
        var TELPON = $$('.editTelponPelanggan').val();
        var FAX = $$('.editFaxPelanggan').val();
        var KREDITLIMIT = $$('.editKreditLimitInternalPelanggan').val();
        var SYARATPIUTANG = $$('.editSyaratBayarCetakInternalPelanggan').val();
        var SYARATPIUTANGMAX = $$('.editSyaratBayarMaxInternalPelanggan').val();
        var TERM = $$('.editTermInternalPelanggan').val();
        var ALAMATKIRIM = $$('.editAlamatKirimPelanggan').val();
        var KATEGORIPELANGGAN = $$('.editKategoriPelanggan').val();
        var KODEAREA = $$('.editAreaPelanggan').val();
        var NPWP = $$('.editNpwpPajakPelanggan').val();
        var KTP = $$('.editKtpPajakPelanggan').val();
        var NAMAFAKTUR = $$('.editNamaFakturPelanggan').val();
        var ALAMATFAKTUR = $$('.editAlamatFakturPelanggan').val();
        var GAMBARNPWP = $$('#gambarKameraNpwpDetailPajak').attr("src");
        var GAMBARKTP = $$('#gambarKameraKtpDetailPajak').attr("src");

        var fotoToko= [];
        var namaFotoToko = [];




        $$('img[name^="fotoTokoPelanggan"]').each(function() {
            if($$(this).attr("src") !=null){
                fotoToko.push($$(this).attr("src"));
                namaFotoToko.push(this.className);
            }
        });

        //dpelanggan1
        var CP1 = [];
        var KJ1 = [];
        var HP1 = [];
        var WA1 = [];
        var EMAIL1 = [];
        var TANGGALLAHIR1 = [];
        var KETERANGAN1 = [];

        //dpelanggan2
        var CP2 = [];
        var KJ2 = [];
        var HP2 = [];
        var WA2 = [];
        var EMAIL2 = [];
        var TANGGALLAHIR2 = [];
        var KETERANGAN2 = [];

        //dpelanggan1
        $$('input[class^="inputKontakNamaPelanggan1"]').each(function() {
            CP1.push($$(this).val());
        });

        $$('input[class^="inputKontakJabatanPelanggan1"]').each(function() {
            KJ1.push($$(this).val());
        });

        $$('input[class^="inputKontakHandphonePelanggan1"]').each(function() {
            HP1.push($$(this).val());
        });

        $$('input[class^="inputKontakWaPelanggan1"]').each(function() {
            WA1.push($$(this).val());
        });

        $$('input[class^="inputKontakEmailPelanggan1"]').each(function() {
            EMAIL1.push($$(this).val());
        });

        $$('input[class^="inputKontakTanggalLahirPelanggan1"]').each(function() {
            TANGGALLAHIR1.push($$(this).val());
        });

        $$('input[class^="inputKontaKeteranganPelanggan1"]').each(function() {
            KETERANGAN1.push($$(this).val());
        });

        //dpelanggan2
        $$('input[class^="inputKontakNamaPelanggan2"]').each(function() {
            CP2.push($$(this).val());
        });

        $$('input[class^="inputKontakJabatanPelanggan2"]').each(function() {
            KJ2.push($$(this).val());
        });

        $$('input[class^="inputKontakHandphonePelanggan2"]').each(function() {
            HP2.push($$(this).val());
        });

        $$('input[class^="inputKontakWaPelanggan2"]').each(function() {
            WA2.push($$(this).val());
        });

        $$('input[class^="inputKontakEmailPelanggan2"]').each(function() {
            EMAIL2.push($$(this).val());
        });

        $$('input[class^="inputKontakTanggalLahirPelanggan2"]').each(function() {
            TANGGALLAHIR2.push($$(this).val());
        });

        $$('input[class^="inputKontaKeteranganPelanggan2"]').each(function() {
            KETERANGAN2.push($$(this).val());
        });


        if(!KODEPELANGGAN){
            myApp.dialog.alert("Kode Pelanggan Harus Diisi");
            myApp.preloader.hide();
        } else if(!NAMA){
            myApp.preloader.hide();
            myApp.dialog.alert("Nama Harus Diisi");
        } else if(!ALAMAT){
            myApp.preloader.hide();
            myApp.dialog.alert("Alamat Harus Diisi");
        }  else if(!KOTA){
            myApp.preloader.hide();
            myApp.dialog.alert("Kota Harus Diisi");
        } else if(!TELPON){
            myApp.preloader.hide();
            myApp.dialog.alert("Telepon Harus Diisi");
        } else if(!FAX){
            myApp.preloader.hide();
            myApp.dialog.alert("Fax Harus Diisi");
        }/* else if(!KREDITLIMIT){
            myApp.preloader.hide();
            myApp.dialog.alert("Kredit Limit Harus Diisi");
        } else if(!SYARATPIUTANG){
            myApp.preloader.hide();
            myApp.dialog.alert("Syarat Bayar Cetak Harus Diisi");
        } else if(!SYARATPIUTANGMAX){
            myApp.preloader.hide();
            myApp.dialog.alert("Syarat Bayar Max Harus Diisi");
        } else if(!TERM){
            myApp.preloader.hide();
            myApp.dialog.alert("Term Harus Diisi");
        } else if(!ALAMATKIRIM){
            myApp.preloader.hide();
            myApp.dialog.alert("Alamat Kirim Harus Diisi");
        } else if(!KODEAREA){
            myApp.preloader.hide();
            myApp.dialog.alert("Kodea Area Harus Diisi");
        } else if(!KATEGORIPELANGGAN){
            myApp.preloader.hide();
            myApp.dialog.alert("Kategori Pelanggan Harus Diisi");
        }*//*else if(fotoToko.length==0){
            myApp.dialog.alert("Foto Toko Harus Diisi");
            myApp.preloader.hide();
        }*/ else {
            myApp.request.post(ipTujuan,{case:act,KODECABANG:KODECABANG,KODEPELANGGAN:KODEPELANGGAN, NAMA:NAMA, ALAMAT:ALAMAT, KOTA:KOTA, TELPON:TELPON,
                FAX:FAX, KREDITLIMIT:KREDITLIMIT, SYARATPIUTANG:SYARATPIUTANG, SYARATPIUTANGMAX:SYARATPIUTANGMAX, TERM:TERM,
                ALAMATKIRIM:ALAMATKIRIM,KATEGORIPELANGGAN:KATEGORIPELANGGAN, USERID:USERID, CP1:CP1, KJ1:KJ1, HP1:HP1, WA1:WA1, EMAIL1:EMAIL1,
                TANGGALLAHIR1:TANGGALLAHIR1, KETERANGAN1:KETERANGAN1,KODEAREA:KODEAREA,NPWP:NPWP,KTP:KTP,NAMAFAKTUR:NAMAFAKTUR,ALAMATFAKTUR:ALAMATFAKTUR,
                CP2:CP2, KJ2:KJ2, HP2:HP2,WA2:WA2, EMAIL2:EMAIL2,TANGGALLAHIR2:TANGGALLAHIR2, KETERANGAN2:KETERANGAN2,fotoToko:fotoToko,hapusFotoToko:hapusFotoToko,
                namaFotoToko:namaFotoToko,GAMBARKTP:GAMBARKTP,GAMBARNPWP:GAMBARNPWP},function(data){
                    var hasil_json = JSON.parse(data);
                    if(hasil_json.hasil == "npwpterdaftar"){
                        myApp.dialog.alert("Nomor NPWP sudah Terdaftar");
                        myApp.preloader.hide();
                    } else if(hasil_json.hasil == "ada"){
                        myApp.dialog.alert("Kode Pelanggan Sudah Terdaftar");
                        myApp.preloader.hide();
                    } else {

                        if(fotoToko.length !=0){
                            for(var i =0; i<fotoToko.length;i++){
                               var toko = new FileUploadOptions();
                               toko.fileKey = "photo";
                               toko.fileName = fotoToko[i].substr(fotoToko[i].lastIndexOf('/') + 1);
                               toko.mimeType = "image/jpeg";
                               toko.chunkedMode = false;
                               toko.headers = {
                                  Connection: "close"
                              };
                              toko.params = {
                                namaFile:KODEPELANGGAN +"_"+namaFotoToko[i]+"_toko"
                            }
                            var ft = new FileTransfer();
                            ft.upload(fotoToko[i], 
                              encodeURI(ipUploadTokoPelanggan),
                              win,
                              fail,
                              toko);

                            var win = function(r) {
                                console.log("Should not be called.");
                            }

                            var fail = function(error) {
                                alert("An error has occurred: Code = " + error.code);
                                console.log("upload error source " + error.source);
                                console.log("upload error target " + error.target);
                            }
                        }
                    }

                    //START UPLOAD FOTO KTP PELANGGAN
                    
                    if(counterGambarKtp == 1){
                       var ktp = new FileUploadOptions();
                       ktp.fileKey = "photo";
                       ktp.fileName = GAMBARKTP.substr(GAMBARKTP.lastIndexOf('/') + 1);
                       ktp.mimeType = "image/jpeg";
                       ktp.chunkedMode = false;
                       ktp.headers = {
                          Connection: "close"
                      };
                      ktp.params = {
                        namaFile:KODEPELANGGAN+"_"+"ktp"
                    }

                    var ft = new FileTransfer();
                    ft.upload(GAMBARKTP, 
                      encodeURI(ipUploadKtpPelanggan),
                      win,
                      fail,
                      ktp);

                    var win = function(r) {
                        console.log("Should not be called.");
                    }

                    var fail = function(error) {
                    // error.code == FileTransferError.ABORT_ERR
                    alert("An error has occurred: Code = " + error.code);
                    console.log("upload error source " + error.source);
                    console.log("upload error target " + error.target);
                }
            }

                //END UPLOAD KTP PELANGGAN


                //START UPLOAD NPWP PELANGGAN
                if(counterGambarNpwp == 1){
                    var npwp = new FileUploadOptions();
                    npwp.fileKey = "photo";
                    npwp.fileName = GAMBARNPWP.substr(GAMBARNPWP.lastIndexOf('/') + 1);
                    npwp.mimeType = "image/jpeg";
                    npwp.chunkedMode = false;
                    npwp.headers = {
                      Connection: "close"
                  };
                  npwp.params = {
                    namaFile:KODEPELANGGAN+"_"+"npwp"
                }

                var ft = new FileTransfer();
                ft.upload(GAMBARNPWP, 
                  encodeURI(ipUploadNpwpPelanggan),
                  win,
                  fail,
                  npwp);

                var win = function(r) {
                    console.log("Should not be called.");
                }

                var fail = function(error) {
                    // error.code == FileTransferError.ABORT_ERR
                    alert("An error has occurred: Code = " + error.code);
                    console.log("upload error source " + error.source);
                    console.log("upload error target " + error.target);
                }
            }

            myApp.dialog.alert("Pelanggan Berhasil Di Edit");
            mainView.router.back("/detail_pelanggan/",{force:true});
            myApp.preloader.hide();
        }
    });
}
});

    //MENYAMAKAN KATEGORI PELANGGAN DULU
    var act = "SELECT_KATEGORI_PELANGGAN";
    myApp.request.post(ipTujuan,{case:act},function(data){
        var hasil_json = JSON.parse(data);
        var tampungKategoriPelanggan = "";

        for(var i =0;i<hasil_json.KODEKATEGORIPELANGGAN.length;i++){
            if(hasil_json.KODEKATEGORIPELANGGAN[i] == editKodeKategoriPelanggan){
                tampungKategoriPelanggan += `<option selected value="`+hasil_json.KODEKATEGORIPELANGGAN[i]+`">`+hasil_json.NAMA[i]+`</option>`;
            } else {
                tampungKategoriPelanggan += `<option value="`+hasil_json.KODEKATEGORIPELANGGAN[i]+`">`+hasil_json.NAMA[i]+`</option>`;
            }
        }
        $$('.editKategoriPelanggan').html(tampungKategoriPelanggan);
    });

    //TAMPIL DETAIL PERUSAHAAN DARI DPELANGGAN1

    
    
    //TAMPIL DETAIL PERUSAHAAN DARI DPELANGGAN2 dan DPELANGGAN1
    var act = "TAMPIL_SELURUH_DETAIL_PERUSAHAAN_PENJUALAN";
    myApp.request.post(ipTujuan,{case:act,KODEPELANGGAN:editKodePelanggan},function(data){
        var hasil_json = JSON.parse(data);
        if(hasil_json.gambartoko == "ada"){
            var tampungGambarToko = ``;
            for(var i = 0; i<hasil_json.KODEGAMBAR.length; i++){
                tampungGambarToko =`
                <div class="card">
                <div class="card-header row" style="background-color:#2196F3;color:white">
                <div class="col padding5" >
                <a href="#" id="`+hasil_json.KODEGAMBAR[i]+`" class="hapusFotoTokoAda">
                <i class="fas fa-window-close  middleWhite" ></i>
                </a>
                </div>
                </div>
                <div class="card-content card-content-padding">
                <img src="`+ipGambarTokoPelanggan+hasil_json.KODEGAMBAR[i]+`.jpg?`+ new Date().getTime()+`" id="gambarFoto-1" height="150" width="100%">
                </div>
                </div>
                `;

                $$('.generateFotoTokoAda').append(tampungGambarToko);
            }

            counterFotoToko = hasil_json.TAMPUNGCOUNTERFOTOTOKO;
            $$('.generateFotoToko').html(`
                <div class="card">
                <div class="card-header row" style="background-color:#2196F3;color:white">
                <a href="#" class="ambilFotoToko-${counterFotoToko} col-33 padding5" >
                <i class="fa fa-camera  middleWhite"></i>
                </a>
                <a href="#" class="ambilFotoTokoGallery-${counterFotoToko} col-33 padding5" id ="1">
                <i class="far fa-image  middleWhite" ></i>
                </a>
                <a href="#" class="hapusFotoToko col-33 padding5" id ="${counterFotoToko}">
                <i class="fas fa-window-close  middleWhite" ></i>
                </a>
                </div>
                <div class="card-content card-content-padding">
                <img class="${counterFotoToko}" name ="fotoTokoPelanggan" id="gambarFoto-${counterFotoToko}" height="150" width="100%">
                </div>
                </div>`);

        } else {
            $$('.generateFotoTokoAda').html("");
        }


        //AMBIL FOTO TOKO
        $$('.ambilFotoToko-'+counterFotoToko).on('click',function(){

            navigator.camera.getPicture(onSuccess,onFail,{
                quality:30,
                destinationType : Camera.DestinationType.FILE_URI,
                
                correctOrientation: true,
                sourceType : Camera.PictureSourceType.CAMERA,
                cameraDirection: Camera.Direction.BACK
            });

            function onSuccess(imageData) {
                var image = document.getElementById('gambarFoto-'+counterFotoToko);
                image.src = imageData;
                counterFotoToko++;
                element =`<div class="card">
                <div class="card-header row" style="background-color:#2196F3;color:white">
                <a href="#" class="ambilFotoToko-${counterFotoToko} col-33 padding5"  >
                <i class="fa fa-camera  middleWhite"></i>
                </a>
                <a href="#" class="ambilFotoTokoGallery-${counterFotoToko} col-33 padding5"  >
                <i class="far fa-image middleWhite"></i>
                </a>
                <a href="#" class="hapusFotoToko col-33 padding5" id ="${counterFotoToko}">
                <i class="fas fa-window-close  middleWhite" ></i>
                </a>
                </div>
                <div class="card-content card-content-padding">
                <img class="${counterFotoToko}" name ="fotoTokoPelanggan" id="gambarFoto-${counterFotoToko}" height="150" width="100%">
                </div>
                </div>`;

                $$('.generateFotoToko').append(element);
                $$('.hapusFotoToko').on('click',function(){
                //$$(this).closest('.card').remove()
                var hapusId = $$(this).attr("id");
                var tampung = $$("#gambarFoto-"+hapusId).attr("src");
                if(tampung != null){
                    $$(this).closest('.card').remove();
                }
            });

                $$('.ambilFotoToko-'+counterFotoToko).on('click',function(){
                    navigator.camera.getPicture(onSuccess,onFail,{
                        quality:30,
                        destinationType : Camera.DestinationType.FILE_URI,
                        
                        correctOrientation: true,
                        sourceType : Camera.PictureSourceType.CAMERA,
                        cameraDirection: Camera.Direction.BACK
                    });
                });

                $$('.ambilFotoTokoGallery-'+counterFotoToko).on('click',function(){
                    navigator.camera.getPicture(onSuccess,onFail,{
                        quality:30,
                        destinationType : Camera.DestinationType.FILE_URI,
                        
                        correctOrientation: true,
                        sourceType : Camera.PictureSourceType.PHOTOLIBRARY,
                    });
                });
            }

            function onFail(message){
                myApp.alert('Failed because: ' +message);
            }
        });

        //AMBIL FOTO TOKO
        $$('.ambilFotoTokoGallery-'+counterFotoToko).on('click',function(){

            navigator.camera.getPicture(onSuccess,onFail,{
                quality:30,
                destinationType : Camera.DestinationType.FILE_URI,
                
                correctOrientation: true,
                sourceType : Camera.PictureSourceType.PHOTOLIBRARY,
                cameraDirection: Camera.Direction.BACK
            });

            function onSuccess(imageData) {
                var image = document.getElementById('gambarFoto-'+counterFotoToko);
                image.src = imageData;
                counterFotoToko++;
                element =`<div class="card">
                <div class="card-header row" style="background-color:#2196F3;color:white">
                <a href="#" class="ambilFotoToko-${counterFotoToko} col-33 padding5"  >
                <i class="fa fa-camera  middleWhite"></i>
                </a>
                <a href="#" class="ambilFotoTokoGallery-${counterFotoToko} col-33 padding5"  >
                <i class="far fa-image middleWhite"></i>
                </a>
                <a href="#" class="hapusFotoToko col-33 padding5" id ="${counterFotoToko}">
                <i class="fas fa-window-close  middleWhite" ></i>
                </a>
                </div>
                <div class="card-content card-content-padding">
                <img class="${counterFotoToko}" name ="fotoTokoPelanggan" id="gambarFoto-${counterFotoToko}" height="150" width="100%">
                </div>
                </div>`;

                $$('.generateFotoToko').append(element);
                $$('.hapusFotoToko').on('click',function(){
                //$$(this).closest('.card').remove()
                var hapusId = $$(this).attr("id");
                var tampung = $$("#gambarFoto-"+hapusId).attr("src");
                if(tampung != null){
                    $$(this).closest('.card').remove();
                }
            });

                $$('.ambilFotoTokoGallery-'+counterFotoToko).on('click',function(){
                    navigator.camera.getPicture(onSuccess,onFail,{
                        quality:30,
                        destinationType : Camera.DestinationType.FILE_URI,
                        
                        correctOrientation: true,
                        sourceType : Camera.PictureSourceType.PHOTOLIBRARY,
                    });
                });

                $$('.ambilFotoToko-'+counterFotoToko).on('click',function(){
                    navigator.camera.getPicture(onSuccess,onFail,{
                        quality:30,
                        destinationType : Camera.DestinationType.FILE_URI,
                        
                        correctOrientation: true,
                        sourceType : Camera.PictureSourceType.CAMERA,
                        cameraDirection: Camera.Direction.BACK
                    });
                });
            }

            function onFail(message){
                myApp.alert('Failed because: ' +message);
            }
        });

        if(hasil_json.gambarktp == "ada"){
            document.getElementById("gambarKameraKtpDetailPajak").src = `${ipGambarKtpPelanggan}${hasil_json.KODEGAMBARKTP}.jpg?`+ new Date().getTime();
        }

        if(hasil_json.gambarnpwp == "ada"){
            document.getElementById("gambarKameraNpwpDetailPajak").src = `${ipGambarNpwpPelanggan}${hasil_json.KODEGAMBARNPWP}.jpg?`+ new Date().getTime();
        }



        if(hasil_json.dpelanggan1 == "ada"){
            var tampungDpelanggan1 = "";
            for(var i = 0;i<hasil_json.COUNTERINTERNAL;i++){
                tampungDpelanggan1 =`
                <div class="card">
                <div class="card-header" style="background-color:#2196F3;color:white">

                <span style="font-size:0.9em"><b>Sales</b></span>
                <a href="#" class="hapusDataInternalSalesPenjualan"><span style="font-size:0.9em;text-align: right"><i class="fas fa-window-close " style="color:white"></i></span></a>

                </div>
                <div class="card-content card-content-padding">
                <div class="list form-store-data" >
                <div class="item-content item-input">
                <div class="item-inner">
                <div class="item-title item-label" style="color:#2196F3"><b>Nama</b></div>
                <div class="item-input-wrap">
                <a href="#" class="popup-open-karyawanPelanggan">
                <input type="hidden" id="`+counterInternal+`" class="counterInternalPelanggan" value="`+counterInternal+`">
                <input type="hidden" class="inputKontakNamaPelanggan1" id="inputCP`+counterInternal+`" placeholder="Nama" value="`;
                if(!hasil_json.CP1[i]){
                    tampungDpelanggan1+="";
                } else {
                    tampungDpelanggan1 += hasil_json.CP1[i];
                }
                tampungDpelanggan1+=`" readonly>
                <input type="text" id="inputCPpalsu`+counterInternal+`" placeholder="Nama" value="`;
                if(!hasil_json.CP1[i]){
                    tampungDpelanggan1+="";
                } else {
                    tampungDpelanggan1 += hasil_json.NAMAKARYAWAN[i];
                }
                tampungDpelanggan1+=`" readonly>
                </a>
                </div>
                </div>
                </div>

                <div class="item-content item-input">
                <div class="item-inner">
                <div class="item-title item-label" style="color:#2196F3"><b>Jabatan</b></div>
                <div class="item-input-wrap">
                <input type="hidden" class="inputKontakJabatanPelanggan1" id="inputKJ`+counterInternal+`" value="`+hasil_json.KJ1[i]+`" >
                <input type="text"  id="inputKJpalsu`+counterInternal+`" placeholder="Jabatan" value="`;
                if(!hasil_json.KJ1[i]){
                    tampungDpelanggan1+="";
                } else {
                    tampungDpelanggan1 += hasil_json.NAMAJABATAN[i];
                }
                tampungDpelanggan1+=`" readonly>
                </div>
                </div>
                </div>

                <div class="item-content item-input">
                <div class="item-inner">
                <div class="item-title item-label" style="color:#2196F3"><b>Handphone</b></div>
                <div class="item-input-wrap">
                <input type="number" class="inputKontakHandphonePelanggan1" id="inputHP`+counterInternal+`" placeholder="0812345" value="`;
                if(!hasil_json.HP1[i]){
                    tampungDpelanggan1+="";
                } else {
                    tampungDpelanggan1 += hasil_json.HP1[i];
                }
                tampungDpelanggan1+=`" readonly>
                </div>
                </div>
                </div>

                <div class="item-content item-input">
                <div class="item-inner">
                <div class="item-title item-label" style="color:#2196F3"><b>Nomor WA</b></div>
                <div class="item-input-wrap">
                <input type="number" class="inputKontakWaPelanggan1" id="inputWA`+counterInternal+`"placeholder="0812345" value="`;
                if(!hasil_json.WA1[i]){
                    tampungDpelanggan1+="";
                } else {
                    tampungDpelanggan1 += hasil_json.WA1[i];
                }
                tampungDpelanggan1+=`" readonly>
                </div>
                </div>
                </div>

                <div class="item-content item-input">
                <div class="item-inner">
                <div class="item-title item-label" style="color:#2196F3"><b>Email</b></div>
                <div class="item-input-wrap">
                <input type="email" class="inputKontakEmailPelanggan1" id="inputEMAIL`+counterInternal+`"placeholder="sumber@blessingcom.com" value="`;
                if(!hasil_json.EMAIL1[i]){
                    tampungDpelanggan1+="";
                } else {
                    tampungDpelanggan1 += hasil_json.EMAIL1[i];
                }
                tampungDpelanggan1+=`" readonly>
                </div>
                </div>
                </div>

                <div class="item-content item-input">
                <div class="item-inner">
                <div class="item-title item-label" style="color:#2196F3"><b>Tanggal Lahir</b></div>
                <div class="item-input-wrap">
                <input type="text" class="inputKontakTanggalLahirPelanggan1" id="inputTANGGALLAHIR`+counterInternal+`" placeholder="Select date" readonly="readonly" id="demo-calendar-internal`+i+`" value="`;
                if(!hasil_json.TANGGALLAHIR1[i]){
                    tampungDpelanggan1+="";
                } else {
                    tampungDpelanggan1 += hasil_json.TANGGALLAHIR1[i];
                }
                tampungDpelanggan1+=`" readonly>
                </div>
                </div>
                </div>

                <div class="item-content item-input">
                <div class="item-inner">
                <div class="item-title item-label" style="color:#2196F3"><b>Keterangan</b></div>
                <div class="item-input-wrap">
                <input type="text" class="inputKontaKeteranganPelanggan1" placeholder="Keterangan" value="`;
                if(!hasil_json.KETERANGAN1[i]){
                    tampungDpelanggan1+="";
                } else {
                    tampungDpelanggan1 += hasil_json.KETERANGAN1[i];
                }
                tampungDpelanggan1+=`" readonly>
                </div>
                </div>
                </div>
                </div>
                </div>
                </div>`;
                $$('.generateInternalSalesPenjualan').append(tampungDpelanggan1);

                var calendarModal = myApp.calendar.create({
                    inputEl: '#demo-calendar-internal'+i,
                    openIn: 'customModal',
                    header: true,
                    footer: true,
                    dateFormat: 'MM dd yyyy',
                });

                counterInternal =i;
            }
        } else {

        }

        

        if(hasil_json.dpelanggan2 == "ada"){

            var tampungDpelanggan2 = "";

            for(var i = 0; i<hasil_json.COUNTERPERUSAHAAN;i++){
                tampungDpelanggan2 =`
                <div class="card">
                <div class="card-header" style="background-color:#2196F3;color:white">

                <span style="font-size:0.9em"><b>Pengelola</b></span>
                <a href="#" class="hapusDataPerusahaanSalesPenjualan"><span style="font-size:0.9em;text-align: right"><i class="fas fa-window-close " style="color:white"></i></span></a>

                </div>
                <div class="card-content card-content-padding">
                <div class="list form-store-data" >


                <div class="item-content item-input">
                <div class="item-inner">
                <div class="item-title item-label" style="color:#2196F3"><b>Nama</b></div>
                <div class="item-input-wrap">
                <input type="text" class="inputKontakNamaPelanggan2" placeholder="Nama" value="`;
                if(!hasil_json.CP2[i]){
                    tampungDpelanggan2+="";
                } else {
                    tampungDpelanggan2+=hasil_json.CP2[i];
                }
                tampungDpelanggan2+=`">
                </div>
                </div>
                </div>

                <div class="item-content item-input">
                <div class="item-inner">
                <div class="item-title item-label" style="color:#2196F3"><b>Jabatan</b></div>
                <div class="item-input-wrap">
                <input type="text" class="inputKontakJabatanPelanggan2" placeholder="Jabatan" value="`;
                if(!hasil_json.KJ2[i]){
                    tampungDpelanggan2+="";
                } else {
                    tampungDpelanggan2 +=hasil_json.KJ2[i];
                }
                tampungDpelanggan2+=`">
                </div>
                </div>
                </div>

                <div class="item-content item-input">
                <div class="item-inner">
                <div class="item-title item-label" style="color:#2196F3"><b>Handphone</b></div>
                <div class="item-input-wrap">
                <input type="number" class="inputKontakHandphonePelanggan2" placeholder="0812345" value="`;
                if(!hasil_json.HP2[i]){
                    tampungDpelanggan2+="";
                } else {
                    tampungDpelanggan2 +=hasil_json.HP2[i];
                }
                tampungDpelanggan2+=`">
                </div>
                </div>
                </div>

                <div class="item-content item-input">
                <div class="item-inner">
                <div class="item-title item-label" style="color:#2196F3"><b>Nomor WA</b></div>
                <div class="item-input-wrap">
                <input type="number" class="inputKontakWaPelanggan2" placeholder="0812345" value="`;
                if(!hasil_json.WA2[i]){
                    tampungDpelanggan2+="";
                } else {
                    tampungDpelanggan2 +=hasil_json.WA2[i];
                }
                tampungDpelanggan2+=`">
                </div>
                </div>
                </div>

                <div class="item-content item-input">
                <div class="item-inner">
                <div class="item-title item-label" style="color:#2196F3"><b>Email</b></div>
                <div class="item-input-wrap">
                <input type="email" class="inputKontakEmailPelanggan2" placeholder="sumber@blessingcom.com" value="`;
                if(!hasil_json.EMAIL2[i]){
                    tampungDpelanggan2+="";
                } else {
                    tampungDpelanggan2 +=hasil_json.EMAIL2[i];
                }
                tampungDpelanggan2+=`">
                </div>
                </div>
                </div>

                <div class="item-content item-input">
                <div class="item-inner">
                <div class="item-title item-label" style="color:#2196F3"><b>Tanggal Lahir</b></div>
                <div class="item-input-wrap">
                <input type="text" class="inputKontakTanggalLahirPelanggan2" placeholder="Select date" readonly="readonly" id="demo-calendar-perusahaan`+i+`"/ value="`;
                if(!hasil_json.TANGGALLAHIR2[i]){
                    tampungDpelanggan2+="";
                } else {
                    tampungDpelanggan2 +=hasil_json.TANGGALLAHIR2[i];
                }
                tampungDpelanggan2+=`">
                </div>
                </div>
                </div>

                <div class="item-content item-input">
                <div class="item-inner">
                <div class="item-title item-label" style="color:#2196F3"><b>Keterangan</b></div>
                <div class="item-input-wrap">
                <input type="text" class="inputKontaKeteranganPelanggan2" placeholder="Keterangan" value="`;
                if(!hasil_json.KETERANGAN2[i]){
                    tampungDpelanggan2+="";
                } else {
                    tampungDpelanggan2 +=hasil_json.KETERANGAN2[i];
                }
                tampungDpelanggan2+=`">
                </div>
                </div>
                </div>
                </div>
                </div>
                </div>`;



                $$('.generatePerusahaanSalesPelanggan').append(tampungDpelanggan2);

                var calendarModal = myApp.calendar.create({
                    inputEl: '#demo-calendar-perusahaan'+i,
                    openIn: 'customModal',
                    header: true,
                    footer: true,
                    dateFormat: 'MM dd yyyy',
                });

                counterPerusahaan =i;
                $$("input[type=text]").keyup(function(){
                    $$(this).val( $$(this).val().toUpperCase() );
                });

                $$("input[type=email]").keyup(function(){
                    $$(this).val( $$(this).val().toUpperCase() );
                });
            }
        } else {

        }

        $$('.hapusDataPerusahaanSalesPenjualan').on('click',function(){
            $$(this).closest('.card').remove()
        });

        $$('.hapusDataInternalSalesPenjualan').on('click',function(){
            $$(this).closest('.card').remove()
        });
        
        $$('.hapusFotoTokoAda').on('click',function(){
            $$(this).closest('.card').remove()
            hapusFotoToko.push(this.id);
        });

        $$('.popup-open-karyawanPelanggan').on('click',function(){
            //console.log($$(this).find('.counterInternalPelanggan').val());
            tampungCounterInternalPelanggan = $$(this).find('.counterInternalPelanggan').val();
            myApp.popup.open('.popup-karyawan');
        });

        $$('.btnCancel').on('click',function(){
            myApp.popup.close('.popup-karyawan');
        });
    });


var act = "TAMPIL_POPUP_KARYAWAN_PELANGGAN";
myApp.request.post(ipTujuan,{case:act,KODECABANG:KODECABANG,USERID:USERID},function(data){
    var hasil_json = JSON.parse(data);
    var tampungPopUpKaryawan ="Tidak Memiliki Karyawan Internal";
    if(hasil_json.hasil == "ada"){
        tampungPopUpKaryawan = "";
        for(var i = 0; i<hasil_json.KODEKARYAWAN.length;i++){
            tampungPopUpKaryawan += `<li>
            <a href="#" class="item-link item-content cobaKlik" onClick="pilihKaryawanPelanggan('`+hasil_json.KODEKARYAWAN[i]+`','`+hasil_json.NAMA[i]+`','`+hasil_json.NAMAJABATAN[i]+`',
            '`+hasil_json.KODEJABATAN[i]+`','`+hasil_json.TELEPON[i]+`','`+hasil_json.WA1[i]+`','`+hasil_json.EMAIL1[i]+`','`+hasil_json.TANGGALLAHIR[i]+`')">
            <div class="item-inner">
            <div class="item-text namaToko" style="color:black">`+hasil_json.NAMA[i]+`</div>
            </div>
            </a>
            </li>`;
        }
        $$('.listPopUpNamaKaryawan').html(tampungPopUpKaryawan);
    } else {
        $$('.listPopUpNamaKaryawan').html(tampungPopUpKaryawan);
    }
});


$$('.btnTambahInternalSalesPenjualan').on('click',function(){
    console.log(counterInternal);
    counterInternal++;
    element =`<div class="card">
    <div class="card-header" style="background-color:#2196F3;color:white">

    <span style="font-size:0.9em"><b>Sales</b></span>
    <a href="#" class="hapusDataInternalSalesPenjualan"><span style="font-size:0.9em;text-align: right"><i class="fas fa-window-close " style="color:white"></i></span></a>

    </div>
    <div class="card-content card-content-padding">
    <div class="list form-store-data" >
    <div class="item-content item-input">
    <div class="item-inner">
    <div class="item-title item-label" style="color:#2196F3"><b>Nama</b></div>
    <div class="item-input-wrap">

    <a href="#" class="popup-open-karyawanPelanggan">

    <input type="hidden" class="counterInternalPelanggan"  value = "`+counterInternal+`" id="`+counterInternal+`">
    <input type="hidden" class="inputKontakNamaPelanggan1"  id="inputCP`+counterInternal+`">
    <input type="text" readonly="" class="inputKontakCPelanggan1"  id="inputCPpalsu`+counterInternal+`" placeholder="Nama">
    </a>

    </div>
    </div>
    </div>

    <div class="item-content item-input">
    <div class="item-inner">
    <div class="item-title item-label" style="color:#2196F3"><b>Jabatan</b></div>
    <div class="item-input-wrap">
    <input type="hidden" class="inputKontakJabatanPelanggan1"  id="inputKJ`+counterInternal+`">
    <input type="text"  readonly="" id ="inputKJpalsu`+counterInternal+`" placeholder="Jabatan">
    </div>
    </div>
    </div>

    <div class="item-content item-input">
    <div class="item-inner">
    <div class="item-title item-label" style="color:#2196F3"><b>Handphone</b></div>
    <div class="item-input-wrap">
    <input type="number" readonly="" class="inputKontakHandphonePelanggan1" id="inputHP`+counterInternal+`" placeholder="0812345">
    </div>
    </div>
    </div>

    <div class="item-content item-input">
    <div class="item-inner">
    <div class="item-title item-label" style="color:#2196F3"><b>Nomor WA</b></div>
    <div class="item-input-wrap">
    <input type="number" readonly="" class="inputKontakWaPelanggan1" id="inputWA`+counterInternal+`" placeholder="0812345">
    </div>
    </div>
    </div>

    <div class="item-content item-input">
    <div class="item-inner">
    <div class="item-title item-label" style="color:#2196F3"><b>Email</b></div>
    <div class="item-input-wrap">
    <input type="email" readonly="" class="inputKontakEmailPelanggan1" id = "inputEMAIL`+counterInternal+`" placeholder="sumber@blessingcom.com">
    </div>
    </div>
    </div>

    <div class="item-content item-input">
    <div class="item-inner">
    <div class="item-title item-label" style="color:#2196F3"><b>Tanggal Lahir</b></div>
    <div class="item-input-wrap">
    <input type="text" readonly="" class="inputKontakTanggalLahirPelanggan1" placeholder="Select date" readonly="readonly" id="inputTANGGALLAHIR`+counterInternal+`"/>
    </div>
    </div>
    </div>

    <div class="item-content item-input">
    <div class="item-inner">
    <div class="item-title item-label" style="color:#2196F3"><b>Keterangan</b></div>
    <div class="item-input-wrap">
    <input type="text" class="inputKontaKeteranganPelanggan1" id = "inputKETERANGAN`+counterInternal+`" placeholder="Keterangan">
    </div>
    </div>
    </div>
    </div>
    </div>
    </div>`;

    $$('.generateInternalSalesPenjualan').append(element);

    var calendarModal = myApp.calendar.create({
        inputEl: '#demo-calendar-modal'+counterInternal,
        openIn: 'customModal',
        header: true,
        footer: true,
        dateFormat: 'MM dd yyyy',
    });


    $$('.hapusDataInternalSalesPenjualan').on('click',function(){
        $$(this).closest('.card').remove()
    });

    $$('.popup-open-karyawanPelanggan').on('click',function(){
            //console.log($$(this).find('.counterInternalPelanggan').val());
            tampungCounterInternalPelanggan = $$(this).find('.counterInternalPelanggan').val();
            myApp.popup.open('.popup-karyawan');
        });
});


$$('.btnTambahPerusahaanSalesPelanggan').on('click',function(){
    counterPerusahaan++;
    element =`<div class="card">
    <div class="card-header" style="background-color:#2196F3;color:white">

    <span style="font-size:0.9em"><b>Sales</b></span>
    <a href="#" class="hapusDataInternalSalesPenjualan"><span style="font-size:0.9em;text-align: right"><i class="fas fa-window-close " style="color:white"></i></span></a>

    </div>
    <div class="card-content card-content-padding">
    <div class="list form-store-data" >
    <div class="item-content item-input">
    <div class="item-inner">
    <div class="item-title item-label" style="color:#2196F3"><b>Nama</b></div>
    <div class="item-input-wrap">
    <input type="text" class="inputKontakNamaPelanggan2" placeholder="Nama">
    </div>
    </div>
    </div>

    <div class="item-content item-input">
    <div class="item-inner">
    <div class="item-title item-label" style="color:#2196F3"><b>Jabatan</b></div>
    <div class="item-input-wrap">
    <input type="text" class="inputKontakJabatanPelanggan2" placeholder="Jabatan">
    </div>
    </div>
    </div>

    <div class="item-content item-input">
    <div class="item-inner">
    <div class="item-title item-label" style="color:#2196F3"><b>Handphone</b></div>
    <div class="item-input-wrap">
    <input type="number" class="inputKontakHandphonePelanggan2" placeholder="0812345">
    </div>
    </div>
    </div>

    <div class="item-content item-input">
    <div class="item-inner">
    <div class="item-title item-label" style="color:#2196F3"><b>Nomor WA</b></div>
    <div class="item-input-wrap">
    <input type="number" class="inputKontakWaPelanggan2" placeholder="0812345">
    </div>
    </div>
    </div>

    <div class="item-content item-input">
    <div class="item-inner">
    <div class="item-title item-label" style="color:#2196F3"><b>Email</b></div>
    <div class="item-input-wrap">
    <input type="email" class="inputKontakEmailPelanggan2" placeholder="sumber@blessingcom.com">
    </div>
    </div>
    </div>

    <div class="item-content item-input">
    <div class="item-inner">
    <div class="item-title item-label" style="color:#2196F3"><b>Tanggal Lahir</b></div>
    <div class="item-input-wrap">
    <input type="text" class="inputKontakTanggalLahirPelanggan2" placeholder="Select date" readonly="readonly" id="demo-calendar-perusahaan`+counterPerusahaan+`"/>
    </div>
    </div>
    </div>

    <div class="item-content item-input">
    <div class="item-inner">
    <div class="item-title item-label" style="color:#2196F3"><b>Keterangan</b></div>
    <div class="item-input-wrap">
    <input type="text" class="inputKontaKeteranganPelanggan2" placeholder="Keterangan">
    </div>
    </div>
    </div>
    </div>
    </div>
    </div>`;

    $$('.generatePerusahaanSalesPelanggan').append(element);

    var calendarModal = myApp.calendar.create({
        inputEl: '#demo-calendar-perusahaan'+counterPerusahaan,
        openIn: 'customModal',
        header: true,
        footer: true,
        dateFormat: 'MM dd yyyy',
    });


    $$('.hapusDataInternalSalesPenjualan').on('click',function(){
        $$(this).closest('.card').remove()
    });

    $$("input[type=text]").keyup(function(){
        $$(this).val( $$(this).val().toUpperCase() );
    });

    $$("input[type=email]").keyup(function(){
        $$(this).val( $$(this).val().toUpperCase() );
    });
});




});

var editKategoriPelanggan;
var editAreaPelanggan;
var editNpwpPajakPelanggan;
var editKtpPajakPelanggan;
var editNamaFakturPelanggan;
var editAlamatFakturPelanggan;
var editKodeKategoriPelanggan;

//detail_pelanggan
$$(document).on('page:init', '.page[data-name="detail_pelanggan"]', function (page) {

    if(halamanGlobal == "MASTER_RENCANA_KUNJUNGAN"){
        $$('.cardFotoKunjungan').remove();
    }
    myApp.preloader.show();
    $$('.backDetailPelanggan').on('click',function(){
        console.log(editHalamanPelanggan);
        if(editHalamanPelanggan == "MASTER_PELANGGAN"){
            mainView.router.navigate("/master_pelanggan/")
        } else if(editHalamanPelanggan == "MASTER_RENCANA_KUNJUNGAN"){
            mainView.router.navigate("/halaman_rencana_kunjungan/");
        } else if(editHalamanPelanggan == "MASTER_KUNJUNGAN") {
            mainView.router.navigate("/halaman_kunjungan/");
        } else if(editHalamanPelanggan == "MASTER_FOLLOWUP"){
            mainView.router.navigate("/halaman_follow_collector/");
        } else if(editHalamanPelanggan == "MASTER_COLLECTOR"){
            mainView.router.navigate("/halaman_follow_collector/");
        } else if(editHalamanPelanggan == "MASTER_KIRIMAN"){
            mainView.router.navigate("/halaman_follow_collector/");
        } else if(editHalamanPelanggan == "MASTER_LAPORAN"){
            mainView.router.navigate("/halaman_laporan/");
        }
    });

    
    if(!userHakAksesArrayGlobal["masterPelanggan"]){
    } else {
        if(userHakAksesArrayGlobal["masterPelanggan"]["POSTING"] == "F"){
            $$('.btnPostingPelanggan').remove();
        }

        if(userHakAksesArrayGlobal["masterPelanggan"]["HAPUS"] == "F"){
            $$('.btnHapusPelanggan').remove();
        }

        if(userHakAksesArrayGlobal["masterPelanggan"]["UBAH"] == "F"){
            $$('.editPelanggan').remove();
        }
    }

    if(!userHakAksesArrayGlobal["masterKunjungan"]){
    } else {
        if(userHakAksesArrayGlobal["masterKunjungan"]["UBAH"] == "F" && halamanGlobal =="MASTER_KUNJUNGAN"){
            $$('.editMasterTmKunjungan').remove();
        }
    }

    if(!userHakAksesArrayGlobal["masterFollowUp"] ){
    } else {
        if(userHakAksesArrayGlobal["masterFollowUp"]["UBAH"] == "F" && halamanGlobal == "MASTER_FOLLOWUP"){
            $$('.editMasterTmKunjungan').remove();
        }
    }

    if(!userHakAksesArrayGlobal["masterCollector"]){
    } else {
        if(userHakAksesArrayGlobal["masterCollector"]["UBAH"] == "F" && halamanGlobal == "MASTER_COLLECTOR"){
            $$('.editMasterTmKunjungan').remove();
        }
    }

    if(!userHakAksesArrayGlobal["masterKiriman"]){
    } else {
        if(userHakAksesArrayGlobal["masterKiriman"]["UBAH"] == "F" && halamanGlobal == "MASTER_KIRIMAN"){
            $$('.editMasterTmKunjungan').remove();
        }
    }

    if(!userHakAksesArrayGlobal["masterLaporan"]){
    } else {
        if(userHakAksesArrayGlobal["masterLaporan"]["UBAH"] == "F" && halamanGlobal == "MASTER_LAPORAN"){
            $$('.editMasterTmKunjungan').remove();
        }
    }

    $$('.editMasterTmKunjungan').on('click',function(){
        myApp.preloader.show();
        mainView.router.navigate("/edit_semua_kunjungan/");
        //mainView.router.navigate("/edit_semua_kunjungan/");
    });
    
    var act = "TAMPIL_SEMUA_LAPORAN_BERDASARKAN_PELANGGAN";
    var tampungLaporan = "";
    myApp.request.post(ipTujuan,{case:act,KODEPELANGGAN:editKodePelanggan},function(data){
        var hasil_json = JSON.parse(data);
        if(hasil_json.hasil == "ada"){
            tampungLaporan +="<ul>";
            for(var i = 0; i<hasil_json.DATETRANSACTION.length;i++){
                var today = new Date(hasil_json.DATETRANSACTION[i]);
                var day = today.getDate();
                var monthIndex = today.getMonth();
                var year = today.getFullYear();
                tampungLaporan +=`<li>
                <a href="#" onClick="klikListLaporanBerdasarkanPelanggan('`+hasil_json.DATETRANSACTION[i]+`')" class="item-link item-content">
                <div class="item-inner">
                <div class="item-title">`+day + ' ' + monthNames[monthIndex] + ' ' + year+`</div>
                <div class="item-after">`+hasil_json.JUMLAHKUNJUNGAN[i]+`</div>
                </div>
                </a>
                </li>`; 

            }
            tampungLaporan +="</ul>";
            $$('.tampilCardLaporanSalesman').html(tampungLaporan);

        } else {
            $$('.tampilCardLaporanSalesman').closest('.card').remove();
        }
    });

    
    


    if(editHalamanPelanggan == "MASTER_FOLLOWUP"){
        $$('.cardHeaderJudul').html("DETAIL FOLLOW UP");
    } else if(editHalamanPelanggan == "MASTER_COLLECTOR"){
        $$('.cardHeaderJudul').html("DETAIL COLLECTOR");
    } else if(editHalamanPelanggan == "MASTER_KIRIMAN"){
        $$('.cardHeaderJudul').html("DETAIL KIRIMAN");
    } else if(editHalamanPelanggan == "MASTER_LAPORAN"){
        var tampungUntukJudulCardDetailKunjungan = editNomorBuktiPelanggan;
        tampungUntukJudulCardDetailKunjungan = tampungUntukJudulCardDetailKunjungan.substr(0,2);
        if(tampungUntukJudulCardDetailKunjungan == "FA"){
            $$('.cardHeaderJudul').html("DETAIL FOLLOW UP");
        } else if(tampungUntukJudulCardDetailKunjungan == "KS"){
            $$('.cardHeaderJudul').html("DETAIL KUNJUNGAN");
        } else if(tampungUntukJudulCardDetailKunjungan == "FC"){
            $$('.cardHeaderJudul').html("DETAIL COLLECTOR");
        } else if(tampungUntukJudulCardDetailKunjungan == "PF"){
            $$('.cardHeaderJudul').html("DETAIL KIRIMAN");
        }
    }



    

    $$('.editPelanggan').on('click',function(){
        mainView.router.navigate("/edit_pelanggan/");
    });

    $$('.title').html(editNamaPelanggan);
    $$('.detailKodePelanggan').html(editKodePelanggan);
    $$('.detailNamaPelanggan').html(editNamaPelanggan);
    $$('.detailAlamatPelanggan').html(editAlamatPelanggan);
    $$('.detailKotaPelanggan').html(editKotaPelanggan);
    $$('.detailTelponPelanggan').html(editTeleponPelanggan);
    $$('.detailFaxPelanggan').html(editFaxPelanggan);
    $$('.detailKategoriPelanggan').html(editNamaKategoriPelanggan);
    //$$('.detailSalesmanPelanggan').html(editUserIdPelanggan);
    $$('.detailAlamatKirimPelanggan').html(editAlamatKirimPelanggan);

    


    var act = "DETAIL_PELANGGAN";
    myApp.request.post(ipTujuan,{case:act,KODEKATEGORIPELANGGAN:editNamaKategoriPelanggan, KODEPELANGGAN:editKodePelanggan,NOMORBUKTI:editNomorBuktiPelanggan},function(data){
        var hasil_json = JSON.parse(data);
        if( editHalamanPelanggan == "MASTER_LAPORAN" || editHalamanPelanggan == "MASTER_KIRIMAN" || editHalamanPelanggan =="MASTER_FOLLOWUP" || editHalamanPelanggan == "MASTER_COLLECTOR" || editHalamanPelanggan == "MASTER_RENCANA_KUNJUNGAN" || editHalamanPelanggan=="MASTER_KUNJUNGAN"){
            $$('.hidePostingPelanggan').html("");
            $$('.editPelanggan').remove();
        }

        var tampungDetailPengelolaInternal = "";
        editKategoriPelanggan = hasil_json.NAMA;
        editNamaFakturPelanggan = hasil_json.NAMAFAKTUR;
        editAlamatFakturPelanggan = hasil_json.ALAMATFAKTUR;
        editAreaPelanggan = hasil_json.KODEAREA;
        editNpwpPajakPelanggan = hasil_json.NPWP;
        editKtpPajakPelanggan = hasil_json.KTP;
        editKodeKategoriPelanggan = hasil_json.KODEKATEGORIPELANGGAN;

        $$('.detailKategoriPelanggan').html(hasil_json.NAMA);
        $$('.detailNamaFakturPelanggan').html(hasil_json.NAMAFAKTUR);
        $$('.detailAlamatFakturPelanggan').html(hasil_json.ALAMATFAKTUR);
        $$('.detailAreaPelanggan').html(hasil_json.KODEAREA);

        $$('.detailSyaratBayarCetakPelanggan').html(hasil_json.SYARATPIUTANG);
        $$('.detailTermPelanggan').html(hasil_json.TERM);
        $$('.detailSyaratBayarMaxPelanggan').html(hasil_json.SYARATPIUTANGMAX);
        $$('.detailKreditLimitPelanggan').html(hasil_json.KREDITLIMIT);
        if(hasil_json.VERGPS == "T"){
            $$('.detailVerifikasiPelanggan').html("SUDAH VERIFIKASI")
        } else {
            $$('.detailVerifikasiPelanggan').html("BELUM VERIFIKASI")
        }
        

        if(hasil_json.LATITUDE == null){ $$('.detailLatitudePelanggan').html("-"); } 
        else { $$(".detailLatitudePelanggan").html(hasil_json.LATITUDE); }

        if(hasil_json.LONGITUDE == null){ $$('.detailLongitudePelanggan').html("-"); } 
        else { $$(".detailLongitudePelanggan").html(hasil_json.LONGITUDE); }

        var element = `<a class="link external" href="http://maps.google.com/maps?saddr=${latGlobal},${lngGlobal}&daddr=${hasil_json.LATITUDE},${hasil_json.LONGITUDE}">Arah</a></a>`;
        $$("#rightDetailPelanggan").append(element);


        if(hasil_json.NPWP == null){ $$('.detailNpwpPelanggan').html("-"); } 
        else { $$(".detailNpwpPelanggan").html(hasil_json.NPWP); }

        if(hasil_json.KTP == null){ $$('.detailKtpPelanggan').html("-"); } 
        else { $$(".detailKtpPelanggan").html(hasil_json.KTP); }


        if(hasil_json.hasilkunjungan == "ada"){
            var today = new Date(hasil_json.TANGGALKUNJUNGAN);

            var monthNames = [
            "January", "February", "March",
            "April", "May", "June", "July",
            "August", "September", "October",
            "November", "December"
            ];

            var day = today.getDate();
            var monthIndex = today.getMonth();
            var year = today.getFullYear();
            $$('.detailTanggalKunjunganPelanggan').html(day + ' ' + monthNames[monthIndex] + ' ' + year);
            $$('.detailJamLoginKunjunganPelanggan').html(hasil_json.JAMMASUK);
            $$('.detailJamKunjunganPelanggan').html(hasil_json.JAMKUNJUNGAN);
            $$('.detailPermintaanKhususPelanggan').html(hasil_json.PERMINTAANKHUSUS);
            $$('.detailKodeSalesmanPelanggan').html(hasil_json.KODESALESMAN);
            
            if(hasil_json.KETERANGAN != "" ||  hasil_json.KETERANGAN != null){
                $$('.detailKeteranganPelanggan').html(hasil_json.KETERANGAN);
            }

            if(hasil_json.KESIMPULAN != "" || hasil_json.KESIMPULAN != null){
                $$('.detailKesimpulanPelanggan').html(hasil_json.KESIMPULAN);
            }


            var element_clipboard = `Tanggal : ${ConvertDateTimeToText(hasil_json.TANGGALKUNJUNGAN,'date')} ${hasil_json.JAMMASUK} - ${hasil_json.JAMKUNJUNGAN} \r\nPelanggan : ${editNamaPelanggan} \r\nKeterangan :  ${hasil_json.KETERANGAN} \r\nPermintaan Khusus : ${hasil_json.PERMINTAANKHUSUS}`;
            $$("#clipboard-keterangan-kunjungan").val(element_clipboard);


        } else {
            $$('.cardDetailKunjungan').remove();
        }
        tampungSourceGambar =[];
        if(hasil_json.hasilfotokunjungan == "ada"){
            for(var i = 0; i<hasil_json.NAMAGAMBAR.length;i++){
                var element = `<a href ="#" onClick="zoomInOutGambar('${editNomorBuktiPelanggan}','${i}')">
                <img src="`+ipGambarKunjungan+hasil_json.NAMAGAMBAR[i]+`.jpg?`+ new Date().getTime()+`" height="200" width="100%">
                </a>`;
                $$(".semuaFotoKunjungan").append(element);
            }

            var myPhotoBrowserDark = myApp.photoBrowser.create({
                photos : tampungSourceGambar,
                theme: 'dark'
            });
            $$('.pb-standalone-dark').on('click', function () {
                myPhotoBrowserDark.open();
            });
        } else {
            $$('.cardFotoKunjungan').remove();
        }


        /*if(hasil_json.hasil == "ada"){
            tampungDetailPengelolaInternal+=`<div class="card">
            <div class ="card-header cardHeaderBiru">Pengelola Internal</div>
            <div class="card-content card-content-padding ">`;

            for(var i = 0; i<hasil_json.CP1.length; i++){
                tampungDetailPengelolaInternal+=`
                <div class="row">
                <div class="col-45 cardContentDetail" >Nama</div>
                <div class="col-5 boldHitam"> : </div>
                <div class="col-50 cardContentHasilDetail ">`+hasil_json.CP1[i]+`</div>
                </div>

                <div class="row">
                <div class="col-45 cardContentDetail" >Jabatan</div>
                <div class="col-5 boldHitam"> : </div>
                <div class="col-50 cardContentHasilDetail ">`;
                if(hasil_json.KJ1[i]==""){
                    tampungDetailPengelolaInternal +=`-`;
                } else {
                    tampungDetailPengelolaInternal +=hasil_json.KJ1[i];
                }
                tampungDetailPengelolaInternal+=`</div>
                </div>


                <div class="row">
                <div class="col-45 cardContentDetail">Telepon</div>
                <div class="col-5 boldHitam"> : </div>
                <div class="col-50 cardContentHasilDetail ">`;
                if(hasil_json.HP1[i]==""){
                    tampungDetailPengelolaInternal +=`-`;
                } else {
                    tampungDetailPengelolaInternal +=hasil_json.HP1[i];
                }
                tampungDetailPengelolaInternal+=`</div>
                </div>

                <div class="row">
                <div class="col-45 cardContentDetail">WA</div>
                <div class="col-5 boldHitam"> : </div>
                <div class="col-50 cardContentHasilDetail ">`;
                if(hasil_json.WA1[i]==""){
                    tampungDetailPengelolaInternal +=`-`;
                } else {
                    tampungDetailPengelolaInternal +=hasil_json.WA1[i];
                }
                tampungDetailPengelolaInternal+=`</div>
                </div>

                <div class="row">
                <div class="col-45 cardContentDetail">Email</div>
                <div class="col-5 boldHitam"> : </div>
                <div class="col-50 cardContentHasilDetail ">`;
                if(hasil_json.EMAIL1[i]==""){
                    tampungDetailPengelolaInternal +=`-`;
                } else {
                    tampungDetailPengelolaInternal +=hasil_json.EMAIL1[i];
                }
                tampungDetailPengelolaInternal+=`</div>
                </div>

                <div class="row">
                <div class="col-45 cardContentDetail">Tanggal Lahir</div>
                <div class="col-5 boldHitam"> : </div>
                <div class="col-50 cardContentHasilDetail ">`;
                if(hasil_json.TANGGALLAHIR[i]=="" || hasil_json.TANGGALLAHIR[i] =="0000-00-00"){
                    tampungDetailPengelolaInternal +=`-`;
                } else {
                    tampungDetailPengelolaInternal +=hasil_json.TANGGALLAHIR[i];
                }
                tampungDetailPengelolaInternal+=`</div>
                </div>

                <div class="row">
                <div class="col-45 cardContentDetail">Keterangan</div>
                <div class="col-5 boldHitam"> : </div>
                <div class="col-50 cardContentHasilDetail ">`;
                if(hasil_json.KETERANGAN[i]==""){
                    tampungDetailPengelolaInternal +=`-`;
                } else {
                    tampungDetailPengelolaInternal +=hasil_json.KETERANGAN[i];
                }
                tampungDetailPengelolaInternal+=`</div>
                </div>
                <hr>`;
            }

            tampungDetailPengelolaInternal+=`</div>`;
            $$('.pengelolaInternal').html(tampungDetailPengelolaInternal);

        } else {
            $$('.pengelolaInternal').html("");
        }*/

        if(hasil_json.hasil == "ada"){
            tampungDetailPengelolaInternal+=`<div class="card">
            <div class="accordion-item"><a href="#" class="item-content item-link"><div class ="card-header cardHeaderBiru">Pengelola Internal</div></a>
            <div class="accordion-item-content">
            <div class="block">
            <div class="card-content">`;

            for(var i = 0; i<hasil_json.CP1.length; i++){
                tampungDetailPengelolaInternal+=`
                <div class="row">
                <div class="col-45 cardContentDetail" >Nama</div>
                <div class="col-5 boldHitam"> : </div>
                <div class="col-50 cardContentHasilDetail ">`+hasil_json.CP1[i]+`</div>
                </div>

                <div class="row">
                <div class="col-45 cardContentDetail" >Jabatan</div>
                <div class="col-5 boldHitam"> : </div>
                <div class="col-50 cardContentHasilDetail ">`;
                if(hasil_json.KJ1[i]==""){
                    tampungDetailPengelolaInternal +=`-`;
                } else {
                    tampungDetailPengelolaInternal +=hasil_json.KJ1[i];
                }
                tampungDetailPengelolaInternal+=`</div>
                </div>


                <div class="row">
                <div class="col-45 cardContentDetail">Telepon</div>
                <div class="col-5 boldHitam"> : </div>
                <div class="col-50 cardContentHasilDetail ">`;
                if(hasil_json.HP1[i]==""){
                    tampungDetailPengelolaInternal +=`-`;
                } else {
                    tampungDetailPengelolaInternal +=hasil_json.HP1[i];
                }
                tampungDetailPengelolaInternal+=`</div>
                </div>

                <div class="row">
                <div class="col-45 cardContentDetail">WA</div>
                <div class="col-5 boldHitam"> : </div>
                <div class="col-50 cardContentHasilDetail ">`;
                if(hasil_json.WA1[i]==""){
                    tampungDetailPengelolaInternal +=`-`;
                } else {
                    tampungDetailPengelolaInternal +=hasil_json.WA1[i];
                }
                tampungDetailPengelolaInternal+=`</div>
                </div>

                <div class="row">
                <div class="col-45 cardContentDetail">Email</div>
                <div class="col-5 boldHitam"> : </div>
                <div class="col-50 cardContentHasilDetail ">`;
                if(hasil_json.EMAIL1[i]==""){
                    tampungDetailPengelolaInternal +=`-`;
                } else {
                    tampungDetailPengelolaInternal +=hasil_json.EMAIL1[i];
                }
                tampungDetailPengelolaInternal+=`</div>
                </div>

                <div class="row">
                <div class="col-45 cardContentDetail">Tanggal Lahir</div>
                <div class="col-5 boldHitam"> : </div>
                <div class="col-50 cardContentHasilDetail ">`;
                if(hasil_json.TANGGALLAHIR[i]=="" || hasil_json.TANGGALLAHIR[i] =="0000-00-00"){
                    tampungDetailPengelolaInternal +=`-`;
                } else {
                    tampungDetailPengelolaInternal +=hasil_json.TANGGALLAHIR[i];
                }
                tampungDetailPengelolaInternal+=`</div>
                </div>

                <div class="row">
                <div class="col-45 cardContentDetail">Keterangan</div>
                <div class="col-5 boldHitam"> : </div>
                <div class="col-50 cardContentHasilDetail ">`;
                if(hasil_json.KETERANGAN[i]==""){
                    tampungDetailPengelolaInternal +=`-`;
                } else {
                    tampungDetailPengelolaInternal +=hasil_json.KETERANGAN[i];
                }
                tampungDetailPengelolaInternal+=`</div>
                </div>
                <hr>`;
            }

            tampungDetailPengelolaInternal+=`</div></div></div></div>`;
            $$('.pengelolaInternal').html(tampungDetailPengelolaInternal);

        } else {
            $$('.pengelolaInternal').html("");
        }

        //PENGELOLA PERUSAHAAN
        /*var tampungDetailPengelolaPerusahaan = "";
        if(hasil_json.hasil2 == "ada2"){
            tampungDetailPengelolaPerusahaan+=`<div class="card">
            <div class ="card-header cardHeaderBiru">Pengelola Perusahaan</div>
            <div class="card-content card-content-padding ">`;

            for(var i = 0; i<hasil_json.CP2.length; i++){
                tampungDetailPengelolaPerusahaan+=`
                <div class="row">
                <div class="col-45 cardContentDetail" >Nama</div>
                <div class="col-5 boldHitam"> : </div>
                <div class="col-50 cardContentHasilDetail ">`+hasil_json.CP2[i]+`</div>
                </div>

                <div class="row">
                <div class="col-45 cardContentDetail" >Jabatan</div>
                <div class="col-5 boldHitam"> : </div>
                <div class="col-50 cardContentHasilDetail ">`;
                if(hasil_json.KJ2[i]==""){
                    tampungDetailPengelolaPerusahaan +=`-`;
                } else {
                    tampungDetailPengelolaPerusahaan +=hasil_json.KJ2[i];
                }
                tampungDetailPengelolaPerusahaan+=`</div>
                </div>


                <div class="row">
                <div class="col-45 cardContentDetail">Telepon</div>
                <div class="col-5 boldHitam"> : </div>
                <div class="col-50 cardContentHasilDetail ">`;
                if(hasil_json.HP2[i]==""){
                    tampungDetailPengelolaPerusahaan +=`-`;
                } else {
                    tampungDetailPengelolaPerusahaan +=hasil_json.HP2[i];
                }
                tampungDetailPengelolaPerusahaan+=`</div>
                </div>

                <div class="row">
                <div class="col-45 cardContentDetail">WA</div>
                <div class="col-5 boldHitam"> : </div>
                <div class="col-50 cardContentHasilDetail ">`;
                if(hasil_json.WA2[i]==""){
                    tampungDetailPengelolaPerusahaan +=`-`;
                } else {
                    tampungDetailPengelolaPerusahaan +=hasil_json.WA2[i];
                }
                tampungDetailPengelolaPerusahaan+=`</div>
                </div>

                <div class="row">
                <div class="col-45 cardContentDetail">Email</div>
                <div class="col-5 boldHitam"> : </div>
                <div class="col-50 cardContentHasilDetail ">`;
                if(hasil_json.EMAIL2[i]==""){
                    tampungDetailPengelolaPerusahaan +=`-`;
                } else {
                    tampungDetailPengelolaPerusahaan +=hasil_json.EMAIL2[i];
                }
                tampungDetailPengelolaPerusahaan+=`</div>
                </div>

                <div class="row">
                <div class="col-45 cardContentDetail">Tanggal Lahir</div>
                <div class="col-5 boldHitam"> : </div>
                <div class="col-50 cardContentHasilDetail ">`;
                if(hasil_json.TANGGALLAHIR2[i]=="" || hasil_json.TANGGALLAHIR2[i] =="0000-00-00"){
                    tampungDetailPengelolaPerusahaan +=`-`;
                } else {
                    tampungDetailPengelolaPerusahaan +=hasil_json.TANGGALLAHIR2[i];
                }
                tampungDetailPengelolaPerusahaan+=`</div>
                </div>

                <div class="row">
                <div class="col-45 cardContentDetail">Keterangan</div>
                <div class="col-5 boldHitam"> : </div>
                <div class="col-50 cardContentHasilDetail ">`;
                if(hasil_json.KETERANGAN2[i]==""){
                    tampungDetailPengelolaPerusahaan +=`-`;
                } else {
                    tampungDetailPengelolaPerusahaan +=hasil_json.KETERANGAN2[i];
                }
                tampungDetailPengelolaPerusahaan+=`</div>
                </div>
                <hr>`;
            }

            tampungDetailPengelolaPerusahaan+=`</div>`;

            $$('.pengelolaPerusahaan').html(tampungDetailPengelolaPerusahaan);

        } else {
            $$('.pengelolaPerusahaan').html("");
        }*/

        var tampungDetailPengelolaPerusahaan = "";
        if(hasil_json.hasil2 == "ada2"){
            tampungDetailPengelolaPerusahaan+=`<div class="card">
            <div class="accordion-item"><a href="#" class="item-content item-link"><div class ="card-header cardHeaderBiru">Pengelola Perusahaan</div></a>
            <div class="accordion-item-content">
            <div class="block">
            <div class="card-content  ">`;

            for(var i = 0; i<hasil_json.CP2.length; i++){
                tampungDetailPengelolaPerusahaan+=`
                <div class="row">
                <div class="col-45 cardContentDetail" >Nama</div>
                <div class="col-5 boldHitam"> : </div>
                <div class="col-50 cardContentHasilDetail ">`+hasil_json.CP2[i]+`</div>
                </div>

                <div class="row">
                <div class="col-45 cardContentDetail" >Jabatan</div>
                <div class="col-5 boldHitam"> : </div>
                <div class="col-50 cardContentHasilDetail ">`;
                if(hasil_json.KJ2[i]==""){
                    tampungDetailPengelolaPerusahaan +=`-`;
                } else {
                    tampungDetailPengelolaPerusahaan +=hasil_json.KJ2[i];
                }
                tampungDetailPengelolaPerusahaan+=`</div>
                </div>


                <div class="row">
                <div class="col-45 cardContentDetail">Telepon</div>
                <div class="col-5 boldHitam"> : </div>
                <div class="col-50 cardContentHasilDetail ">`;
                if(hasil_json.HP2[i]==""){
                    tampungDetailPengelolaPerusahaan +=`-`;
                } else {
                    tampungDetailPengelolaPerusahaan +=hasil_json.HP2[i];
                }
                tampungDetailPengelolaPerusahaan+=`</div>
                </div>

                <div class="row">
                <div class="col-45 cardContentDetail">WA</div>
                <div class="col-5 boldHitam"> : </div>
                <div class="col-50 cardContentHasilDetail ">`;
                if(hasil_json.WA2[i]==""){
                    tampungDetailPengelolaPerusahaan +=`-`;
                } else {
                    tampungDetailPengelolaPerusahaan +=hasil_json.WA2[i];
                }
                tampungDetailPengelolaPerusahaan+=`</div>
                </div>

                <div class="row">
                <div class="col-45 cardContentDetail">Email</div>
                <div class="col-5 boldHitam"> : </div>
                <div class="col-50 cardContentHasilDetail ">`;
                if(hasil_json.EMAIL2[i]==""){
                    tampungDetailPengelolaPerusahaan +=`-`;
                } else {
                    tampungDetailPengelolaPerusahaan +=hasil_json.EMAIL2[i];
                }
                tampungDetailPengelolaPerusahaan+=`</div>
                </div>

                <div class="row">
                <div class="col-45 cardContentDetail">Tanggal Lahir</div>
                <div class="col-5 boldHitam"> : </div>
                <div class="col-50 cardContentHasilDetail ">`;
                if(hasil_json.TANGGALLAHIR2[i]=="" || hasil_json.TANGGALLAHIR2[i] =="0000-00-00"){
                    tampungDetailPengelolaPerusahaan +=`-`;
                } else {
                    tampungDetailPengelolaPerusahaan +=hasil_json.TANGGALLAHIR2[i];
                }
                tampungDetailPengelolaPerusahaan+=`</div>
                </div>

                <div class="row">
                <div class="col-45 cardContentDetail">Keterangan</div>
                <div class="col-5 boldHitam"> : </div>
                <div class="col-50 cardContentHasilDetail ">`;
                if(hasil_json.KETERANGAN2[i]==""){
                    tampungDetailPengelolaPerusahaan +=`-`;
                } else {
                    tampungDetailPengelolaPerusahaan +=hasil_json.KETERANGAN2[i];
                }
                tampungDetailPengelolaPerusahaan+=`</div>
                </div>
                <hr>`;
            }

            tampungDetailPengelolaPerusahaan+=`</div></div></div></div>`;

            $$('.pengelolaPerusahaan').html(tampungDetailPengelolaPerusahaan);

        } else {
            $$('.pengelolaPerusahaan').html("");
        }


        //DETAIL PELANGGAN GAMBAR TOKO
        var tampungSemuaFotoToko="";
        if(hasil_json.hasilfototoko == "ada"){
            for(var i = 0; i<hasil_json.GAMBARTOKO.length; i++){

                tampungSemuaFotoToko += `<img src="`+ipGambarTokoPelanggan+hasil_json.GAMBARTOKO[i]+`.jpg?`+ new Date().getTime()+`" height="200" width="100%">`;
            }
            $$('.semuaFotoToko').html(tampungSemuaFotoToko);
        } 

        if(hasil_json.hasilktp == "ada"){
            $$('.gambarKtp').html(`<img src="`+ipGambarKtpPelanggan+hasil_json.GAMBARKTP+`.jpg?`+ new Date().getTime()+`" height="200" width="100%">`);
        }

        if(hasil_json.hasilnpwp == "ada"){
            $$('.gambarNpwp').html(`<img src="`+ipGambarNpwpPelanggan+hasil_json.GAMBARNPWP+`.jpg?`+ new Date().getTime()+`" height="200" width="100%">`);
        }
        myApp.preloader.hide();

    });

$$('.btnPostingPelanggan').on('click',function(){
    myApp.preloader.show();
    var act = "POSTING_PELANGGAN";
    myApp.request.post(ipTujuan,{case:act,KODEPELANGGAN:editKodePelanggan,USERID:USERID},function(data){
        myApp.dialog.alert("Pelanggan Berhasil Diposting");
        //mainView.router.navigate("/master_pelanggan/");
        mainView.router.back("/master_pelanggan/",{force:true});
    });
});

$$('.btnHapusPelanggan').on('click',function(){
    var act = "HAPUS_PELANGGAN";
    myApp.request.post(ipTujuan,{case:act,KODEPELANGGAN:editKodePelanggan,USERID:USERID},function(data){
        myApp.dialog.alert("Pelanggan Berhasil Dihapus");
        mainView.router.back("/master_pelanggan/",{force:true});
        //mainView.router.navigate("/master_pelanggan/");
    });
});
});

//input_pelanggan
$$(document).on('page:init', '.page[data-name="input_pelanggan"]', function (page) {
    $$("input[type=text]").keyup(function(){
        $$(this).val( $$(this).val().toUpperCase() );
    });

    var counter = 1;

    var act = "SELECT_KATEGORI_PELANGGAN";
    myApp.request.post(ipTujuan,{case:act},function(data){
        var hasil_json = JSON.parse(data);
        var tampungKategoriPelanggan = "";

        for(var i =0;i<hasil_json.KODEKATEGORIPELANGGAN.length;i++){
            tampungKategoriPelanggan += `<option value="`+hasil_json.KODEKATEGORIPELANGGAN[i]+`">`+hasil_json.NAMA[i]+`</option>`;
        }

        $$('.inputKategoriPelanggan').html(tampungKategoriPelanggan);
    });


    $$('.popup-toko').on('popup:open', function (e, popup) {
        console.log('About popup open');
    });


    
    var searchbar3 = myApp.searchbar.create({
        el: '.searchKaryawan',
        searchContainer: '.list',
        searchIn: '.namaToko',
        on: {
            search(sb, query, previousQuery) {
                console.log(query, previousQuery);
            }
        }
    });


    var searchbar2 = myApp.searchbar.create({
        el: '.abc',
        searchContainer: '.list',
        searchIn: '.namaToko',
        on: {
            search(sb, query, previousQuery) {
                console.log(query, previousQuery);
            }
        }
    });

    $$('.btnCancel').on('click',function(){
        myApp.popup.close('.popup-toko');
        myApp.popup.close('.popup-karyawan');
    });

    $$('.hapusFotoToko').on('click',function(){
        var hapusId = $$(this).attr("id");
        var tampung = $$("#gambarFoto-"+hapusId).attr("src");
        if(tampung != null){
            $$(this).closest('.card').remove();
        }
    });


    $$('.ambilFotoToko-'+counter).on('click',function(){
        navigator.camera.getPicture(onSuccess,onFail,{
            quality:30,
            destinationType : Camera.DestinationType.FILE_URI,
            
            correctOrientation: true,
            sourceType : Camera.PictureSourceType.CAMERA,
            cameraDirection: Camera.Direction.BACK
        });

        function onSuccess(imageData) {
            var image = document.getElementById('gambarFoto-'+counter);
            image.src = imageData;
            counter++;

            element =`<div class="card">
            <div class="card-header row" style="background-color:#2196F3;color:white">
            <a href="#" class="ambilFotoToko-${counter} col-33 padding5"  >
            <i class="fa fa-camera  middleWhite"></i>
            </a>
            <a href="#" class="ambilFotoTokoGallery-${counter} col-33 padding5" id ="1">
            <i class="far fa-image  middleWhite" ></i>
            </a>
            <a href="#" class="hapusFotoToko col-33 padding5" id ="${counter}">
            <i class="fas fa-window-close  middleWhite" ></i>
            </a>
            </div>
            <div class="card-content card-content-padding">
            <img name ="fotoTokoPelanggan" id="gambarFoto-${counter}" height="150" width="100%">
            </div>
            </div>`;

            $$('.generateFotoToko').append(element);
            $$('.hapusFotoToko').on('click',function(){
                var hapusId = $$(this).attr("id");
                var tampung = $$("#gambarFoto-"+hapusId).attr("src");
                if(tampung != null){
                    $$(this).closest('.card').remove();
                }
            });

            $$('.ambilFotoToko-'+counter).on('click',function(){

                navigator.camera.getPicture(onSuccess,onFail,{
                    quality:30,
                    destinationType : Camera.DestinationType.FILE_URI,
                    
                    correctOrientation: true,
                    sourceType : Camera.PictureSourceType.CAMERA,
                    cameraDirection: Camera.Direction.BACK
                });
            });

            $$('.ambilFotoTokoGallery-'+counter).on('click',function(){
                navigator.camera.getPicture(onSuccess,onFail,{
                    quality:30,
                    destinationType : Camera.DestinationType.FILE_URI,
                    
                    correctOrientation: true,
                    sourceType : Camera.PictureSourceType.PHOTOLIBRARY,
                    cameraDirection: Camera.Direction.BACK
                });
            });
        }

        function onFail(message){
            myApp.alert('Failed because: ' +message);
        }
    });

    $$('.ambilFotoTokoGallery-'+counter).on('click',function(){
        navigator.camera.getPicture(onSuccess,onFail,{
            quality:30,
            destinationType : Camera.DestinationType.FILE_URI,
            
            correctOrientation: true,
            sourceType : Camera.PictureSourceType.PHOTOLIBRARY,
        });

        function onSuccess(imageData) {
            var image = document.getElementById('gambarFoto-'+counter);
            image.src = imageData;
            counter++;

            element =`<div class="card">
            <div class="card-header row" style="background-color:#2196F3;color:white">
            <a href="#" class="ambilFotoToko-${counter} col-33 padding5"  >
            <i class="fa fa-camera  middleWhite"></i>
            </a>
            <a href="#" class="ambilFotoTokoGallery-${counter} col-33 padding5" id ="1">
            <i class="far fa-image  middleWhite" ></i>
            </a>
            <a href="#" class="hapusFotoToko col-33 padding5" id ="${counter}">
            <i class="fas fa-window-close  middleWhite" ></i>
            </a>
            </div>
            <div class="card-content card-content-padding">
            <img name ="fotoTokoPelanggan" id="gambarFoto-${counter}" height="150" width="100%">
            </div>
            </div>`;

            $$('.generateFotoToko').append(element);
            $$('.hapusFotoToko').on('click',function(){
                var hapusId = $$(this).attr("id");
                var tampung = $$("#gambarFoto-"+hapusId).attr("src");
                if(tampung != null){
                    $$(this).closest('.card').remove();
                }
            });

            $$('.ambilFotoTokoGallery-'+counter).on('click',function(){
                navigator.camera.getPicture(onSuccess,onFail,{
                    quality:30,
                    destinationType : Camera.DestinationType.FILE_URI,
                    
                    correctOrientation: true,
                    sourceType : Camera.PictureSourceType.PHOTOLIBRARY,
                    cameraDirection: Camera.Direction.BACK
                });
            });

            $$('.ambilFotoToko-'+counter).on('click',function(){

                navigator.camera.getPicture(onSuccess,onFail,{
                    quality:30,
                    destinationType : Camera.DestinationType.FILE_URI,
                    
                    correctOrientation: true,
                    sourceType : Camera.PictureSourceType.CAMERA,
                    cameraDirection: Camera.Direction.BACK
                });
            });
        }

        function onFail(message){
            myApp.alert('Failed because: ' +message);
        }
    });

    $$('.btnTambahData').on('click',function(){
        element = `<div class="card">
        <div class="card-header" style="background-color:#2196F3;color:white">

        <span style="font-size:0.9em"><b>Kontak Pengiriman</b></span>
        <a href="#" class="hapusDataPengelola"><span style="font-size:0.9em;text-align: right"><i class="fas fa-window-close " style="color:white"></i></span></a>

        </div>
        <div class="card-content card-content-padding">
        <div class="list form-store-data" >
        <div class="item-content item-input">
        <div class="item-inner">
        <div class="item-title item-label" style="color:#2196F3"><b>Nama</b></div>
        <div class="item-input-wrap">
        <input type="text" class="namaPelanggan" placeholder="Nama">
        </div>
        </div>
        </div>

        <div class="item-content item-input">
        <div class="item-inner">
        <div class="item-title item-label" style="color:#2196F3"><b>Jabatan</b></div>
        <div class="item-input-wrap">
        <input type="text" class="namaPelanggan" placeholder="Supervisor">
        </div>
        </div>
        </div>

        <div class="item-content item-input">
        <div class="item-inner">
        <div class="item-title item-label" style="color:#2196F3"><b>No Telepon</b></div>
        <div class="item-input-wrap">
        <input type="number" class="namaPelanggan" placeholder="021">
        </div>
        </div>
        </div>

        <div class="item-content item-input">
        <div class="item-inner">
        <div class="item-title item-label" style="color:#2196F3"><b>Handphone</b></div>
        <div class="item-input-wrap">
        <input type="number" class="namaPelanggan" placeholder="0821">
        </div>
        </div>
        </div>


        </div>
        </div>
        </div>`;

        $$('.generateTambahData').append(element);
        $$('.hapusDataPengelola').on('click',function(){
            $$(this).closest('.card').remove()
        });

    });

    $$('.btnTambahDetailPenjualan').on('click',function(){
        element = `<div class="card">
        <div class="card-header" style="background-color:#2196F3;color:white">

        <span style="font-size:0.9em"><b>Kontak Penjualan</b></span>
        <a href="#" class="hapusDataKontakPenjualan"><span style="font-size:0.9em;text-align: right"><i class="fas fa-window-close " style="color:white"></i></span></a>

        </div>
        <div class="card-content card-content-padding">
        <div class="list form-store-data" >
        <div class="item-content item-input">
        <div class="item-inner">
        <div class="item-title item-label" style="color:#2196F3"><b>Nama</b></div>
        <div class="item-input-wrap">
        <input type="text" class="namaPelanggan" placeholder="Nama">
        </div>
        </div>
        </div>

        <div class="item-content item-input">
        <div class="item-inner">
        <div class="item-title item-label" style="color:#2196F3"><b>Jabatan</b></div>
        <div class="item-input-wrap">
        <input type="text" class="namaPelanggan" placeholder="Supervisor">
        </div>
        </div>
        </div>

        <div class="item-content item-input">
        <div class="item-inner">
        <div class="item-title item-label" style="color:#2196F3"><b>No Telepon</b></div>
        <div class="item-input-wrap">
        <input type="number" class="namaPelanggan" placeholder="021">
        </div>
        </div>
        </div>

        <div class="item-content item-input">
        <div class="item-inner">
        <div class="item-title item-label" style="color:#2196F3"><b>Handphone</b></div>
        <div class="item-input-wrap">
        <input type="number" class="namaPelanggan" placeholder="0821">
        </div>
        </div>
        </div>


        </div>
        </div>



        </div>
        </div>`;
        $$('.generateDetailPenjualan').append(element);
        $$('.hapusDataKontakPenjualan').on('click',function(){
            $$(this).closest('.card').remove()
        });

    });


    var act = "TAMPIL_POPUP_KARYAWAN_PELANGGAN";
    myApp.request.post(ipTujuan,{case:act,KODECABANG:KODECABANG,USERID:USERID},function(data){
        var hasil_json = JSON.parse(data);
        var tampungPopUpKaryawan ="Tidak Memiliki Karyawan Internal";
        if(hasil_json.hasil == "ada"){
            tampungPopUpKaryawan = "";
            for(var i = 0; i<hasil_json.KODEKARYAWAN.length;i++){
                tampungPopUpKaryawan += `<li>
                <a href="#" class="item-link item-content cobaKlik" onClick="pilihKaryawanPelanggan('`+hasil_json.KODEKARYAWAN[i]+`','`+hasil_json.NAMA[i]+`','`+hasil_json.NAMAJABATAN[i]+`',
                '`+hasil_json.KODEJABATAN[i]+`','`+hasil_json.TELEPON[i]+`','`+hasil_json.WA1[i]+`','`+hasil_json.EMAIL1[i]+`','`+hasil_json.TANGGALLAHIR[i]+`')">
                <div class="item-inner">
                <div class="item-text namaToko" style="color:black">`+hasil_json.NAMA[i]+`</div>
                </div>
                </a>
                </li>`;
            }
            $$('.listPopUpNamaKaryawan').html(tampungPopUpKaryawan);
        } else {
            $$('.listPopUpNamaKaryawan').html(tampungPopUpKaryawan);
        }
    });

    var counterInternal = 1;

    $$('.btnTambahInternalSalesPenjualan').on('click',function(){
        element =`<div class="card">
        <div class="card-header" style="background-color:#2196F3;color:white">

        <span style="font-size:0.9em"><b>Sales</b></span>
        <a href="#" class="hapusDataInternalSalesPenjualan"><span style="font-size:0.9em;text-align: right"><i class="fas fa-window-close " style="color:white"></i></span></a>

        </div>
        <div class="card-content card-content-padding">
        <div class="list form-store-data" >
        <div class="item-content item-input">
        <div class="item-inner">
        <div class="item-title item-label" style="color:#2196F3"><b>Nama</b></div>
        <div class="item-input-wrap">

        <a href="#" class="popup-open-karyawanPelanggan">

        <input type="hidden" class="counterInternalPelanggan"  value = "`+counterInternal+`" id="`+counterInternal+`">
        <input type="hidden" class="inputKontakNamaPelanggan1"  id="inputCP`+counterInternal+`">
        <input type="text" readonly="" class="inputKontakCPelanggan1"  id="inputCPpalsu`+counterInternal+`" placeholder="Nama">
        </a>

        </div>
        </div>
        </div>

        <div class="item-content item-input">
        <div class="item-inner">
        <div class="item-title item-label" style="color:#2196F3"><b>Jabatan</b></div>
        <div class="item-input-wrap">
        <input type="hidden" class="inputKontakJabatanPelanggan1"  id="inputKJ`+counterInternal+`">
        <input type="text"  readonly="" id ="inputKJpalsu`+counterInternal+`" placeholder="Jabatan">
        </div>
        </div>
        </div>

        <div class="item-content item-input">
        <div class="item-inner">
        <div class="item-title item-label" style="color:#2196F3"><b>Handphone</b></div>
        <div class="item-input-wrap">
        <input type="number" readonly="" class="inputKontakHandphonePelanggan1" id="inputHP`+counterInternal+`" placeholder="0812345">
        </div>
        </div>
        </div>

        <div class="item-content item-input">
        <div class="item-inner">
        <div class="item-title item-label" style="color:#2196F3"><b>Nomor WA</b></div>
        <div class="item-input-wrap">
        <input type="number" readonly="" class="inputKontakWaPelanggan1" id="inputWA`+counterInternal+`" placeholder="0812345">
        </div>
        </div>
        </div>

        <div class="item-content item-input">
        <div class="item-inner">
        <div class="item-title item-label" style="color:#2196F3"><b>Email</b></div>
        <div class="item-input-wrap">
        <input type="email" readonly="" class="inputKontakEmailPelanggan1" id = "inputEMAIL`+counterInternal+`" placeholder="sumber@blessingcom.com">
        </div>
        </div>
        </div>

        <div class="item-content item-input">
        <div class="item-inner">
        <div class="item-title item-label" style="color:#2196F3"><b>Tanggal Lahir</b></div>
        <div class="item-input-wrap">
        <input type="text" readonly="" class="inputKontakTanggalLahirPelanggan1" placeholder="Select date" readonly="readonly" id="inputTANGGALLAHIR`+counterInternal+`"/>
        </div>
        </div>
        </div>

        <div class="item-content item-input">
        <div class="item-inner">
        <div class="item-title item-label" style="color:#2196F3"><b>Keterangan</b></div>
        <div class="item-input-wrap">
        <input type="text" class="inputKontaKeteranganPelanggan1" id = "inputKETERANGAN`+counterInternal+`" placeholder="Keterangan">
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>`;

        $$('.generateInternalSalesPenjualan').append(element);

        $$('.popup-open-karyawanPelanggan').on('click',function(){
            tampungCounterInternalPelanggan = $$(this).find('.counterInternalPelanggan').val();
            myApp.popup.open('.popup-karyawan');
        });
        

        var calendarModal = myApp.calendar.create({
            inputEl: '#demo-calendar-modal'+counterInternal,
            openIn: 'customModal',
            header: true,
            footer: true,
            dateFormat: 'MM dd yyyy',
        });


        $$('.hapusDataInternalSalesPenjualan').on('click',function(){
            $$(this).closest('.card').remove()
        });
        counterInternal++;

    });




var counterPerusahaan = 1;

$$('.btnTambahPerusahaanSalesPelanggan').on('click',function(){
    element =`<div class="card">
    <div class="card-header" style="background-color:#2196F3;color:white">

    <span style="font-size:0.9em"><b>Pengelola</b></span>
    <a href="#" class="hapusDataInternalSalesPenjualan"><span style="font-size:0.9em;text-align: right"><i class="fas fa-window-close " style="color:white"></i></span></a>

    </div>
    <div class="card-content card-content-padding">
    <div class="list form-store-data" >
    <div class="item-content item-input">
    <div class="item-inner">
    <div class="item-title item-label" style="color:#2196F3"><b>Nama</b></div>
    <div class="item-input-wrap">
    <input type="text" class="inputKontakNamaPelanggan2" placeholder="Nama">
    </div>
    </div>
    </div>

    <div class="item-content item-input">
    <div class="item-inner">
    <div class="item-title item-label" style="color:#2196F3"><b>Jabatan</b></div>
    <div class="item-input-wrap">
    <input type="text" class="inputKontakJabatanPelanggan2" placeholder="Jabatan">
    </div>
    </div>
    </div>

    <div class="item-content item-input">
    <div class="item-inner">
    <div class="item-title item-label" style="color:#2196F3"><b>Handphone</b></div>
    <div class="item-input-wrap">
    <input type="number" class="inputKontakHandphonePelanggan2" placeholder="0812345">
    </div>
    </div>
    </div>

    <div class="item-content item-input">
    <div class="item-inner">
    <div class="item-title item-label" style="color:#2196F3"><b>Nomor WA</b></div>
    <div class="item-input-wrap">
    <input type="number" class="inputKontakWaPelanggan2" placeholder="0812345">
    </div>
    </div>
    </div>

    <div class="item-content item-input">
    <div class="item-inner">
    <div class="item-title item-label" style="color:#2196F3"><b>Email</b></div>
    <div class="item-input-wrap">
    <input type="email" class="inputKontakEmailPelanggan2" placeholder="sumber@blessingcom.com">
    </div>
    </div>
    </div>

    <div class="item-content item-input">
    <div class="item-inner">
    <div class="item-title item-label" style="color:#2196F3"><b>Tanggal Lahir</b></div>
    <div class="item-input-wrap">
    <input type="text" class="inputKontakTanggalLahirPelanggan2" placeholder="Select date" readonly="readonly" id="demo-calendar-perusahaan`+counterPerusahaan+`"/>
    </div>
    </div>
    </div>

    <div class="item-content item-input">
    <div class="item-inner">
    <div class="item-title item-label" style="color:#2196F3"><b>Keterangan</b></div>
    <div class="item-input-wrap">
    <input type="text" class="inputKontaKeteranganPelanggan2" placeholder="Keterangan">
    </div>
    </div>
    </div>
    </div>
    </div>
    </div>`;

    $$('.generatePerusahaanSalesPelanggan').append(element);

    var calendarModal = myApp.calendar.create({
        inputEl: '#demo-calendar-perusahaan'+counterPerusahaan,
        openIn: 'customModal',
        header: true,
        footer: true,
        dateFormat: 'MM dd yyyy',
    });


    $$('.hapusDataInternalSalesPenjualan').on('click',function(){
        $$(this).closest('.card').remove()
    });
    counterPerusahaan++;
    $$("input[type=text]").keyup(function(){
        $$(this).val( $$(this).val().toUpperCase() );
    });

    $$("input[type=email]").keyup(function(){
        $$(this).val( $$(this).val().toUpperCase() );
    });

});



$$('.ambilFotoToko-'+counter).on('click',function(){
    $$(this).closest('.gambarFoto').find('src').val("asd");
    var url = $$(this).closest('.gambarFoto').attr("src");
    console.log(url);
});


$$('.btnBatalInputPelanggan').on('click',function(){
    mainView.router.navigate("/master_pelanggan/");
});

        //buka kamera KTP
        $$('.bukaKameraKtpDetailPajak').on('click',function(page){
            navigator.camera.getPicture(onSuccess,onFail,{
                quality:30,
                destinationType : Camera.DestinationType.FILE_URI,
                
                correctOrientation: true,
                sourceType : Camera.PictureSourceType.CAMERA,
                cameraDirection: Camera.Direction.BACK
            });

            function onSuccess(imageData){
                var image = document.getElementById('gambarKameraKtpDetailPajak');
                image.src = imageData;
            }

            function onFail(message){
                myApp.alert('Failed because: ' +message);
            }

        });

        //buka kamera NPWP
        $$('.bukaKameraNpwpDetailPajak').on('click',function(page){
            navigator.camera.getPicture(onSuccess,onFail,{
                quality:30,
                destinationType : Camera.DestinationType.FILE_URI,
                
                correctOrientation: true,
                sourceType : Camera.PictureSourceType.CAMERA,
                cameraDirection: Camera.Direction.BACK
            });

            function onSuccess(imageData){
                var image = document.getElementById('gambarKameraNpwpDetailPajak');
                image.src = imageData;
            }

            function onFail(message){
                myApp.alert('Failed because: ' +message);
            }

        });


        $$('.btnSimpanInputPelanggan').on('click',function(){
            myApp.preloader.show();
            var act = "INPUT_PELANGGAN";
            var KODEPELANGGAN = $$('.inputKodePelanggan').val();
            var NAMA = $$('.inputNamaPelanggan').val();
            var ALAMAT = $$('.inputAlamatPelanggan').val();
            var KOTA = $$('.inputKotaPelanggan').val();
            var TELPON = $$('.inputTelponPelanggan').val();
            var FAX = $$('.inputFaxPelanggan').val();
            var KREDITLIMIT = $$('.inputKreditLimitInternalPelanggan').val();
            var SYARATPIUTANG = $$('.inputSyaratBayarCetakInternalPelanggan').val();
            var SYARATPIUTANGMAX = $$('.inputSyaratBayarMaxInternalPelanggan').val();
            var TERM = $$('.inputTermInternalPelanggan').val();
            var ALAMATKIRIM = $$('.inputAlamatKirimPelanggan').val();
            var KATEGORIPELANGGAN = $$('.inputKategoriPelanggan').val();
            var KODEAREA = $$('.inputAreaPelanggan').val();
            var NPWP = $$('.inputNpwpPajakPelanggan').val();
            var KTP = $$('.inputKtpPajakPelanggan').val();
            var NAMAFAKTUR = $$('.inputNamaFakturPelanggan').val();
            var ALAMATFAKTUR = $$('.inputAlamatFakturPelanggan').val();
            var GAMBARNPWP = $$('#gambarKameraNpwpDetailPajak').attr("src");
            var GAMBARKTP = $$('#gambarKameraKtpDetailPajak').attr("src");

            var fotoToko= [];
            //$$("#foto-ktp").attr("src");

            $$('img[name^="fotoTokoPelanggan"]').each(function() {
                if($$(this).attr("src") !=null){
                    fotoToko.push($$(this).attr("src"));
                }
            });

            

            //dpelanggan1
            var CP1 = [];
            var KJ1 = [];
            var HP1 = [];
            var WA1 = [];
            var EMAIL1 = [];
            var TANGGALLAHIR1 = [];
            var KETERANGAN1 = [];

            //dpelanggan2
            var CP2 = [];
            var KJ2 = [];
            var HP2 = [];
            var WA2 = [];
            var EMAIL2 = [];
            var TANGGALLAHIR2 = [];
            var KETERANGAN2 = [];

            //dpelanggan1
            $$('input[class^="inputKontakNamaPelanggan1"]').each(function() {
                CP1.push($$(this).val());
            });

            $$('input[class^="inputKontakJabatanPelanggan1"]').each(function() {
                KJ1.push($$(this).val());
            });

            $$('input[class^="inputKontakHandphonePelanggan1"]').each(function() {
                HP1.push($$(this).val());
            });

            $$('input[class^="inputKontakWaPelanggan1"]').each(function() {
                WA1.push($$(this).val());
            });

            $$('input[class^="inputKontakEmailPelanggan1"]').each(function() {
                EMAIL1.push($$(this).val());
            });

            $$('input[class^="inputKontakTanggalLahirPelanggan1"]').each(function() {
                TANGGALLAHIR1.push($$(this).val());
            });

            $$('input[class^="inputKontaKeteranganPelanggan1"]').each(function() {
                KETERANGAN1.push($$(this).val());
            });

            //dpelanggan2
            $$('input[class^="inputKontakNamaPelanggan2"]').each(function() {
                CP2.push($$(this).val());
            });

            $$('input[class^="inputKontakJabatanPelanggan2"]').each(function() {
                KJ2.push($$(this).val());
            });

            $$('input[class^="inputKontakHandphonePelanggan2"]').each(function() {
                HP2.push($$(this).val());
            });

            $$('input[class^="inputKontakWaPelanggan2"]').each(function() {
                WA2.push($$(this).val());
            });

            $$('input[class^="inputKontakEmailPelanggan2"]').each(function() {
                EMAIL2.push($$(this).val());
            });

            $$('input[class^="inputKontakTanggalLahirPelanggan2"]').each(function() {
                TANGGALLAHIR2.push($$(this).val());
            });

            $$('input[class^="inputKontaKeteranganPelanggan2"]').each(function() {
                KETERANGAN2.push($$(this).val());
            });

            
            if(!KODEPELANGGAN){
                myApp.dialog.alert("Kode Pelanggan Harus Diisi");
                myApp.preloader.hide();
            } else if(!NAMA){
                myApp.preloader.hide();
                myApp.dialog.alert("Nama Harus Diisi");
            } else if(!ALAMAT){
                myApp.preloader.hide();
                myApp.dialog.alert("Alamat Harus Diisi");
            }  else if(!KOTA){
                myApp.preloader.hide();
                myApp.dialog.alert("Kota Harus Diisi");
            } else if(!KODEAREA){
                myApp.preloader.hide();
                myApp.dialog.alert("Kodea Area Harus Diisi");
            } else if(!TELPON){
                myApp.preloader.hide();
                myApp.dialog.alert("Telepon Harus Diisi");
            } else if(!FAX){
                myApp.preloader.hide();
                myApp.dialog.alert("Fax Harus Diisi");
            } else if(!KATEGORIPELANGGAN){
                myApp.preloader.hide();
                myApp.dialog.alert("Kategori Pelanggan Harus Diisi");
            } /*else if(!KREDITLIMIT){
                myApp.preloader.hide();
                myApp.dialog.alert("Kredit Limit Harus Diisi");
            } else if(!SYARATPIUTANG){
                myApp.preloader.hide();
                myApp.dialog.alert("Syarat Bayar Cetak Harus Diisi");
            } else if(!SYARATPIUTANGMAX){
                myApp.preloader.hide();
                myApp.dialog.alert("Syarat Bayar Max Harus Diisi");
            } else if(!TERM){
                myApp.preloader.hide();
                myApp.dialog.alert("Term Harus Diisi");
            } else if(!ALAMATKIRIM){
                myApp.preloader.hide();
                myApp.dialog.alert("Alamat Kirim Harus Diisi");
            } */ /* else if(!NPWP){
                myApp.preloader.hide();
                myApp.dialog.alert("NPWP Harus Diisi");
            } else if(!GAMBARNPWP && !GAMBARKTP){
                myApp.preloader.hide();
                myApp.dialog.alert("Gambar NPWP atau KTP Harus Diisi");
            } *//*else if(fotoToko.length==0){
                myApp.dialog.alert("Foto Toko Harus Diisi");
                myApp.preloader.hide();
            }*/ else {
                myApp.request.post(ipTujuan,{case:act,KODECABANG:KODECABANG,KODEPELANGGAN:KODEPELANGGAN, NAMA:NAMA, ALAMAT:ALAMAT, KOTA:KOTA, TELPON:TELPON,
                    FAX:FAX, KREDITLIMIT:KREDITLIMIT, SYARATPIUTANG:SYARATPIUTANG, SYARATPIUTANGMAX:SYARATPIUTANGMAX, TERM:TERM,
                    ALAMATKIRIM:ALAMATKIRIM,KATEGORIPELANGGAN:KATEGORIPELANGGAN, USERID:USERID, CP1:CP1, KJ1:KJ1, HP1:HP1, WA1:WA1, EMAIL1:EMAIL1,
                    TANGGALLAHIR1:TANGGALLAHIR1, KETERANGAN1:KETERANGAN1,KODEAREA:KODEAREA,NPWP:NPWP,KTP:KTP,NAMAFAKTUR:NAMAFAKTUR,ALAMATFAKTUR:ALAMATFAKTUR,
                    CP2:CP2, KJ2:KJ2, HP2:HP2,WA2:WA2, EMAIL2:EMAIL2,TANGGALLAHIR2:TANGGALLAHIR2, KETERANGAN2:KETERANGAN2,fotoToko:fotoToko,
                    GAMBARKTP:GAMBARKTP,GAMBARNPWP:GAMBARNPWP},function(data){
                        var hasil_json = JSON.parse(data);

                        if(hasil_json.hasil == "tidakada"){

                            if(fotoToko.length>0){


                            //UPLOAD FOTO TOKO
                            for(var i =0; i<fotoToko.length;i++){
                               var toko = new FileUploadOptions();
                               toko.fileKey = "photo";
                               toko.fileName = fotoToko[i].substr(fotoToko[i].lastIndexOf('/') + 1);
                               toko.mimeType = "image/jpeg";
                               toko.chunkedMode = false;
                               toko.headers = {
                                  Connection: "close"
                              };
                              toko.params = {
                                namaFile:KODEPELANGGAN +"_"+i+"_toko"
                            }
                            var ft = new FileTransfer();
                            ft.upload(fotoToko[i], 
                              encodeURI(ipUploadTokoPelanggan),
                              win,
                              fail,
                              toko);

                            var win = function(r) {
                                console.log("Should not be called.");
                            }

                            var fail = function(error) {
                                alert("An error has occurred: Code = " + error.code);
                                console.log("upload error source " + error.source);
                                console.log("upload error target " + error.target);
                            }
                        }
                    }

                //END UPLOAD FOTO TOKO

                //START UPLOAD FOTO KTP PELANGGAN
                if(GAMBARKTP){
                 var ktp = new FileUploadOptions();
                 ktp.fileKey = "photo";
                 ktp.fileName = GAMBARKTP.substr(GAMBARKTP.lastIndexOf('/') + 1);
                 ktp.mimeType = "image/jpeg";
                 ktp.chunkedMode = false;
                 ktp.headers = {
                  Connection: "close"
              };
              ktp.params = {
                namaFile:KODEPELANGGAN+"_"+"ktp"
            }

            var ft = new FileTransfer();
            ft.upload(GAMBARKTP, 
              encodeURI(ipUploadKtpPelanggan),
              win,
              fail,
              ktp);

            var win = function(r) {
                console.log("Should not be called.");
            }

            var fail = function(error) {
                    // error.code == FileTransferError.ABORT_ERR
                    alert("An error has occurred: Code = " + error.code);
                    console.log("upload error source " + error.source);
                    console.log("upload error target " + error.target);
                }
            }

                //END UPLOAD KTP PELANGGAN


                //START UPLOAD NPWP PELANGGAN
                if(GAMBARNPWP){
                    var npwp = new FileUploadOptions();
                    npwp.fileKey = "photo";
                    npwp.fileName = GAMBARNPWP.substr(GAMBARNPWP.lastIndexOf('/') + 1);
                    npwp.mimeType = "image/jpeg";
                    npwp.chunkedMode = false;
                    npwp.headers = {
                      Connection: "close"
                  };
                  npwp.params = {
                    namaFile:KODEPELANGGAN+"_"+"npwp"
                }

                var ft = new FileTransfer();
                ft.upload(GAMBARNPWP, 
                  encodeURI(ipUploadNpwpPelanggan),
                  win,
                  fail,
                  npwp);

                var win = function(r) {
                    console.log("Should not be called.");
                }

                var fail = function(error) {
                    // error.code == FileTransferError.ABORT_ERR
                    alert("An error has occurred: Code = " + error.code);
                    console.log("upload error source " + error.source);
                    console.log("upload error target " + error.target);
                }
            }
                //END UPLOAD FOTO NPWP

                myApp.preloader.hide();
                myApp.dialog.alert("Pelanggan Berhasil Diinput");
                //mainView.router.navigate("/master_pelanggan/");
                mainView.router.back("/master_pelanggan/",{force:true});
            } else if(hasil_json.hasil == "ada"){
                myApp.dialog.alert("Kode Pelanggan Sudah Terpakai");

                myApp.preloader.hide();
            } else if(hasil_json.hasil == "npwpterdaftar"){
                myApp.dialog.alert("NPWP Sudah Pernah Terdaftar");

                myApp.preloader.hide();
            } else {
                myApp.dialog.alert("ERROR");

                myApp.preloader.hide();
            }
        });
} 
}); 

});

//edit_semua_kunjungan
$$(document).on('page:init', '.page[data-name="edit_semua_kunjungan"]', function (page) {
    var act = "TAMPIL_EDIT_SEMUA_KUNJUNGAN";
    var counter = 0;
    var counterHapus = "tidak";
    var gambarHapus =[];
    myApp.request.post(ipTujuan,{case:act,NOMORBUKTI:editNomorBuktiPelanggan},function(data){
        myApp.preloader.show();
        var hasil_json = JSON.parse(data);
        var tampungPermintaanKhusus = "";
        for(var i = 0; i<hasil_json.NAMA.length; i++){
            if(hasil_json.PERMINTAANKHUSUS == hasil_json.NAMA[i]){
                tampungPermintaanKhusus += `<option value="`+hasil_json.NAMA[i]+`" selected>`+hasil_json.NAMA[i]+`</option>`;
            } else {
                tampungPermintaanKhusus += `<option value="`+hasil_json.NAMA[i]+`">`+hasil_json.NAMA[i]+`</option>`;
            }
        }
        $$('.editPermintaanKhususKunjungan').html(tampungPermintaanKhusus);
        $$('.editKesimpulanKunjungan').html(hasil_json.KESIMPULAN);
        $$('.editKeteranganKunjungan').val(hasil_json.KETERANGAN);
        myApp.preloader.hide();

        
        if(hasil_json.hasilgambarkunjungan == "ada"){
            var tampungGambarKunjungan = "";
            for(var i = 0;i<hasil_json.NAMAGAMBAR.length;i++){
                counter=hasil_json.counter[i];
                tampungGambarKunjungan +=`<div class="card">
                <div class="card-header row" style="background-color:#2196F3;color:white">
                <div class="col padding5">
                <a href="#" class="hapusFotoKunjungan col-50 padding5" id ="${counter}">
                <i class="fas fa-window-close  middleWhite" ></i>
                </a>
                </div>
                </div>
                <div class="card-content card-content-padding">
                <img src="`+ipGambarKunjungan+hasil_json.NAMAGAMBAR[i]+`.jpg?`+ new Date().getTime()+`" id="foto-kunjungan-${counter}" class="${counter}" height="150" width="100%">
                </div>
                </div>`;
            }
            $$('.spanFotoSemuaKunjunganAda').html(tampungGambarKunjungan);
            $$('.hapusFotoKunjungan').on('click',function(){

                var hapusId = $$(this).attr("id");
                var tampung = $$("#foto-kunjungan-"+hapusId).attr("src");

                if(tampung != null){
                    gambarHapus.push(hapusId);
                    $$(this).closest('.card').remove();
                }
            });

            counter++;
            $$('.spanFotoKunjungan').html(`
                <div class="card">
                <div class="card-header row" style="background-color:#2196F3;color:white">
                <div class="col padding5">
                <a href="#" onClick="editAmbilFotoKunjungan('${counter}')" class="ambilFotoKunjungan">
                <i class="fa fa-camera  middleWhite"> FOTO</i>
                </a>
                </div>
                </div>
                <div class="card-content card-content-padding">
                <img id="foto-kunjungan-${counter}" name="fotoKunjunganUpload" class="${counter}" height="150" width="100%">
                </div>
                </div>`);
        } else {
            $$('.spanFotoSemuaKunjunganAda').remove();
            $$('.spanFotoKunjungan').html(`
                <div class="card">
                <div class="card-header row" style="background-color:#2196F3;color:white">
                <div class="col padding5">
                <a href="#" onClick="editAmbilFotoKunjungan('1')" class="ambilFotoKunjungan">
                <i class="fa fa-camera  middleWhite"> FOTO</i>
                </a>
                </div>
                </div>
                <div class="card-content card-content-padding">
                <img id="foto-kunjungan-1" name="fotoKunjunganUpload" class="1" height="150" width="100%">
                </div>
                </div>`);
        }
    });


    $$('.btnEditSemuaKunjungan').on('click',function(){
        myApp.preloader.show();
        var PERMINTAANKHUSUS = $$('.editPermintaanKhususKunjungan').val();
        var KESIMPULAN = $$('.editKesimpulanKunjungan').val();
        var KETERANGAN = $$('.editKeteranganKunjungan').val();
        var fotoKunjungan = [];
        var namaFotoKunjungan = [];
        $$('img[name^="fotoKunjunganUpload"]').each(function() {
            if($$(this).attr("src") !=null){
                fotoKunjungan.push($$(this).attr("src"));
                namaFotoKunjungan.push(this.className);
            }
        });

        var act = "EDIT_SEMUA_KUNJUNGAN";
        myApp.request.post(ipTujuan,{case:act,USERID:USERID,KETERANGAN:KETERANGAN,namaFotoKunjungan:namaFotoKunjungan,
            NAMAGAMBAR:gambarHapus,NOMORBUKTI:editNomorBuktiPelanggan,PERMINTAANKHUSUS:PERMINTAANKHUSUS,KESIMPULAN:KESIMPULAN},function(data){
                var hasil_json = JSON.parse(data);
                if(namaFotoKunjungan.length>0 ){
                    for(var i =0; i<fotoKunjungan.length;i++){
                       var toko = new FileUploadOptions();
                       toko.fileKey = "photo";
                       toko.fileName = fotoKunjungan[i].substr(fotoKunjungan[i].lastIndexOf('/') + 1);
                       toko.mimeType = "image/jpeg";
                       toko.chunkedMode = false;
                       toko.headers = {
                          Connection: "close"
                      };
                      toko.params = {
                        namaFile:editNomorBuktiPelanggan +'-'+namaFotoKunjungan[i]
                    }
                    var ft = new FileTransfer();
                    ft.upload(fotoKunjungan[i], 
                      encodeURI(ipUploadKunjungan),
                      win,
                      fail,
                      toko);

                    var win = function(r) {
                        console.log("Should not be called.");
                    }

                    var fail = function(error) {
                        myApp.dialog.alert("eror :" +error.code);
                        alert("An error has occurred: Code = " + error.code);
                        console.log("upload error source " + error.source);
                        console.log("upload error target " + error.target);
                    }
                }
                myApp.preloader.hide();
                myApp.dialog.alert("Berhasil Mengedit Data");
                mainView.router.back("/detail_pelanggan/",{force:true});
            } else {
                myApp.preloader.hide();
                myApp.dialog.alert("Berhasil Mengedit Data");
                mainView.router.back("/detail_pelanggan/",{force:true});
            }
        });
    });
});

//master_barang
$$(document).on('page:init', '.page[data-name="master_barang"]', function (page) {
    var searchbar = myApp.searchbar.create({
        el: '.searchbar',
        searchContainer: '.list',
        searchIn: '.namaBarang',
        on: {
            search(sb, query, previousQuery) {
                console.log(query, previousQuery);
            }
        }
    });
});



var halamanPembedaPostingHapus = "";
//halaman_posting_hapus
$$(document).on('page:init', '.page[data-name="halaman_posting_hapus"]', function (page) {


    DATETRANSACTION = "";

    if(halamanPostingHapus == "tmrencanakunjungan"){
        DATETRANSACTION = editTanggalRencanaKunjungan;

        if(userHakAksesArrayGlobal["masterRencanaKunjungan"]["POSTING"] == "F"){
            $$('.btnPostingTerpilih').remove();
        }

        if(userHakAksesArrayGlobal["masterRencanaKunjungan"]["HAPUS"] == "F"){
            $$('.btnHapusTerpilih').remove();
        }
    } else if(halamanPostingHapus == "tmkunjungan" && tampungHalamanFollowDanCollector == ""){
        DATETRANSACTION = tanggalKunjungan;

        if(userHakAksesArrayGlobal["masterKunjungan"]["POSTING"] == "F"){
            $$('.btnPostingTerpilih').remove();
        }

        if(userHakAksesArrayGlobal["masterKunjungan"]["HAPUS"] == "F"){
            $$('.btnHapusTerpilih').remove();
        }
    } else if(tampungHalamanFollowDanCollector == "FOLLOWUP"){
        DATETRANSACTION = tampungTanggalFollowDanCollector;
        if(userHakAksesArrayGlobal.masterFollowUp != "undefined" && userHakAksesArrayGlobal["masterFollowUp"]["POSTING"] == "F"){
            $$('.btnPostingTerpilih').remove();
        }

        if(userHakAksesArrayGlobal.masterFollowUp != "undefined" && userHakAksesArrayGlobal["masterFollowUp"]["HAPUS"] == "F"){
            $$('.btnHapusTerpilih').remove();
        }
    } else if(tampungHalamanFollowDanCollector == "COLLECTOR"){
        DATETRANSACTION = tampungTanggalFollowDanCollector;
        if(userHakAksesArrayGlobal.masterCollector != "undefined" && userHakAksesArrayGlobal["masterCollector"]["POSTING"] == "F"){
            $$('.btnPostingTerpilih').remove();
        }

        if(userHakAksesArrayGlobal.masterCollector != "undefined" && userHakAksesArrayGlobal["masterCollector"]["HAPUS"] == "F"){
            $$('.btnHapusTerpilih').remove();
        }
    } else if(tampungHalamanFollowDanCollector == "KIRIMAN"){
        DATETRANSACTION = tampungTanggalFollowDanCollector;
        if(userHakAksesArrayGlobal.masterKiriman != "undefined" && userHakAksesArrayGlobal["masterKiriman"]["POSTING"] == "F"){
            $$('.btnPostingTerpilih').remove();
        }

        if(userHakAksesArrayGlobal.masterKiriman != "undefined" && userHakAksesArrayGlobal["masterKiriman"]["HAPUS"] == "F"){
            $$('.btnHapusTerpilih').remove();
        }
    } else if(tampungHalamanFollowDanCollector == "LAPORAN"){
        DATETRANSACTION = tampungTanggalListLaporan;
        if(userHakAksesArrayGlobal.masterLaporan != "undefined" && userHakAksesArrayGlobal["masterLaporan"]["POSTING"] == "F"){
            $$('.btnPostingTerpilih').remove();
        }

        if(userHakAksesArrayGlobal.masterLaporan != "undefined" && userHakAksesArrayGlobal["masterLaporan"]["HAPUS"] == "F"){
            $$('.btnHapusTerpilih').remove();
        }
    } 

    var today = new Date(DATETRANSACTION);
    var day = today.getDate();
    var monthIndex = today.getMonth();
    var year = today.getFullYear();


    $$('.title').html(day + ' ' + monthNames[monthIndex] + ' ' + year);
    
    var act = "TAMPIL_POSTING_HAPUS";
    myApp.request.post(ipTujuan,{case:act,KODEJABATAN:KODEJABATAN,USERID:USERID,DATETRANSACTION:DATETRANSACTION,halamanPostingHapus:halamanPostingHapus,tampungHalamanFollowDanCollector:tampungHalamanFollowDanCollector,
        parameter_rencana:parameter_rencana,TANGGALDARI:tanggalDariRencana,TANGGALSAMPAI:tanggalSampaiRencana,
        STAFFDARI:staffDariRencana,STAFFSAMPAI:staffSampaiRencana,KODECABANG:KODECABANG},function(data){
            var hasil_json = JSON.parse(data);
            var tampungPostingHapus = "";
            if(hasil_json.hasil == "ada"){
                tampungPostingHapus +=`<div class="list">
                <ul>`;

                for(var i = 0; i<hasil_json.NOMORBUKTI.length; i++){
                    tampungPostingHapus +=
                    `<li>
                    <label class="item-checkbox item-content">
                    <input type="checkbox" name="postingHapusValue[]" value="`+hasil_json.NOMORBUKTI[i]+`"/>
                    <i class="icon icon-checkbox"></i>
                    <div class="item-inner">
                    <div class="item-title">`+hasil_json.NAMA[i]+`</div>
                    </div>
                    </label>
                    </li>`;
                }

                tampungPostingHapus +=`</ul>
                </div>
                `;
            } else {
                tampungPostingHapus += "TIDAK ADA";
            }

            $$('.tampilPostingHapus').html(tampungPostingHapus);
        });


    $$('.btnPostingTerpilih').on('click',function(){
        myApp.preloader.show();
        var postingHapusValue = [];
        $$('input[name^="postingHapusValue"]').each(function() {
            if($$(this).prop("checked")){
                postingHapusValue.push($$(this).val());
            }
        });

        if(postingHapusValue.length!=0){
            var act = "POSTING_TERPILIH";
            myApp.request.post(ipTujuan,{case:act,postingHapusValue:postingHapusValue,USERID:USERID,halamanPostingHapus:halamanPostingHapus},function(data){
                myApp.dialog.alert("Sudah Berhasil Diposting");
                /*if(halamanPostingHapus == "tmrencanakunjungan"){
                    mainView.router.navigate("/halaman_rencana_kunjungan/");
                } else if(halamanPostingHapus == "tmkunjungan" && tampungHalamanFollowDanCollector == ""){
                    mainView.router.navigate("/halaman_kunjungan/");
                } else if(tampungHalamanFollowDanCollector == "FOLLOWUP"){
                    mainView.router.navigate("/halaman_follow_collector/");
                } else if(tampungHalamanFollowDanCollector == "COLLECTOR"){
                    mainView.router.navigate("/halaman_follow_collector/");
                } else if(tampungHalamanFollowDanCollector == "KIRIMAN"){
                    mainView.router.navigate("/halaman_follow_collector/");
                } else if(tampungHalamanFollowDanCollector == "LAPORAN"){
                    mainView.router.navigate("/halaman_laporan/");
                }*/
                mainView.router.back();
            });
        } else {
            myApp.dialog.alert("Pilih Terlebih Dahulu");
            myApp.preloader.hide();
        }
    });

    $$('.btnHapusTerpilih').on('click',function(){
        myApp.preloader.show();
        var postingHapusValue = [];
        $$('input[name^="postingHapusValue"]').each(function() {
            if($$(this).prop("checked")){
                postingHapusValue.push($$(this).val());
            }
        });

        if(postingHapusValue.length!=0){
            var act = "HAPUS_TERPILIH";
            myApp.request.post(ipTujuan,{case:act,postingHapusValue:postingHapusValue,USERID:USERID,halamanPostingHapus:halamanPostingHapus},function(data){
                myApp.dialog.alert("Sudah Berhasil Dihapus");
                /*if(halamanPostingHapus == "tmrencanakunjungan"){
                    mainView.router.navigate("/halaman_rencana_kunjungan/");
                } else if(halamanPostingHapus == "tmkunjungan"  && tampungHalamanFollowDanCollector == ""){
                    mainView.router.navigate("/halaman_kunjungan/");
                } else if(tampungHalamanFollowDanCollector == "FOLLOWUP"){
                    mainView.router.navigate("/halaman_follow_collector/");
                } else if(tampungHalamanFollowDanCollector == "COLLECTOR"){
                    mainView.router.navigate("/halaman_follow_collector/");
                } else if(tampungHalamanFollowDanCollector == "KIRIMAN"){
                    mainView.router.navigate("/halaman_follow_collector/");
                } else if(tampungHalamanFollowDanCollector == "LAPORAN"){
                    mainView.router.navigate("/halaman_laporan/");
                }*/
                mainView.router.back({force:true});
            });
        } else {
            myApp.dialog.alert("Pilih Terlebih Dahulu");
            myApp.preloader.hide();
        }
    });
});

var halamanPostingHapus = "";
$$(document).on('page:init', '.page[data-name="halaman_rencana_kunjungan"]', function (page) {
    if(userHakAksesArrayGlobal['masterRencanaKunjungan']['UBAH'] == "F"){
        $$('.editPostingHapus').remove();
    }

    $$('.title').html(editTanggalRencanaKunjungan);
    $$('.editPostingHapus').on('click',function(){
        if(halamanGlobal == "MASTER_RENCANA_KUNJUNGAN"){
            halamanPostingHapus = "tmrencanakunjungan";
            mainView.router.navigate("/halaman_posting_hapus/");
        } else if(halamanGlobal == "RENCANA_TAGIHAN_ADMIN") {
            mainView.router.navigate("/halaman_posting_hapus_tagihan/");
        }
    });

    if(parameter_rencana == "tidakada"){
        var act = "TAMPIL_SEMUA_OUTLET_RENCANA_KUNJUNGAN";
        myApp.request.post(ipTujuan,{case:act,USERID:USERID,DATETRANSACTION:editTanggalRencanaKunjungan,KODECABANG:KODECABANG},function(data){
            var hasil_json = JSON.parse(data);
            var tampungOutletRencanaKunjungan = "<ul>";
            if(hasil_json.hasil == "ada"){
                for(var i = 0; i<hasil_json.KODEPELANGGAN.length; i++){
                    tampungOutletRencanaKunjungan +=`
                    <li>
                    <a href="#" onClick="detailPelanggan('MASTER_RENCANA_KUNJUNGAN','`+hasil_json.KODEPELANGGAN[i]+`','`+hasil_json.NAMA[i]+`',
                    '`+hasil_json.ALAMAT[i].replace(/(["'])/g, "\\$1")+`','`+hasil_json.KOTA[i]+`','`+hasil_json.TELPON[i]+`','`+hasil_json.FAX[i]+`',
                    '`+hasil_json.KREDITLIMIT[i]+`','`+hasil_json.SYARATPIUTANG[i]+`','`+hasil_json.SYARATPIUTANGMAX[i]+`',
                    '`+hasil_json.USERID[i]+`','`+hasil_json.TERM[i]+`','`+hasil_json.NAMAKATEGORIPELANGGAN[i]+`','`+hasil_json.ALAMATKIRIM[i]+`','`+hasil_json.NOMORBUKTI[i]+`')" class="item-link item-content detailRencanaKunjungan">
                    <div class="item-inner">
                    <div class="item-title">`+hasil_json.NAMA[i]+`</div>

                    </div>
                    </a>
                    </li>`;
                }
                tampungOutletRencanaKunjungan += "</ul>";

                $$('.semuaOutletRencanaKunjungan').html(tampungOutletRencanaKunjungan);
            } else {

                $$('.semuaOutletRencanaKunjungan').html("Belum Ada Rencana Kunjungan");
            }

            myApp.preloader.hide();
        });
    } else {
        var params = {
            case:"TAMPIL_SEMUA_OUTLET_RENCANA_KUNJUNGAN_PARAMETER",
            USERID:USERID,
            KODECABANG:KODECABANG,
            KODEJABATAN:KODEJABATAN,
            TANGGALDARI:tanggalDariRencana,
            TANGGALSAMPAI:tanggalSampaiRencana,
            STAFFDARI:staffDariRencana,
            STAFFSAMPAI:staffSampaiRencana,
            DATETRANSACTION:editTanggalRencanaKunjungan
        }
        myApp.request.post(ipTujuan,params,
            function(data){
                var hasil_json = JSON.parse(data);
                var tampungOutletRencanaKunjungan = "<ul>";
                if(hasil_json.hasil == "ada"){
                    for(var i = 0; i<hasil_json.KODEPELANGGAN.length; i++){
                        tampungOutletRencanaKunjungan +=`
                        <li>
                        <a href="#" onClick="detailPelanggan('MASTER_RENCANA_KUNJUNGAN','`+hasil_json.KODEPELANGGAN[i]+`','`+hasil_json.NAMA[i]+`',
                        '`+hasil_json.ALAMAT[i].replace(/(["'])/g, "\\$1")+`','`+hasil_json.KOTA[i]+`','`+hasil_json.TELPON[i]+`','`+hasil_json.FAX[i]+`',
                        '`+hasil_json.KREDITLIMIT[i]+`','`+hasil_json.SYARATPIUTANG[i]+`','`+hasil_json.SYARATPIUTANGMAX[i]+`',
                        '`+hasil_json.USERID[i]+`','`+hasil_json.TERM[i]+`','`+hasil_json.NAMAKATEGORIPELANGGAN[i]+`','`+hasil_json.ALAMATKIRIM[i]+`','`+hasil_json.NOMORBUKTI[i]+`')" class="item-link item-content detailRencanaKunjungan">
                        <div class="item-inner">
                        <div class="item-title">`+hasil_json.NAMA[i]+` <span class="badge color-green">`+hasil_json.KODESALESMAN[i]+`</span></div>

                        </div>
                        </a>
                        </li>`;
                    }
                    tampungOutletRencanaKunjungan += "</ul>";

                    $$('.semuaOutletRencanaKunjungan').html(tampungOutletRencanaKunjungan);
                } else {

                    $$('.semuaOutletRencanaKunjungan').html("Belum Ada Rencana Kunjungan");
                }

                myApp.preloader.hide();
            },
            function(xhr,status){
                PreloaderHide(status);
            })
    }
});



//input_karyawan
$$(document).on('page:init', '.page[data-name="input_karyawan"]', function (page) {
    $$("input[type=text]").keyup(function(){
        $$(this).val( $$(this).val().toUpperCase() );
    });

    $$('.cabangInputKaryawan').val(KODECABANG);
    $$('.inputUserIdKaryawan').val(USERID);

    var calendarModal = myApp.calendar.create({
        inputEl: '#demo-calendar-modal-lahir',
        openIn: 'customModal',
        header: true,
        footer: true,
        dateFormat: 'MM dd yyyy',
    });


    var today = new Date();
    today = new Date().setDate(today.getDate() - 1);

    var calendarModal = myApp.calendar.create({
        inputEl: '#demo-calendar-modal-masuk',
        openIn: 'customModal',
        header: true,
        footer: true,
        dateFormat: 'MM dd yyyy',
        minDate: today,
    });

    var calendarModal = myApp.calendar.create({
        inputEl: '#demo-calendar-modal-keluar',
        openIn: 'customModal',
        header: true,
        footer: true,
        dateFormat: 'MM dd yyyy',
        minDate: today,
    });

    var act = "TAMPIL_INPUT_KARYAWAN";
    myApp.request.post(ipTujuan,{case:act,KODECABANG:KODECABANG},function(data){
        var hasil_json = JSON.parse(data);
        var tampungSelect = "";
        if(hasil_json.hasil == "ada"){
            for(var i =0; i<hasil_json.NAMA.length; i++){
                tampungSelect +=`<option value="`+hasil_json.KODEJABATAN[i]+`" selected>`+hasil_json.NAMA[i]+`</option>`;
            }
            $$('.jabatanInputKaryawan').html(tampungSelect);
        } else {
            $$('.jabatanInputKaryawan').html("");
        }
    });

    $$('.ambilFotoKtp').on('click',function(page){
        navigator.camera.getPicture(onSuccess,onFail,{
            quality:30,
            destinationType : Camera.DestinationType.FILE_URI,
            
            correctOrientation: true,
            sourceType : Camera.PictureSourceType.CAMERA,
            cameraDirection: Camera.Direction.BACK
        });

        function onSuccess(imageData){
            var image = document.getElementById('foto-ktp');
            image.src = imageData;
        }

        function onFail(message){
            myApp.alert('Failed because: ' +message);
        }

    });

    $$('.ambilFotoNpwp').on('click',function(page){
        console.log("b");
        navigator.camera.getPicture(onSuccess,onFail,{
            quality:30,
            destinationType : Camera.DestinationType.FILE_URI,
            
            correctOrientation: true,
            sourceType : Camera.PictureSourceType.CAMERA,
            cameraDirection: Camera.Direction.BACK
        });

        function onSuccess(imageData){
            var image = document.getElementById('foto-npwp');
            image.src = imageData;
        }

        function onFail(message){
            myApp.alert('Failed because: ' +message);
        }

    });

    $$('.ambilFotoKaryawan').on('click',function(page){
        navigator.camera.getPicture(onSuccess,onFail,{
            quality:30,
            destinationType : Camera.DestinationType.FILE_URI,
            
            correctOrientation: true,
            sourceType : Camera.PictureSourceType.CAMERA,
            cameraDirection: Camera.Direction.BACK
        });

        function onSuccess(imageData){
            var image = document.getElementById('foto-karyawan');
            image.src = imageData;
        }

        function onFail(message){
            myApp.alert('Failed because: ' +message);
        }

    });

    $$('.btnInputKaryawan').on('click',function(){
        var act = "INPUT_KARYAWAN";
        var KODEKARYAWAN = $$('.inputKodeKaryawan').val();
        var NAMA = $$('.inputNamaKaryawan').val();
        var ALAMAT = $$('.inputAlamatKaryawan').val();
        var KOTA = $$('.inputKotaKaryawan').val();
        var TELEPON  = $$('.inputNoKaryawan').val();
        var NPWP  = $$('.inputNpwpKaryawan').val();
        var KTP = $$('.inputKtpKaryawan').val();
        var TANGGALMASUK = $$('#demo-calendar-modal-masuk').val();
        var WA1 = $$('.inputWAKaryawan').val();
        var EMAIL1 = $$('.inputEmailKaryawan').val();
        var TANGGALLAHIR = $$('#demo-calendar-modal-lahir').val();
        //var TANGGALKELUAR = $$('#demo-calendar-modal-keluar').val();
        var KODECABANG = $$('.cabangInputKaryawan').val();
        var KODEJABATAN = $$('.jabatanInputKaryawan').val();

        var FOTOKTP = $$("#foto-ktp").attr("src");
        var FOTONPWP = $$("#foto-npwp").attr("src");
        var FOTOKARYAWAN = $$("#foto-karyawan").attr("src");
        

        myApp.preloader.show();
        
        if(!KODEKARYAWAN){
            myApp.dialog.alert("Kode Karyawan Harus Diisi");
            myApp.preloader.hide();
        } else if(!NAMA){
            myApp.dialog.alert("Nama Harus Diisi");
            myApp.preloader.hide();
        } else if(!ALAMAT){
            myApp.dialog.alert("Alamat Harus Diisi");
            myApp.preloader.hide();
        } else if(!KOTA){
            myApp.dialog.alert("Alamat Harus Diisi");
            myApp.preloader.hide();
        } else if(!TELEPON){
            myApp.preloader.hide();
            myApp.dialog.alert("Telepon Harus Diisi");
        } else if(!WA1){
            myApp.preloader.hide();
            myApp.dialog.alert("No WA Harus Diisi");
        } else if(!EMAIL1){
            myApp.preloader.hide();
            myApp.dialog.alert("Email Harus Diisi");
        } else if(!TANGGALLAHIR){
            myApp.preloader.hide();
            myApp.dialog.alert("Tanggal Lahir Harus Diisi");
        } else if(!TANGGALMASUK){
            myApp.preloader.hide();
            myApp.dialog.alert("Tanggal Masuk Harus Diisi");
        } else if(!KODECABANG){
            myApp.preloader.hide();
            myApp.dialog.alert("Cabang Harus Diisi");
        } else if(!KODEJABATAN){
            myApp.preloader.hide();
            myApp.dialog.alert("Jabatan Harus Diisi");
        } else {
         myApp.request.post(ipTujuan,{case:act , KODEKARYAWAN:KODEKARYAWAN , NAMA:NAMA , ALAMAT:ALAMAT , KOTA:KOTA , TELEPON:TELEPON,
            NPWP:NPWP, KTP:KTP, TANGGALMASUK:TANGGALMASUK, WA1:WA1, EMAIL1:EMAIL1, TANGGALLAHIR:TANGGALLAHIR,
            KODECABANG:KODECABANG , KODEJABATAN:KODEJABATAN, USERID:USERID},function(data){
                var hasil_json = JSON.parse(data);
                if(hasil_json.hasil == "ada"){
                    myApp.dialog.alert("Kode Karyawan Sudah Terdaftar");
                    myApp.preloader.hide();
                } else {

                    if(FOTOKTP !=null){


                        var ktp = new FileUploadOptions();
                        ktp.fileKey = "photo";
                        ktp.fileName = FOTOKTP.substr(FOTOKTP.lastIndexOf('/') + 1);
                        ktp.mimeType = "image/jpeg";
                        ktp.chunkedMode = false;
                        ktp.headers = {
                          Connection: "close"
                      };
                      ktp.params = {
                        namaFile:KODEKARYAWAN +"-ktp"
                    }

                    var ft = new FileTransfer();
                    ft.upload(FOTOKTP, 
                      encodeURI(ipUpload),
                      win,
                      fail,
                      ktp);

                    var win = function(r) {
                        console.log("Should not be called.");
                    }

                    var fail = function(error) {
                        alert("An error has occurred: Code = " + error.code);
                        console.log("upload error source " + error.source);
                        console.log("upload error target " + error.target);
                    }

                } 
                if(FOTONPWP!=null){



                    var npwp = new FileUploadOptions();
                    npwp.fileKey = "photo";
                    npwp.fileName = FOTONPWP.substr(FOTONPWP.lastIndexOf('/') + 1);
                    npwp.mimeType = "image/jpeg";
                    npwp.chunkedMode = false;
                    npwp.headers = {
                      Connection: "close"
                  };
                  npwp.params = {
                    namaFile:KODEKARYAWAN +"-npwp"
                }

                var ft = new FileTransfer();
                ft.upload(FOTONPWP, 
                  encodeURI(ipUpload),
                  win,
                  fail,
                  npwp);

                var win = function(r) {
                    console.log("Should not be called.");
                }

                var fail = function(error) {
                    alert("An error has occurred: Code = " + error.code);
                    console.log("upload error source " + error.source);
                    console.log("upload error target " + error.target);
                }


            }

            if(FOTOKARYAWAN!=null){



                var npwp = new FileUploadOptions();
                npwp.fileKey = "photo";
                npwp.fileName = FOTOKARYAWAN.substr(FOTOKARYAWAN.lastIndexOf('/') + 1);
                npwp.mimeType = "image/jpeg";
                npwp.chunkedMode = false;
                npwp.headers = {
                  Connection: "close"
              };
              npwp.params = {
                namaFile:KODEKARYAWAN +"-karyawan"
            }

            var ft = new FileTransfer();
            ft.upload(FOTOKARYAWAN, 
              encodeURI(ipUpload),
              win,
              fail,
              npwp);

            var win = function(r) {
                console.log("Should not be called.");
            }

            var fail = function(error) {
                alert("An error has occurred: Code = " + error.code);
                console.log("upload error source " + error.source);
                console.log("upload error target " + error.target);
            }
        }


        myApp.preloader.hide();
        //mainView.router.navigate("/master_karyawan/");
        mainView.router.back("/master_karyawan/",{force:true});
    }


});
}





});

$$('.btnBatalInputKaryawan').on('click',function(){
    //mainView.router.navigate("/master_karyawan/");
    mainView.router.back();
});

});


//input_rencana_kunjungan
$$(document).on('page:init', '.page[data-name="input_rencana_kunjungan"]', function (page) {

    var act = "POPUP_TAMPIL_NAMA_TOKO";
    myApp.request.post(ipTujuan,{case:act,USERID:USERID,KODECABANG:KODECABANG},function(data){
        var hasil_json = JSON.parse(data);
        tampungPopupNamaToko = "";
        if(hasil_json.hasil=="ada"){
            for(var i = 0; i<hasil_json.KODEPELANGGAN.length;i++){
                tampungPopupNamaToko +=`
                <li>
                <a href="#" class="item-link item-content" onClick="pilihToko('`+hasil_json.KODEPELANGGAN[i]+`','`+hasil_json.NAMA[i]+`')">
                <div class="item-inner">
                <div class="item-text namaToko" style="color:black">`+hasil_json.KODEPELANGGAN[i]+` - `+hasil_json.NAMA[i]+`</div>
                </div>
                </a>
                </li>`;
            }
        } else {
            $$('.listPopupNamaTokoRencanaKunjungan').html("");
        }
        $$('.listPopupNamaTokoRencanaKunjungan').html(tampungPopupNamaToko);
    });

    var counter = 1;
    $$('.btnTambahToko').on('click',function(){
        var element = `<div class="card">
        <div class="card-header" style="background-color:#2196F3;color:white">

        <span style="font-size:0.9em"><b>Toko</b></span>
        <a href="#" class="hapusToko"><span style="font-size:0.9em;text-align: right"><i class="fas fa-window-close " style="color:white"></i></span></a>

        </div>
        <div class="card-content card-content-padding">
        <div class="list form-store-data" >
        <div class="item-content item-input">
        <div class="item-inner">
        <div class="item-input-wrap">
        <a href="#" class="popup-open-toko" id ="`+counter+`">
        <input type="text" class="toko`+counter+`" placeholder="" readonly="readonly"/>
        <input type="hidden" name ="kodePelanggan" class="valueToko`+counter+`"/>
        </a>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>`;

        $$('.generateTambahToko').append(element);
        $$('.hapusToko').on('click',function(){
            $$(this).closest('.card').remove()
        });

        $$('.popup-open-toko').on('click',function(){
            tampungCounter = $(this).attr('id');
            
            myApp.popup.open('.popup-toko');
        });
        counter++;

    });

    $$('.hapusToko').on('click',function(){
        $$(this).closest('.card').remove()
    });

    $$('.popup-open-toko').on('click',function(){
        var tampungCounter = $(this).attr('id');
        console.log(tampungCounter);
        myApp.popup.open('.popup-toko');

    });


    $$('.btnInputRencanaKunjungan').on('click',function(){
        myApp.preloader.show();
        var act = "INPUT_RENCANA_KUNJUNGAN";
        var DATETRANSACTION = $$('#demo-calendar-modal').val();
        var KODEPELANGGAN = [];
        
        $$('input[name^="kodePelanggan"]').each(function() {
            if($$(this).val()!=""){
                KODEPELANGGAN.push($$(this).val());
            }
        });

        if( DATETRANSACTION && KODEPELANGGAN.length !=0 ){
            myApp.request.post(ipTujuan,{case:act,DATETRANSACTION:DATETRANSACTION, KODEPELANGGAN:KODEPELANGGAN, USERID:USERID},function(data){
                //mainView.router.navigate("/master_rencana_kunjungan/");
                console.log(data);
                var response = JSON.parse(data);
                if(response.hasil == "berhasil"){
                    myApp.dialog.alert("Rencana Kunjungan Berhasil Di Input");
                    mainView.router.back("/master_rencana_kunjungan/",{force:true});
                } 
                if(response.hasil == null){
                    if(response.KODE == null)
                    {
                        myApp.dialog.alert(response.pesan);
                        myApp.preloader.hide();
                    }
                    if(response.KODE != null)
                    {
                        myApp.dialog.prompt('Masukkan Authorization Code' , function (inputCode) {
                            if(response.KODE==inputCode)
                            {
                                myApp.request.post(ipTujuan,{case:"INPUT_RENCANA_KUNJUNGAN_OTORISASI",DATETRANSACTION:DATETRANSACTION, KODEPELANGGAN:KODEPELANGGAN, USERID:USERID, OTORISASI:inputCode},function(data){
                                    var response = JSON.parse(data);
                                    console.log(data);
                                    if(response.hasil == "berhasil"){
                                        myApp.dialog.alert("Rencana Kunjungan Berhasil Di Input");
                                        mainView.router.back("/master_rencana_kunjungan/",{force:true});
                                    }
                                    else
                                    {
                                        myApp.dialog.alert(response.hasil);
                                    }
                               });
                            }
                            else{
                                myApp.dialog.alert("Authorization Code Salah, Ulangi lagi");
                                myApp.preloader.hide();
                            }
                        });
                        myApp.preloader.hide();
                    }
                }
                else
                {
                    myApp.dialog.alert(response.hasil);
                    myApp.preloader.hide();
                }
            });   
        } else {
            myApp.dialog.alert("Isi Semua Data Terlebih Dahulu");
            myApp.preloader.hide();
        }
    });

    var today = new Date();
    today = new Date().setDate(today.getDate());

    var calendarModal = myApp.calendar.create({
        inputEl: '#demo-calendar-modal',
        openIn: 'customModal',
        header: true,
        footer: true,
        dateFormat: 'MM dd yyyy',
        minDate: today,
    });

    var searchbar = myApp.searchbar.create({
        el: '.searchbar',
        searchContainer: '.list',
        searchIn: '.namaToko',
        on: {
            search(sb, query, previousQuery) {
                console.log(query, previousQuery);
            }
        }
    });

    $$('.btnCancel').on('click',function(){
        //myApp.popup.destroy('.popup-toko');
        myApp.popup.close('.popup-toko');
        
    });

    $$('.cobaKlik').on('click',function(){
        myApp.popup.close('.popup-toko');
        //myApp.dialog.alert("as");
    });

    /*$$('.popup-toko').on('popup:opened', function (e, popup) {
     ;
     $$('.namaToko').on('click',function(){

        $$(this).closest('.card').val("a");
    });
});*/
});

//input_follow_collector
$$(document).on('page:init', '.page[data-name="input_follow_collector"]', function (page) {
    if(halamanGlobal == "MASTER_COLLECTOR"){
        WAKTUMASUK = waktuMasukLoginTokoCollector;
        $$('.kunjunganNamaToko').val(namaLoginTokoCollector);
        $$('.kunjunganKodeToko').val(kodeLoginTokoCollector);
    } else if(halamanGlobal == "MASTER_KIRIMAN"){
        WAKTUMASUK = waktuMasukLoginTokoKiriman;
        $$('.kunjunganNamaToko').val(namaLoginTokoKiriman);
        $$('.kunjunganKodeToko').val(kodeLoginTokoKiriman);
    } else if(halamanGlobal == "MASTER_FOLLOWUP"){
        WAKTUMASUK ="";
        $$('.spanNamaToko').html(`<a href="#" class="popup-open-toko"> 
            <input type="text" class="kunjunganNamaToko" placeholder="" readonly="readonly"/>
            <input type="hidden" class="kunjunganKodeToko"/>
            </a> `);
    } else {
        WAKTUMASUK = waktuLoginDashboard;
        $$('.kunjunganNamaToko').val(namaTokoDashboard);
        $$('.kunjunganKodeToko').val(kodeTokoDashboard);
    }

    $$('.backInputFollowCollector').on('click',function(){
        if(halamanGlobal == "MASTER_COLLECTOR"){
            mainView.router.navigate("/halaman_pilih_login_report/");
        } else if(halamanGlobal == "MASTER_KIRIMAN"){
            mainView.router.navigate("/halaman_pilih_login_report/");
        } else if(halamanGlobal == "MASTER_FOLLOWUP"){
            mainView.router.navigate("/master_followup/");
        }
    });

    if(halamanGlobal == "MASTER_COLLECTOR" || halamanGlobal == "MASTER_KIRIMAN" || halamanGlobal == "BYPASS_COLLECTOR" || halamanGlobal =="BYPASS_KIRIMAN"){
    } 
    else {
        $$('.spanTransferGiroTunai').html("");
    }

    if(halamanGlobal == "MASTER_KIRIMAN" || halamanGlobal == "BYPASS_KIRIMAN"){
        $$('.spanTanggalKembali').html("");
    }

    var act = "TAMPIL_PERMINTAAN_KHUSUS";
    myApp.request.post(ipTujuan,{case:act},function(data){
        myApp.preloader.show();
        var hasil_json = JSON.parse(data);
        var tampungPermintaanKhusus = "";
        for(var i = 0; i<hasil_json.NAMA.length; i++){
            if((halamanGlobal == "MASTER_KIRIMAN" && hasil_json.NAMA[i] == "KIRIMAN") || (halamanGlobal == "BYPASS_KIRIMAN" && hasil_json.NAMA[i] == "KIRIMAN")){
                tampungPermintaanKhusus +=`<option value="`+hasil_json.NAMA[i]+`" selected>`+hasil_json.NAMA[i]+`</option>`;
            } else if((halamanGlobal == "MASTER_COLLECTOR" && hasil_json.NAMA[i] == "TAGIHAN RUTIN") || (halamanGlobal == "BYPASS_COLLECTOR" && hasil_json.NAMA[i] == "TAGIHAN RUTIN")){
                tampungPermintaanKhusus +=`<option value="`+hasil_json.NAMA[i]+`" selected>`+hasil_json.NAMA[i]+`</option>`;

            } else {
                tampungPermintaanKhusus +=`<option value="`+hasil_json.NAMA[i]+`">`+hasil_json.NAMA[i]+`</option>`;
            }
        }
        $$('.inputPermintaanKhususKunjungan').html(tampungPermintaanKhusus);
        $$('.latitudeEditKunjungan').val(latGlobal);
        $$('.longitudeEditKunjungan').val(lngGlobal);
        myApp.preloader.hide();
    });


    var whereLikeHalaman;
    var judulHalaman;

    var today = new Date();
    
    var monthNames = [
    "January", "February", "March",
    "April", "May", "June", "July",
    "August", "September", "October",
    "November", "December"
    ];

    var day = today.getDate();
    var monthIndex = today.getMonth();
    var year = today.getFullYear();
    $$("#demo-calendar-kunjungan").val(day + ' ' + monthNames[monthIndex] + ' ' + year);

    today = new Date().setDate(today.getDate() - 1);

    var calendarModal = myApp.calendar.create({
        inputEl: '#demo-calendar-kembali',
        openIn: 'customModal',
        header: true,
        footer: true,
        dateFormat: 'dd MM yyyy',
        minDate: today,
    });

    /*$$('.popup-open-toko').on('click',function(){
        myApp.popup.open('.popup-toko');
    });*/

    var searchbar = myApp.searchbar.create({
        el: '.searchbar',
        searchContainer: '.listPopupNamaTokoRencanaKunjungan',
        searchIn: '.namaToko',
        on: {
            search(sb, query, previousQuery) {
                //console.log(query, previousQuery);
            }
        }
    });

    $$('.btnCancel').on('click',function(){
        myApp.popup.close('.popup-toko');
        
    });


    var act = "TAMPIL_PERMINTAAN_KHUSUS";
    myApp.request.post(ipTujuan,{case:act},function(data){
        myApp.preloader.show();
        var hasil_json = JSON.parse(data);
        var tampungPermintaanKhusus = "";
        for(var i = 0; i<hasil_json.NAMA.length; i++){
            tampungPermintaanKhusus +=`<option value="`+hasil_json.NAMA[i]+`" >`+hasil_json.NAMA[i]+`</option>`;
        }
        myApp.preloader.hide();
    });

    var act = "POPUP_TAMPIL_NAMA_TOKO";
    myApp.request.post(ipTujuan,{case:act,KODECABANG:KODECABANG,USERID:USERID},function(data){
        var hasil_json = JSON.parse(data);
        tampungPopupNamaToko = "";
        if(hasil_json.hasil=="ada"){
            for(var i = 0; i<hasil_json.KODEPELANGGAN.length;i++){
                tampungPopupNamaToko +=`
                <li>
                <a href="#" class="item-link item-content" onClick="pilihTokoKunjungan('`+hasil_json.KODEPELANGGAN[i]+`','`+hasil_json.NAMA[i]+`')">
                <div class="item-inner">
                <div class="item-text namaToko" style="color:black">`+hasil_json.KODEPELANGGAN[i]+` - `+hasil_json.NAMA[i]+`</div>
                </div>
                </a>
                </li>`;
            }
        } else {
            $$('.listPopupNamaTokoRencanaKunjungan').html("");
        }
        $$('.listPopupNamaTokoRencanaKunjungan').html(tampungPopupNamaToko);
    });
    
    if(tampungHalamanFollowDanCollector == "FOLLOWUP"){
        $$('.btnInputFollowCollector').html("INPUT FOLLOW UP");
        $$('.titleFollowCollector').html("INPUT FOLLOW UP")
        whereLikeHalaman = "FA%";
        judulHalaman = "Follow Up";
    } else if ( tampungHalamanFollowDanCollector == "COLLECTOR"){
        $$('.btnInputFollowCollector').html("INPUT COLLECTOR");
        $$('.titleFollowCollector').html("INPUT COLLECTOR");
        judulHalaman = "Collector";
        whereLikeHalaman = "FC%";
    } else if (tampungHalamanFollowDanCollector == "KIRIMAN"){
        $$('.btnInputFollowCollector').html("INPUT KIRIMAN");
        $$('.titleFollowCollector').html("INPUT KIRIMAN");
        judulHalaman = "Kiriman";
        whereLikeHalaman = "PF%";
    }

    $$('.btnInputFollowCollector').on('click',function(){
        myApp.preloader.show();
        var act = "INPUT_FOLLOW_COLLECTOR";
        var DATETRANSACTION = $$('#demo-calendar-kunjungan').val();
        var KODEPELANGGAN = $$('.kunjunganKodeToko').val();
        var KETERANGAN = $$('.inputKeteranganKunjungan').val();
        var TANGGALKEMBALI = $$('#demo-calendar-kembali').val();
        var KESIMPULAN = $$('.inputKesimpulanKunjungan').val();
        var PERMINTAANKHUSUS = $$('.inputPermintaanKhususKunjungan').val();
        var TRANSFER = $$('.inputTransferKunjungan').val();
        var GIRO = $$('.inputGiroKunjungan').val();
        var TUNAI = $$('.inputTunaiKunjungan').val();

        var fotoKunjungan= [];
        var namaFotoKunjungan = [];

        $$('img[name^="fotoKunjunganUpload"]').each(function() {
            if($$(this).attr("src") !=null){
                fotoKunjungan.push($$(this).attr("src"));
                namaFotoKunjungan.push(this.className);
            }
        });


        if((namaFotoKunjungan.length>0 && latGlobal && lngGlobal) || halamanGlobal == "MASTER_FOLLOWUP" || tampungHalamanFollowDanCollector == "FOLLOWUP"){
            halamanGlobal = "MASTER_FOLLOWUP";

            myApp.request.post(ipTujuan,{case:act,USERID:USERID,DATETRANSACTION:DATETRANSACTION,KODEPELANGGAN:KODEPELANGGAN,KETERANGAN:KETERANGAN,
                TANGGALKEMBALI:TANGGALKEMBALI,KESIMPULAN:KESIMPULAN,PERMINTAANKHUSUS:PERMINTAANKHUSUS,LIKE:whereLikeHalaman,TRANSFER:TRANSFER,
                GIRO:GIRO,namaFotoKunjungan:namaFotoKunjungan,LATITUDE:latGlobal,LONGITUDE:lngGlobal,TUNAI:TUNAI,waktuMasukLoginTokoCollector:WAKTUMASUK,waktuMasukLoginTokoKiriman:WAKTUMASUK},function(data){
                    var hasil_json = JSON.parse(data);
                    if(hasil_json.hasil == "sudahrencanakembali"){
                        myApp.dialog.alert("Sudah ada Rencana Kunjungan Kembali");
                        myApp.preloader.hide();
                    } else if(hasil_json.hasil == "pernahkunjungan"){
                        myApp.dialog.alert("Anda Sudah Pernah "+judulHalaman);
                        myApp.preloader.hide();
                    }  else if(hasil_json.hasil == "pernahkunjunganlebih"){
                        myApp.preloader.hide();
                        var act = "INPUT_FOLLOW_COLLECTOR_LEBIH";
                        myApp.dialog.confirm("Anda Sudah Pernah Menginput "+judulHalaman+" Ke Toko ini, Tetap Ingin Melanjutkan ?",function(){
                            myApp.request.post(ipTujuan,{case:act,USERID:USERID,DATETRANSACTION:DATETRANSACTION,KODEPELANGGAN:KODEPELANGGAN,KETERANGAN:KETERANGAN,
                                TANGGALKEMBALI:TANGGALKEMBALI,KESIMPULAN:KESIMPULAN,PERMINTAANKHUSUS:PERMINTAANKHUSUS,LIKE:whereLikeHalaman,TRANSFER:TRANSFER,
                                GIRO:GIRO,TUNAI:TUNAI,namaFotoKunjungan:namaFotoKunjungan,LATITUDE:latGlobal,LONGITUDE:lngGlobal,waktuMasukLoginTokoCollector:WAKTUMASUK,waktuMasukLoginTokoKiriman:WAKTUMASUK},function(data){
                                    myApp.preloader.show();
                                    var hasil_json = JSON.parse(data);
                                    myApp.dialog.alert("Berhasil Menginput "+judulHalaman+" Anda");
                                    if(judulHalaman == "Follow Up"){
                                        /*mainView.router.back("/master_followup/",{force:true});*/
                                        mainView.router.back({force:true});
                                    } else{
                                        if(halamanGlobal == "MASTER_KIRIMAN" || halamanGlobal == "MASTER_COLLECTOR"){
                                            
                                            /*mainView.router.back("/halaman_pilih_login_report/",{force:true});*/
                                            mainView.router.back({force:true})
                            
                                            waktuMasukLoginTokoCollector = "";
                                            kodeLoginTokoCollector = "";
                                            namaLoginTokoCollector="";
                                            
                                            waktuMasukLoginTokoKiriman = "";
                                            kodeLoginTokoKiriman = "";
                                            namaLoginTokoKiriman="";
                                            
                                            localStorage.removeItem("waktuMasukLoginTokoCollector");
                                            localStorage.removeItem("kodeLoginTokoCollector");
                                            localStorage.removeItem("namaLoginTokoCollector");
                                            
                                            localStorage.removeItem("waktuMasukLoginTokoKiriman");
                                            localStorage.removeItem("kodeLoginTokoKiriman");
                                            localStorage.removeItem("namaLoginTokoKiriman");
                                        
                                        } else {
                                            RemoveItemLocalStorageKunjungan();
                                        }

                                        
                                        
                                        if(fotoKunjungan.length !=0){
                                            for(var i =0; i<fotoKunjungan.length;i++){
                                               var toko = new FileUploadOptions();
                                               toko.fileKey = "photo";
                                               toko.fileName = fotoKunjungan[i].substr(fotoKunjungan[i].lastIndexOf('/') + 1);
                                               toko.mimeType = "image/jpeg";
                                               toko.chunkedMode = false;
                                               toko.headers = {
                                                  Connection: "close"
                                              };
                                              toko.params = {
                                                namaFile:hasil_json.NOMORBUKTI +'-'+namaFotoKunjungan[i]
                                            }
                                            var ft = new FileTransfer();
                                            ft.upload(fotoKunjungan[i], 
                                              encodeURI(ipUploadKunjungan),
                                              win,
                                              fail,
                                              toko);

                                            var win = function(r) {
                                                console.log("Should not be called.");
                                            }

                                            var fail = function(error) {
                                                myApp.dialog.alert("eror :" +error.code);
                                                alert("An error has occurred: Code = " + error.code);
                                                console.log("upload error source " + error.source);
                                                console.log("upload error target " + error.target);
                                            }
                                        }
                                    }
                                }
                            });
                        });
                    } else {
                        myApp.dialog.alert("Berhasil Menginput "+judulHalaman+" Anda");
                        if(tampungHalamanFollowDanCollector == "FOLLOWUP"){
                            /*mainView.router.back("/master_followup/",{force:true});*/
                            mainView.router.back({force:true})
                        } else {
                            /*mainView.router.back("/halaman_pilih_login_report/",{force:true});*/
                            mainView.router.back({force:true})
                            
                            if(halamanGlobal =="MASTER_KIRIMAN" || halamanGlobal =="MASTER_COLLECTOR"){
                                waktuMasukLoginTokoCollector = "";
                                kodeLoginTokoCollector = "";
                                namaLoginTokoCollector="";
                                
                                waktuMasukLoginTokoKiriman = "";
                                kodeLoginTokoKiriman = "";
                                namaLoginTokoKiriman="";
                                
                                localStorage.removeItem("waktuMasukLoginTokoCollector");
                                localStorage.removeItem("kodeLoginTokoCollector");
                                localStorage.removeItem("namaLoginTokoCollector");
                                
                                localStorage.removeItem("waktuMasukLoginTokoKiriman");
                                localStorage.removeItem("kodeLoginTokoKiriman");
                                localStorage.removeItem("namaLoginTokoKiriman");
                                
                            } else {
                                RemoveItemLocalStorageKunjungan();
                            }
                            
                            if(fotoKunjungan.length !=0){
                                for(var i =0; i<fotoKunjungan.length;i++){
                                   var toko = new FileUploadOptions();
                                   toko.fileKey = "photo";
                                   toko.fileName = fotoKunjungan[i].substr(fotoKunjungan[i].lastIndexOf('/') + 1);
                                   toko.mimeType = "image/jpeg";
                                   toko.chunkedMode = false;
                                   toko.headers = {
                                      Connection: "close"
                                  };
                                  toko.params = {
                                    namaFile:hasil_json.NOMORBUKTI +'-'+namaFotoKunjungan[i]
                                }
                                var ft = new FileTransfer();
                                ft.upload(fotoKunjungan[i], 
                                  encodeURI(ipUploadKunjungan),
                                  win,
                                  fail,
                                  toko);
                    
                                var win = function(r) {
                                    console.log("Should not be called.");
                                }
                    
                                var fail = function(error) {
                                    myApp.dialog.alert("eror :" +error.code);
                                    alert("An error has occurred: Code = " + error.code);
                                    console.log("upload error source " + error.source);
                                    console.log("upload error target " + error.target);
                                }
                            }
                        }
                    }
                    }

            });
        } else if(!latGlobal){
            myApp.dialog.alert("Tidak Bisa Menginput, Silahkah Hubungi Admin");
            myApp.preloader.hide();
        } //tutup if halaman global
        else {
            myApp.dialog.alert("Harus Isi Foto Terlebih Dahulu");
            myApp.preloader.hide();
        }

    });

});

var STATUSKUNJUNGAN;
//input_kunjungan
$$(document).on('page:init', '.page[data-name="input_kunjungan"]', function (page) {
    if(halamanGlobal == "MASTER_KUNJUNGAN"){
        WAKTUMASUK = waktuMasukLoginTokoKunjungan;
        $$('.kunjunganNamaToko').val(namaLoginTokoKunjungan);
        $$('.kunjunganKodeToko').val(kodeLoginTokoKunjungan);
    } else {
        WAKTUMASUK = waktuLoginDashboard;
        $$('.kunjunganNamaToko').val(namaTokoDashboard);
        $$('.kunjunganKodeToko').val(kodeTokoDashboard);
    }
    var act = "TAMPIL_PERMINTAAN_KHUSUS";
    myApp.request.post(ipTujuan,{case:act},function(data){
        myApp.preloader.show();
        var hasil_json = JSON.parse(data);
        var tampungPermintaanKhusus = "";
        for(var i = 0; i<hasil_json.NAMA.length; i++){
            tampungPermintaanKhusus +=`<option `;
            if(hasil_json.NAMA[i] == "KUNJUNGAN RUTIN"){
                tampungPermintaanKhusus+= ` selected `;
            }

            if(hasil_json.NAMA[i] != "FOLLOW UP BY PHONE"){
                tampungPermintaanKhusus +=`value="`+hasil_json.NAMA[i]+`">`+hasil_json.NAMA[i]+`</option>`;
            }
        }
        $$('.inputPermintaanKhususKunjungan').html(tampungPermintaanKhusus);
        $$('.latitudeEditKunjungan').val(latGlobal);
        $$('.longitudeEditKunjungan').val(lngGlobal);
        myApp.preloader.hide();
    });

    $$("input[type=text]").keyup(function(){
        $$(this).val( $$(this).val().toUpperCase() );
    });

    var today = new Date();
    
    var monthNames = [
    "January", "February", "March",
    "April", "May", "June", "July",
    "August", "September", "October",
    "November", "December"
    ];

    var day = today.getDate();
    var monthIndex = today.getMonth();
    var year = today.getFullYear();
    $$("#demo-calendar-kunjungan").val(day + ' ' + monthNames[monthIndex] + ' ' + year);

    var act = "POPUP_TAMPIL_NAMA_TOKO";
    myApp.request.post(ipTujuan,{case:act,KODECABANG:KODECABANG,USERID:USERID},function(data){
        var hasil_json = JSON.parse(data);
        tampungPopupNamaToko = "";
        if(hasil_json.hasil=="ada"){
            for(var i = 0; i<hasil_json.KODEPELANGGAN.length;i++){
                tampungPopupNamaToko +=`
                <li>
                <a href="#" class="item-link item-content" onClick="pilihTokoKunjungan('`+hasil_json.KODEPELANGGAN[i]+`','`+hasil_json.NAMA[i]+`')">
                <div class="item-inner">
                <div class="item-text namaToko" style="color:black">`+hasil_json.KODEPELANGGAN[i]+` - `+hasil_json.NAMA[i]+`</div>
                </div>
                </a>
                </li>`;
            }
        } else {
            $$('.listPopupNamaTokoRencanaKunjungan').html("");
        }
        $$('.listPopupNamaTokoRencanaKunjungan').html(tampungPopupNamaToko);
    });


    $$('.btnInputKunjungan').on('click',function(){
        myApp.preloader.show();
        var DATETRANSACTION = $$('#demo-calendar-kunjungan').val();
        var KODEPELANGGAN = $$('.kunjunganKodeToko').val();
        var KETERANGAN = $$('.inputKeteranganKunjungan').val();
        var TANGGALKEMBALI = $$('#demo-calendar-kembali').val();
        var KESIMPULAN = $$('.inputKesimpulanKunjungan').val();
        var PERMINTAANKHUSUS = $$('.inputPermintaanKhususKunjungan').val();
        var LATITUDEEDIT = $$('.latitudeEditKunjungan').val();
        var LONGITUDEEDIT = $$('.longitudeEditKunjungan').val();
        /*var LATITUDEEDIT = null;
        var LONGITUDEEDIT = null;*/

        var fotoKunjungan= [];
        var namaFotoKunjungan = [];

        $$('img[name^="fotoKunjunganUpload"]').each(function() {
            if($$(this).attr("src") !=null){
                fotoKunjungan.push($$(this).attr("src"));
                namaFotoKunjungan.push(this.className);
            }
        });
        
        
        if(!KODEPELANGGAN){
            myApp.dialog.alert("Masukkan Toko Terlebih Dahulu");
            myApp.preloader.hide();
        }else if(!latGlobal || !lngGlobal){
            myApp.dialog.alert("Tidak Bisa Menginput Kunjungan, Silahkan Menghubungi Admin");
            myApp.preloader.hide();
        }/* else if(KODEPELANGGAN != kodeLoginTokoKunjungan){
            myApp.dialog.alert("Toko Harus Sama Dengan Login");
            myApp.preloader.hide();
        }*//*else if(namaFotoKunjungan.length<1){
            myApp.dialog.alert("Masukkan Foto Terlebih Dahulu");
            myApp.preloader.hide();
        } */else {
            var act ="GET_LATITUDE_LONGITUDE_PELANGGAN";
            myApp.request.post(ipTujuan,{case:act,KODEPELANGGAN:KODEPELANGGAN},function(data){
                var hasil_json = JSON.parse(data);
                if(hasil_json.hasil == "ada"){
                    var LATITUDEPELANGGAN = hasil_json.LATITUDE;
                    var LONGITUDEPELANGGAN = hasil_json.LONGITUDE;
                    var JARAK = hasil_json.jarak;
                    var pelanggan = new google.maps.LatLng(LATITUDEPELANGGAN, LONGITUDEPELANGGAN);
                    var sales = new google.maps.LatLng(latGlobal, lngGlobal);
                    var service = new google.maps.DistanceMatrixService();
                    service.getDistanceMatrix(
                    {
                        origins: [pelanggan],
                        destinations: [sales],
                        travelMode: 'DRIVING',
                    }, callback);

                    function callback(response, status) {
                        if (status == 'OK') {
                            var origins = response.originAddresses;
                            var destinations = response.destinationAddresses;

                            var results = response.rows[0].elements;
                            for (var j = 0; j < results.length; j++) {
                                var element = results[j];
                                console.log(element);
                                var distance = element.distance.value;
                                var duration = element.duration.text;
                                jarakKunjunganPelanggan = distance;
                                if(jarakKunjunganPelanggan<=JARAK){
                                    STATUSKUNJUNGAN = "DALAM";
                                    
                                } else {
                                    STATUSKUNJUNGAN = "LUAR";
                                }
                            }
                            var act ="INPUT_KUNJUNGAN";
                            myApp.request.post(ipTujuan,{case:act, DATETRANSACTION:DATETRANSACTION,KODEPELANGGAN:KODEPELANGGAN,
                                KETERANGAN:KETERANGAN,STATUSKUNJUNGAN:STATUSKUNJUNGAN,PERMINTAANKHUSUS:PERMINTAANKHUSUS,LATITUDEEDIT:LATITUDEEDIT, LONGITUDEEDIT:LONGITUDEEDIT,
                                TANGGALKEMBALI:TANGGALKEMBALI,KESIMPULAN:KESIMPULAN,USERID:USERID, latGlobal:latGlobal,lngGlobal:lngGlobal,
                                waktuMasukLoginTokoKunjungan:WAKTUMASUK,namaFotoKunjungan:namaFotoKunjungan},function(data){
                                    var hasil_json = JSON.parse(data);
                                    myApp.preloader.show();
                                    if(hasil_json.hasil == "sudahrencanakembali"){
                                        myApp.dialog.alert("Sudah ada Rencana Kunjungan Kembali");
                                        myApp.preloader.hide();
                                    } else if(hasil_json.hasil == "pernahkunjungan"){
                                        myApp.dialog.alert("Anda Sudah Pernah Kunjungan");
                                        myApp.preloader.hide();
                                    } else if(hasil_json.hasil == "pernahkunjunganlebih"){
                                        myApp.preloader.hide();
                                        var act = "INPUT_KUNJUNGAN_LEBIH";
                                        myApp.dialog.confirm("Anda Sudah Pernah Menginput Kunjungan Ke Toko ini, Tetap Ingin Melanjutkan ?",function(){
                                            myApp.request.post(ipTujuan,{case:act, DATETRANSACTION:DATETRANSACTION,KODEPELANGGAN:KODEPELANGGAN,
                                                KETERANGAN:KETERANGAN,STATUSKUNJUNGAN:STATUSKUNJUNGAN,PERMINTAANKHUSUS:PERMINTAANKHUSUS,LATITUDEEDIT:LATITUDEEDIT, LONGITUDEEDIT:LONGITUDEEDIT,
                                                TANGGALKEMBALI:TANGGALKEMBALI,namaFotoKunjungan:namaFotoKunjungan,KESIMPULAN:KESIMPULAN,USERID:USERID, latGlobal:latGlobal,lngGlobal:lngGlobal,waktuMasukLoginTokoKunjungan:WAKTUMASUK},
                                                function(data){
                                                    myApp.preloader.show();
                                                    var hasil_json = JSON.parse(data);
                                                    myApp.dialog.alert("Berhasil Menginput Kunjungan Anda");
                                                    waktuMasukLoginTokoKunjungan = "";
                                                    kodeLoginTokoKunjungan = "";
                                                    namaLoginTokoKunjungan = "";
                                                    localStorage.removeItem("waktuMasukLoginTokoKunjungan");
                                                    localStorage.removeItem("kodeLoginTokoKunjungan");
                                                    localStorage.removeItem("namaLoginTokoKunjungan");
                                                    RemoveItemLocalStorageKunjungan();
                                                    //mainView.router.back("/halaman_pilih_login_report/",{force:true});
                                                    mainView.router.back({force:true});
                                                    if(fotoKunjungan.length !=0){

                                                        for(var i =0; i<fotoKunjungan.length;i++){
                                                            var toko = new FileUploadOptions();
                                                            toko.fileKey = "photo";
                                                            toko.fileName = fotoKunjungan[i].substr(fotoKunjungan[i].lastIndexOf('/') + 1);
                                                            toko.mimeType = "image/jpeg";
                                                            toko.chunkedMode = false;
                                                            toko.headers = {
                                                                Connection: "close"
                                                            };
                                                            toko.params = {
                                                                namaFile:hasil_json.NOMORBUKTI +'-'+namaFotoKunjungan[i]
                                                            }
                                                            var ft = new FileTransfer();
                                                            ft.upload(fotoKunjungan[i], 
                                                                encodeURI(ipUploadKunjungan),
                                                                win,
                                                                fail,
                                                                toko);

                                                            var win = function(r) {
                                                                console.log("Should not be called.");
                                                            }

                                                            var fail = function(error) {
                                                                alert("An error has occurred: Code = " + error.code);
                                                                console.log("upload error source " + error.source);
                                                                console.log("upload error target " + error.target);
                                                            }
                                                        }
                                                    }
                                                },function(xhr,status){
                                                    if(status == 4 || status == 0){
                                                        myApp.preloader.hide();
                                                        myApp.dialog.alert("Internet Anda Bermasalah");
                                                    }
                                                });
});
} else  {
    myApp.dialog.alert("Berhasil Menginput Kunjungan Anda");
    waktuMasukLoginTokoKunjungan = "";
    kodeLoginTokoKunjungan = "";
    namaLoginTokoKunjungan = "";
    localStorage.removeItem("namaLoginTokoKunjungan");
    localStorage.removeItem("waktuMasukLoginTokoKunjungan");
    localStorage.removeItem("kodeLoginTokoKunjungan");
    RemoveItemLocalStorageKunjungan();
    //mainView.router.back("/halaman_pilih_login_report/",{force:true});
    mainView.router.back({force:true})
    myApp.preloader.hide();

    if(fotoKunjungan.length !=0){
        for(var i =0; i<fotoKunjungan.length;i++){
            var toko = new FileUploadOptions();
            toko.fileKey = "photo";
            toko.fileName = fotoKunjungan[i].substr(fotoKunjungan[i].lastIndexOf('/') + 1);
            toko.mimeType = "image/jpeg";
            toko.chunkedMode = false;
            toko.headers = {
                Connection: "close"
            };
            toko.params = {
                namaFile:hasil_json.NOMORBUKTI +'-'+namaFotoKunjungan[i]
            }
            var ft = new FileTransfer();
            ft.upload(fotoKunjungan[i], 
                encodeURI(ipUploadKunjungan),
                win,
                fail,
                toko);

            var win = function(r) {
                console.log("Should not be called.");
            }

            var fail = function(error) {
                alert("An error has occurred: Code = " + error.code);
                console.log("upload error source " + error.source);
                console.log("upload error target " + error.target);
            }
        }
    }
} 
},function(xhr,status){
    if(status == 4 || status == 0){
        myApp.preloader.hide();
        myApp.dialog.alert("Internet Anda Bermasalah");
    }
});
}

else {
    //else milik if status ok
    myApp.preloader.hide();
    myApp.dialog.alert("Internet Anda Bermasalah");
}
}
} else {
    STATUSKUNJUNGAN = "DALAM";
    var act ="INPUT_KUNJUNGAN";
    myApp.request.post(ipTujuan,{case:act, DATETRANSACTION:DATETRANSACTION,KODEPELANGGAN:KODEPELANGGAN,
        KETERANGAN:KETERANGAN,STATUSKUNJUNGAN:STATUSKUNJUNGAN, PERMINTAANKHUSUS:PERMINTAANKHUSUS,LATITUDEEDIT:LATITUDEEDIT, LONGITUDEEDIT:LONGITUDEEDIT,
        TANGGALKEMBALI:TANGGALKEMBALI,KESIMPULAN:KESIMPULAN,USERID:USERID, 
        latGlobal:latGlobal,lngGlobal:lngGlobal,waktuMasukLoginTokoKunjungan:WAKTUMASUK,namaFotoKunjungan:namaFotoKunjungan},function(data){
            var hasil_json = JSON.parse(data);
            myApp.preloader.show();
            if(hasil_json.hasil == "sudahrencanakembali"){
                myApp.dialog.alert("Sudah ada Rencana Kunjungan Kembali");
                myApp.preloader.hide();
            } else if(hasil_json.hasil == "pernahkunjungan"){
                myApp.dialog.alert("Anda Sudah Pernah Kunjungan");
                myApp.preloader.hide();
            } else if(hasil_json.hasil == "pernahkunjunganlebih"){
                myApp.preloader.hide();
                var act = "INPUT_KUNJUNGAN_LEBIH";
                myApp.dialog.confirm("Anda Sudah Pernah Menginput Kunjungan Ke Toko ini, Tetap Ingin Melanjutkan ?",function(){
                    myApp.request.post(ipTujuan,{case:act, DATETRANSACTION:DATETRANSACTION,KODEPELANGGAN:KODEPELANGGAN,
                        KETERANGAN:KETERANGAN,STATUSKUNJUNGAN:STATUSKUNJUNGAN, PERMINTAANKHUSUS:PERMINTAANKHUSUS,LATITUDEEDIT:LATITUDEEDIT, LONGITUDEEDIT:LONGITUDEEDIT,
                        TANGGALKEMBALI:TANGGALKEMBALI,KESIMPULAN:KESIMPULAN,USERID:USERID,namaFotoKunjungan:namaFotoKunjungan, latGlobal:latGlobal,lngGlobal:lngGlobal,waktuMasukLoginTokoKunjungan:WAKTUMASUK},function(data){
                            myApp.preloader.show();
                            myApp.dialog.alert("Berhasil Menginput Kunjungan Anda");
                            var hasil_json = JSON.parse(data);
                            waktuMasukLoginTokoKunjungan = "";
                            kodeLoginTokoKunjungan = "";
                            namaLoginTokoKunjungan = "";
                            localStorage.removeItem("namaLoginTokoKunjungan");
                            localStorage.removeItem("waktuMasukLoginTokoKunjungan");
                            localStorage.removeItem("kodeLoginTokoKunjungan");
                            RemoveItemLocalStorageKunjungan();
                            //mainView.router.navigate("/halaman_pilih_login_report/");
                            //mainView.router.back("/halaman_pilih_login_report/",{force:true});
                            mainView.router.back({force:true});
                            myApp.preloader.hide();

                            if(fotoKunjungan.length !=0){
                                for(var i =0; i<fotoKunjungan.length;i++){
                                    //myApp.dialog.alert(hasil_json.NOMORBUKTI +'-'+namaFotoKunjungan[i]);
                                    var toko = new FileUploadOptions();
                                    toko.fileKey = "photo";
                                    toko.fileName = fotoKunjungan[i].substr(fotoKunjungan[i].lastIndexOf('/') + 1);
                                    toko.mimeType = "image/jpeg";
                                    toko.chunkedMode = false;
                                    toko.headers = {
                                        Connection: "close"
                                    };
                                    toko.params = {
                                        namaFile:hasil_json.NOMORBUKTI +'-'+namaFotoKunjungan[i]
                                    }
                                    var ft = new FileTransfer();
                                    ft.upload(fotoKunjungan[i], 
                                        encodeURI(ipUploadKunjungan),
                                        win,
                                        fail,
                                        toko);

                                    var win = function(r) {
                                        console.log("Should not be called.");
                                    }

                                    var fail = function(error) {
                                        alert("An error has occurred: Code = " + error.code);
                                        console.log("upload error source " + error.source);
                                        console.log("upload error target " + error.target);
                                    }
                                }
                            }
                        },function(xhr,status){
                            if(status == 4 || status == 0){
                                myApp.preloader.hide();
                                myApp.dialog.alert("Internet Anda Bermasalah");
                            }
                        });
                });
            } else {
                myApp.dialog.alert("Berhasil Menginput Kunjungan Anda");
                waktuMasukLoginTokoKunjungan = "";
                kodeLoginTokoKunjungan = "";
                namaLoginTokoKunjungan = "";
                localStorage.removeItem("namaLoginTokoKunjungan");
                localStorage.removeItem("waktuMasukLoginTokoKunjungan");
                localStorage.removeItem("kodeLoginTokoKunjungan");
                RemoveItemLocalStorageKunjungan();
                //mainView.router.navigate("/halaman_pilih_login_report/");
                //mainView.router.back("/halaman_pilih_login_report/",{force:true});
                mainView.router.back({force:true});
                myApp.preloader.hide();


                if(fotoKunjungan.length !=0){
                    for(var i =0; i<fotoKunjungan.length;i++){
                        var toko = new FileUploadOptions();
                        toko.fileKey = "photo";
                        toko.fileName = fotoKunjungan[i].substr(fotoKunjungan[i].lastIndexOf('/') + 1);
                        toko.mimeType = "image/jpeg";
                        toko.chunkedMode = false;
                        toko.headers = {
                          Connection: "close"
                      };
                      toko.params = {

                        namaFile:hasil_json.NOMORBUKTI +'-'+namaFotoKunjungan[i]
                    }
                    var ft = new FileTransfer();
                    ft.upload(fotoKunjungan[i], 
                        encodeURI(ipUploadKunjungan),
                        win,
                        fail,
                        toko);

                    var win = function(r) {
                        console.log("Should not be called.");
                    }

                    var fail = function(error) {
                        alert("An error has occurred: Code = " + error.code);
                        console.log("upload error source " + error.source);
                        console.log("upload error target " + error.target);
                    }
                }
            }
        }
    },function(xhr,status){
        if(status == 4 || status == 0){
            myApp.preloader.hide();
            myApp.dialog.alert("Internet Anda Bermasalah");
        }
    });
}
},function(xhr,status){ //function milik get latitude
    if(status == 4 || status == 0){
        myApp.preloader.hide();
        myApp.dialog.alert("Internet Anda Bermasalah");
    }
});

}


});



today = new Date().setDate(today.getDate() - 1);

var calendarModal = myApp.calendar.create({
    inputEl: '#demo-calendar-kembali',
    openIn: 'customModal',
    header: true,
    footer: true,
    dateFormat: 'dd MM yyyy',
    minDate: today,
});


var searchbar = myApp.searchbar.create({
    el: '.searchbar',
    searchContainer: '.list',
    searchIn: '.namaToko',
    on: {
        search(sb, query, previousQuery) {
            console.log(query, previousQuery);
        }
    }
});

$$('.btnCancel').on('click',function(){
    myApp.popup.close('.popup-toko');

});

});

var editNama;
var editAlamat;
var editTelepon;
var editKtp;
var editUsername;
var editPassword;

$$(document).on('page:init', '.page[data-name="halaman_kunjungan"]', function (page) {
    $$('.editPostingHapus').on('click',function(){
        halamanPostingHapus = "tmkunjungan";
        mainView.router.navigate("/halaman_posting_hapus/");
    });

    if(userHakAksesArrayGlobal["masterKunjungan"]["UBAH"] == "F"){
        $$('.editPostingHapus').remove();
    }

    $$('.title').html(tanggalKunjungan);

    var act = "TAMPIL_SEMUA_OUTLET_KUNJUNGAN";
    myApp.request.post(ipTujuan,{case:act,USERID:USERID,DATETRANSACTION:tanggalKunjungan,KODEJABATAN:KODEJABATAN},function(data){
        var hasil_json = JSON.parse(data);
        var tampungSemuaKunjungan ="";
        if(hasil_json.hasil == "ada"){
            tampungSemuaKunjungan += "<ul>";
            for(var i = 0; i<hasil_json.KODEPELANGGAN.length;i++){
                tampungSemuaKunjungan+= `
                <li>
                <a href="#" onClick="detailPelanggan('MASTER_KUNJUNGAN','`+hasil_json.KODEPELANGGAN[i]+`','`+hasil_json.NAMA[i]+`',
                '`+hasil_json.ALAMAT[i].replace(/(["'])/g, "\\$1")+`','`+hasil_json.KOTA[i]+`','`+hasil_json.TELPON[i]+`','`+hasil_json.FAX[i]+`','`+hasil_json.KREDITLIMIT[i]+`',
                '`+hasil_json.SYARATPIUTANG[i]+`','`+hasil_json.SYARATPIUTANGMAX[i]+`','`+hasil_json.USERID[i]+`','`+hasil_json.TERM[i]+`',
                '`+hasil_json.NAMAKATEGORIPELANGGAN[i]+`','`+hasil_json.ALAMATKIRIM[i]+`','`+hasil_json.NOMORBUKTIKUNJUNGAN[i]+`')" class="item-link item-content">
                <div class="item-inner">
                <div class="item-title-row">
                <div class="item-text" style="color:black"><b>`+hasil_json.KODEPELANGGAN[i]+`</b>   <span class="badge color-green">`+hasil_json.KODESALESMAN[i]+`</span><Br>`+hasil_json.NAMA[i]+`</span></div>

                </div>      
                </div>
                </a>
                </li>`;
            }
            tampungSemuaKunjungan += "</ul>";

            $$('.listKunjungan').html(tampungSemuaKunjungan);
        } else {
            $$('.listKunjungan').html("Belum Ada Kunjungan");
        }
        myApp.preloader.hide();
    });
});

//halaman_follow_collector
$$(document).on('page:init', '.page[data-name="halaman_follow_collector"]', function (page) {
    $$('.backFollowCollector').on('click',function(){
        if(tampungHalamanFollowDanCollector == "FOLLOWUP"){
            mainView.router.navigate("/master_followup/");
        } else if(tampungHalamanFollowDanCollector == "KIRIMAN"){
            mainView.router.navigate("/master_kiriman/");
        } else {
            mainView.router.navigate("/master_collector/");
        }
    });

    
    var whereLikeHalaman;
    var tampungMasterHalaman;
    if(tampungHalamanFollowDanCollector == "FOLLOWUP"){
        whereLikeHalaman = "FA%";
        tampungMasterHalaman = "MASTER_FOLLOWUP";
        if(userHakAksesArrayGlobal.masterFollowUp != "undefined" && userHakAksesArrayGlobal["masterFollowUp"]["UBAH"] == "F"){
            $$('.editPostingHapus').remove();
        } 

    } else if(tampungHalamanFollowDanCollector == "KIRIMAN"){
        whereLikeHalaman = "PF%";
        tampungMasterHalaman = "MASTER_KIRIMAN";
        if(userHakAksesArrayGlobal.masterKiriman != "undefined" && userHakAksesArrayGlobal["masterKiriman"]["UBAH"] == "F"){
            console.log(userHakAksesArrayGlobal["masterKiriman"])
            $$('.editPostingHapus').remove();
        } 
    } else {
        whereLikeHalaman = "FC%";
        tampungMasterHalaman = "MASTER_COLLECTOR";
        if(userHakAksesArrayGlobal.masterCollector != "undefined" && userHakAksesArrayGlobal["masterCollector"]["UBAH"] == "F"){
            $$('.editPostingHapus').remove();
        } 
    }

    $$('.editPostingHapus').on('click',function(){
        halamanPostingHapus = "tmkunjungan";
        mainView.router.navigate("/halaman_posting_hapus/");
    });

    //myApp.dialog.alert(tanggalKunjungan+jumlahBelumKunjungan+jumlahSudahKunjungan);
    $$('.title').html(tampungTanggalFollowDanCollector);

    var act = "TAMPIL_SEMUA_OUTLET_FOLLOWUP_COLLECTOR";
    myApp.request.post(ipTujuan,{case:act,KODECABANG:KODECABANG,DATETRANSACTION:tampungTanggalFollowDanCollector,LIKE:whereLikeHalaman,USERID:USERID,KODEJABATAN:KODEJABATAN},function(data){
        var hasil_json = JSON.parse(data);
        var tampungSemuaKunjungan ="";
        if(hasil_json.hasil == "ada"){
            tampungSemuaKunjungan += "<ul>";
            for(var i = 0; i<hasil_json.KODEPELANGGAN.length;i++){
                tampungSemuaKunjungan+= `
                <li>
                <a href="#" onClick="detailPelanggan('`+tampungMasterHalaman+`','`+hasil_json.KODEPELANGGAN[i]+`','`+hasil_json.NAMA[i]+`',
                '`+hasil_json.ALAMAT[i].replace(/(["'])/g, "\\$1")+`','`+hasil_json.KOTA[i]+`','`+hasil_json.TELPON[i]+`','`+hasil_json.FAX[i]+`','`+hasil_json.KREDITLIMIT[i]+`',
                '`+hasil_json.SYARATPIUTANG[i]+`','`+hasil_json.SYARATPIUTANGMAX[i]+`','`+hasil_json.USERID[i]+`','`+hasil_json.TERM[i]+`',
                '`+hasil_json.NAMAKATEGORIPELANGGAN[i]+`','`+hasil_json.ALAMATKIRIM[i]+`','`+hasil_json.NOMORBUKTIKUNJUNGAN[i]+`')" class="item-link item-content">
                <div class="item-inner">
                <div class="item-title-row">
                <div class="item-text" style="color:black"><b>`+hasil_json.KODEPELANGGAN[i]+`</b>   <span class="badge color-green">`+hasil_json.KODESALESMAN[i]+`</span><Br>`+hasil_json.NAMA[i]+`</div>

                </div>      
                </div>
                </a>
                </li>`;
            }
            tampungSemuaKunjungan += "</ul>";

            $$('.listKunjungan').html(tampungSemuaKunjungan);
        } else {
            $$('.listKunjungan').html("Belum Ada Kunjungan");
        }
        myApp.preloader.hide();
    });
});


$$(document).on('page:init', '.page[data-name="lapor_kunjungan"]', function (page) {
    $$('.namaToko').val(namaToko);
    $$('.alamatToko').val(alamatToko);




    $$('.btnLapor').on('click',function(){
        var status = $$('.status').val();
        var alasan = $$('.alasan').val();
        var gambar = $$("#gambarKamera").attr("src");
        //myApp.dialog.alert(gambar);

        var options = new FileUploadOptions();
        options.fileKey = "photo";
        options.fileName = gambar.substr(gambar.lastIndexOf('/') + 1);
        options.mimeType = "image/jpeg";
        options.params = {
            namaFile:"kode"
        }

        var ft = new FileTransfer();
        ft.upload(gambar, 
          encodeURI(ipUpload),
          win,
          fail,
          options);

        var win = function(r) {
            console.log("Should not be called.");
            myApp.dialog.alert("berhasil");
        }

        var fail = function(error) {
            myApp.dialog.alert(error);
                    // error.code == FileTransferError.ABORT_ERR
                    alert("An error has occurred: Code = " + error.code);
                    console.log("upload error source " + error.source);
                    console.log("upload error target " + error.target);
                }

                myApp.dialog.alert("Data Sudah Diubah");

            });

    $$('.bukaKamera').on('click',function(){
        //myApp.dialog.alert("asd");

        navigator.camera.getPicture(onSuccess,onFail,{
            quality:30,
            destinationType : Camera.DestinationType.FILE_URI,
            
            correctOrientation: true,
            sourceType : Camera.PictureSourceType.CAMERA,
            cameraDirection: Camera.Direction.BACK
        });

        function onSuccess(imageData) {
            var image = document.getElementById('gambarKamera');
            image.src = imageData;
        }

        function onFail(message){
            myApp.alert('Failed because: ' +message);
        }

    });
});



$$(document).on('page:init', '.page[data-name="input_barang"]', function (page) {
    $$('.btnInputBarang').on('click',function(){
        var kode = $$('.kodeBarang').val();
        var nama = $$('.namaBarangg').val();
        var jumlah = $$('.jumlahBarang').val();
        var keterangan = $$('.keterangan').val();
        myApp.dialog.alert("Kode : "+ kode+"<br>Nama : "+nama);
        mainView.router.navigate("/master_barang/"); 
    });
});

$$(document).on('page:init', '.page[data-name="master_barang"]', function (page) {
    $$('.fabInputBarang').on('click',function(){
        mainView.router.navigate("/input_barang/");
    });
});

$$(document).on('page:init', '.page[data-name="import_laporan"]', function (page) {
    var params = {
        case:"TAMPIL_MASTER_JABATAN"
    }
    myApp.request.post(ipTujuan,params,
        function(data){
            var response = JSON.parse(data);
            var element = `<option value=""></option>`;
            for(var i = 0; i<response.KODEJABATAN.length;i++){
                element +=`<option value="${response.KODEJABATAN[i]}">${response.NAMA[i]}</option>`;
            }
            $$(".kodeSampaiJabatan").html(element);
            $$(".kodeDariJabatan").html(element);

        },
        function(xhr,status){
            PreloaderHide(status);
        })
    var calendarModal = myApp.calendar.create({
        inputEl: '#dariTanggalLaporanPerStaff',
        openIn: 'customModal',
        header: true,
        footer: true,
        dateFormat: 'MM dd yyyy',
    });

    var calendarModal = myApp.calendar.create({
        inputEl: '#sampaiTanggalLaporanPerStaff',
        openIn: 'customModal',
        header: true,
        footer: true,
        dateFormat: 'MM dd yyyy',
    });

    

    $$('.popup-open-karyawanPelangganDari').on('click',function(){
        myApp.popup.open('.popup-karyawanDari'); 
    });

    $$('.popup-open-karyawanPelangganSampai').on('click',function(){
        myApp.popup.open('.popup-karyawanSampai');
    });

    $$('.btnCancel').on('click',function(){
        myApp.popup.close('.popup-karyawanDari');
        myApp.popup.close('.popup-karyawanSampai');
    });

    PopupLaporanKaryawanDari("SEMUA");
    PopupLaporanKaryawanSampai("SEMUA");
    var searchbar3 = myApp.searchbar.create({
        el: '.searchKaryawanDari',
        searchContainer: '.listPopUpNamaKaryawanDari',
        searchIn: '.namaKaryawanDari',
        on: {
            search(sb, query, previousQuery) {
                console.log(query, previousQuery);
            }
        }
    });

    var searchbar4 = myApp.searchbar.create({
        el: '.searchKaryawanSampai',
        searchContainer: '.listPopUpNamaKaryawanSampai',
        searchIn: '.namaKaryawanSampai',
        on: {
            search(sb, query, previousQuery) {
                console.log(query, previousQuery);
            }
        }
    });
});

$$(document).on('page:init', '.page[data-name="master_karyawan"]', function (page) {
    if(!userHakAksesArrayGlobal["masterKaryawan"]){
    } else {
        if(userHakAksesArrayGlobal["masterKaryawan"]["TAMBAH"] == "F"){
            $$('.fabInputKaryawan').closest('.fab').remove();
        }
    }

    var searchbar = myApp.searchbar.create({
        el: '.searchbar',
        searchContainer: '.list',
        searchIn: '.namaKaryawan',
        on: {
            search(sb, query, previousQuery) {
                console.log(query, previousQuery);
            }
        }
    });

    var act = "TAMPIL_MASTER_KARYAWAN";
    myApp.request.post(ipTujuan,{case:act,KODECABANG:KODECABANG},function(data){
        var hasil_json = JSON.parse(data);
        var tampungMasterKaryawan = "";
        if(hasil_json.hasil == "ada"){
            tampungMasterKaryawan ="<ul>";
            for(var i = 0; i<hasil_json.KODEKARYAWAN.length; i++){
                tampungMasterKaryawan += `
                <li>
                <a href="#" class="item-link item-content" onClick="detailKaryawan('`+hasil_json.KODEKARYAWAN[i]+`','`+hasil_json.NAMA[i]+`','`+hasil_json.ALAMAT[i]+`','`+hasil_json.KOTA[i]+`',
                '`+hasil_json.TELEPON[i]+`','`+hasil_json.NAMAJABATAN[i]+`','`+hasil_json.KODECABANG[i]+`','`+hasil_json.NPWP[i]+`','`+hasil_json.KTP[i]+`'
                ,'`+hasil_json.TANGGALMASUK[i]+`','`+hasil_json.TANGGALKELUAR[i]+`','`+hasil_json.STATUSKARYAWAN[i]+`','`+hasil_json.KODEJABATAN[i]+`', '`+hasil_json.USERID[i]+`', '`+hasil_json.STATUS[i]+`')">
                <div class="item-inner">
                <div class="item-text namaKaryawan" style="color:black">`+hasil_json.NAMA[i]+`</div>

                </div>
                </a>
                </li>
                `;
            }
            tampungMasterKaryawan +="</ul>";

            $$('.tampilMasterKaryawan').html(tampungMasterKaryawan);

        } else {
            $$('.tampilMasterKaryawan').html("Tidak Mempunyai Data Karyawan");
        }
        myApp.preloader.hide();
    });


    $$('.fabInputKaryawan').on('click',function(){
        mainView.router.navigate("/input_karyawan/"); 
    });
});



$$(document).on('page:init', '.page[data-name="detail_karyawan"]', function (page) {
    if(!userHakAksesArrayGlobal["masterKaryawan"]){
    } else {
        if(userHakAksesArrayGlobal["masterKaryawan"]["UBAH"] == "F"){
            $$('.editKaryawan').closest('.right').remove();
        }
        if(userHakAksesArrayGlobal["masterKaryawan"]["HAPUS"] == "F"){
            $$('.btnHapusKaryawan').remove();
        }
        if(userHakAksesArrayGlobal["masterKaryawan"]["POSTING"] == "F"){
            $$('.btnPostingKaryawan').remove();
        }
    }

    if(tampungStatusPostingKaryawan == "CLOSE"){
        $$('.btnPostingKaryawan').remove();
        $$('.btnHapusKaryawan').remove();
        $$('.editKaryawan').remove();
    }

    $$('.btnPostingKaryawan').on('click',function(){
        var act = "POSTING_KARYAWAN";
        myApp.dialog.confirm("Posting "+tampungNamaKaryawan +" ?",function(){
            myApp.request.post(ipTujuan,{case:act,KODEKARYAWAN:tampungKodeKaryawan,USERID:USERID},function(data){
                //var hasil_json = JSON.parse(data);
                myApp.dialog.alert(tampungNamaKaryawan +" Sudah Diposting");
                //mainView.router.navigate("/master_karyawan/");
                mainView.router.back("/master_karyawan/",{force:true});
            });
        });
    });

    $$('.btnHapusKaryawan').on('click',function(){
        var act = "HAPUS_KARYAWAN";
        myApp.dialog.confirm("Hapus "+tampungNamaKaryawan +" ?",function(){
            myApp.request.post(ipTujuan,{case:act,KODEKARYAWAN:tampungKodeKaryawan},function(data){
                //var hasil_json = JSON.parse(data);
                myApp.dialog.alert(tampungNamaKaryawan +" Sudah Dihapus");
                //mainView.router.navigate("/master_karyawan/");
                mainView.router.back("/master_karyawan/",{force:true});
            });
        });
    });

    $$('.detailKodeKaryawan').html(tampungKodeKaryawan);
    $$('.detailNamaKaryawan').html(tampungNamaKaryawan);
    $$('.detailAlamatKaryawan').html(tampungAlamatKaryawan);
    $$('.detailKotaKaryawan').html(tampungKotaKaryawan);
    $$('.detailTeleponKaryawan').html(tampungTeleponKaryawan);
    $$('.detailJabatanKaryawan').html(tampungNamaJabatanKaryawan);
    $$('.detailCabangKaryawan').html(tampungKodeCabangKaryawan);
    $$('.detailNpwpKaryawan').html(tampungNpwpKaryawan);
    $$('.detailKtpKaryawan').html(tampungKtpKaryawan);
    $$('.detailTanggalMasukKaryawan').html(tampungTanggalMasukKaryawan);
    if(tampungTanggalKeluarKaryawan==="null"){
        $$('.detailTanggalKeluarKaryawan').html("-");
    } else {

        $$('.detailTanggalKeluarKaryawan').html(tampungTanggalKeluarKaryawan);
    }
    $$('.detailUserIdKaryawan').html(tampungUserIdKaryawan);

    tampungSourceGambar = [];

    var act = "TAMPIL_FOTO_KARYAWAN";
    myApp.request.post(ipTujuan,{case:act,KODEKARYAWAN:tampungKodeKaryawan},function(data){
        var hasil_json = JSON.parse(data);
        if(hasil_json.gambarktp == "ada"){
            var fotoKtp = document.getElementById('foto-ktp');
            fotoKtp.src = ipGambar+tampungKodeKaryawan+"-ktp.jpg?"+ new Date().getTime();
            tampungSourceGambar.push(ipGambar+tampungKodeKaryawan+"-ktp.jpg?"+ new Date().getTime());
        } else {
            $$('#foto-ktp').closest('.card').remove();
        }

        if(hasil_json.gambarnpwp == "ada"){

            var fotoNpwp = document.getElementById('foto-npwp');
            fotoNpwp.src = ipGambar+tampungKodeKaryawan+"-npwp.jpg?"+ new Date().getTime();
            tampungSourceGambar.push(ipGambar+tampungKodeKaryawan+"-npwp.jpg?"+ new Date().getTime());
        } else {
            $$('#foto-npwp').closest('.card').remove();
        }

        if(hasil_json.gambardiri == "ada"){
            var fotoKaryawan = document.getElementById('foto-karyawan');
            fotoKaryawan.src = ipGambar+tampungKodeKaryawan+"-karyawan.jpg?"+ new Date().getTime();
            tampungSourceGambar.push(ipGambar+tampungKodeKaryawan+"-karyawan.jpg?"+ new Date().getTime());
        } else {
            $$('#foto-karyawan').closest('.card').remove();
        }
    });


    var myPhotoBrowserDark = myApp.photoBrowser.create({
        photos : tampungSourceGambar,
        theme: 'dark'
    });

    $$('.pb-standalone-dark').on('click', function () {
        myPhotoBrowserDark.open();
    });

    $$('.editKaryawan').on('click',function(){
        mainView.router.navigate("/edit_karyawan/");
    });
});

$$(document).on('page:init', '.page[data-name="edit_profile"]', function (page) {
    var params = {
        case:"EDIT_PROFILE",
        USERID:USERID,
        KODEJABATAN:KODEJABATAN,
        KODECABANG:KODECABANG
    }

    myApp.request.post(ipTujuan,params,
        function(data){
            var response = JSON.parse(data);
            console.log(response);
            if(response.hasil == "ada"){
                $$("#namaProfile").val(response.profile.NAMA);
                $$("#alamatProfile").val(response.profile.ALAMAT);
                $$("#noHpProfile").val(response.profile.TELEPON);
                if(response.profile.FOTO == "ada"){
                    $$('#fotoProfile').attr("src",ipGambar+USERID+"-karyawan.jpg?"+ new Date().getTime())
                } else{
                    $$('#fotoProfile').attr("src",noProfilePict)
                }
            } else {

            }
            myApp.preloader.hide();
        },
        function(xhr,status){
            PreloaderHide(status);
        })
});


/*hasil_laporan_rencana_tagihan*/
$$(document).on('page:init', '.page[data-name="hasil_laporan_rencana_tagihan"]', function (page) {
    HideTombolExport();
    var params = {
        case:"LAPORAN_RENCANA_TAGIHAN",
        USERID:USERID,
        KODECABANG:KODECABANG,
        KODEJABATAN:KODEJABATAN,
        STAFFDARI:staffDariRencana,
        STAFFSAMPAI:staffSampaiRencana,
        TANGGALDARI:tanggalDariRencana,
        TANGGALSAMPAI:tanggalSampaiRencana
    }

    myApp.request.post(ipTujuan,params,
        function(data){
            var response = JSON.parse(data);
            if(response.hasil == "ada"){
                var element = `<div class="row">`;
                var KODESALESMAN = "";
                var counterelement = 0;
                var counterTanggal = "";
                var lengthResponse = response.RENCANA.length;
                response.RENCANA.forEach(function(obj,x){
                    if(counterTanggal != obj.DATETRANSACTION){

                        if( counterelement != 0 && counterTanggal != obj.DATETRANSACTION){
                            element +=`</ul>
                            </div>
                            </div>
                            </div>`;
                        }
                        element +=`<div class="card card-outline col-50 tablet-33 desktop-25 margin-top" style="margin:0 auto;">
                        <div class="card-header boldPutih" style="background-color:#e2552b;">${ConvertDateTimeToText(obj.DATETRANSACTION,'dateday')}</div>
                        <div class="card-content card-content-padding">
                        <div class="list simple-list">
                        <ul>`;

                        counterTanggal = obj.DATETRANSACTION;
                        KODESALESMAN = "";
                    }
                    
                    
                    if(counterTanggal == obj.DATETRANSACTION && KODESALESMAN != obj.KODESALESMAN){
                        counterTanggal = obj.DATETRANSACTION;
                        KODESALESMAN = obj.KODESALESMAN;
                        var jumlah =0;
                        response.KODESALESMAN.forEach(function(obj,x){
                            if(KODESALESMAN == obj.KODESALESMAN && obj.DATETRANSACTION == counterTanggal){
                                jumlah++;
                            }
                        })
                        element +=`<li class="item-divider bold">${obj.KODESALESMAN} <span class="badge color-white text-align-right" style="color:red;font-size:1.2em">${jumlah}</span></li>`;
                    }

                    element += `<li><div class="item-title">${obj.NAMAPELANGGAN} - ${obj.KOTA}</div></li>`;
                    
                    if( lengthResponse == x+1){
                        element +=`</ul>
                        </div>
                        </div>
                        </div>`;
                    }
                    counterelement = 1;
                })
                element +=`</div>`;
                $$('#pageHasilRekapRencanaKunjungan').html(element);
            }
            myApp.preloader.hide();
        },
        function(xhr,status){
            PreloaderHide(status);
        })
})

/*hasil_laporan_rencana_kunjungan*/
$$(document).on('page:init', '.page[data-name="hasil_laporan_rencana_kunjungan"]', function (page) {
    myApp.preloader.hide();
    HideTombolExport();
    var params = {
        case:"LAPORAN_RENCANA_KUNJUNGAN",
        USERID:USERID,
        KODECABANG:KODECABANG,
        KODEJABATAN:KODEJABATAN,
        STAFFDARI:staffDariRencana,
        STAFFSAMPAI:staffSampaiRencana,
        TANGGALDARI:tanggalDariRencana,
        TANGGALSAMPAI:tanggalSampaiRencana
    }

    myApp.request.post(ipTujuan,params,
        function(data){
            var response = JSON.parse(data);
            if(response.hasil == "ada"){
                var element = `<div class="row">`;
                var KODESALESMAN = "";
                var counterelement = 0;
                var counterTanggal = "";
                var lengthResponse = response.RENCANA.length;
                response.RENCANA.forEach(function(obj,x){
                    if(counterTanggal != obj.DATETRANSACTION){

                        if( counterelement != 0 && counterTanggal != obj.DATETRANSACTION){
                            element +=`</ul>
                            </div>
                            </div>
                            </div>`;
                        }
                        element +=`<div class="card card-outline col-50 tablet-33 desktop-25 margin-top" style="margin:0 auto;" id="${obj.DATETRANSACTION}">
                        <div class="card-header boldPutih" style="background-color:#e2552b;">${ConvertDateTimeToText(obj.DATETRANSACTION,'dateday')}</div>
                        <div class="card-content card-content-padding">
                        <div class="list simple-list">
                        <ul>`;

                        counterTanggal = obj.DATETRANSACTION;
                        KODESALESMAN = "";
                    }
                    
                    
                    if(counterTanggal == obj.DATETRANSACTION && KODESALESMAN != obj.KODESALESMAN){
                        counterTanggal = obj.DATETRANSACTION;
                        KODESALESMAN = obj.KODESALESMAN;
                        var jumlah =0;
                        response.KODESALESMAN.forEach(function(obj,x){
                            if(KODESALESMAN == obj.KODESALESMAN && obj.DATETRANSACTION == counterTanggal){
                                jumlah++;
                            }
                        })
                        element +=`<li class="item-divider bold">${obj.KODESALESMAN} <span class="badge color-white text-align-right" style="color:red;font-size:1.2em">${jumlah}</span></li>`;
                    }

                    element += `<li><div class="item-title">${obj.NAMAPELANGGAN} - ${obj.KOTA}</div></li>`;
                    
                    if( lengthResponse == x+1){
                        element +=`</ul>
                        </div>
                        </div>
                        </div>`;
                    }
                    counterelement = 1;
                })
                element +=`</div>`;
                $$('#pageHasilRekapRencanaKunjungan').html(element);

                var counter_tanggal = "";
                var element ="";
                /*response.TIDAK_ADA_RENCANA.forEach(function(obj,x){
                    if(counter_tanggal == "" ){
                        counter_tanggal = obj.TANGGAL;
                    }
                    element +=`<li class="item-divider bold">${obj.KODESALESMAN} <span class="badge color-white text-align-right" style="color:red;font-size:1.2em">${obj.JUMLAH_RENCANA}</span></li>`;
                    
                    if(response.TIDAK_ADA_RENCANA[x+1]){

                        if(counter_tanggal != response.TIDAK_ADA_RENCANA[x+1].TANGGAL){
                            $$("#"+obj.TANGGAL).find('ul').append(element);
                            counter_tanggal = obj.TANGGAL;
                            element = "";
                        }
                    }

                    if(response.TIDAK_ADA_RENCANA.length == x+1){
                        $$("#"+obj.TANGGAL).find('ul').append(element);
                        counter_tanggal = obj.TANGGAL;
                        element = "";
                    }

                })*/
            }
            myApp.preloader.hide();
        },
        function(xhr,status){
            PreloaderHide(status);
        })
})

/*hasil_laporan_kunjungan*/
$$(document).on('page:init', '.page[data-name="hasil_laporan_kunjungan"]', function (page) {
    HideTombolExport();
    var params = {
        case:"LAPORAN_KUNJUNGAN",
        USERID:USERID,
        KODECABANG:KODECABANG,
        KODEJABATAN:KODEJABATAN,
        STAFFDARI:staffDariKunjungan,
        STAFFSAMPAI:staffSampaiKunjungan,
        TANGGALDARI:tanggalDariKunjungan,
        TANGGALSAMPAI:tanggalSampaiKunjungan
    }

    myApp.request.post(ipTujuan,params,
        function(data){
            var response = JSON.parse(data);
            if(response.hasil == "ada"){
                var element = `<div class="row">`;
                var KODESALESMAN = "";
                var counterelement = 0;
                var counterTanggal = "";
                var lengthResponse = response.KUNJUNGAN.length;
                response.KUNJUNGAN.forEach(function(obj,x){
                    if(counterTanggal != obj.DATETRANSACTION){

                        if( counterelement != 0 && counterTanggal != obj.DATETRANSACTION){
                            element +=`</ul>
                            </div>
                            </div>
                            </div>`;
                        }
                        element +=`<div class="card card-outline col-50 tablet-33 desktop-25 margin-top" style="margin:0 auto;">
                        <div class="card-header boldPutih" style="background-color:#e2552b;">${ConvertDateTimeToText(obj.DATETRANSACTION,'dateday')}</div>
                        <div class="card-content card-content-padding">
                        <div class="list simple-list">
                        <ul>`;

                        counterTanggal = obj.DATETRANSACTION;
                        KODESALESMAN = "";
                    }
                    
                    
                    if(counterTanggal == obj.DATETRANSACTION && KODESALESMAN != obj.KODESALESMAN){
                        counterTanggal = obj.DATETRANSACTION;
                        KODESALESMAN = obj.KODESALESMAN;
                        var jumlah =0;
                        response.KODESALESMAN.forEach(function(obj,x){
                            if(KODESALESMAN == obj.KODESALESMAN && obj.DATETRANSACTION == counterTanggal){
                                jumlah++;
                            }
                        })
                        
                        var total_point = 0;
                        response.KUNJUNGAN.forEach(function(obj,x){
                    if(KODESALESMAN == obj.KODESALESMAN && obj.DATETRANSACTION == counterTanggal){
                        var res_kategori = obj.KATEGORIPELANGGAN.substr(0,4);
                        if(obj.SESUAI_KUNJUNGAN == "ya")
                        {
                            if(res_kategori == "TOKO"){
                                total_point += 2; 
                            }
                            if(res_kategori == "FLEE")
                            {
                                total_point += 3.2; 
                            }
                            else
                            {
                                total_point += 0;
                            }
                        }
                        else
                        {
                            if(res_kategori == "TOKO"){
                                total_point += 1; 
                            }
                            if(res_kategori == "FLEE")
                            {
                                total_point += 1.6; 
                            }
                            else
                            {
                                total_point += 0;
                            }
                        }
                    }

                        })                        
                        element +=`<li class="item-divider bold" style="height:70px;">`;
                        element +=`<label style="line-height:20px;">${obj.KODESALESMAN}<br><b style="font-size:12px; color:black;">POINT ${total_point}</b></label>`;
                        element +=`<span class="badge color-white text-align-right" style="color:red;font-size:1.2em">${jumlah}</span></li>`;
                    }

                    element += `<li><div class="item-title"`;
                    if(obj.SESUAI_KUNJUNGAN == "tidak"){
                        element += ` style="color:red"`;
                    }
                    element+=`>${obj.NAMAPELANGGAN} - ${obj.KOTA} (${obj.KATEGORIPELANGGAN})</div></li>`;
                    
                    if( lengthResponse == x+1){
                        element +=`</ul>
                        </div>
                        </div>
                        </div>`;
                    }
                    counterelement = 1;
                })
                element +=`</div>`;
                $$('#pageHasilRekapRencanaKunjungan').html(element);
            }
            myApp.preloader.hide();
        },
        function(xhr,status){
            PreloaderHide(status);
        })
})


/*input_absensi*/
$$(document).on('page:init', '.page[data-name="input_absensi"]', function (page) {
    myApp.preloader.hide();
    var params = {
        case:"CEK_STATUS_INPUT_ABSENSI",
        USERID:USERID,
    };
    myApp.request.post(ipTujuan,params,
        function(data){
            var response = JSON.parse(data);
            if(response.hasil == "LOGIN" || response.hasil == "LOGOUT"){
                $$("#jenisInputAbsensi").val(response.hasil);
                $$("#idInputAbsensi").val(response.id);
            } else {
                myApp.dialog.alert("Terjadi Kesalahan Silahkan Menghubungi Admin");
            }
        },
        function(xhr,status){
            PreloaderHide(status);
        })
})



/*master_absensi*/
$$(document).on('page:init', '.page[data-name="master_absensi"]', function (page) {
    $$("#namaAbsensi").html(USERID);
    var params = {
        case:"MASTER_ABSENSI",
        USERID:USERID,
    };
    myApp.request.post(ipTujuan,params,
        function(data){
            var response = JSON.parse(data);
            if(response.hasil == "berhasil"){
                LiveClockFromServer(response.JAM_SERVER);
                if(response.MASTER_ABSENSI){
                    var element = `<div class="card">
                    <div class="card-content">
                    <div class="list semuaTampilMasterLaporan">
                    <ul>`;
                    response.MASTER_ABSENSI.forEach(function(obj,x){
                        element += `<li>
                        <div class="item-inner item-content">
                        <div class="item-title">${ConvertDateTimeToText(obj.tanggal,'dateday')}  `;

                        if(obj.waktu_login){
                            element +=` ${ConvertDateTimeToText(obj.waktu_login,'time')} Datang`;
                        }

                        if(obj.waktu_logout){
                            element +=` ${ConvertDateTimeToText(obj.waktu_logout,'time')} Pulang`;
                        }

                        element +=`</div>
                        </div>
                        </li>`;
                    });
                    element += `</ul>
                    </div>
                    </div>
                    </div>`;

                    var jumlahMasuk = parseInt(response.DIAGRAM_JUMLAH.MASUK) + parseInt(response.DIAGRAM_JUMLAH.LEMBUR);
                    HighChartDiagramJumlah(response.TAMPIL_HARI_ABSENSI,response.DIAGRAM_JUMLAH.MASUK,response.DIAGRAM_JUMLAH.LEMBUR,response.DIAGRAM_JUMLAH.LIBUR,"containerChartJumlah");
                    HighChartDiagram(jumlahMasuk,response.DIAGRAM_JUMLAH_KETEPATAN.TEPAT_WAKTU,response.DIAGRAM_JUMLAH_KETEPATAN.TIDAK_TEPAT_WAKTU,"containerDiagramKetepatan");

                } else {
                    var element = "Belum Pernah Absen";
                }

                $$("#master_absensi").html(element);myApp.preloader.hide();
            } else {
                myApp.preloader.hide();
                myApp.dialog.alert("Terjadi Kesalahan Silahkan Menghubungi Admin");
            }
        },
        function(xhr,status){
            PreloaderHide(status);
        })
})

/*laporan_absensi*/
$$(document).on('page:init', '.page[data-name="laporan_absensi"]', function (page) {
    var calendarModal = myApp.calendar.create({
        inputEl: '#dariTanggalLaporan',
        openIn: 'customModal',
        header: true,
        footer: true,
        dateFormat: 'MM dd yyyy',
    });

    var calendarModal = myApp.calendar.create({
        inputEl: '#sampaiTanggalLaporan',
        openIn: 'customModal',
        header: true,
        footer: true,
        dateFormat: 'MM dd yyyy',
    });

    $$('.popup-open-karyawanPelangganDari').on('click',function(){
        myApp.popup.open('.popup-karyawanDari'); 
    });

    PopupLaporanKaryawanUserId(USERID);
    $$('.btnCancel').on('click',function(){
        myApp.popup.close('.popup-karyawanDari');
    });
    
    HasilLaporanAbsensi();
    myApp.preloader.hide();
})

/*parameter_laporan_absensi*/
$$(document).on('page:init', '.page[data-name="parameter_laporan_absensi"]', function (page) {
    var calendarModal = myApp.calendar.create({
        inputEl: '#dariTanggalLaporanPerStaff',
        openIn: 'customModal',
        header: true,
        footer: true,
        dateFormat: 'MM dd yyyy',
    });

    var calendarModal = myApp.calendar.create({
        inputEl: '#sampaiTanggalLaporanPerStaff',
        openIn: 'customModal',
        header: true,
        footer: true,
        dateFormat: 'MM dd yyyy',
    });

    $$('.popup-open-karyawanPelangganDari').on('click',function(){
        myApp.popup.open('.popup-karyawanDari');
    });


    $$('.btnCancel').on('click',function(){
        myApp.popup.close('.popup-karyawanDari');
    });


    PopupLaporanKaryawanUserIdAbsensi(USERID);
    SearhInputDari('searchKaryawanDari','listPopUpNamaKaryawanDari','namaKaryawanDari');
    myApp.preloader.hide();

    $$(".LihatLaporanAbsensi").on('click',function(){
        myApp.preloader.show();
        var KODESALESMAN = $$(".kodeDariSalesmanLaporan").val();
        var TANGGALDARI = $$("#dariTanggalLaporanPerStaff").val();
        var TANGGALSAMPAI = $$("#sampaiTanggalLaporanPerStaff").val();
        if(!KODESALESMAN){
            alertKosong('Staff');
        } else if(!TANGGALDARI){
            alertKosong('Tanggal Dari');
        } else if(!TANGGALSAMPAI){
            alertKosong('Tanggal Sampai');
        } else {
            mainView.router.navigate("/laporan_absensi/");
        }
    });
})

/*parameter_laporan_point_kunjungan*/
$$(document).on('page:init', '.page[data-name="parameter_laporan_point_kunjungan"]', function (page) {
    SearhInputDari('searchKaryawanDari','listPopUpNamaKaryawanDari','namaKaryawanDari');
    var calendarModal = myApp.calendar.create({
        inputEl: '#dariTanggalLaporanPerStaff',
        openIn: 'customModal',
        header: true,
        footer: true,
        dateFormat: 'MM dd yyyy',
    });

    var calendarModal = myApp.calendar.create({
        inputEl: '#sampaiTanggalLaporanPerStaff',
        openIn: 'customModal',
        header: true,
        footer: true,
        dateFormat: 'MM dd yyyy',
    });

    $$('.popup-open-karyawanPelangganDari').on('click',function(){
        myApp.popup.open('.popup-karyawanDari'); 
    });


    $$('.btnCancel').on('click',function(){
        myApp.popup.close('.popup-karyawanDari');
    });


    PopupLaporanKaryawanUserId(USERID);
    myApp.preloader.hide();

    $$(".LihatLaporanPointKunjungan").on('click',function(){
        myApp.preloader.show();
        var KODESALESMAN = $$(".kodeDariSalesmanLaporan").val();
        var TANGGALDARI = $$("#dariTanggalLaporanPerStaff").val();
        var TANGGALSAMPAI = $$("#sampaiTanggalLaporanPerStaff").val();
        if(!KODESALESMAN){
            alertKosong('Staff');
        } else if(!TANGGALDARI){
            alertKosong('Tanggal Dari');
        } else if(!TANGGALSAMPAI){
            alertKosong('Tanggal Sampai');
        } else {
            mainView.router.navigate("/laporan_point_kunjungan/");
        }
    });
})

/*laporan_absensi*/
$$(document).on('page:init', '.page[data-name="laporan_point_kunjungan"]', function (page) {
    var calendarModal = myApp.calendar.create({
        inputEl: '#dariTanggalLaporan',
        openIn: 'customModal',
        header: true,
        footer: true,
        dateFormat: 'MM dd yyyy',
    });

    var calendarModal = myApp.calendar.create({
        inputEl: '#sampaiTanggalLaporan',
        openIn: 'customModal',
        header: true,
        footer: true,
        dateFormat: 'MM dd yyyy',
    });

    $$('.popup-open-karyawanPelangganDari').on('click',function(){
        myApp.popup.open('.popup-karyawanDari'); 
    });

    PopupLaporanKaryawanUserId(USERID);
    $$('.btnCancel').on('click',function(){
        myApp.popup.close('.popup-karyawanDari');
    });
    
    HasilLaporanPointKunjungan();
    myApp.preloader.hide();
})

$$(document).on('page:init', '.page[data-name="edit_karyawan"]', function (page) {
    $$("input[type=text]").keyup(function(){
        $$(this).val( $$(this).val().toUpperCase());
    });

    $$('.editKodeKaryawan').val(tampungKodeKaryawan);
    $$('.editNamaKaryawan').val(tampungNamaKaryawan);
    $$('.editAlamatKaryawan').val(tampungAlamatKaryawan);
    $$('.editKotaKaryawan').val(tampungKotaKaryawan);
    $$('.editNoKaryawan').val(tampungTeleponKaryawan);
    $$('#demo-calendar-modal-masuk').val(tampungTanggalMasukKaryawan);
    $$('.editNpwpKaryawan').val(tampungNpwpKaryawan);
    $$('.editKtpKaryawan').val(tampungKtpKaryawan);
    $$('.editCabangKaryawan').val(tampungKodeCabangKaryawan);
    $$('.editUserIdKaryawan').val(USERID);
    var counterFotoKtp = "0";
    var counterFotoNpwp = "0";
    var counterFotoKaryawan = "0";



    var act = "TAMPIL_JABATAN";
    myApp.request.post(ipTujuan,{case:act,KODECABANG:KODECABANG},function(data){
        var hasil_json = JSON.parse(data);
        var tampungSelect = "";
        if(hasil_json.hasil == "ada"){
            for(var i =0; i<hasil_json.NAMA.length; i++){
                if(tampungKodeJabatanKaryawan == hasil_json.KODEJABATAN[i]){
                    tampungSelect +=`<option value="`+hasil_json.KODEJABATAN[i]+`" selected>`+hasil_json.NAMA[i]+`</option>`;
                } else {

                    tampungSelect +=`<option value="`+hasil_json.KODEJABATAN[i]+`">`+hasil_json.NAMA[i]+`</option>`;
                }
            }
            $$('.jabatanEditKaryawan').html(tampungSelect);
        } else {
            $$('.jabatanEditKaryawan').html("");
        }
    });

    $$('.ambilFotoKtp').on('click',function(page){
        navigator.camera.getPicture(onSuccess,onFail,{
            quality:30,
            destinationType : Camera.DestinationType.FILE_URI,
            
            correctOrientation: true,
            sourceType : Camera.PictureSourceType.CAMERA,
            cameraDirection: Camera.Direction.BACK
        });

        function onSuccess(imageData){
            var image = document.getElementById('edit-foto-ktp');
            image.src = imageData;
            counterFotoKtp = "1";
        }

        function onFail(message){
            myApp.alert('Failed because: ' +message);
        }

    });

    $$('.ambilFotoNpwp').on('click',function(page){
        navigator.camera.getPicture(onSuccess,onFail,{
            quality:30,
            destinationType : Camera.DestinationType.FILE_URI,
            
            correctOrientation: true,
            sourceType : Camera.PictureSourceType.CAMERA,
            cameraDirection: Camera.Direction.BACK
        });

        function onSuccess(imageData){
            var image = document.getElementById('edit-foto-npwp');
            image.src = imageData;
            counterFotoNpwp = "1";
        }

        function onFail(message){
            myApp.alert('Failed because: ' +message);
        }
    });

    $$('.ambilFotoKaryawan').on('click',function(page){
        navigator.camera.getPicture(onSuccess,onFail,{
            quality:30,
            destinationType : Camera.DestinationType.FILE_URI,
            
            correctOrientation: true,
            sourceType : Camera.PictureSourceType.CAMERA,
            cameraDirection: Camera.Direction.BACK
        });

        function onSuccess(imageData){
            var image = document.getElementById('edit-foto-karyawan');
            image.src = imageData;
            counterFotoKaryawan = "1";
        }

        function onFail(message){
            myApp.alert('Failed because: ' +message);
        }
    });

    var fotoKtp = document.getElementById('edit-foto-ktp');
    fotoKtp.src = ipGambar+tampungKodeKaryawan+"-ktp.jpg?"+ new Date().getTime();

    var fotoNpwp = document.getElementById('edit-foto-npwp');
    fotoNpwp.src = ipGambar+tampungKodeKaryawan+"-npwp.jpg?"+ new Date().getTime();

    var fotoKaryawan = document.getElementById('edit-foto-karyawan');
    fotoKaryawan.src = ipGambar+tampungKodeKaryawan+"-karyawan.jpg?"+ new Date().getTime();

    $$('.btnInputKaryawan').on('click',function(){

        var act = "EDIT_KARYAWAN";
        var KODEKARYAWAN = $$('.editKodeKaryawan').val();
        var NAMA = $$('.editNamaKaryawan').val();
        var ALAMAT = $$('.editAlamatKaryawan').val();
        var KOTA = $$('.editKotaKaryawan').val();
        var TELEPON  = $$('.editNoKaryawan').val();
        var NPWP  = $$('.editNpwpKaryawan').val();
        var KTP = $$('.editKtpKaryawan').val();
        var TANGGALMASUK = $$('#demo-calendar-modal-masuk').val();
        var KODECABANG = $$('.editCabangKaryawan').val();
        var KODEJABATANEDIT = $$('.jabatanEditKaryawan').val();


        var FOTOKTP = $$("#edit-foto-ktp").attr("src");
        var FOTONPWP = $$("#edit-foto-npwp").attr("src");
        var FOTOKARYAWAN = $$("#edit-foto-karyawan").attr("src");
        myApp.preloader.show();

        console.log(KODEKARYAWAN,NAMA,ALAMAT,KOTA,TELEPON,NPWP,KTP,TANGGALMASUK,KODECABANG,KODEJABATAN);

        if(KODEKARYAWAN&&NAMA&&ALAMAT&&KOTA&&TELEPON&&NPWP&&KTP&&TANGGALMASUK&&KODECABANG&&KODEJABATAN){
         myApp.request.post(ipTujuan,{case:act , KODEKARYAWAN:KODEKARYAWAN , NAMA:NAMA , ALAMAT:ALAMAT , KOTA:KOTA , TELEPON:TELEPON,
            NPWP:NPWP, KTP:KTP, TANGGALMASUK:TANGGALMASUK,
            KODECABANG:KODECABANG , KODEJABATAN:KODEJABATANEDIT, USERID:USERID},function(data){
                if(counterFotoKtp=="1"){
                    myApp.dialog.alert(FOTOKTP);
                    myApp.dialog.alert(FOTOKTP.substr(FOTOKTP.lastIndexOf('/') + 1));
                    var ktp = new FileUploadOptions();
                    ktp.fileKey = "photo";
                    ktp.fileName = FOTOKTP.substr(FOTOKTP.lastIndexOf('/') + 1);
                    ktp.mimeType = "image/jpeg";
                    ktp.chunkedMode = false;

                    ktp.headers = {
                      Connection: "close"
                  };
                  ktp.params = {
                    namaFile:KODEKARYAWAN +"-ktp"
                }


                var ft = new FileTransfer();
                ft.upload(FOTOKTP, 
                  encodeURI(ipUpload),
                  win,
                  fail,
                  ktp);

                var win = function(r) {
                    console.log("Should not be called.");
                }

                var fail = function(error) {
                    // error.code == FileTransferError.ABORT_ERR
                    alert("An error has occurred: Code = " + error.code);
                    console.log("upload error source " + error.source);
                    console.log("upload error target " + error.target);
                }
            }

            if(counterFotoNpwp == "1"){
                var npwp = new FileUploadOptions();
                npwp.fileKey = "photo";
                npwp.fileName = FOTONPWP.substr(FOTONPWP.lastIndexOf('/') + 1);
                npwp.mimeType = "image/jpeg";
                npwp.chunkedMode = false;
                npwp.headers = {
                  Connection: "close"
              };
              npwp.params = {
                namaFile:KODEKARYAWAN +"-npwp"
            }


            var ft = new FileTransfer();
            ft.upload(FOTONPWP, 
              encodeURI(ipUpload),
              win,
              fail,
              npwp);

            var win = function(r) {
                console.log("Should not be called.");
            }

            var fail = function(error) {
                alert("An error has occurred: Code = " + error.code);
                console.log("upload error source " + error.source);
                console.log("upload error target " + error.target);
            }
        }

        if(counterFotoKaryawan == "1"){
            var npwp = new FileUploadOptions();
            npwp.fileKey = "photo";
            npwp.fileName = FOTOKARYAWAN.substr(FOTOKARYAWAN.lastIndexOf('/') + 1);
            npwp.mimeType = "image/jpeg";
            npwp.chunkedMode = false;
            npwp.headers = {
              Connection: "close"
          };
          npwp.params = {
            namaFile:KODEKARYAWAN +"-karyawan"
        }


        var ft = new FileTransfer();
        ft.upload(FOTOKARYAWAN, 
          encodeURI(ipUpload),
          win,
          fail,
          npwp);

        var win = function(r) {
            console.log("Should not be called.");
        }

        var fail = function(error) {
            alert("An error has occurred: Code = " + error.code);
            console.log("upload error source " + error.source);
            console.log("upload error target " + error.target);
        }
    }

    myApp.preloader.hide();
    counterFotoNpwp = "0";
    counterFotoKtp = "0";
    counterFotoKaryawan = "0";

    /*mainView.router.navigate("/master_karyawan/",{
        reloadCurrent: true,
        ignoreCache: true,
    });*/

    mainView.router.back("/detail_karyawan/",{force:true});





});
     } else {
        myApp.dialog.alert("Anda Harus Mengisi Seluruh Data Terlebih Dahulu");
        myApp.preloader.hide();
    }



});

$$('.btnBatalInputKaryawan').on('click',function(){
    //mainView.router.navigate("/master_karyawan/");
    mainView.router.back();
        /*var FOTOKTP = $$("#edit-foto-ktp").attr("src");
        var FOTONPWP = $$("#edit-foto-npwp").attr("src");
        var fotoKtp = $$("#edit-foto-ktp").attr("src");
        myApp.dialog.alert(fotoKtp);
        myApp.dialog.alert(FOTONPWP);*/
    });
});

//pemasangan_ban
/*$$(document).on('page:init', '.page[data-name="input_pemasangan_ban"]', function (page) {
    var today = new Date();
    var day = today.getDate();
    var monthIndex = today.getMonth();
    var year = today.getFullYear();
    $$('#tanggalPemasanganBan').val(day + ' ' + monthNames[monthIndex] + ' ' + year)
    $$('.userIdPemasanganBan').val(USERID);

    $$('.popup-open-toko').on('click',function(){
        myApp.popup.open('.popup-toko');
    });

    $$('.popup-open-nomorplat').on('click',function(){
        myApp.popup.open('.popup-nomorplat');
    });

    var searchbar = myApp.searchbar.create({
        el: '.searchbar',
        searchContainer: '.list',
        searchIn: '.namaToko',
        on: {
            search(sb, query, previousQuery) {
            }
        }
    });
    
    $$('.btnCancel').on('click',function(){
        myApp.popup.close('.popup-toko');
        myApp.popup.close('.popup-nomorplat');
    });

    var act = "POPUP_TAMPIL_PELANGGAN_NOMORPLAT";
    myApp.request.post(ipTujuan,{case:act,KODECABANG:KODECABANG,USERID:USERID},function(data){
        var hasil_json = JSON.parse(data);
        tampungPopupNamaToko = "";
        if(hasil_json.hasil=="ada"){
            for(var i = 0; i<hasil_json.KODEPELANGGAN.length;i++){
                tampungPopupNamaToko +=`
                <li>
                <a href="#" class="item-link item-content" onClick="pilihTokoNomorPlat('`+hasil_json.KODEPELANGGAN[i]+`','`+hasil_json.NAMA[i]+`')">
                <div class="item-inner">
                <div class="item-text namaToko" style="color:black"><b>`+hasil_json.KODEPELANGGAN[i]+`</b> - `+hasil_json.NAMA[i] +`</div>
                </div>
                </a>
                </li>`;
            }
        } else {
            $$('.listPopupNamaPelanggan').html("");
        }
        $$('.listPopupNamaPelanggan').html(tampungPopupNamaToko);
        myApp.preloader.hide();
    });

    var act = "TAMPIL_KONFIGURASI_TRUK_DAN_KAROSERI";
    myApp.request.post(ipTujuan,{case:act},function(data){
        var hasil_json = JSON.parse(data);
        if(hasil_json.karoseri == "ada"){
            for(var i = 0; i<hasil_json.KODEKAROSERI.length; i++){
                $$('.karoseriPemasanganBan').append(`<option value="${hasil_json.KODEKAROSERI[i]}">${hasil_json.KODEKAROSERI[i]}</option>`)
            }
        } else {
            mainView.router.navigate("/home/");
        }

        if(hasil_json.konfigurasi == "ada"){
            for(var i = 0; i<hasil_json.KODEKONFIGURASI.length; i++){
                $$('.konfigurasiTrukPemasanganBan').append(`<option value="${hasil_json.KODEKONFIGURASI[i]}">${hasil_json.KODEKONFIGURASI[i]}</option>`)
            }
        } else {
            mainView.router.navigate("/home/");
        }
        myApp.preloader.hide();
    });

    var counter = 1;
    $$('.btnTambahBarang').on('click',function(){
        element = `<div class="card">
        <div class="card-header" style="background-color:#2196F3;color:white">

        <span style="font-size:0.9em"><b>Barang</b></span>
        <a href="#" class="hapusToko"><span style="font-size:0.9em;text-align: right"><i class="fas fa-window-close " style="color:white"></i></span></a>

        </div>
        <div class="card-content card-content-padding">
        <div class="list form-store-data" >

        <div class="item-content item-input">
        <div class="item-inner">
        <div class="item-title item-label" style="color:#2196F3;font-weight: bold">Kode Barang</div>
        <div class="item-input-wrap">
        <a href="#" onClick="popupOpenToko('${counter}')" class="popup-open-toko-${counter}" id ="${counter}">
        <input type="text" class="barang${counter}" placeholder="" readonly="readonly"/>
        <input type="hidden" name="kodeBarangPemasanganBan" class="valueBarang${counter}"/>
        </a>
        </div>
        </div>
        </div>


        <div class="item-content item-input">
        <div class="item-inner">
        <div class="item-title item-label" style="color:#2196F3;font-weight: bold">Serial Number</div>
        <div class="item-input-wrap">
        <input type="text" placeholder="Serial Number" name="serialNumberPemasanganBan" maxlength="30" />
        </div>
        </div>
        </div>


        <div class="item-content item-input">
        <div class="item-inner">
        <div class="item-title item-label" style="color:#2196F3;font-weight: bold">Posisi</div>
        <div class="item-input-wrap">
        <input type="number" placeholder="Posisi" name="posisiBarangPemasanganBan" maxlength="5" />
        </div>
        </div>
        </div>

        <div class="item-content item-input">
        <div class="item-inner">
        <div class="item-title item-label" style="color:#2196F3;font-weight: bold">Tekanan Angin</div>
        <div class="item-input-wrap">
        <input type="number" placeholder="Posisi" name="tekananAnginPemasanganBan" maxlength="5" />
        </div>
        </div>
        </div>

        <div class="item-content item-input">
        <div class="item-inner">
        <div class="item-title item-label" style="color:#2196F3;font-weight: bold">Tebal Kembangan</div>
        <div class="item-input-wrap">
        <input type="number" placeholder="Tebal Kembangan" name="tebalKembanganPemasanganBan" />
        </div>
        </div>
        </div>

        <div class="item-content item-input">
        <div class="item-inner">
        <div class="item-title item-label" style="color:#2196F3;font-weight: bold">Harga</div>
        <div class="item-input-wrap">
        <input type="number" placeholder="Tebal Kembangan" name="hargaPemasanganBan" />
        </div>
        </div>
        </div>

        <div class="item-content item-input">
        <div class="item-inner">
        <div class="item-title item-label" style="color:#2196F3;font-weight: bold">Keterangan</div>
        <div class="item-input-wrap">
        <input type="text" placeholder="Keterangan" name="keteranganPemasanganBan" />
        </div>
        </div>
        </div>

        
        </div>

        <span class="spanFotoKunjungan">
        <div class="card">
        <div class="card-header row" style="background-color:#2196F3;color:white">

        <a href="#" onClick="ambilFotoKunjunganz('${counter}','1')" class="ambilFotoKunjungan-${counter}-1 col padding5">
        <i class="fa fa-camera  middleWhite"> </i>
        </a>

        <a href="#" onClick="ambilFotoGalleryz('${counter}','1')" class="ambilFotoGallery-${counter}-1 col padding5">
        <i class="far fa-image  middleWhite"> </i>
        </a>
        </div>
        <div class="card-content card-content-padding">
        <input type="hidden" name="counterArrayFoto" value="${counter}-1">


        <img id="foto-kunjungan-${counter}-1" name="fotoKunjunganUpload[${counter}][]" class="1" height="150" width="100%">
        

        </div>
        </div>
        </span>

        </div>
        </div>`;
        $$('.generateTambahBarang').append(element);
        $$('.popup-open-toko').on('click',function(){ 
            tampungCounter = $(this).attr('id');
            myApp.popup.open('.popup-toko');
        });

        element = `<div class="popup popup-toko-${counter}" style="background-color:white" data-ajax="false">
        <form class="searchbar searchToko${counter}">
        <div class="searchbar-inner">
        <div class="searchbar-input-wrap">
        <input type="search" placeholder="Search">
        <i class="searchbar-icon"></i>
        <span class="input-clear-button"></span>
        </div>
        <span class="searchbar-disable-button" >Cancel</span>
        </div>

        </form>
        <div class="judul" style="font-size:1.3em;text-align: center"></div>

        <div class="searchbar-backdrop"></div>
        <div class="block">
        <div class="row">
        <button class="col button button-fill btnCancel" onClick="popupCancel('${counter}')">Cancel</button>
        </div>
        </div>
        <div class="list inset searchbar-found">
        <ul class="listPopupNamaTokoRencanaKunjungan${counter}">
        </ul>
        </div>
        <div class="block searchbar-not-found">
        <div class="block-inner">Nothing found</div>
        </div>
        </div>`;

        
        $$('.spanTambahPopupToko').append(element);
        
        searchbar[counter] = myApp.searchbar.create({
            el: '.searchToko'+counter,
            searchContainer: '.listPopupNamaTokoRencanaKunjungan'+counter,
            searchIn: '.namaBarang'+counter,
            on: {
                search(sb, query, previousQuery) {

                }
            }
        });

        var act = "POPUP_TAMPIL_BARANG";
        myApp.request.post(ipTujuan,{case:act,USERID:USERID,KODECABANG:KODECABANG},function(data){
            var hasil_json = JSON.parse(data);
            tampungPopupNamaToko = "";
            if(hasil_json.hasil=="ada"){
                for(var i = 0; i<hasil_json.KODEBARANG.length;i++){
                    tampungPopupNamaToko +=`
                    <li>
                    <a href="#" class="item-link item-content" onClick="pilihBarangPopup('`+hasil_json.KODEBARANG[i]+`','`+hasil_json.NAMA[i]+`','${counter}')">
                    <div class="item-inner">
                    <div class="item-text namaBarang${counter}" style="color:black">`+hasil_json.KODEBARANG[i]+` - `+hasil_json.NAMA[i]+`</div>
                    </div>
                    </a>
                    </li>`;
                }
            } else {
                $$('.listPopupNamaTokoRencanaKunjungan'+counter).html("");
            }
            $$('.listPopupNamaTokoRencanaKunjungan'+counter).html(tampungPopupNamaToko);
            counter++;
        });

        $$('.hapusToko').on('click',function(){
            $$(this).closest('.card').remove();
        });
    });

$$('.btnInputPemasanganBan').on('click',function(){
    myApp.preloader.show();
    var KODEPELANGGAN = $$('.kunjunganKodeToko').val();
    var TANGGAL = $$('#tanggalPemasanganBan').val();
    var NOMORPLAT = $$('.nomorPlatPemasanganBan').val();
    var ODOMETER = $$('.odometerPemasanganBan').val();
    var NAMASOPIR = $$('.namaSopirPemasanganBan').val();
    var NOHPSOPIR = $$('.noHpSopirPemasanganBan').val();
    var NAMAPENGAWAS = $$('.namaPengawasPemasanganBan').val();
    var NOHPPENGAWAS = $$('.noHpPengawasPemasanganBan').val();
    var MEREKTRUK = $$('.merekTrukPemasanganBan').val();
    var KONFIGURASITRUK = $$('.konfigurasiTrukPemasanganBan').val();
    var KAROSERI = $$('.karoseriPemasanganBan').val();
    var USERID = $$('.userIdPemasanganBan').val();
    var KODEBARANG = [];
    var SERIALNUMBER = [];
    var POSISI = [];
    var TEKANANANGIN = [];
    var TD = [];
    var HARGA = [];
    var KETERANGAN = [];

    var arrayFoto = [];

    $$('input[name^="kodeBarangPemasanganBan"]').each(function() {
        KODEBARANG.push($$(this).val());
    });

    $$('input[name^="serialNumberPemasanganBan"]').each(function() {
        SERIALNUMBER.push($$(this).val());
    });

    $$('input[name^="posisiBarangPemasanganBan"]').each(function() {
        POSISI.push($$(this).val());
    });

    $$('input[name^="tekananAnginPemasanganBan"]').each(function() {
        TEKANANANGIN.push($$(this).val());
    });

    $$('input[name^="tebalKembanganPemasanganBan"]').each(function() {
        TD.push($$(this).val());
    });

    $$('input[name^="hargaPemasanganBan"]').each(function() {
        HARGA.push($$(this).val());
    });

    $$('input[name^="keteranganPemasanganBan"]').each(function() {
        KETERANGAN.push($$(this).val());
    });

    var fotoKunjungan = {};
    var namaFotoKunjungan = {};
    var counterArrayFotoTampung;

    i=1;
    $$('input[name^="counterArrayFoto"]').each(function() {
        fotoKunjungan[$$(this).val()] = new Array();
        namaFotoKunjungan[$$(this).val()] = new Array();
        arrayFoto.push($$(this).val());
        counterArrayFotoTampung = $$(this).val();

        $$('img[name^="fotoKunjunganUpload['+i+']"]').each(function() {
            if($$(this).attr("src") !=null){
                fotoKunjungan[counterArrayFotoTampung].push($$(this).attr("src"));
                namaFotoKunjungan[counterArrayFotoTampung].push(this.className);
            }
        });
        i++;
    });

    var act = "INPUT_PEMASANGAN_BAN";
    
    if(!KODEPELANGGAN){
        alertKosong("PT / Toko / Pelanggan");
    } else if(!NOMORPLAT){
        alertKosong("Nomor Plat");
    } else if(!ODOMETER){
        alertKosong("Odometer");
    } else if(!NAMASOPIR){
        alertKosong("Nama Sopir");
    } else if(!NOHPSOPIR){
        alertKosong("No HP Sopir");
    } else if(!NAMAPENGAWAS){
        alertKosong("Nama Pengawas");
    } else if(!NOHPPENGAWAS){
        alertKosong("No HP Pengawas");
    } else if(!MEREKTRUK){
        alertKosong("Merek Truk");
    } else if(KODEBARANG.length == 0 || KODEBARANG.includes("")){
        alertKosong("Kode Barang");
    } else if(SERIALNUMBER.includes("")){
        alertKosong("Serial Number");
    } else if(POSISI.includes("")){
        alertKosong("Posisi");
    } else if(TEKANANANGIN.includes("")){
        alertKosong("Tekanan");
    } else if(TD.includes("")){
        alertKosong("Tebal Kemabangan");
    } else {
        myApp.request.post(ipTujuan,{case:act,KODEPELANGGAN:KODEPELANGGAN,TANGGAL:TANGGAL,NOMORPLAT:NOMORPLAT,ODOMETER:ODOMETER,NAMASOPIR:NAMASOPIR,
            NOHPSOPIR:NOHPSOPIR,NAMAPENGAWAS:NAMAPENGAWAS,NOHPPENGAWAS:NOHPPENGAWAS,MEREKTRUK:MEREKTRUK,KONFIGURASITRUK:KONFIGURASITRUK,KAROSERI:KAROSERI,
            USERID:USERID,arrayFoto:arrayFoto,namaFotoKunjungan:namaFotoKunjungan,KODEBARANG:KODEBARANG,SERIALNUMBER:SERIALNUMBER,POSISI:POSISI,TEKANANANGIN:TEKANANANGIN,TD:TD,HARGA:HARGA,KETERANGAN:KETERANGAN},function(data){
                var hasil_json = JSON.parse(data);
                if(hasil_json.hasil == "berhasil"){

                    if(hasil_json.adafoto == "ada"){
                        hasil_json.LASTID.forEach(function(e){
                            if(fotoKunjungan[e].length !=0){
                                myApp.dialog.alert("Masuk Foto"+e);
                                hasil_json[e].forEach(function(x,idx){
                                    var toko = new FileUploadOptions();
                                    toko.fileKey = "photo";
                                    toko.fileName = fotoKunjungan[e][idx].substr(fotoKunjungan[e][idx].lastIndexOf('/') + 1);
                                    toko.mimeType = "image/jpeg";
                                    toko.chunkedMode = false;
                                    toko.headers = {
                                        Connection: "close"
                                    };
                                    toko.params = {
                                        namaFile:x
                                    }
                                    var ft = new FileTransfer();
                                    ft.upload(fotoKunjungan[e][idx], 
                                        encodeURI(ipUploadTdPemasanganBan),
                                        win,
                                        fail,
                                        toko);

                                    var win = function(r) {
                                        console.log("Should not be called.");
                                    }

                                    var fail = function(error) {
                                        myApp.dialog.alert("eror :" +error.code);
                                        alert("An error has occurred: Code = " + error.code);
                                        console.log("upload error source " + error.source);
                                        console.log("upload error target " + error.target);
                                    }


                                });
                            }
                        });

                        myApp.dialog.alert("Berhasil Menginput Data");
                        mainView.router.navigate("/home/");
                    } else {
                        myApp.dialog.alert("Berhasil Menginput Data");

                        mainView.router.navigate("/home/");
                    }
                } else if(hasil_json.hasil == "duplicate_primary_key") {
                    myApp.dialog.alert("Terdapat Serial Number yang Sama");
                    myApp.preloader.hide();
                } else if(hasil_json.hasil == "duplicate_serialnumber"){
                    myApp.dialog.alert("Serial Number Pernah Diinput");
                    myApp.preloader.hide();
                } else {
                    myApp.dialog.alert("Terdapat Error, Segera Hubungi Admin :D");
                    myApp.preloader.hide();
                }
            }, function(xhr,status){
                PreloaderHide(status);
            });
    }

});
});*/

/*window.plugins.OneSignal
.startInit("ec4cf440-afa6-4896-8350-d4e493082179")
.inFocusDisplaying(window.plugins.OneSignal.OSInFocusDisplayOption.Notification)
.endInit();

window.plugins.OneSignal.getIds(function (ids) {
    GCM_ID = ids.userId;
});

}, false);*/


document.addEventListener("resume", onResume, false);
document.addEventListener("pause", onPause, false);

function onPause(){
    bgGeo.stopWatchPosition();
}

function onResume(){
    BackgroundGeolocation.watchPosition(function(location) {

        console.log(location);
        latGlobal = location.coords.latitude;
        lngGlobal = location.coords.longitude;
        console.log(latGlobal);
        console.log(lngGlobal);
    }, function(errorCode) {
        alert('An location error occurred: ' + errorCode);
    }, {
        interval: 1000, 
        persist: false,    
    });

    USERID = localStorage.getItem("USERID");
    KODECABANG = localStorage.getItem("KODECABANG");
    KODEJABATAN = localStorage.getItem("KODEJABATAN");
    PASSWORD = localStorage.getItem("PASSWORD");

    var act = "CEK_USERNAME_PASSWORD";
    myApp.request.post(ipTujuan,{case:act,GCM_ID:GCM_ID,USERID:USERID,PASSWORD:PASSWORD,KODEJABATAN:KODEJABATAN}
        ,function(data){
            var hasil_json = JSON.parse(data);
            if(hasil_json.hasil == "sama"){

            } else {
                mainView.router.navigate("/",{reloadAll:true});
                localStorage.setItem("USERID",null);
                localStorage.setItem("KODECABANG",null);
                localStorage.setItem("KODEJABATAN",null);
                localStorage.setItem("PASSWORD",null);
                /*setTimeout(function() {
                    bgGeo.stop();
                }, 1000);*/
            }
        }
        ,function(xhr,status){
            PreloaderHide(status);
        });
    
    var act = "CEK_VERSI_APP";
    myApp.request.post(ipTujuan,{case:act,KODEVERSI:KODEVERSI,USERID:USERID,VERSIMANUAL:VERSIMANUAL},function(data){
        var hasil_json = JSON.parse(data);
        if(hasil_json.hasil != KODEVERSI){
            myApp.dialog.confirm("Aplikasi Anda Belum Paling Terbaru, Silahkan Update Terlebih Dahulu",function(){
                var url = "http://"+ip+"/bond/aplikasi/esp.apk";
                cordova.InAppBrowser.open(url, '_system', 'location=yes');
            },function(){
                navigator.app.exitApp();
            });
        } else {
            //console.log("sudah sama");
        }
    });
}


//FUNGSI-FUNGSI SEMUA

function laporKunjungan(nama,alamat){
    namaToko = nama;
    alamatToko = alamat;
    mainView.router.navigate('/lapor_kunjungan/');
}

function detailBarang(kode,nama,jumlah,harga){
    var kodeBarang = kode;
    var namaBarang = nama;
    var jumlahBarang = jumlah;
    var hargaBarang = harga;
    myApp.dialog.alert(kodeBarang + namaBarang + jumlahBarang + hargaBarang);
}

var editKodePelanggan;
var editNamaPelanggan;
var editAlamatPelanggan;
var editKotaPelanggan;
var editTelponPelanggan;
var editFaxPelanggan;
var editKreditLimitPelanggan ;
var editSyaratPiutangPelanggan;
var editSyaratPiutangMaxPelanggan;
var editUserIdPelanggan;
var editTermPelanggan;
var editNamaKategoriPelanggan;
var editAlamatKirimPelanggan;
var editHalamanPelanggan;
var editNomorBuktiPelanggan;

function detailPelanggan(halaman,kode,nama,alamat,kota,telpon,fax,kreditlimit,syaratpiutang,syaratpiutangmax,userid,term,namakategoripelanggan,alamatkirim,nomorbuktikunjungan){
    editHalamanPelanggan = halaman;
    editKodePelanggan = kode;
    editNamaPelanggan = nama;
    editAlamatPelanggan = alamat;
    editKotaPelanggan = kota;
    editTeleponPelanggan = telpon;
    editFaxPelanggan = fax;
    editKreditLimitPelanggan = kreditlimit ;
    editSyaratPiutangPelanggan = syaratpiutang;
    editSyaratPiutangMaxPelanggan = syaratpiutangmax;
    editUserIdPelanggan = userid;
    editTermPelanggan = term;
    editNamaKategoriPelanggan = namakategoripelanggan;
    editAlamatKirimPelanggan = alamatkirim;
    editNomorBuktiPelanggan = nomorbuktikunjungan;

    mainView.router.navigate("/detail_pelanggan/");
}


function klikListKunjungan(tanggal,jumlahBelum,jumlahSudah){
    tanggalKunjungan = tanggal;
    jumlahBelumKunjungan = jumlahBelum;
    jumlahSudahKunjungan = jumlahSudah;
    mainView.router.navigate('/halaman_kunjungan/')
}

function editKaryawan(nama,alamat,telepon,ktp,username,password){
    editNama = nama;
    editAlamat= alamat;
    editTelepon = telepon;
    editKtp =ktp;
    editUsername=username;
    editPassword=password;
    mainView.router.navigate("/input_karyawan/");
}

function pilihToko(kode,nama){
    kodeToko = kode;
    namaToko = nama;
    //mainView.router.navigate("/buat_rencana_kunjungan/");
    $$('.toko'+tampungCounter).val(namaToko);
    $$('.valueToko'+tampungCounter).val(kodeToko);

    //$$(this).closest('.toko').val(namaToko);
    myApp.popup.close('.popup-toko');
}

function pilihTokoUntukKendaraan(kode,nama){
    $$('.kunjunganNamaToko').val(nama);
    $$('.kunjunganKodeToko').val(kode);
    myApp.popup.close('.popup-toko');
}

function pilihTokoPopup(kode,nama,counter){
    kodeToko = kode;
    namaToko = nama;
    //mainView.router.navigate("/buat_rencana_kunjungan/");
    $$('.toko'+counter).val(namaToko);
    $$('.valueToko'+counter).val(kodeToko);
    //$$(this).closest('.toko').val(namaToko);
    myApp.popup.close('.popup-toko-'+counter);
}

function pilihBarangPopup(kode,nama,counter){
    //mainView.router.navigate("/buat_rencana_kunjungan/");
    $$('.barang'+counter).val(nama);
    $$('.valueBarang'+counter).val(kode);
    //$$(this).closest('.toko').val(namaToko);
    myApp.popup.close('.popup-toko-'+counter);
}

function pilihBarang(kode,nama,harga){
    //mainView.router.navigate("/buat_rencana_kunjungan/");
    $$('.namaBarang').val(nama);
    $$('.valueBarang').val(kode);
    $$('.hargaPemasanganBan').val(harga);
    myApp.popup.close('.popup-barang');
}

var namaSales;
function pilihSales(nama){
    namaSales = nama;
    //mainView.router.navigate("/buat_rencana_kunjungan/");
    $$('.salesman').val(namaSales);
    myApp.popup.close('.popup-toko');
}

var editTanggalRencanaKunjungan;
function klikListRencanaKunjungan(tanggal){
    //myApp.dialog.alert(jumlah);
    editTanggalRencanaKunjungan = tanggal;
    mainView.router.navigate("/halaman_rencana_kunjungan/");
}

var KODEJABATAN="";
var NAMA="";
var editJabataneditJabatanUserId="";
var STATUS="";

function detailJabatan(kode,nama,userid,status,cabang){
    KODEJABATAN = kode;
    NAMA = nama;
    editJabataneditJabatanUserId = userid;
    TAMPUNGKODECABANG = cabang;
    STATUS = status;
    mainView.router.navigate("/detail_jabatan/");

}

var editKodeJabatanHakAkses;
var editUserIdHakAkses;
var editCabangHakAkses;
var halaman_hak_akses = "";

function detailHakAkses(kode,userid,cabang,halaman){
    editKodeJabatanHakAkses = kode;
    editUserIdHakAkses = userid;
    editCabangHakAkses = cabang;
    halaman_hak_akses = halaman;
    mainView.router.navigate("/detail_hak_akses/");
}

var tampungKodeKaryawan;
var tampungNamaKaryawan;
var tampungAlamatKaryawan;
var tampungKotaKaryawan;
var tampungTeleponKaryawan;
var tampungKodeJabatanKaryawan;
var tampungNamaJabatanKaryawan;
var tampungKodeCabangKaryawan;
var tampungNpwpKaryawan;
var tampungKtpKaryawan;
var tampungTanggalMasukKaryawan;
var tampungTanggalKeluarKaryawan;
var tampungStatusKaryawan;
var tampungUserIdKaryawan;

var tampungKodeKategoriPelanggan;
var tampungNamaKategoriPelanggan;
var tampungUserIdKategoriPelanggan;
var tampungStatusKategoriPelanggan;
var tampungStatusPostingKaryawan;

function detailKaryawan(kode,nama,alamat,kota,telepon,namajabatan,kodecabang,npwp,ktp,tanggalmasuk,tanggalkeluar,statuskaryawan,kodejabatankaryawan,userid,status){
    //myApp.dialog.alert(namajabatan);
    tampungKodeKaryawan = kode;
    tampungNamaKaryawan = nama;
    tampungAlamatKaryawan = alamat;
    tampungKotaKaryawan = kota;
    tampungTeleponKaryawan = telepon;
    tampungNamaJabatanKaryawan = namajabatan;
    tampungKodeCabangKaryawan = kodecabang;
    tampungNpwpKaryawan = npwp;
    tampungKtpKaryawan = ktp;
    tampungTanggalMasukKaryawan = tanggalmasuk;
    tampungTanggalKeluarKaryawan = tanggalkeluar;
    tampungStatusKaryawan = statuskaryawan;
    tampungKodeJabatanKaryawan = kodejabatankaryawan;
    tampungUserIdKaryawan = userid;
    tampungStatusPostingKaryawan = status;
    mainView.router.navigate("/detail_karyawan/");
}


function detailKategoriPelanggan(kode,nama,userid,status){
    tampungKodeKategoriPelanggan = kode;
    tampungNamaKategoriPelanggan = nama;
    tampungUserIdKategoriPelanggan = userid;
    tampungStatusKategoriPelanggan = status;
    mainView.router.navigate("/detail_kategori_pelanggan/");
}


function pilihTokoKunjungan(kode,nama){
    $$('.kunjunganKodeToko').val(kode);
    $$('.kunjunganNamaToko').val(nama);
    myApp.popup.close('.popup-toko');
}

function pilihTokoNomorPlat(kode,nama){
    $$('.kunjunganKodeToko').val(kode);
    $$('.kunjunganNamaToko').val(nama);
    $$('.nomorPlatPemasanganBan').val("");

    var act = "POPUP_TAMPIL_NOMORPLAT";
    myApp.request.post(ipTujuan,{case:act,KODECABANG:KODECABANG,USERID:USERID,KODEPELANGGAN:kode},function(data){
        var hasil_json = JSON.parse(data);
        tampungPopupNomorPlat = "";
        if(hasil_json.hasil=="ada"){
            for(var i = 0; i<hasil_json.NOMORPLAT.length;i++){
                tampungPopupNomorPlat +=`
                <li>
                <a href="#" class="item-link item-content" onClick="pilihNomorPlat('`+hasil_json.NOMORPLAT[i]+`','`+hasil_json.KAROSERI[i]+`','`+hasil_json.KONFIGURASITRUK[i]+`')">
                <div class="item-inner">
                <div class="item-text namaToko" style="color:black"><b>`+hasil_json.NOMORPLAT[i]+`</div>
                </div>
                </a>
                </li>`;
            }
        } else {
            $$('.listPopupNomorPlat').html("");
        }
        $$('.listPopupNomorPlat').html(tampungPopupNomorPlat);
        myApp.preloader.hide();
    });

    myApp.popup.close('.popup-toko');
}

function pilihNomorPlat(nomorplat,karoseri,konfigurasi){
    $$('.nomorPlatPemasanganBan').val(nomorplat);
    $$('.karoseriPemasanganBan').val(karoseri);
    $$('.konfigurasiTrukPemasanganBan').val(konfigurasi);
    
    myApp.popup.close('.popup-nomorplat');
}


var jarakKunjunganPelanggan;

function PilihMenuUserMenu(screen,menu,counterClass,counterId){
    tampungScreenMenu = "";
    console.log($(this).find(".namaToko").html());
    var act = "TAMPIL_POPUP_MENU";
    myApp.request.post(ipTujuan,{case:act,tampungCounterScreenMenu:screen},function(data){
        var hasil_json = JSON.parse(data);
        if(hasil_json.hasil == "ada"){
            for(var i = 0; i<hasil_json.SCREEN.length; i++){
                tampungScreenMenu +=`<li>
                <a href="#" class="item-link item-content" onClick="PilihMenuUserMenu('`+hasil_json.SCREEN[i]+`','`+hasil_json.MENU[i]+`','`+counterClass+`','`+counterId+`')">
                <div class="item-inner">
                <div class="item-text namaToko" style="color:black">`+hasil_json.MENU[i]+`</div>
                </div>
                <input type="hidden" class="valueScreen" value="`+hasil_json.SCREEN[i]+`">
                </a>
                </li>`;
            }
        } else {
            myApp.popup.close('.popup-usermenu');
            $$('.namaMenuUserMenu'+counterId).val(menu);
            $$('.screenMenuUserMenu'+counterId).val(screen);
        }

        $$('.listPopupNamaMenuUserMenu').html(tampungScreenMenu);
    });
}

function pilihJabatanHakAkses(kode,nama){
    $$('.namaJabatanHakAkses').val(nama);
    $$('.kodeJabatanHakAkses').val(kode);

    myApp.popup.close('.popup-jabatan');
}


function pilihKaryawanHakAkses(kode,nama){
    $$('.namaHakAkses').val(nama);
    $$('.userIdHakAkses').val(kode);

    myApp.popup.close('.popup-kodeKaryawan');
}

var tampungHalamanFollowDanCollector;
var tampungTanggalFollowDanCollector;

function klikListFollowDanCollector(halaman,tanggal){
    tampungHalamanFollowDanCollector = halaman;
    tampungTanggalFollowDanCollector = tanggal;
    mainView.router.navigate("/halaman_follow_collector/");
}



var tampungCounterInternalPelanggan;
function pilihKaryawanPelanggan(kodekaryawan,namakaryawan,namajabatan,kodejabatan,telepon,wa,email,tanggallahir){
    $$('#inputCP'+tampungCounterInternalPelanggan).val(kodekaryawan);
    $$('#inputCPpalsu'+tampungCounterInternalPelanggan).val(namakaryawan);
    $$('#inputKJ'+tampungCounterInternalPelanggan).val(kodejabatan);
    $$('#inputKJpalsu'+tampungCounterInternalPelanggan).val(namajabatan);

    $$('#inputHP'+tampungCounterInternalPelanggan).val(telepon);
    $$('#inputWA'+tampungCounterInternalPelanggan).val(wa);
    $$('#inputEMAIL'+tampungCounterInternalPelanggan).val(email);
    $$('#inputTANGGALLAHIR'+tampungCounterInternalPelanggan).val(tanggallahir);

    myApp.popup.close('.popup-karyawan');
}

function backToHome(){
    mainView.router.navigate("/home/");
    myApp.preloader.show();
}

var tampungKodeBarangPricelist;
var tampungNamaBarangPricelist;
var tampungBarangPricelist1;
var tampungBarangPricelist2;
var tampungBarangPricelist3;

function detailPricelist(kode,nama,p1,p2,p3){
 tampungKodeBarangPricelist = kode;
 tampungNamaBarangPricelist = nama;
 tampungBarangPricelist1 = p1;
 tampungBarangPricelist2 = p2;
 tampungBarangPricelist3 = p3;
 myApp.preloader.show();
 mainView.router.navigate("/detail_pricelist/");
}

var tampungTanggalListLaporan;
function klikListLaporan(tanggal){
    tampungTanggalListLaporan = tanggal;
    tampungHalamanFollowDanCollector = "LAPORAN";
    mainView.router.navigate("/halaman_laporan/");
}

var tampungTanggalListLaporanRencanaKunjungan;
function klikListLaporanRencanaKunjungan(tanggal){
    tampungTanggalListLaporanRencanaKunjungan = tanggal;
    mainView.router.navigate("/halaman_laporan_rencana_kunjungan/");
    myApp.preloader.show();
}


var tampungTanggalListLaporanBerdasarkanPelanggan;
function klikListLaporanBerdasarkanPelanggan(tanggal){
    myApp.preloader.show();
    tampungTanggalListLaporanBerdasarkanPelanggan = tanggal;
    mainView.router.navigate("/detail_laporan_berdasarkan_pelanggan/");
}


function pilihKategoriBarang(kode,nama){
    myApp.popup.close();
    $$('.inputNamaPalsuKategoriBarangPricelist').val(nama);
    $$('.inputKategoriBarangPricelist').val(kode);
}

function pilihPermintaanKhusus(nama){
    myApp.popup.close();
    $$('.permintaanKhususFilterLaporan').val(nama);
}

function alertKosong(isi){
    myApp.dialog.alert(isi+" Harus Di isi");
    myApp.preloader.hide();
}

function pilihFilterKaryawan(kodekaryawan,nama){
    $$('.namaSalesmanFilterRencanaKunjungan').val(nama);
    $$('.kodeSalesmanFilterRencanaKunjungan').val(kodekaryawan);
    myApp.popup.close();
}

var tampungKodeDetailLaporanPelanggan;
function detailLaporanPelanggan(master,kodepelanggan){
    tampungKodeDetailLaporanPelanggan = kodepelanggan;
    mainView.router.navigate("/detail_laporan_pelanggan/");
    myApp.preloader.show();
}



function ambilFotoKunjungan(counter){
    navigator.camera.getPicture(onSuccess,onFail,{
        quality:30,
        destinationType : Camera.DestinationType.FILE_URI,
        correctOrientation: true,
        sourceType : Camera.PictureSourceType.CAMERA,
        cameraDirection: Camera.Direction.BACK
    });

    function onSuccess(imageData) {
        var image = document.getElementById('foto-kunjungan-'+counter);
        image.src = imageData;
        counter++;
        element =`<div class="card">
        <div class="card-header row" style="background-color:#2196F3;color:white">
        
        <a href="#" class="ambilFotoKunjungan-${counter} col padding5"  >
        <i class="fa fa-camera  middleWhite"></i>
        </a>

        <a href="#" class="ambilFotoGallery-${counter} col padding5">
        <i class="far fa-image  middleWhite"> </i>
        </a>


        <a href="#" class="hapusFotoKunjungan col padding5" id ="${counter}">
        <i class="fas fa-window-close  middleWhite" ></i>
        </a>
        </div>
        <div class="card-content card-content-padding">
        <img name="fotoKunjunganUpload" class="${counter}" id="foto-kunjungan-${counter}"  height="150" width="100%">
        </div>
        </div>`;

        $$('.spanFotoKunjungan').append(element);

        $$('.hapusFotoKunjungan').on('click',function(){
            var hapusId = $$(this).attr("id");
            var tampung = $$("#foto-kunjungan-"+hapusId).attr("src");
            if(tampung != null){
                $$(this).closest('.card').remove();
            }
        });

        $$('.ambilFotoKunjungan-'+counter).on('click',function(){
            navigator.camera.getPicture(onSuccess,onFail,{
                quality:30,
                destinationType : Camera.DestinationType.FILE_URI,
                
                correctOrientation: true,
                sourceType : Camera.PictureSourceType.CAMERA,
                cameraDirection: Camera.Direction.BACK
            });
        });

        $$('.ambilFotoGallery-'+counter).on('click',function(){
            navigator.camera.getPicture(onSuccess,onFail,{
                quality:30,
                destinationType : Camera.DestinationType.FILE_URI,
                
                correctOrientation: true,
                sourceType : Camera.PictureSourceType.PHOTOLIBRARY,
            });
        });
    }

    function onFail(message){
        myApp.alert('Failed because: ' +message);
    }
}

function ambilFotoGallery(counter){
    navigator.camera.getPicture(onSuccess,onFail,{
        quality:30,
        destinationType : Camera.DestinationType.FILE_URI,
        
        correctOrientation: true,
        sourceType : Camera.PictureSourceType.PHOTOLIBRARY,
    });

    function onSuccess(imageData) {
        var image = document.getElementById('foto-kunjungan-'+counter);
        image.src = imageData;
        counter++;
        element =`<div class="card">
        <div class="card-header row" style="background-color:#2196F3;color:white">
        
        <a href="#" class="ambilFotoKunjungan-${counter} col padding5"  >
        <i class="fa fa-camera  middleWhite"></i>
        </a>

        <a href="#" class="ambilFotoGallery-${counter} col padding5">
        <i class="far fa-image  middleWhite"> </i>
        </a>


        <a href="#" class="hapusFotoKunjungan col padding5" id ="${counter}">
        <i class="fas fa-window-close  middleWhite" ></i>
        </a>
        </div>
        <div class="card-content card-content-padding">
        <img name="fotoKunjunganUpload" class="${counter}" id="foto-kunjungan-${counter}" height="150" width="100%">
        </div>
        </div>`;

        $$('.spanFotoKunjungan').append(element);
        $$('.hapusFotoKunjungan').on('click',function(){
            var hapusId = $$(this).attr("id");
            var tampung = $$("#foto-kunjungan-"+hapusId).attr("src");
            if(tampung != null){
                $$(this).closest('.card').remove();
            }
        });

        $$('.ambilFotoKunjungan-'+counter).on('click',function(){
            navigator.camera.getPicture(onSuccess,onFail,{
                quality:30,
                destinationType : Camera.DestinationType.FILE_URI,
                
                correctOrientation: true,
                sourceType : Camera.PictureSourceType.CAMERA,
                cameraDirection: Camera.Direction.BACK
            });
        });

        $$('.ambilFotoGallery-'+counter).on('click',function(){
            navigator.camera.getPicture(onSuccess,onFail,{
                quality:30,
                destinationType : Camera.DestinationType.FILE_URI,
                
                correctOrientation: true,
                sourceType : Camera.PictureSourceType.PHOTOLIBRARY,
            });
        });
    }

    function onFail(message){
        myApp.alert('Failed because: ' +message);
    }
}

function ambilFotoPemantauanBan(counter,e){
    navigator.camera.getPicture(onSuccess,onFail,{
        quality:30,
        destinationType : Camera.DestinationType.FILE_URI,
        
        correctOrientation: true,
        sourceType : Camera.PictureSourceType.CAMERA,
        cameraDirection: Camera.Direction.BACK
    });

    function onSuccess(imageData) {
        var image = document.getElementById('foto-kunjungan-'+counter);
        image.src = imageData;
        counter++;
        element =`<div class="card">
        <div class="card-header row" style="background-color:#2196F3;color:white">
        
        <a href="#" class="ambilFotoKunjungan-${counter} col padding5" onClick="ambilFotoPemantauanBan('${counter}',this)"  >
        <i class="fa fa-camera  middleWhite"></i>
        </a>

        <a href="#" class="ambilFotoGallery-${counter}  col padding5" onClick="ambilGalleryPemantauanBan('${counter}',this)">
        <i class="far fa-image  middleWhite"> </i>
        </a>


        <a href="#" class="hapusFotoKunjungan col padding5" id ="${counter}">
        <i class="fas fa-window-close  middleWhite" ></i>
        </a>
        </div>
        <div class="card-content card-content-padding">
        <img name="fotoKunjunganUpload" class="${counter}" id="foto-kunjungan-${counter}" height="150" width="100%">
        </div>
        </div>`;

        $$(e).closest('.spanFotoKunjungan').append(element);
        $$('.hapusFotoKunjungan').on('click',function(){
            var hapusId = $$(this).attr("id");
            var tampung = $$("#foto-kunjungan-"+hapusId).attr("src");
            if(tampung != null){
                $$(this).closest('.card').remove();
            }
        });
    }

    function onFail(message){
        myApp.alert('Failed because: ' +message);
    }
}

function ambilGalleryPemantauanBan(counter,e){
    navigator.camera.getPicture(onSuccess,onFail,{
        quality:30,
        destinationType : Camera.DestinationType.FILE_URI,
        
        correctOrientation: true,
        sourceType : Camera.PictureSourceType.PHOTOLIBRARY,
    });

    function onSuccess(imageData) {
        var image = document.getElementById('foto-kunjungan-'+counter);
        image.src = imageData;
        counter++;
        element =`<div class="card">
        <div class="card-header row" style="background-color:#2196F3;color:white">
        
        <a href="#" class="ambilFotoKunjungan-${counter} col padding5"  onClick="ambilFotoPemantauanBan('${counter}',this)">
        <i class="fa fa-camera  middleWhite"></i>
        </a>

        <a href="#" class="ambilFotoGallery-${counter} col padding5" onClick="ambilGalleryPemantauanBan('${counter}',this)">
        <i class="far fa-image  middleWhite"> </i>
        </a>


        <a href="#" class="hapusFotoKunjungan col padding5" id ="${counter}">
        <i class="fas fa-window-close  middleWhite" ></i>
        </a>
        </div>
        <div class="card-content card-content-padding">
        <img name="fotoKunjunganUpload" class="${counter}" id="foto-kunjungan-${counter}" height="150" width="100%">
        </div>
        </div>`;

        $$(e).closest('.spanFotoKunjungan').append(element);
        $$('.hapusFotoKunjungan').on('click',function(){
            var hapusId = $$(this).attr("id");
            var tampung = $$("#foto-kunjungan-"+hapusId).attr("src");
            if(tampung != null){
                $$(this).closest('.card').remove();
            }
        });
    }

    function onFail(message){
        myApp.alert('Failed because: ' +message);
    }
    
}


function editAmbilFotoKunjungan(counter){
    navigator.camera.getPicture(onSuccess,onFail,{
        quality:30,
        destinationType : Camera.DestinationType.FILE_URI,
        
        correctOrientation: true,
        sourceType : Camera.PictureSourceType.PHOTOLIBRARY,
    });
    /*var image = document.getElementById('foto-kunjungan-'+counter);
        
        counter++;
        element =`<div class="card">
        <div class="card-header row" style="background-color:#2196F3;color:white">

        <div class="col padding5">
        <a href="#" class="ambilFotoKunjungan-${counter}" onClick="editAmbilFotoKunjungan('${counter}')" >
        <i class="fa fa-camera  middleWhite"></i>
        </a>
        </div>
        <div class="col padding5">
        <a href="#" class="hapusFotoKunjungan" id ="${counter}">
        <i class="fas fa-window-close  middleWhite" ></i>
        </a>

        </div>
        </div>
        <div class="card-content card-content-padding">
        <img name="fotoKunjunganUpload" class="${counter}" id="foto-kunjungan-${counter}" height="150" width="100%">
        </div>
        </div>`;

        $$('.spanFotoKunjungan').append(element);*/

        function onSuccess(imageData) {
            var image = document.getElementById('foto-kunjungan-'+counter);
            image.src = imageData;
            counter++;
            element =`<div class="card">
            <div class="card-header row" style="background-color:#2196F3;color:white">
            <div class="col padding5">
            <a href="#" class="ambilFotoKunjungan-${counter}" onClick="editAmbilFotoKunjungan('${counter}')" >
            <i class="fa fa-camera  middleWhite"></i>
            </a>
            </div>
            <div class="col padding5">
            <a href="#" class="hapusFotoKunjungan" id ="${counter}">
            <i class="fas fa-window-close  middleWhite" ></i>
            </a>
            </div>
            <div class="card-content card-content-padding">
            <img name="fotoKunjunganUpload" class="${counter}" id="foto-kunjungan-${counter}" height="150" width="100%">
            </div>
            </div>`;

            $$('.spanFotoKunjungan').append(element);
            $$('.hapusFotoKunjungan').on('click',function(){
                var hapusId = $$(this).attr("id");
                var tampung = $$("#foto-kunjungan-"+hapusId).attr("src");
                if(tampung != null){
                    $$(this).closest('.card').remove();
                }
            });

            $$('.ambilFotoKunjungan-'+counter).on('click',function(){
                navigator.camera.getPicture(onSuccess,onFail,{
                    quality:30,
                    destinationType : Camera.DestinationType.FILE_URI,
                    
                    correctOrientation: true,
                    sourceType : Camera.PictureSourceType.PHOTOLIBRARY,
                });
            });
        }

        function onFail(message){
            myApp.alert('Failed because: ' +message);
        }
    }

    function editAmbilFotoPemantauanBan(counter){
        navigator.camera.getPicture(onSuccess,onFail,{
            quality:30,
            destinationType : Camera.DestinationType.FILE_URI,
            
            correctOrientation: true,
            sourceType : Camera.PictureSourceType.CAMERA,
        });

        function onSuccess(imageData) {
            var image = document.getElementById('foto-pemantauan-'+counter);
            image.src = imageData;
            counter++;
            element =`<div class="card">
            <div class="card-header row" style="background-color:#2196F3;color:white">

            <div class="col padding5">
            <a href="#" onClick="editAmbilFotoPemantauanBan('`+counter+`')" class="ambilFotoKunjunganzzz-${counter} padding5"  >
            <i class="fa fa-camera  middleWhite"></i>
            </a>
            </div>

            <div class="col padding5">
            <a href="#" onClick="editAmbilGalleryPemantauanBan('`+counter+`')" class="ambilFotoGalleryzzz-${counter} col-50 padding5" id ="${counter}">
            <i class="fas fa-image  middleWhite" ></i>
            </a>
            </div>

            <div class="col padding5">
            <a href="#" class="hapusFotoKunjungan col padding5" id ="${counter}">
            <i class="fas fa-window-close  middleWhite" ></i>
            </a>
            </div>

            </div>
            <div class="card-content card-content-padding">
            <img name="fotoPemantauanBanUpload" class="${counter}" id="foto-pemantauan-${counter}" height="150" width="100%">
            </div>
            </div>`;

            $$('.spanFotoPemantauanBan').append(element);
            $$('.hapusFotoKunjungan').on('click',function(){
                var hapusId = $$(this).attr("id");
                var tampung = $$("#foto-pemantauan-"+hapusId).attr("src");
                if(tampung != null){
                    $$(this).closest('.card').remove();
                }
            });

        }

        function onFail(message){
            myApp.alert('Failed because: ' +message);
        }
    }

    function editAmbilGalleryPemantauanBan(counter){
        navigator.camera.getPicture(onSuccess,onFail,{
            quality:30,
            destinationType : Camera.DestinationType.FILE_URI,
            
            correctOrientation: true,
            sourceType : Camera.PictureSourceType.PHOTOLIBRARY,
        });

        function onSuccess(imageData) {
            var image = document.getElementById('foto-pemantauan-'+counter);
            image.src = imageData;
            counter++;
            element =`<div class="card">
            <div class="card-header row" style="background-color:#2196F3;color:white">
            <div class="col padding5">
            <a href="#" onClick="editAmbilFotoPemantauanBan('`+counter+`')" class="ambilFotoKunjungan-${counter} padding5">
            <i class="fa fa-camera  middleWhite"></i>
            </a>
            </div>

            <div class="col padding5">
            <a href="#" onClick="editAmbilGalleryPemantauanBan('`+counter+`')" class="ambilFotoGallery-${counter} col-50 padding5" id ="${counter}">
            <i class="fas fa-image  middleWhite" ></i>
            </a>
            </div>

            <div class="col padding5">
            <a href="#" class="hapusFotoKunjungan col padding5" id ="${counter}">
            <i class="fas fa-window-close  middleWhite" ></i>
            </a>
            </div>

            </div>
            <div class="card-content card-content-padding">
            <img name="fotoPemantauanBanUpload" class="${counter}" id="foto-pemantauan-${counter}" height="150" width="100%">
            </div>
            </div>`;

            $$('.spanFotoPemantauanBan').append(element);
            $$('.hapusFotoKunjungan').on('click',function(){
                var hapusId = $$(this).attr("id");
                var tampung = $$("#foto-pemantauan-"+hapusId).attr("src");
                if(tampung != null){
                    $$(this).closest('.card').remove();
                }
            });
        }

        function onFail(message){
            myApp.alert('Failed because: ' +message);
        }
    }

    function HapusFoto(e){
        $$(e).closest('.card').remove();
    }

    function ambilFotoKameraPricelist(e,counterq){        
        navigator.camera.getPicture(onSuccess,onFail,{
            quality:30,
            destinationType : Camera.DestinationType.FILE_URI,
            
            correctOrientation: true,
            sourceType : Camera.PictureSourceType.CAMERA,
        });

        function onSuccess(imageData) {
            var image = document.getElementById('foto-pricelist-'+counterq);
            image.src = imageData;
            counterq++;
            
            var element = `<div class="card">
            <div class="card-header row" style="background-color:#2196F3;color:white">
            <a href="#" onClick="ambilFotoKameraPricelist(this,'${counterq}')" class="ambilFotoToko-1 col padding5" >
            <i class="fa fa-camera  middleWhite"></i>        
            </a>
            <a href="#" onClick="ambilFotoGalleryPricelist(this,'${counterq}')" class=" col padding5">
            <i class="far fa-image  middleWhite" ></i>
            </a>
            </div>

            <div class="card-content card-content-padding">
            <img name ="fotoTokoPricelist" id="foto-pricelist-${counterq}" height="150" width="100%">
            </div>
            </div>`;
            $$(e).closest('.generateFotoPricelist').append(element);

            var element = `<a href="#" onClick="HapusFoto(this)" class="ambilFotoToko-1 col padding5" >
            <i class="fa fa-window-close  middleWhite"></i>        
            </a>`;
            $$(e).closest('.card-header').html(element);
        }

        function onFail(message){
            myApp.alert('Failed because: ' +message);
        }

    }

    function ambilFotoGalleryPricelist(e,counterq){

        navigator.camera.getPicture(onSuccess,onFail,{
            quality:30,
            destinationType : Camera.DestinationType.FILE_URI,
            
            correctOrientation: true,
            sourceType : Camera.PictureSourceType.PHOTOLIBRARY,
        });

        function onSuccess(imageData) {
            var image = document.getElementById('foto-pricelist-'+counterq);
            image.src = imageData;
            counterq++;
            
            var element = `<div class="card">
            <div class="card-header row" style="background-color:#2196F3;color:white">
            <a href="#" onClick="ambilFotoKameraPricelist(this,'${counterq}')" class="ambilFotoToko-1 col padding5" >
            <i class="fa fa-camera  middleWhite"></i>        
            </a>
            <a href="#" onClick="ambilFotoGalleryPricelist(this,'${counterq}')" class=" col padding5">
            <i class="far fa-image  middleWhite" ></i>
            </a>
            </div>

            <div class="card-content card-content-padding">
            <img name ="fotoTokoPricelist" id="foto-pricelist-${counterq}" height="150" width="100%">
            </div>
            </div>`;
            $$(e).closest('.generateFotoPricelist').append(element);

            var element = `<a href="#" onClick="HapusFoto(this)" class="ambilFotoToko-1 col padding5" >
            <i class="fa fa-window-close  middleWhite"></i>        
            </a>`;
            $$(e).closest('.card-header').html(element);
        }

        function onFail(message){
            myApp.alert('Failed because: ' +message);
        }
    }

    function cobain(response,map,startcounter,endcounter){
        var gambar = `${imgFolder}history_tracking.png`;
        addMarkerWithInfowindow(map, new google.maps.LatLng(parseFloat(response.tracking[startcounter].LATITUDE),parseFloat(response.tracking[startcounter].LONGITUDE)),"","1",gambar,"history");
        startcounter++;
        if(startcounter > endcounter){

        } else {
            cobain(response,map,startcounter,endcounter);
        }
    }

    

    function ElementRute(index,counterWarna){
        var warna = ["black","red","blue","green"];
        var maxWarna = warna.length;

        if(counterWarna == maxWarna){
            counterWarna = 0;
        }

        return `<div style="margin:0 auto"><img src="${imgFolder}history_tracking_${warna[counterWarna]}.png" style="width:15px;height:15px">   Rute ${index}</div><br>`;
    }

    function AddMarkerPemetaanByPelanggan(response,map,startcounter,endcounter,gambar){
        var img = gambar;
        addMarkerWithInfowindow(map, new google.maps.LatLng(parseFloat(response.KOORDINAT[startcounter].LATITUDE),parseFloat(response.KOORDINAT[startcounter].LONGITUDE)),response.KOORDINAT[startcounter].NAMA,startcounter+1,img,"");
        startcounter++;
        if(startcounter > endcounter){

        } else {
            AddMarkerPemetaanByPelanggan(response,map,startcounter,endcounter,img);
        }
    }

    function AddMarkerPemetaanByPelangganLogo(response,map,startcounter,endcounter,gambar){
        var img = `${imgFolder}bendera/${response.KOORDINAT[startcounter].nama_gambar}?`+ new Date().getTime();
        var stringInfoWindow = `${response.KOORDINAT[startcounter].NAMA}<br>${response.KOORDINAT[startcounter].USERID}`;
        addMarkerWithInfowindow(map, new google.maps.LatLng(parseFloat(response.KOORDINAT[startcounter].LATITUDE),parseFloat(response.KOORDINAT[startcounter].LONGITUDE)),stringInfoWindow,startcounter+1,img,"");
        startcounter++;
        if(startcounter > endcounter){

        } else {
            AddMarkerPemetaanByPelangganLogo(response,map,startcounter,endcounter,img);

        }
    }

    function addMarkerWithInfowindow(map, marker_position, infowindow_content,counter,gambar,jenis){
        /*var image = 'https://developers.google.com/maps/documentation/javascript/examples/full/images/beachflag.png';*/
        var image = {
            url:`${imgFolder}flag_pelanggan.png?`+ new Date().getTime(),
            scaledSize:new google.maps.Size(38,38),
            labelOrigin: new google.maps.Point(16, 10)
        }
        if(counter == 0) {
            var myLatlng, marker, infowindow,contentString;
            marker = new google.maps.Marker({
              position: marker_position,
              map: map,
              icon: image
          });
        } else {
            if(gambar){
                if(jenis == "history"){
                    var image = {
                        url:gambar,
                        scaledSize: new google.maps.Size(10, 10),
                        origin: new google.maps.Point(0,0), 
                        anchor: new google.maps.Point(0, 0) 
                    }
                } else {

                    var image = {
                        url:gambar,
                        scaledSize: new google.maps.Size(30, 30),
                        origin: new google.maps.Point(0,0), 
                        anchor: new google.maps.Point(0, 0) 
                    }
                }

            }
            var myLatlng, marker, infowindow,contentString;
            marker = new google.maps.Marker({
              position: marker_position,
              label: counter.toString(),
              map: map,
              icon: image
          });
        }
        contentString = infowindow_content;
        infowindow = new google.maps.InfoWindow({
            content: contentString
        });
        marker.addListener('click', function() {
            infowindow.open(map, marker);
        });
    }

    function RouteHistoryTracking(response,map,startcounter,endcounter,counterWarna){
        var warna = ["black","red","blue","green"];
        var maxWarna = 4;
        var counterWarna = response.tracking[startcounter].RUTE % maxWarna -1;
        gambar = `${imgFolder}history_tracking_${warna[counterWarna]}.png`;
        addMarkerWithoutInfoWindow(map, new google.maps.LatLng(parseFloat(response.tracking[startcounter].LATITUDE),parseFloat(response.tracking[startcounter].LONGITUDE)),"","1",gambar,"history",response.tracking[startcounter].WAKTU);
        startcounter++;
        if(startcounter > endcounter){

        } else {
            RouteHistoryTracking(response,map,startcounter,endcounter);
        }
    }

    function addMarkerWithoutInfoWindow(map, marker_position, infowindow_content,counter,gambar,jenis,waktu){
        if(counter == 0) {
            var myLatlng, marker, infowindow,contentString;
            marker = new google.maps.Marker({
              position: marker_position,
              map: map,
              icon: image
          });
        } else {
            if(gambar){
                if(jenis == "history"){
                    var image = {
                        url:gambar,
                        scaledSize: new google.maps.Size(10, 10),
                        origin: new google.maps.Point(0,0), 
                        anchor: new google.maps.Point(0, 0) 
                    }
                } else {

                    var image = {
                        url:gambar,
                        scaledSize: new google.maps.Size(30, 30),
                        origin: new google.maps.Point(0,0), 
                        anchor: new google.maps.Point(0, 0) 
                    }
                }

            }
            var myLatlng, marker, infowindow,contentString;
            marker = new google.maps.Marker({
              position: marker_position,
              map: map,
              icon: image
          });
        }

        contentString = `Pukul ${ConvertDateTimeToText(waktu,'time')}`;
        infowindow = new google.maps.InfoWindow({
            content: contentString
        });
        marker.addListener('click', function() {
            infowindow.open(map, marker);
        });
    }


    function zoomInOutGambar(nomorbukti,idx){
        index = parseInt(idx);
        var act = "AMBIL_GAMBARKUNJUNGAN";
        myApp.request.post(ipTujuan,{case:act,NOMORBUKTI:nomorbukti},function(data){
            var hasil_json = JSON.parse(data);
            if(hasil_json.hasil == "ada"){
                tampungSourceGambar = [];
                for( var i =0; i<hasil_json.NAMAGAMBAR.length;i++){
                    tampungSourceGambar.push(ipGambarKunjungan+hasil_json.NAMAGAMBAR[i]+`.jpg?`+ new Date().getTime());
                }

                var myPhotoBrowserDark = myApp.photoBrowser.create({
                    photos : tampungSourceGambar,
                    theme: 'dark'
                });

                //$$('.pb-standalone-dark').on('click', function () {
                    myPhotoBrowserDark.open(index);
                //});

            } 
        });   
    }

    function zoomInOutGambarAbsensi(nama){
        var tampungGambar = ipGambarAbsensi+nama+`.jpg?`+ new Date().getTime();
        var myPhotoBrowserDark = myApp.photoBrowser.create({
            photos : [tampungGambar],
            theme: 'dark'
        });

        myPhotoBrowserDark.open();
    }

    function zoomInOutGambarRencanaKunjungan(nomorbukti,idx){
        index = parseInt(idx);
        var act = "AMBIL_GAMBAR_RENCANA_KUNJUNGAN";
        myApp.request.post(ipTujuan,{case:act,NOMORBUKTI:nomorbukti},function(data){
            var hasil_json = JSON.parse(data);
            if(hasil_json.hasil == "ada"){
                tampungSourceGambar = [];
                for( var i =0; i<hasil_json.NAMAGAMBAR.length;i++){
                    tampungSourceGambar.push(ipGambarRencanaKunjungan+hasil_json.NAMAGAMBAR[i]+`.jpg?`+ new Date().getTime());
                }

                var myPhotoBrowserDark = myApp.photoBrowser.create({
                    photos : tampungSourceGambar,
                    theme: 'dark'
                });

                //$$('.pb-standalone-dark').on('click', function () {
                    myPhotoBrowserDark.open(index);
                //});
            } 
        });
    }

    function zoomInOutGambarKunjungan(nomorbukti,idx){
        index = parseInt(idx);
        var act = "AMBIL_GAMBAR_KUNJUNGAN";
        myApp.request.post(ipTujuan,{case:act,NOMORBUKTI:nomorbukti},function(data){
            var hasil_json = JSON.parse(data);
            if(hasil_json.hasil == "ada"){
                tampungSourceGambar = [];
                for( var i =0; i<hasil_json.NAMAGAMBAR.length;i++){
                    tampungSourceGambar.push(ipGambarKunjungan+hasil_json.NAMAGAMBAR[i]+`.jpg?`+ new Date().getTime());
                }

                var myPhotoBrowserDark = myApp.photoBrowser.create({
                    photos : tampungSourceGambar,
                    theme: 'dark'
                });

                //$$('.pb-standalone-dark').on('click', function () {
                    myPhotoBrowserDark.open(index);
                //});

            } 
        });
    }

    function zoomInOutGambarGlobal(url,idx,jenis){
        index = parseInt(idx);
        tampungSourceGambar = [];
        if(jenis == "nota_pengeluaran"){
            urlZoomInOutGambar.foto_nota_pengeluaran.forEach(function(obj,x){
                tampungSourceGambar.push(`${ipGambarPengeluaran}nota_pengeluaran/${obj.url}.jpg?${new Date().getTime()}`);
            })
        } else if(jenis == "foto_odometer"){
            tampungSourceGambar.push(url);
        } else if(jenis == "foto_nomor_plat"){
            tampungSourceGambar.push(url);
        }

        var myPhotoBrowserDark = myApp.photoBrowser.create({
            photos : tampungSourceGambar,
            theme: 'dark'
        });
        myPhotoBrowserDark.open(index);
    }

    function zoomInOutGambarTdPemantauanBan(nomorbukti,idx){
        index = parseInt(idx);
        var act = "AMBIL_GAMBAR_TD_PEMANTAUAN_BAN";
        myApp.request.post(ipTujuan,{case:act,NOMORBUKTI:nomorbukti},function(data){
            var hasil_json = JSON.parse(data);
            if(hasil_json.hasil == "ada"){
                tampungSourceGambar = [];
                for( var i =0; i<hasil_json.NAMAGAMBAR.length;i++){
                    tampungSourceGambar.push(ipGambarPemantauanBan+hasil_json.NAMAGAMBAR[i]+`.jpg?`+ new Date().getTime());
                }

                var myPhotoBrowserDark = myApp.photoBrowser.create({
                    photos : tampungSourceGambar,
                    theme: 'dark'
                });

                //$$('.pb-standalone-dark').on('click', function () {
                    myPhotoBrowserDark.open(index);
                //});

            } 
        });
    }

    function zoomInOutGambarTmPemantauanBan(nomorbukti,idx){
        index = parseInt(idx);
        var act = "AMBIL_GAMBAR_TM_PEMANTAUAN_BAN";
        myApp.request.post(ipTujuan,{case:act,NOMORBUKTI:nomorbukti},function(data){
            var hasil_json = JSON.parse(data);
            if(hasil_json.hasil == "ada"){
                tampungSourceGambar = [];
                for( var i =0; i<hasil_json.NAMAGAMBAR.length;i++){
                    tampungSourceGambar.push(ipGambarTmPemantauanBan+hasil_json.NAMAGAMBAR[i]+`.jpg?`+ new Date().getTime());
                }

                var myPhotoBrowserDark = myApp.photoBrowser.create({
                    photos : tampungSourceGambar,
                    theme: 'dark'
                });

                //$$('.pb-standalone-dark').on('click', function () {
                    myPhotoBrowserDark.open(index);
                //});

            } 
        });
    }

    function logOutUser(){
        myApp.dialog.confirm("Benarkah Anda Mau Logout ?",function(){

            /*setTimeout(function() {
                bgGeo.stop();
            }, 1000);*/
        //bgGeo.stopWatchPosition();
        var params = {
            case:"LOGOUT",
            USERID:USERID
        }
        RemoveItemLocalStorageKunjungan();
        localStorage.setItem("USERID",null);
        localStorage.setItem("KODECABANG",null);
        localStorage.setItem("KODEJABATAN",null);
        localStorage.setItem("PASSWORD",null);
        KODEJABATAN = "";
        localStorage.removeItem("waktuMasukLoginTokoKunjungan");
        localStorage.removeItem("kodeLoginTokoKunjungan");
        localStorage.removeItem("namaLoginTokoKunjungan");
        localStorage.removeItem("waktuMasukLoginTokoCollector");
        localStorage.removeItem("kodeLoginTokoCollector");
        localStorage.removeItem("namaLoginTokoCollector");
        localStorage.removeItem("waktuMasukLoginTokoKiriman");
        localStorage.removeItem("kodeLoginTokoKiriman");
        localStorage.removeItem("namaLoginTokoKiriman");
        waktuMasukLoginTokoKiriman = "";
        waktuMasukLoginTokoCollector = "";
        waktuMasukLoginTokoKunjungan = "";
        namaLoginTokoKunjungan = "";
        namaLoginTokoKiriman = "";
        namaLoginTokoCollector = "";
        kodeLoginTokoKiriman = "";
        kodeLoginTokoCollector = "";
        kodeLoginTokoKunjungan = "";

        myApp.request.post(ipTujuan,params)
        mainView.router.navigate({url:'/login/'});

    });

    }

    function PopupLaporanKaryawan(KODEJABATANDIPILIH){
        var act = "TAMPIL_POPUP_KARYAWAN_PELANGGAN_BERDASARKAN_JABATAN";
        myApp.request.post(ipTujuan,{case:act,KODECABANG:KODECABANG,KODEJABATAN:KODEJABATANDIPILIH},function(data){
            var hasil_json = JSON.parse(data);
            var tampungPopUpKaryawan ="Tidak Memiliki Karyawan Internal";
            if(hasil_json.hasil == "ada"){
                tampungPopUpKaryawan = "";
                for(var i = 0; i<hasil_json.KODEKARYAWAN.length;i++){
                    tampungPopUpKaryawan += `<li>
                    <a href="#" class="item-link item-content cobaKlik" onClick="pilihDari('`+hasil_json.KODEKARYAWAN[i]+`','`+hasil_json.NAMA[i]+`')">
                    <div class="item-inner">
                    <div class="item-text namaKaryawanDari" style="color:black">`+hasil_json.NAMA[i]+`</div>
                    </div>
                    </a>
                    </li>`;
                }
                $$('.listPopUpNamaKaryawanDari').html(tampungPopUpKaryawan);
            } else {
                $$('.listPopUpNamaKaryawanDari').html(tampungPopUpKaryawan);
            }
            myApp.preloader.hide();
        });
    }

    function PopupLaporanKaryawanUserId(USERID){
        var act = "TAMPIL_POPUP_KARYAWAN_PELANGGAN_BERDASARKAN_JABATAN";
        KODEJABATANDIPILIH = "SEMUA";
        myApp.request.post(ipTujuan,{case:act,KODECABANG:KODECABANG,KODEJABATAN:KODEJABATANDIPILIH},function(data){
            var hasil_json = JSON.parse(data);
            var tampungPopUpKaryawan ="Tidak Memiliki Karyawan Internal";
            if(hasil_json.hasil == "ada"){
                tampungPopUpKaryawan = "";
                for(var i = 0; i<hasil_json.KODEKARYAWAN.length;i++){
                    if(USERID == "SUMBER" || USERID == "DWI"){
                        tampungPopUpKaryawan += `<li>
                        <a href="#" class="item-link item-content cobaKlik" onClick="pilihDari('`+hasil_json.KODEKARYAWAN[i]+`','`+hasil_json.NAMA[i]+`')">
                        <div class="item-inner">
                        <div class="item-text namaKaryawanDari" style="color:black">`+hasil_json.NAMA[i]+`</div>
                        </div>
                        </a>
                        </li>`;  
                    } else {
                        if(hasil_json.KODEKARYAWAN[i] == USERID){
                            tampungPopUpKaryawan += `<li>
                            <a href="#" class="item-link item-content cobaKlik" onClick="pilihDari('`+hasil_json.KODEKARYAWAN[i]+`','`+hasil_json.NAMA[i]+`')">
                            <div class="item-inner">
                            <div class="item-text namaKaryawanDari" style="color:black">`+hasil_json.NAMA[i]+`</div>
                            </div>
                            </a>
                            </li>`;  
                        }
                    }
                }
                $$('.listPopUpNamaKaryawanDari').html(tampungPopUpKaryawan);
            } else {
                $$('.listPopUpNamaKaryawanDari').html(tampungPopUpKaryawan);
            }
            myApp.preloader.hide();
        });
    }

    function PopupLaporanKaryawanUserIdAbsensi(USERID){
        var act = "TAMPIL_POPUP_KARYAWAN_PELANGGAN_BERDASARKAN_JABATAN";
        KODEJABATANDIPILIH = "SEMUA";
        myApp.request.post(ipTujuan,{case:act,KODECABANG:KODECABANG,KODEJABATAN:KODEJABATANDIPILIH},function(data){
            var hasil_json = JSON.parse(data);
            var tampungPopUpKaryawan ="Tidak Memiliki Karyawan Internal";
            if(hasil_json.hasil == "ada"){
                tampungPopUpKaryawan = "";
                for(var i = 0; i<hasil_json.KODEKARYAWAN.length;i++){
                    if(USERID == "SUMBER" || USERID == "DWI"){
                        tampungPopUpKaryawan += `<li>
                        <a href="#" class="item-link item-content cobaKlik" onClick="pilihDariAbsensi('`+hasil_json.KODEKARYAWAN[i]+`','`+hasil_json.NAMA[i]+`')">
                        <div class="item-inner">
                        <div class="item-text namaKaryawanDari" style="color:black">`+hasil_json.NAMA[i]+`</div>
                        </div>
                        </a>
                        </li>`;  
                    } else {
                        if(hasil_json.KODEKARYAWAN[i] == USERID){
                            tampungPopUpKaryawan += `<li>
                            <a href="#" class="item-link item-content cobaKlik" onClick="pilihDariAbsensi('`+hasil_json.KODEKARYAWAN[i]+`','`+hasil_json.NAMA[i]+`')">
                            <div class="item-inner">
                            <div class="item-text namaKaryawanDari" style="color:black">`+hasil_json.NAMA[i]+`</div>
                            </div>
                            </a>
                            </li>`;  
                        }
                    }
                }
                $$('.listPopUpNamaKaryawanDari').html(tampungPopUpKaryawan);
            } else {
                $$('.listPopUpNamaKaryawanDari').html(tampungPopUpKaryawan);
            }
            myApp.preloader.hide();
        });
    }

    

    function PopupLaporanKaryawanDari(KODEJABATANDIPILIH){
        var act = "TAMPIL_POPUP_KARYAWAN_PELANGGAN_BERDASARKAN_JABATAN";
        myApp.request.post(ipTujuan,{case:act,KODECABANG:KODECABANG,KODEJABATAN:KODEJABATANDIPILIH},function(data){
            var hasil_json = JSON.parse(data);
            var tampungPopUpKaryawan ="Tidak Memiliki Karyawan Internal";
            if(hasil_json.hasil == "ada"){
                tampungPopUpKaryawan = "";
                for(var i = 0; i<hasil_json.KODEKARYAWAN.length;i++){
                    tampungPopUpKaryawan += `<li>
                    <a href="#" class="item-link item-content cobaKlik" onClick="pilihDariKaryawan('`+hasil_json.KODEKARYAWAN[i]+`','`+hasil_json.NAMA[i]+`')">
                    <div class="item-inner">
                    <div class="item-text namaKaryawanDari" style="color:black">`+hasil_json.NAMA[i]+`</div>
                    </div>
                    </a>
                    </li>`;
                }
                $$('.listPopUpNamaKaryawanDari').html(tampungPopUpKaryawan);
            } else {
                $$('.listPopUpNamaKaryawanDari').html(tampungPopUpKaryawan);
            }
            myApp.preloader.hide();
        });
    }

    function PopupLaporanKaryawanSampai(KODEJABATANDIPILIH){
        var act = "TAMPIL_POPUP_KARYAWAN_PELANGGAN_BERDASARKAN_JABATAN";
        myApp.request.post(ipTujuan,{case:act,KODECABANG:KODECABANG,KODEJABATAN:KODEJABATANDIPILIH},function(data){
            var hasil_json = JSON.parse(data);
            var tampungPopUpKaryawan ="Tidak Memiliki Karyawan Internal";
            if(hasil_json.hasil == "ada"){
                tampungPopUpKaryawan = "";
                for(var i = 0; i<hasil_json.KODEKARYAWAN.length;i++){
                    tampungPopUpKaryawan += `<li>
                    <a href="#" class="item-link item-content cobaKlik" onClick="pilihSampaiKaryawan('`+hasil_json.KODEKARYAWAN[i]+`','`+hasil_json.NAMA[i]+`')">
                    <div class="item-inner">
                    <div class="item-text namaKaryawanSampai" style="color:black">`+hasil_json.NAMA[i]+`</div>
                    </div>
                    </a>
                    </li>`;
                }
                $$('.listPopUpNamaKaryawanSampai').html(tampungPopUpKaryawan);
            } else {
                $$('.listPopUpNamaKaryawanSampai').html(tampungPopUpKaryawan);
            }
            myApp.preloader.hide();
        });
    }


    function PopupLaporanKaryawanPerTanggalDari(KODEJABATANDIPILIH,KODEKARYAWAN){
        var act = "TAMPIL_POPUP_KARYAWAN_PELANGGAN_PER_TANGGAL";
        myApp.request.post(ipTujuan,{case:act,KODECABANG:KODECABANG,KODEJABATAN:KODEJABATANDIPILIH,KODEKARYAWAN:KODEKARYAWAN},function(data){
            var hasil_json = JSON.parse(data);
            var tampungPopUpKaryawan ="Tidak Memiliki Karyawan Internal";
            if(hasil_json.hasil == "ada"){
                tampungPopUpKaryawan = "";
                for(var i = 0; i<hasil_json.KODEKARYAWAN.length;i++){
                    tampungPopUpKaryawan += `<li>
                    <a href="#" class="item-link item-content cobaKlik" onClick="pilihDariKaryawan('`+hasil_json.KODEKARYAWAN[i]+`','`+hasil_json.NAMA[i]+`')">
                    <div class="item-inner">
                    <div class="item-text namaKaryawanDari" style="color:black">`+hasil_json.NAMA[i]+`</div>
                    </div>
                    </a>
                    </li>`;
                }
                $$('.listPopUpNamaKaryawanDari').html(tampungPopUpKaryawan);
            } else {
                $$('.listPopUpNamaKaryawanDari').html(tampungPopUpKaryawan);
            }
            myApp.preloader.hide();
        });
    }

    function PopupLaporanKaryawanPerTanggalSampai(KODEJABATANDIPILIH,KODEKARYAWAN){
        var act = "TAMPIL_POPUP_KARYAWAN_PELANGGAN_PER_TANGGAL";
        myApp.request.post(ipTujuan,{case:act,KODECABANG:KODECABANG,KODEJABATAN:KODEJABATANDIPILIH,KODEKARYAWAN:KODEKARYAWAN},function(data){
            var hasil_json = JSON.parse(data);
            var tampungPopUpKaryawan ="Tidak Memiliki Karyawan Internal";
            if(hasil_json.hasil == "ada"){
                tampungPopUpKaryawan = "";
                for(var i = 0; i<hasil_json.KODEKARYAWAN.length;i++){
                    tampungPopUpKaryawan += `<li>
                    <a href="#" class="item-link item-content cobaKlik" onClick="pilihSampaiKaryawan('`+hasil_json.KODEKARYAWAN[i]+`','`+hasil_json.NAMA[i]+`')">
                    <div class="item-inner">
                    <div class="item-text namaKaryawanSampai" style="color:black">`+hasil_json.NAMA[i]+`</div>
                    </div>
                    </a>
                    </li>`;
                }
                $$('.listPopUpNamaKaryawanSampai').html(tampungPopUpKaryawan);
            } else {
                $$('.listPopUpNamaKaryawanSampai').html(tampungPopUpKaryawan);
            }
            myApp.preloader.hide();
        });
    }

    function PopupKaryawan(jabatan,namaClass){
        var act = "TAMPIL_POPUP_KARYAWAN_CLASS";
        myApp.request.post(ipTujuan,{case:act,KODECABANG:KODECABANG,KODEJABATAN:jabatan},function(data){
            var hasil_json = JSON.parse(data);
            var tampungPopUpKaryawan ="Tidak Memiliki Karyawan";
            if(hasil_json.hasil == "ada"){
                tampungPopUpKaryawan = "";
                for(var i = 0; i<hasil_json.KODEKARYAWAN.length;i++){
                    tampungPopUpKaryawan += `<li>
                    <a href="#" class="item-link item-content cobaKlik" onClick="pilihKaryawan('`+hasil_json.KODEKARYAWAN[i]+`','`+hasil_json.NAMA[i]+`')">
                    <div class="item-inner">
                    <div class="item-text namaKaryawan" style="color:black">`+hasil_json.NAMA[i]+`</div>
                    </div>
                    </a>
                    </li>`;
                }
                $$('.'+namaClass).html(tampungPopUpKaryawan);
            } else {
                $$('.'+namaClass).html(tampungPopUpKaryawan);
            }
            myApp.preloader.hide();
        });
    }

    function PopupLaporanKaryawanBerdasarUserId(userId){
        var act = "TAMPIL_POPUP_KARYAWAN_PELANGGAN_BERDASARKAN_USERID";
        myApp.request.post(ipTujuan,{case:act,KODECABANG:KODECABANG,USERID:userId},function(data){
            var hasil_json = JSON.parse(data);
            var tampungPopUpKaryawan ="Tidak Memiliki Karyawan Internal";
            if(hasil_json.hasil == "ada"){
                tampungPopUpKaryawan = "";
                for(var i = 0; i<hasil_json.KODEKARYAWAN.length;i++){
                    tampungPopUpKaryawan += `<li>
                    <a href="#" class="item-link item-content cobaKlik" onClick="pilihDariKaryawan('`+hasil_json.KODEKARYAWAN[i]+`','`+hasil_json.NAMA[i]+`')">
                    <div class="item-inner">
                    <div class="item-text namaKaryawanDari" style="color:black">`+hasil_json.NAMA[i]+`</div>
                    </div>
                    </a>
                    </li>`;
                }
                $$('.listPopUpNamaKaryawanDari').html(tampungPopUpKaryawan);
            } else {
                $$('.listPopUpNamaKaryawanDari').html(tampungPopUpKaryawan);
            }
            myApp.preloader.hide();
        });
    }

    function pilihKaryawan(kodekaryawan,nama){
        $$('.namaDriverInputRencanaKirimanCollector').val(nama);
        $$('.kodeDriverInputRencanaKirimanCollector').val(kodekaryawan);
        myApp.popup.close();
    }

    function pilihDari(kodekaryawan,nama){
        $$('.namaDariSalesmanLaporan').val(nama);
        $$('.kodeDariSalesmanLaporan').val(kodekaryawan);
        myApp.popup.close();
        if(halamanGlobal == "LAPORAN_ABSENSI"){
            HasilLaporanAbsensi();    
        } else if(halamanGlobal == "LAPORAN_POINT_KUNJUNGAN") {
            HasilLaporanPointKunjungan();
        }
    }

    function pilihDariAbsensi(kodekaryawan,nama){
        $$('.namaDariSalesmanLaporan').val(nama);
        $$('.kodeDariSalesmanLaporan').val(kodekaryawan);
        myApp.popup.close();
    }

    function pilihDariKaryawan(kodekaryawan,nama){
        $$('.namaDariSalesmanLaporan').val(nama);
        $$('.kodeDariSalesmanLaporan').val(kodekaryawan);
        myApp.popup.close();
    }

    function pilihSampaiKaryawan(kodekaryawan,nama){
        $$('.namaSampaiSalesmanLaporan').val(nama);
        $$('.kodeSampaiSalesmanLaporan').val(kodekaryawan);
        myApp.popup.close();
    }

    function pilihPelangganDari(kodepelanggan,nama){
        $$('.namaDariPelanggan').val(nama);
        $$('.kodeDariPelanggan').val(kodepelanggan);
        myApp.popup.close();
    }

    function pilihPelangganSampai(kodepelanggan,nama){
        $$('.namaSampaiPelanggan').val(nama);
        $$('.kodeSampaiPelanggan').val(kodepelanggan);
        myApp.popup.close();
    }

    function PreloaderHide(status){  
        if(status == 4 || status == 0){
            setTimeout(function () {
                myApp.preloader.hide();

                $$('.page-content').html(`
                    <div class="block" >
                    <p class="row" >

                    <button style="position: fixed;
                    margin: auto;
                    left: 0;
                    right: 0;
                    top: 50%;
                    bottom: 0;font-weight:bold" class="col-50 button button-big button-fill" onClick="RefreshPage()"><i class="fas fa-sync-alt"></i>  Refresh</button>
                    </p>

                    </div>
                    `);
            }, 3000);
        }


    }


    function RefreshPage(){
        myApp.preloader.show();
        var tampungCounter = myApp.views.current["history"].length-1;
        var tampungHalaman = myApp.views.current["history"][tampungCounter];
        mainView.router.navigate(tampungHalaman, {
          reloadCurrent: true,
          ignoreCache: true,
      });
    }

    function ChartKaryawanVsKunjungan(arrNamaKaryawan,arrJumlahKunjunganKaryawan){

        var ctx = document.getElementById("myChart").getContext('2d');
        var myChart = new Chart(ctx, {
            type: 'horizontalBar',
            data: {
                labels: arrNamaKaryawan,
                datasets: [{
                    label: 'Jumlah Kunjungan',
                    data: arrJumlahKunjunganKaryawan,

                    borderWidth: 1
                }]
            },
            options: {animation: {
                onComplete: function () {
                    var ctx = this.chart.ctx;
                    ctx.font = Chart.helpers.fontString(Chart.defaults.global.defaultFontFamily, 'normal', Chart.defaults.global.defaultFontFamily);
                    ctx.fillStyle = "black";
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'bottom';

                    this.data.datasets.forEach(function (dataset)
                    {
                        for (var i = 0; i < dataset.data.length; i++) {
                            for(var key in dataset._meta)
                            {
                                var model = dataset._meta[key].data[i]._model;
                                ctx.fillText(dataset.data[i], model.x+10, model.y +7);
                            }
                        }
                    });
                }
            },
            legend:{
                fontColor:'red'
            },

            scales: {
                display:true,
                yAxes: [{
                    ticks: {
                        beginAtZero:true,
                    }
                }]
            },

        },

    });
    }


    var tampungKodePelangganUpdateGps;
    function UpdateGps(kode){
        tampungKodePelangganUpdateGps = kode;
        myApp.preloader.show();
        mainView.router.navigate("/detail_update_gps_pelanggan/");
    }

    function ubahGpsPelanggan(kodepelanggan,nomorbukti,latitude,longitude){
        var act = "UPDATE_GPS_PELANGGAN_DETAIL";
        myApp.request.post(ipTujuan,{case:act,KODEPELANGGAN:kodepelanggan,NOMORBUKTI:nomorbukti,LATITUDE:latitude,LONGITUDE:longitude},function(data){
        //mainView.router.navigate("/update_gps_pelanggan/");
        mainView.router.back("/update_gps_pelanggan/");
    });
    }

    var tampungTanggalRencana;
    function klikListRencana(tanggal){
        tampungTanggalRencana = tanggal;
        AlertPengembangan();
    }

    function AlertPengembangan(){
        myApp.dialog.alert("Maaf masih Dalam Tahap Pengembangan");
    }

    function ambilFotoKunjunganz(counterToko,counterFoto){
        navigator.camera.getPicture(onSuccess,onFail,{
            quality:30,
            destinationType : Camera.DestinationType.FILE_URI,
            
            correctOrientation: true,
            sourceType : Camera.PictureSourceType.CAMERA,
            cameraDirection: Camera.Direction.BACK
        });

        function onSuccess(imageData) {
            var image = document.getElementById('foto-kunjungan-'+counterToko+'-'+counterFoto);
            image.src = imageData;
            counterFoto++;
            element =`<div class="card">
            <div class="card-header row" style="background-color:#2196F3;color:white">

            <a href="#" onClick="ambilFotoKunjunganz('${counterToko}','${counterFoto}')" class="ambilFotoKunjungan-${counterToko}-${counterFoto} col padding5"  >
            <i class="fa fa-camera  middleWhite"></i>
            </a>

            <a href="#" onClick="ambilFotoGalleryz('${counterToko}','${counterFoto}')" class="ambilFotoGallery-${counterToko}-${counterFoto} col padding5">
            <i class="far fa-image  middleWhite"> </i>
            </a>


            <a href="#" class="hapusFotoKunjungan col padding5" id ="1">
            <i class="fas fa-window-close  middleWhite" ></i>
            </a>
            </div>
            <div class="card-content card-content-padding">

            <input type="hidden" name="counterArrayFoto" value="${counterToko}-${counterFoto}">
            <img name="fotoKunjunganUpload[${counterToko}][]" class="${counterFoto}" id="foto-kunjungan-${counterToko}-${counterFoto}" height="150" width="100%">

            </div>
            </div>`;

            var tampung = counterFoto-1;
            $$('.ambilFotoKunjungan-'+counterToko+'-'+tampung).closest('.spanFotoKunjungan').append(element);
            $$('.hapusFotoKunjungan').on('click',function(){
                var hapusId = $$(this).attr("id");
                var tampung = $$("#foto-kunjungan-"+hapusId).attr("src");
                if(tampung != null){
                    $$(this).closest('.card').remove();
                }
            });

        /*$$('.ambilFotoKunjungan-'+counter).on('click',function(){
            navigator.camera.getPicture(onSuccess,onFail,{
                quality:30,
                destinationType : Camera.DestinationType.FILE_URI,
                
                correctOrientation: true,
                sourceType : Camera.PictureSourceType.CAMERA,
                cameraDirection: Camera.Direction.BACK
            });
        });

        $$('.ambilFotoGallery-'+counter).on('click',function(){
            navigator.camera.getPicture(onSuccess,onFail,{
                quality:30,
                destinationType : Camera.DestinationType.FILE_URI,
                
                correctOrientation: true,
                sourceType : Camera.PictureSourceType.PHOTOLIBRARY,
            });
        });*/
    }

    function onFail(message){
        myApp.alert('Failed because: ' +message);
    }
    /*counterFoto++;
    element =`<div class="card">
    <div class="card-header row" style="background-color:#2196F3;color:white">

    <a href="#" onClick="ambilFotoKunjunganz('${counterToko}','${counterFoto}')" class="ambilFotoKunjungan-${counterToko}-${counterFoto} col padding5"  >
    <i class="fa fa-camera  middleWhite"></i>
    </a>

    <a href="#" onClick="ambilFotoGalleryz('${counterToko}','${counterFoto}')" class="ambilFotoGallery-${counterToko}-${counterFoto} col padding5">
    <i class="far fa-image  middleWhite"> </i>
    </a>


    <a href="#" class="hapusFotoKunjungan col padding5" id ="1">
    <i class="fas fa-window-close  middleWhite" ></i>
    </a>
    </div>
    <div class="card-content card-content-padding">
    <img name="fotoKunjunganUpload[${counterToko}][]" class="${counterFoto}" id="foto-kunjungan-${counterFoto}" height="150" width="100%">
    </div>
    </div>`;

    var tampung = counterFoto-1;
    $$('.ambilFotoKunjungan-'+counterToko+'-'+tampung).closest('.spanFotoKunjungan').append(element);*/

}

function ambilFotoGalleryz(counterToko,counterFoto){
    navigator.camera.getPicture(onSuccess,onFail,{
        quality:30,
        destinationType : Camera.DestinationType.FILE_URI,
        
        correctOrientation: true,
        sourceType : Camera.PictureSourceType.PHOTOLIBRARY,
    });

    function onSuccess(imageData) {
        var image = document.getElementById('foto-kunjungan-'+counterToko+'-'+counterFoto);
        image.src = imageData;
        counterFoto++;
        element =`<div class="card">
        <div class="card-header row" style="background-color:#2196F3;color:white">

        <a href="#" onClick="ambilFotoKunjunganz('${counterToko}','${counterFoto}')" class="ambilFotoKunjungan-${counterToko}-${counterFoto} col padding5"  >
        <i class="fa fa-camera  middleWhite"></i>
        </a>

        <a href="#" onClick="ambilFotoGalleryz('${counterToko}','${counterFoto}')" class="ambilFotoGallery-${counterToko}-${counterFoto} col padding5">
        <i class="far fa-image  middleWhite"> </i>
        </a>


        <a href="#" class="hapusFotoKunjungan col padding5" id ="1">
        <i class="fas fa-window-close  middleWhite" ></i>
        </a>
        </div>
        <input type="hidden" name="counterArrayFoto" value="${counterToko}-${counterFoto}">
        <div class="card-content card-content-padding">
        <img name="fotoKunjunganUpload[${counterToko}][]" class="${counterFoto}" id="foto-kunjungan-${counterToko}-${counterFoto}" height="150" width="100%">
        
        </div>
        </div>`;

        var tampung = counterFoto-1;
        $$('.ambilFotoGallery-'+counterToko+'-'+tampung).closest('.spanFotoKunjungan').append(element);
        $$('.hapusFotoKunjungan').on('click',function(){
            var hapusId = $$(this).attr("id");
            var tampung = $$("#foto-kunjungan-"+hapusId).attr("src");
            if(tampung != null){
                $$(this).closest('.card').remove();
            }
        });

        /*$$('.ambilFotoKunjungan-'+counter).on('click',function(){
            navigator.camera.getPicture(onSuccess,onFail,{
                quality:30,
                destinationType : Camera.DestinationType.FILE_URI,
                
                correctOrientation: true,
                sourceType : Camera.PictureSourceType.CAMERA,
                cameraDirection: Camera.Direction.BACK
            });
        });

        $$('.ambilFotoGallery-'+counter).on('click',function(){
            navigator.camera.getPicture(onSuccess,onFail,{
                quality:30,
                destinationType : Camera.DestinationType.FILE_URI,
                
                correctOrientation: true,
                sourceType : Camera.PictureSourceType.PHOTOLIBRARY,
            });
        });*/
    }

    function onFail(message){
        myApp.alert('Failed because: ' +message);
    }
    /*counterFoto++;
    element =`<div class="card">
    <div class="card-header row" style="background-color:#2196F3;color:white">

    <a href="#" onClick="ambilFotoKunjunganz('${counterToko}','${counterFoto}')" class="ambilFotoKunjungan-${counterToko}-${counterFoto} col padding5"  >
    <i class="fa fa-camera  middleWhite"></i>
    </a>

    <a href="#" onClick="ambilFotoGalleryz('${counterToko}','${counterFoto}')" class="ambilFotoGallery-${counterToko}-${counterFoto} col padding5">
    <i class="far fa-image  middleWhite"> </i>
    </a>


    <a href="#" class="hapusFotoKunjungan col padding5" id ="1">
    <i class="fas fa-window-close  middleWhite" ></i>
    </a>
    </div>
    <div class="card-content card-content-padding">
    <img name="fotoKunjunganUpload[${counterToko}][]" class="${counterFoto}" id="foto-kunjungan-${counterToko}-${counterFoto}" height="150" width="100%">
    </div>
    </div>`;

    var tampung = counterFoto-1;
    $$('.ambilFotoGallery-'+counterToko+'-'+tampung).closest('.spanFotoKunjungan').append(element);*/
}

function ambilFotoKunjunganzz(counterToko,counterFoto){
    navigator.camera.getPicture(onSuccess,onFail,{
        quality:30,
        destinationType : Camera.DestinationType.FILE_URI,
        
        correctOrientation: true,
        sourceType : Camera.PictureSourceType.CAMERA,
        cameraDirection: Camera.Direction.BACK
    });

    function onSuccess(imageData) {
        var image = document.getElementById('foto-kunjungan-'+counterToko+'-'+counterFoto);
        image.src = imageData;
        counterFoto++;
        element =`<div class="card">
        <div class="card-header row" style="background-color:#2196F3;color:white">

        <a href="#" onClick="ambilFotoKunjunganzz('${counterToko}','${counterFoto}')" class="ambilFotoKunjunganzz-${counterToko}-${counterFoto} col padding5"  >
        <i class="fa fa-camera  middleWhite"></i>
        </a>

        <a href="#" onClick="ambilFotoGalleryzz('${counterToko}','${counterFoto}')" class="ambilFotoGalleryzz-${counterToko}-${counterFoto} col padding5">
        <i class="far fa-image  middleWhite"> </i>
        </a>


        <a href="#" class="hapusFotoKunjungan col padding5" id ="1">
        <i class="fas fa-window-close  middleWhite" ></i>
        </a>
        </div>
        <div class="card-content card-content-padding">

        <input type="hidden" name="counterArrayFoto" value="${counterToko}-${counterFoto}">
        <img name="fotozKunjunganUploadz[${counterToko}][]" class="${counterFoto}" id="foto-kunjungan-${counterToko}-${counterFoto}" height="150" width="100%">
        
        </div>
        </div>`;

        var tampung = counterFoto-1;
        $$('.ambilFotoKunjunganzz-'+counterToko+'-'+tampung).closest('.spanFotoKunjungan').append(element);
        $$('.hapusFotoKunjunganzz').on('click',function(){
            var hapusId = $$(this).attr("id");
            var tampung = $$("#foto-kunjungan-"+hapusId).attr("src");
            if(tampung != null){
                $$(this).closest('.card').remove();
            }
        });

        /*$$('.ambilFotoKunjungan-'+counter).on('click',function(){
            navigator.camera.getPicture(onSuccess,onFail,{
                quality:30,
                destinationType : Camera.DestinationType.FILE_URI,
                
                correctOrientation: true,
                sourceType : Camera.PictureSourceType.CAMERA,
                cameraDirection: Camera.Direction.BACK
            });
        });

        $$('.ambilFotoGallery-'+counter).on('click',function(){
            navigator.camera.getPicture(onSuccess,onFail,{
                quality:30,
                destinationType : Camera.DestinationType.FILE_URI,
                
                correctOrientation: true,
                sourceType : Camera.PictureSourceType.PHOTOLIBRARY,
            });
        });*/
    }

    function onFail(message){
        myApp.alert('Failed because: ' +message);
    }
    /*counterFoto++;
    element =`<div class="card">
    <div class="card-header row" style="background-color:#2196F3;color:white">

    <a href="#" onClick="ambilFotoKunjunganz('${counterToko}','${counterFoto}')" class="ambilFotoKunjungan-${counterToko}-${counterFoto} col padding5"  >
    <i class="fa fa-camera  middleWhite"></i>
    </a>

    <a href="#" onClick="ambilFotoGalleryz('${counterToko}','${counterFoto}')" class="ambilFotoGallery-${counterToko}-${counterFoto} col padding5">
    <i class="far fa-image  middleWhite"> </i>
    </a>


    <a href="#" class="hapusFotoKunjungan col padding5" id ="1">
    <i class="fas fa-window-close  middleWhite" ></i>
    </a>
    </div>
    <div class="card-content card-content-padding">
    <img name="fotoKunjunganUpload[${counterToko}][]" class="${counterFoto}" id="foto-kunjungan-${counterFoto}" height="150" width="100%">
    </div>
    </div>`;

    var tampung = counterFoto-1;
    $$('.ambilFotoKunjungan-'+counterToko+'-'+tampung).closest('.spanFotoKunjungan').append(element);*/

}

function ambilFotoGalleryzz(counterToko,counterFoto){
    navigator.camera.getPicture(onSuccess,onFail,{
        quality:30,
        destinationType : Camera.DestinationType.FILE_URI,
        
        correctOrientation: true,
        sourceType : Camera.PictureSourceType.PHOTOLIBRARY,
    });

    function onSuccess(imageData) {
        var image = document.getElementById('foto-kunjungan-'+counterToko+'-'+counterFoto);
        image.src = imageData;
        counterFoto++;
        element =`<div class="card">
        <div class="card-header row" style="background-color:#2196F3;color:white">

        <a href="#" onClick="ambilFotoKunjunganzz('${counterToko}','${counterFoto}')" class="ambilFotoKunjunganzz-${counterToko}-${counterFoto} col padding5"  >
        <i class="fa fa-camera  middleWhite"></i>
        </a>

        <a href="#" onClick="ambilFotoGalleryzz('${counterToko}','${counterFoto}')" class="ambilFotoGalleryzz-${counterToko}-${counterFoto} col padding5">
        <i class="far fa-image  middleWhite"> </i>
        </a>


        <a href="#" class="hapusFotoKunjungan col padding5" id ="1">
        <i class="fas fa-window-close  middleWhite" ></i>
        </a>
        </div>
        <input type="hidden" name="counterArrayFoto" value="${counterToko}-${counterFoto}">
        <div class="card-content card-content-padding">
        <img src="asd" name="fotozKunjunganUploadz[${counterToko}][]" class="${counterFoto}" id="foto-kunjungan-${counterToko}-${counterFoto}" height="150" width="100%">
        
        </div>
        </div>`;

        var tampung = counterFoto-1;
        $$('.ambilFotoGalleryzz-'+counterToko+'-'+tampung).closest('.spanFotoKunjungan').append(element);
        $$('.hapusFotoKunjunganzz').on('click',function(){
            var hapusId = $$(this).attr("id");
            var tampung = $$("#foto-kunjungan-"+hapusId).attr("src");
            if(tampung != null){
                $$(this).closest('.card').remove();
            }
        });

        /*$$('.ambilFotoKunjungan-'+counter).on('click',function(){
            navigator.camera.getPicture(onSuccess,onFail,{
                quality:30,
                destinationType : Camera.DestinationType.FILE_URI,
                
                correctOrientation: true,
                sourceType : Camera.PictureSourceType.CAMERA,
                cameraDirection: Camera.Direction.BACK
            });
        });

        $$('.ambilFotoGallery-'+counter).on('click',function(){
            navigator.camera.getPicture(onSuccess,onFail,{
                quality:30,
                destinationType : Camera.DestinationType.FILE_URI,
                
                correctOrientation: true,
                sourceType : Camera.PictureSourceType.PHOTOLIBRARY,
            });
        });*/
    }

    function onFail(message){
        myApp.alert('Failed because: ' +message);
    }
    /*counterFoto++;
    element =`<div class="card">
    <div class="card-header row" style="background-color:#2196F3;color:white">

    <a href="#" onClick="ambilFotoKunjunganz('${counterToko}','${counterFoto}')" class="ambilFotoKunjungan-${counterToko}-${counterFoto} col padding5"  >
    <i class="fa fa-camera  middleWhite"></i>
    </a>

    <a href="#" onClick="ambilFotoGalleryz('${counterToko}','${counterFoto}')" class="ambilFotoGallery-${counterToko}-${counterFoto} col padding5">
    <i class="far fa-image  middleWhite"> </i>
    </a>


    <a href="#" class="hapusFotoKunjungan col padding5" id ="1">
    <i class="fas fa-window-close  middleWhite" ></i>
    </a>
    </div>
    <div class="card-content card-content-padding">
    <img name="fotoKunjunganUpload[${counterToko}][]" class="${counterFoto}" id="foto-kunjungan-${counterToko}-${counterFoto}" height="150" width="100%">
    </div>
    </div>`;

    var tampung = counterFoto-1;
    $$('.ambilFotoGallery-'+counterToko+'-'+tampung).closest('.spanFotoKunjungan').append(element);*/
}

var tampungEditNomorBuktiRencanaKirimanCollector;
function editRencanaKirimanCollector(nomorbukti){
    tampungEditNomorBuktiRencanaKirimanCollector = nomorbukti;
    if(halamanGlobal == "LAPORAN_RENCANA_KIRIMAN" || halamanGlobal == "LAPORAN_RENCANA_COLLECTOR"){
        mainView.router.navigate("/edit_rencana_kiriman_collector/");
    } else {
        mainView.router.navigate("/edit_kiriman_collector/");
    }
}

function popupCancel(counter){
    myApp.popup.close('.popup-toko-'+counter);
}

function popupOpenToko(counter){
    tampungCounter = $(this).attr('id');
    myApp.popup.open('.popup-toko-'+counter);
}

function popupOpen(className){
    myApp.popup.open(`.${className}`);
}

function callCalendarFormat(id){
    var calendarModal = myApp.calendar.create({
        inputEl: '#'+id,
        openIn: 'customModal',
        header: true,
        footer: true,
        dateFormat: 'MM dd yyyy',
    });
}

var tampungLatLama;
var tampungLngLama;

function setPositionPetaByLatLong(latitude,longitude,useridkaryawan){
    var position = {
        lat: parseFloat(latitude),
        lng: parseFloat(longitude)
    }
    marker= new google.maps.Marker({
        position: position,
        label: {
            text:useridkaryawan,
            x:'200',
            y:'35',
            color: "black",
            fontWeight:"bold",
        },
        map: map,
        icon: {
            url:iconCar,
            scaledSize: new google.maps.Size(32, 32),
            labelOrigin: new google.maps.Point(14, -5)
        }
    });

    gmarkers.push(marker);
}

function BatalPopup(namaPopup){
    myApp.popup.close(namaPopup);
}

var tampungTanggalPemantauanBan;
function klikListTanggalPemantauanBan(tanggal){
    tampungTanggalPemantauanBan = tanggal;
    mainView.router.navigate("/master_pemantauan_ban_per_tanggal/");
    myApp.preloader.show();
}

var tampungNomorBuktiPemantauanBan;
function klikListTanggalPemantauanBanDetail(nomorbukti){
    tampungNomorBuktiPemantauanBan = nomorbukti;
    mainView.router.navigate("/detail_pemantauan_ban/");
}


function klikListTanggalPemasanganBanDetail(nomorbukti){
    nomorBuktiDariPemasanganBan = nomorbukti;
    nomorBuktiTerpilih = nomorbukti;
    $$('.inputAtauEdit').val("edit");
    mainView.router.navigate("/detail_pemasangan_ban/");
}

var tampungTanggalPemasanganBan;
function klikListTanggalPemasanganBan(tanggal){
    tampungTanggalPemasanganBan = tanggal;
    mainView.router.navigate("/master_pemasangan_ban_per_tanggal/");
    myApp.preloader.show();
}

var tampungEditNomorBuktiPosisiPemantauanBan;
var tampungEditNomorBuktiPemantauanBan;
var tampungEditPosisiPemantauanBan;
function editPemantauanBan(nomorbukti,posisi){
    if(posisi){
        tampungEditNomorBuktiPemantauanBan = nomorbukti;
        tampungEditNomorBuktiPosisiPemantauanBan = nomorbukti+"_"+posisi;
        tampungEditPosisiPemantauanBan = posisi;
        mainView.router.navigate("/edit_pemantauan_ban/");
    } else {
        tampungEditNomorBuktiPemantauanBan = nomorbukti;
        tampungEditPosisiPemantauanBan = posisi;
        mainView.router.navigate("/edit_tm_pemantauan_ban/");
    }
    
}

function BackBatal(){
    mainView.router.back();
}

var tampungKonfigurasi;
function PilihKonfigurasi(konfigurasi){
    tampungKonfigurasi = konfigurasi;
    mainView.router.navigate("/halaman_konfigurasi/");
}

function editPemasanganBan(nomorbukti,konfigurasi){
    tampungKonfigurasi = konfigurasi;
    mainView.router.navigate("/halaman_konfigurasi/");
}

var tampungNomorBuktiTmPemasanganBan;
function editTmPemasanganBan(nomorbukti,konfigurasi){
    tampungNomorBuktiTmPemasanganBan = nomorbukti;
    mainView.router.navigate("/edit_pemasangan_ban/");
}

var posisiBanTerpilih;
var nomorBuktiTerpilih;
var tanggalTerpilih;
function PilihPosisiBan(posisi,nomorbukti,tanggal){
    posisiBanTerpilih = posisi;
    nomorBuktiTerpilih = nomorbukti;
    tanggalTerpilih = tanggal;
    mainView.router.navigate("/input_detail_pemasangan_ban/");
}

var tampungKodepelangganNomorPlat;
function detailMasterKendaraan(kodepelanggan){
    tampungKodepelangganNomorPlat = kodepelanggan;
    mainView.router.navigate("/isi_master_kendaraan/");
}

/*var files = "";
function processSelectedFiles(fileInput) {
    files = "";
    files = fileInput.files[0];
}
*/

/*function ImportDatabase(e){
    myApp.preloader.show();
    var files = "";
    var act = "";
    files = $$(e).closest(".card-content").find('.fileCsv');

    $$('input[class^="radioButtonMbrg"]:checked').each(function () {
        act = $$(this).val();
    })

    if(act == "stokBarang"){
        act = "DB_UPDATE_STOK_MBRG";
    } else {
        act = "DB_UPDATE_SEMUA_MBRG";
    }

    var typeFile = files[0].files[0].name.slice(-3);

    if(files[0].files.length > 0 && typeFile == "csv"){
        files = files[0].files[0];
        Papa.parse(files, { 
            header:true,
            skipEmptyLines:'greedy',
            complete: function(results) {
                var data = results.data;
                var params = {
                    arrData:data,
                    case:act,
                    USERID:USERID
                }
                myApp.request.post(ipTujuan,params,
                    function(data){
                        var response = JSON.parse(data);
                        if(response.hasil == "berhasil"){
                            myApp.dialog.alert("Berhasil Mengimport CSV");
                            mainView.router.back({force:true});

                        } else {
                            myApp.dialog.alert("Gagal Mengimport Database, Silahkan Hubungi Admin");
                            myApp.preloader.hide();
                        }
                    },
                    function(xhr,status){
                        PreloaderHide(status);
                    })
            }
        });
    } else {
        myApp.preloader.hide();
        myApp.dialog.alert("Pilih File CSV Terlebih Dahulu");
    }
    
}*/



var loadMasterBarang = {};
function ImportDatabaseMasterBarang(e){
    var act = "";

    $$('input[class^="radioButtonMbrg"]:checked').each(function () {
        act = $$(this).val();
    })

    if(act == "stokBarang"){
        act = "DB_UPDATE_STOK_MBRG";
    } else {
        act = "DB_UPDATE_SEMUA_MBRG";
    }
    myApp.preloader.show();
    files = $$(e).closest(".card-content").find('.fileExcel');
    var params = {
        case:act,
        data:loadMasterBarang,
        USERID:USERID
    }
    var typeFile = files[0].files[0].name;
    typeFile = typeFile.split('.')[1];
    if(files[0].files.length > 0){
        if(typeFile == "csv"){
            files = files[0].files[0];
            Papa.parse(files, { 
                header:true,
                skipEmptyLines:'greedy',
                complete: function(results) {
                    var data = results.data;
                    var params = {
                        data:data,
                        case:act,
                        USERID:USERID
                    }
                    myApp.request.post(ipTujuan,params,
                        function(data){
                            var response = JSON.parse(data);
                            if(response.hasil == "berhasil"){
                                if(act == "DB_UPDATE_STOK_MBRG"){
                                    myApp.dialog.alert("Import Stok Berhasil");
                                } else {
                                    myApp.dialog.alert("Import Barang Berhasil");
                                }
                            } else {
                                myApp.dialog.alert("Gagal Mengimport Database, Silahkan Hubungi Admin");
                            }
                            myApp.preloader.hide();
                        },
                        function(xhr,status){
                            PreloaderHide(status);
                        })
                }
            });
        } else {
            myApp.request.post(ipTujuan,params,
                function(data){
                    var response = JSON.parse(data);
                    if(response.hasil == "berhasil"){
                        if(act == "DB_UPDATE_STOK_MBRG"){
                            myApp.dialog.alert("Import Stok Berhasil");
                        } else {
                            myApp.dialog.alert("Import Barang Berhasil");
                        }
                        myApp.preloader.hide();
                    } else {
                        myApp.preloader.hide();
                        myApp.dialog.alert("Terjadi Kesalahan, Silahkan Hubungi Admin");
                    }
                },
                function(xhr,status){
                    PreloaderHide(status);
                });
        }
    } else {
        myApp.dialog.alert("Pilih File XLS / XLSX / CSV Terlebih Dahulu");
    }
}

function loadFileMasterBarang(event) {
    alasql('SELECT * FROM FILE(?,{headers:true})',[event],function(data){
        loadMasterBarang = data;
    });
}

function TampilStok(e,stok){
    $$(e).html(stok);
}

function zoomInOutGambarPricelist(kode,idx){
    index = parseInt(idx);
    var act = "AMBIL_GAMBAR_PRICELIST";
    myApp.request.post(ipTujuan,{case:act,KODEBARANG:kode},function(data){
        var hasil_json = JSON.parse(data);
        if(hasil_json.hasil == "ada"){
            tampungSourceGambar = [];
            hasil_json.GAMBAR.forEach(function(obj,x){
                tampungSourceGambar.push(ipGambarPricelist+obj.NAMAGAMBAR+`.jpg?`+ new Date().getTime());
            })

            var myPhotoBrowserDark = myApp.photoBrowser.create({
                photos : tampungSourceGambar,
                theme: 'dark'
            });
            myPhotoBrowserDark.open(index);
        } 
    });   
}

function UpdateApk(){
    var url = "http://"+ip+"/bond/aplikasi/esp.apk";
    cordova.InAppBrowser.open(url, '_system', 'location=yes');
}

function PilihPopupNomorPlat(nomorplat,kodepelanggan){
    $$('.nomorPlatPemantauanBan').val(nomorplat);
    myApp.popup.close('.popup-toko');
}

function downloadFile(fileName, urlData) {
    var aLink = document.createElement('a');
    
    aLink.download = fileName;
    aLink.href = urlData
    var event = new MouseEvent('click');
    aLink.dispatchEvent(event);
}

function ImportLaporanCsv(){
    myApp.preloader.show();
    /*var JABATANDARI = $$('.kodeDariJabatan').val();
    var JABATANSAMPAI = $$('.kodeSampaiJabatan').val();
    var TANGGALDARI = $$('#dariTanggalLaporanPerStaff').val();
    var TANGGALSAMPAI = $$('#sampaiTanggalLaporanPerStaff').val();
    var KARYAWANDARI = $$('.kodeDariSalesmanLaporan').val();
    var KARYAWANSAMPAI = $$('.kodeSampaiSalesmanLaporan').val();*/

    var params = {
        case:"IMPORT_LAPORAN",
        JABATANDARI : $$('.kodeDariJabatan').val(),
        JABATANSAMPAI : $$('.kodeSampaiJabatan').val(),
        TANGGALDARI : $$('#dariTanggalLaporanPerStaff').val(),
        TANGGALSAMPAI : $$('#sampaiTanggalLaporanPerStaff').val(),
        KARYAWANDARI : $$('.kodeDariSalesmanLaporan').val(),
        KARYAWANSAMPAI : $$('.kodeSampaiSalesmanLaporan').val(),
    }
    myApp.request.post(ipTujuan,params,
        function(data){
          var response = JSON.parse(data);
          console.log(response.kunjungan);
          var csv = Papa.unparse(response.kunjungan,{header:true});
          
          downloadFile('laporan_kunjungan.csv', 'data:text/csv;charset=UTF-8,' +   encodeURIComponent(csv));

          myApp.preloader.hide();
      },
      function(xhr,status){
        PreloaderHide(status);
    })
}

var kodeTokoDashboard;
var namaTokoDashboard;
function DashboardKunjungan(jenis,kode,nama){

    if(jenis == "kunjungan"){
        halamanGlobal = "BYPASS_KUNJUNGAN";
        kodeTokoDashboard = kode;
        namaTokoDashboard = nama;
        mainView.router.navigate('/input_kunjungan/');
    } else if(jenis == "kiriman"){
        halamanGlobal = "BYPASS_KIRIMAN";
        tampungHalamanFollowDanCollector = "KIRIMAN";
        kodeTokoDashboard = kode;
        namaTokoDashboard = nama;
        mainView.router.navigate("/input_follow_collector/");

    } else if(jenis == "collector"){
        halamanGlobal = "BYPASS_COLLECTOR";
        tampungHalamanFollowDanCollector = "COLLECTOR";
        kodeTokoDashboard = kode;
        namaTokoDashboard = nama;
        mainView.router.navigate("/input_follow_collector/");
    }
}

function LoginDashboardRencana(e,jenis,kode,nama){
    if(waktuLoginDashboard){
        myApp.dialog.alert("Selesaikan Rencana sebelumnya terlebih dahulu");
    } else {
        kodePelangganLoginDashboard = kode;
        var params = {
            case:"WAKTU_SERVER"
        };
        myApp.request.post(ipTujuan,params,
            function(data){
                waktuLoginDashboard= data;
                var element = `<a href="#" class="link" onClick="DashboardKunjungan('${jenis}','${kode}','${nama}')">Report</a>`;
                $$(e).closest(".card-footer").html(element);
                localStorage.setItem("kodePelangganLoginDashboard",kode);
                localStorage.setItem("waktuLoginDashboard",waktuLoginDashboard);
            }, function(xhr,status){
                PreloaderHide(status);
            })
    }
}

function RemoveItemLocalStorageKunjungan(){
    waktuLoginDashboard = null;
    kodePelangganLoginDashboard = null;
    localStorage.removeItem("waktuLoginDashboard");
    localStorage.removeItem("kodePelangganLoginDashboard");
}

function PercentNumberFormat(number,digit){
    return number.toFixed(digit);
}

function PindahHalaman(halaman){
    myApp.preloader.show();
    mainView.router.navigate(halaman);
}

function ProfileKamera(e){
    navigator.camera.getPicture(onSuccess,onFail,{
        quality:30,
        destinationType : Camera.DestinationType.FILE_URI,
        
        correctOrientation: true,
        sourceType : Camera.PictureSourceType.CAMERA,
        cameraDirection: Camera.Direction.BACK
    });

    function onSuccess(imageData){
        var image = document.getElementById('fotoProfile');
        image.src = imageData;
        $$('#counterFotoProfile').val(1);
    }

    function onFail(message){
        myApp.alert('Failed because: ' +message);
    }
}

function ProfileGallery(e){
    navigator.camera.getPicture(onSuccess,onFail,{
        quality:30,
        destinationType : Camera.DestinationType.FILE_URI,
        
        correctOrientation: true,
        sourceType : Camera.PictureSourceType.PHOTOLIBRARY,
    });

    function onSuccess(imageData){
        var image = document.getElementById('fotoProfile');
        image.src = imageData;
        $$('#counterFotoProfile').val(1);
    }

    function onFail(message){
        myApp.alert('Failed because: ' +message);
    }
}

function SimpanProfile(){
    var fotoProfile = $$('#counterFotoProfile').val();
    var NAMA = $$("#namaProfile").val();
    var ALAMAT = $$("#alamatProfile").val();
    var TELEPON = $$("#noHpProfile").val();
    var FOTO = $$('#fotoProfile').attr("src");
    myApp.preloader.show();
    if(!NAMA){
        alertKosong("Nama");
    } else if(!ALAMAT){
        alertKosong("Alamat");
    } else if(!TELEPON){
        alertKosong("Telepon");
    } else {
        var params = {
            case:"UPDATE_PROFILE",
            NAMA:NAMA,
            ALAMAT:ALAMAT,
            TELEPON:TELEPON,
            USERID:USERID
        }
        myApp.request.post(ipTujuan,params,
            function(data){
                var response = JSON.parse(data);
                if(response.hasil == "berhasil" && fotoProfile == 1){
                    var profile = new FileUploadOptions();
                    profile.fileKey = "photo";
                    profile.fileName = FOTO.substr(FOTO.lastIndexOf('/') + 1);
                    profile.mimeType = "image/jpeg";
                    profile.chunkedMode = false;
                    profile.headers = {
                        Connection: "close"
                    };
                    profile.params = {
                        namaFile:USERID +'-'+'karyawan'
                    }
                    var ft = new FileTransfer();
                    ft.upload(FOTO, 
                        encodeURI(ipUpload),
                        win,
                        fail,
                        profile);

                    var win = function(r) {
                        myApp.dialog.alert("Berhasil Mengedit Profile Anda");
                        mainView.router.back({force:true});
                    }

                    var fail = function(error) {
                        alert("An error has occurred: Code = " + error.code);
                        console.log("upload error source " + error.source);
                        console.log("upload error target " + error.target);
                    }

                    myApp.dialog.alert("Berhasil Mengedit Profile Anda");
                    mainView.router.back({force:true});

                } else if(response.hasil == "berhasil" && fotoProfile == 0){
                    myApp.dialog.alert("Berhasil Mengedit Profile Anda");
                    mainView.router.back({force:true});
                } else {
                    myApp.dialog.alert("Silahkan Menghubungi Admin");
                    myApp.preloader.hide();
                }
            },
            function(xhr,status){
                PreloaderHide(status);
            })
    }
}

function GantiKodeJabatan(){
    var KODEJABATANDARI = $$('.kodeDariJabatan').val();
    var KODEJABATANSAMPAI = $$('.kodeSampaiJabatan').val();
    var params = {
        case:"TAMPIL_KODE_KARYAWAN",
        KODEJABATANDARI:KODEJABATANDARI,
        KODEJABATANSAMPAI:KODEJABATANSAMPAI,
        KODECABANG:KODECABANG,
        KODEJABATAN:KODEJABATAN
    };
    myApp.request.post(ipTujuan,params,
        function(data){
            var response = JSON.parse(data);
            console.log(response);
            if(response.hasil == "ada" && response.karyawan.length > 0){
                var tampungPopUpKaryawan = "";
                response.karyawan.forEach(function(obj,x){
                    tampungPopUpKaryawan += `<li>
                    <a href="#" class="item-link item-content cobaKlik" onClick="pilihDariKaryawan('`+obj.KODEKARYAWAN+`','`+obj.NAMA+`')">
                    <div class="item-inner">
                    <div class="item-text namaKaryawanDari" style="color:black">`+obj.NAMA+`</div>
                    </div>
                    </a>
                    </li>`;
                })
                $$('.listPopUpNamaKaryawanDari').html(tampungPopUpKaryawan);
                $$('.listPopUpNamaKaryawanSampai').html(tampungPopUpKaryawan);
                $$('.namaDariSalesmanLaporan').val("");
                $$('.namaSampaiSalesmanLaporan').val("");
            } else {

            }
        },
        function(xhr,status){
            PreloaderHide(status);
        })
}


function ChartDashboard(sesuai_rencana,diluar_rencana){
    Highcharts.chart('containerChart', {
        chart: {
            type: 'pie',
            options3d: {
                enabled: true,
                alpha: 45,
                beta: 0
            },

        },
        exporting: false,
        credits:false,
        title: {
            text: 'Chart Kunjungan Sesuai VS Tambahan'
        },
        tooltip: {
            pointFormat: '{series.name}: <b>{point.y:.1f}%</b>'
        },
        plotOptions: {
            pie: {
                allowPointSelect: true,
                cursor: 'pointer',
                depth: 35,
                dataLabels: {
                    enabled: true,
                    format: '{point.name}'
                }
            }
        },
        series: [{
            type: 'pie',
            name: 'Total',
            data: [
            {
                name: 'Sesuai Rencana',
                y: parseFloat(sesuai_rencana),

                dataLabels: {
                    enabled: true,
                    format: '{point.y:.1f} %'
                }
                
            },
            {
                name: 'Diluar Rencana',
                y: parseFloat(diluar_rencana),
                sliced: true,
                selected: true,
                dataLabels: {
                    enabled: true,
                    format: '{point.y:.1f} %'
                },

            },
            ]
        }],
    });

    if(sesuai_rencana == 0 && diluar_rencana == 0){
        $$("#containerChart").remove();
        $$("#blockRencanaKunjungan").remove();
        $$("#blockKunjungan").remove();
    }
}

function HighChartDiagramJumlah(hari,masuk,lembur,libur,idelement){
    Highcharts.chart(idelement, {
        chart: {
            type: 'pie',
            options3d: {
                enabled: true,
                alpha: 45,
                beta: 0
            },

        },
        exporting: false,
        credits:false,
        title: {
            text: `Diagram Jumlah Dalam ${hari} terakhir`
        },
        tooltip: {
            pointFormat: '{series.name}: <b>{point.y}</b>'
        },
        plotOptions: {
            pie: {
                allowPointSelect: true,
                cursor: 'pointer',
                depth: 35,
                dataLabels: {
                    enabled: true,
                    format: '{point.name}'
                }
            }
        },
        series: [{
            type: 'pie',
            name: 'Total',
            data: [
            {
                name: 'Masuk',
                y: parseFloat(masuk),

                dataLabels: {
                    enabled: true,
                    format: '{point.y} '
                }
                
            },
            {
                name: 'Libur',
                y: parseFloat(libur),
                sliced: true,
                selected: true,
                dataLabels: {
                    enabled: true,
                    format: '{point.y} '
                },

            },
            {
                name: 'Lembur',
                y: parseFloat(lembur),
                sliced: true,
                selected: true,
                dataLabels: {
                    enabled: true,
                    format: '{point.y} '
                },

            },
            ]
        }],
    });
}

function HighChartDiagramTotalPointKunjungan(title,point_kunjungan,standar_point_kunjungan,idelement){
    Highcharts.chart(idelement, {
        chart: {
            type: 'pie',
            options3d: {
                enabled: true,
                alpha: 45,
                beta: 0
            },

        },
        exporting: false,
        credits:false,
        title: {
            text: title
        },
        tooltip: {
            pointFormat: '{series.name}: <b>{point.y:.1f}%</b>'
        },
        plotOptions: {
            pie: {
                allowPointSelect: true,
                cursor: 'pointer',
                depth: 35,
                dataLabels: {
                    enabled: true,
                    format: '{point.name}'
                }
            }
        },
        series: [{
            type: 'pie',
            name: 'Total',
            data: [
            {
                name: 'Point',
                y: parseFloat(point_kunjungan),

                dataLabels: {
                    enabled: true,
                    format: '{point.y:.1f} %'
                }
                
            },
            {
                name: 'Standar',
                y: parseFloat(standar_point_kunjungan),
                sliced: true,
                selected: true,
                dataLabels: {
                    enabled: true,
                    format: '{point.y:.1f} %'
                },

            },
            ]
        }],
    });
}

function HighChartDiagram(masuk,tepat_waktu,tidak_tepat_waktu,idelement){
    Highcharts.chart(idelement, {
        chart: {
            type: 'pie',
            options3d: {
                enabled: true,
                alpha: 45,
                beta: 0
            },

        },
        exporting: false,
        credits:false,
        title: {
            text: `Jumlah Absen ${masuk}`
        },
        tooltip: {
            pointFormat: '{series.name}: <b>{point.y}</b>'
        },
        plotOptions: {
            pie: {
                allowPointSelect: true,
                cursor: 'pointer',
                depth: 35,
                dataLabels: {
                    enabled: true,
                    format: '{point.name}'
                }
            }
        },
        series: [{
            type: 'pie',
            name: 'Total',
            data: [
            {
                name: 'Tepat Waktu',
                y: parseFloat(tepat_waktu),

                dataLabels: {
                    enabled: true,
                    format: '{point.y} '
                }
                
            },
            {
                name: 'Tidak Tepat Waktu',
                y: parseFloat(tidak_tepat_waktu),
                sliced: true,
                selected: true,
                dataLabels: {
                    enabled: true,
                    format: '{point.y} '
                },

            },
            ]
        }],
    });
}



var tanggalRealisasiKunjungan;
var staffRealisasiKunjungan;
function LihatLaporan(){
    tanggalRealisasiKunjungan = $$("#dariTanggal").val();
    staffRealisasiKunjungan = $$(".kodeDariSalesmanLaporan").val();
    if(!tanggalRealisasiKunjungan){
        alertKosong("Tanggal");
    } else if(!staffRealisasiKunjungan){
        alertKosong("Staff");
    } else {
        PindahHalaman("/detail_realisasi_kunjungan/");
    }
}


function LihatRealisasiKunjunganSemua(){
    tanggalRealisasiKunjungan = $$("#dariTanggal").val();
    if(!tanggalRealisasiKunjungan){
        alertKosong("Tanggal");
    } else {
        PindahHalaman("/detail_realisasi_kunjungan_semua/");
    }
}

var tanggalHistoryTracking;
var staffHistoryTracking;
function LihatHistory(){
    tanggalHistoryTracking = $$("#dariTanggal").val();
    staffHistoryTracking = $$(".kodeDariSalesmanLaporan").val();
    if(!tanggalHistoryTracking){
        alertKosong("Tanggal");
    } else if(!staffHistoryTracking){
        alertKosong("Staff");
    } else {
        PindahHalaman("/detail_history_tracking/");
    }
}

function ConvertDateTimeToText(waktu,jenis){
    var namaBulan = [
    "Januari", "Februari", "Maret",
    "April", "Mei", "Juni", "Juli",
    "Agustus", "September", "Oktober",
    "November", "Desember"
    ];

    var namaHari = [
    'MINGGU','SENIN','SELASA','RABU','KAMIS','JUMAT','SABTU'
    ];
    //var today = new Date(waktu);
    var today = new Date(waktu.replace(/-/g, '/'));
    var indexDay = today.getDay();
    var day = today.getDate();
    var monthIndex = today.getMonth();
    var year = today.getFullYear();
    var hours = today.getHours();
    hours = ("0" + hours).slice(-2);
    var minutes = today.getMinutes();
    minutes = ("0" + minutes).slice(-2);
    var seconds = today.getSeconds();
    seconds = ("0" + seconds).slice(-2);

    if(jenis == "datetime"){
        return day + ' ' + namaBulan[monthIndex] + ' ' + year+ '<br>' +hours+':'+minutes+':'+seconds;
    } else if(jenis == "time"){
        return hours+':'+minutes+':'+seconds;
    } else if(jenis == "date"){
        return day + ' ' + namaBulan[monthIndex] + ' ' + year;
    } else if(jenis == "dateday"){
        return namaHari[indexDay] +', '+ day + ' ' + namaBulan[monthIndex] + ' ' + year;
    } else if(jenis == "datetimeday"){
        return namaHari[indexDay] +', '+ day + ' ' + namaBulan[monthIndex] + ' ' + year + '<br>' +hours+':'+minutes+':'+seconds;
    } else if(jenis == "day"){
        return namaHari[indexDay];
    }  else if(jenis == "datetimedaywithoutbr"){
        return namaHari[indexDay] +', '+ day + ' ' + namaBulan[monthIndex] + ' ' + year + ',' +hours+':'+minutes+':'+seconds;
    } else if(jenis == 'timeWithoutSecond'){
        return hours+':'+minutes;
    }
}

function JarakWaktu(waktuMulai,waktuAkhir){
    var delta = Math.abs(new Date(waktuAkhir) - new Date(waktuMulai)) / 1000;

    var days = Math.floor(delta / 86400);
    delta -= days * 86400;

    var hours = Math.floor(delta / 3600) % 24;
    delta -= hours * 3600;

    var minutes = Math.floor(delta / 60) % 60;
    delta -= minutes * 60;

    var seconds = delta % 60;

    return "<b>"+hours + " JAM " + minutes +" MENIT " + seconds+ " DETIK "+"</b>";
}

var tanggalDariRencana;
var tanggalSampaiRencana;
var staffDariRencana;
var staffSampaiRencana;
function ParameterRencanaKunjungan(){
    console.log(halamanGlobal);
    tanggalDariRencana = $$("#dariTanggalLaporanPerStaff").val();
    tanggalSampaiRencana = $$("#sampaiTanggalLaporanPerStaff").val();
    staffDariRencana = $$(".kodeDariSalesmanLaporan").val();
    staffSampaiRencana = $$(".kodeSampaiSalesmanLaporan").val();
    if(halamanGlobal == "MASTER_LAPORAN_RENCANA_KUNJUNGAN"){
        PindahHalaman("/hasil_laporan_rencana_kunjungan/");   
    } else if(halamanGlobal == "LAPORAN_RENCANA_TAGIHAN"){
        PindahHalaman("/hasil_laporan_rencana_tagihan/");
    }
}



var tanggalDariKunjungan;
var tanggalSampaiKunjungan;
var staffDariKunjungan;
var staffSampaiKunjungan;
function ParameterKunjungan(){
    tanggalDariKunjungan = $$("#dariTanggalLaporanPerStaff").val();
    tanggalSampaiKunjungan = $$("#sampaiTanggalLaporanPerStaff").val();
    staffDariKunjungan = $$(".kodeDariSalesmanLaporan").val();
    staffSampaiKunjungan = $$(".kodeSampaiSalesmanLaporan").val();
    if(halamanGlobal == "LAPORAN_KUNJUNGAN"){
        PindahHalaman("/hasil_laporan_kunjungan/"); 
    }
}

function ExportRencanaKunjungan(){
    myApp.preloader.show();
    var fileType = $$("input[name='radio-pilih-file-excel']:checked").val();
    var params = {
        case:"EXPORT_RENCANA_KUNJUNGAN",
        USERID:USERID,
        KODECABANG:KODECABANG,
        KODEJABATAN:KODEJABATAN,
        TANGGALDARI:tanggalDariRencana,
        TANGGALSAMPAI:tanggalSampaiRencana,
        STAFFDARI:staffDariRencana,
        STAFFSAMPAI:staffSampaiRencana,
        parameter_rencana:parameter_rencana
    }

    myApp.request.post(ipTujuan,params,
        function(data){
            var response = JSON.parse(data);

            if(response.hasil == "ada"){
                var data = [];
                data = response.RENCANA;
                if(fileType == "XLSX"){
                    alasql.promise('SELECT * INTO XLSX("Rencana Kunjungan.xlsx",{headers:true}) FROM ?', [data])
                    .then(function(data){
                        console.log('Data saved');
                    }).catch(function(err){
                        console.log('Error:', err);
                    });
                } else {
                    alasql.promise('SELECT * INTO XLS("Rencana Kunjungan.xls",{headers:true}) FROM ?', [data])
                    .then(function(data){
                        console.log('Data saved');
                    }).catch(function(err){
                        console.log('Error:', err);
                    });
                }
                
            } else {
                myApp.preloader.hide();
                myApp.dialog.alert("Silahkan Hubungi Admin")
            }
            myApp.preloader.hide();
        },
        function(xhr,status){
            PreloaderHide(status);
        })
}


function OpenPopUp(popupClass){
    myApp.popup.open('.popup-pilih-file-excel'); 
}


function ExportPricelist(){
    myApp.preloader.show();
    var fileType = $$("input[name='radio-pilih-file-excel']:checked").val();
    var params = {
        case:"EXPORT_PRICELIST",
        USERID:USERID,
        KODECABANG:KODECABANG,
        KODEJABATAN:KODEJABATAN,
    }
    myApp.request.post(ipTujuan,params,
        function(data){
            var response = JSON.parse(data);
            if(response.hasil == "ada"){
                var data = [];
                data = response.PRICELIST;

                if(fileType == "XLS"){
                    alasql.promise('SELECT * INTO XLS("Pricelist.xls",{headers:true}) FROM ?', [data])
                    .then(function(data){
                        console.log('Data saved');
                    }).catch(function(err){
                        console.log('Error:', err);
                    });

                } else if(fileType == "CSV"){
                    alasql.promise('SELECT * INTO CSV("Pricelist.csv",{headers:true,separator:","}) FROM ?', [data])
                    .then(function(data){
                        console.log('Data saved');
                    }).catch(function(err){
                        console.log('Error:', err);
                    });
                } else {
                    alasql.promise('SELECT * INTO XLSX("Pricelist.xlsx",{headers:true}) FROM ?', [data])
                    .then(function(data){
                        console.log('Data saved');
                    }).catch(function(err){
                        console.log('Error:', err);
                    });

                }
                myApp.popup.close('.popup-pilih-file-excel');
                myApp.preloader.hide();
            } else {
                myApp.preloader.hide();
                myApp.dialog.alert("Silahkan Hubungi Admin");
            }
        },
        function(xhr,status){
            PreloaderHide(status);
        })
}



function ExportKunjungan(){
    myApp.preloader.show();
    
    var params = {
        case:"EXPORT_KUNJUNGAN",
        USERID:USERID,
        KODECABANG:KODECABANG,
        KODEJABATAN:KODEJABATAN,
        TANGGALDARI:tanggalDariKunjungan,
        TANGGALSAMPAI:tanggalSampaiKunjungan,
        STAFFDARI:staffDariKunjungan,
        STAFFSAMPAI:staffSampaiKunjungan,
    }

    myApp.request.post(ipTujuan,params,
        function(data){
            var response = JSON.parse(data);
            if(response.hasil == "ada"){
                var data = [];
                data = response.KUNJUNGAN;
                alasql.promise('SELECT * INTO XLSX("Laporan Kunjungan.xlsx",{headers:true}) FROM ?', [data])
                .then(function(data){
                   console.log('Data saved');
               }).catch(function(err){
                   console.log('Error:', err);
               });
           } else {
            myApp.preloader.hide();
            myApp.dialog.alert("Silahkan Hubungi Admin")
        }
        myApp.preloader.hide();
    },
    function(xhr,status){
        PreloaderHide(status);
    })
}

var loadTmFakturData = {};
function ImportTmFaktur(e){
    myApp.preloader.show();
    files = $$(e).closest(".card-content").find('.fileExcel');
    
    if(files[0].files.length > 0){

        var typeFile = files[0].files[0].name;
        typeFile = typeFile.split('.')[1];
        if(typeFile == "csv"){
            files = files[0].files[0];
            Papa.parse(files, { 
                header:true,
                skipEmptyLines:'greedy',
                complete: function(results) {
                    var data = results.data;
                    var params = {
                        data:data,
                        case:"IMPORT_TM_FAKTUR",
                        USERID:USERID
                    }
                    myApp.request.post(ipTujuan,params,
                        function(data){
                            var response = JSON.parse(data);
                            if(response.hasil == "berhasil"){
                                myApp.dialog.alert("Import Tm Faktur Berhasil");
                                myApp.preloader.hide();
                            } else {
                                myApp.dialog.alert("Gagal Mengimport Database, Silahkan Hubungi Admin");
                                myApp.preloader.hide();
                            }
                        },
                        function(xhr,status){
                            PreloaderHide(status);
                        })
                }
            });
        } else {
            var params = {
                case:"IMPORT_TM_FAKTUR",
                data:loadTmFakturData
            }
            myApp.request.post(ipTujuan,params,
                function(data){
                    var response = JSON.parse(data);
                    if(response.hasil == "berhasil"){
                        myApp.dialog.alert("Import Tm Faktur Berhasil");
                        myApp.preloader.hide();
                    } else {
                        myApp.preloader.hide();
                        myApp.dialog.alert("Terjadi Kesalahan, Silahkan Hubungi Admin");
                    }
                },
                function(xhr,status){
                    PreloaderHide(status);
                });
            
        }
    } else {
        myApp.dialog.alert("Pilih File XLS / XLSX / CSV Terlebih Dahulu");
    }
}

function loadFile(event) {
    alasql('SELECT * FROM FILE(?,{headers:true})',[event],function(data){
        console.log(data);
        loadTmFakturData = data;
        loadTmFakturData.forEach(function(obj,x){
            loadTmFakturData[x].DATETRANSACTION = ExcelDateToJSDate(loadTmFakturData[x].DATETRANSACTION,'date');
            loadTmFakturData[x].TGLJTP = ExcelDateToJSDate(loadTmFakturData[x].TGLJTP,'date');
            loadTmFakturData[x].TGLKIRIM = ExcelDateToJSDate(loadTmFakturData[x].TGLKIRIM,'date');
            loadTmFakturData[x].TGLKIRIMGUDANG = ExcelDateToJSDate(loadTmFakturData[x].TGLKIRIMGUDANG,'datetime');
            loadTmFakturData[x].TGLJTPCETAK = ExcelDateToJSDate(loadTmFakturData[x].TGLJTPCETAK,'date');
            loadTmFakturData[x].TGLLUNAS = ExcelDateToJSDate(loadTmFakturData[x].TGLLUNAS,'date');
        })
    });

}

var loadTdFakturData = {};
function ImportTdFaktur(e){
    //myApp.preloader.show();
    files = $$(e).closest(".card-content").find('.fileExcel');
    
    if(files[0].files.length > 0){

        var typeFile = files[0].files[0].name;
        typeFile = typeFile.split('.')[1];
        if(typeFile == "csv"){
            files = files[0].files[0];
            Papa.parse(files, { 
                header:true,
                skipEmptyLines:'greedy',
                complete: function(results) {
                    var data = results.data;
                    var params = {
                        data:data,
                        case:"IMPORT_TD_FAKTUR",
                        USERID:USERID
                    }
                    myApp.request.post(ipTujuan,params,
                        function(data){
                            var response = JSON.parse(data);
                            if(response.hasil == "berhasil"){
                                myApp.dialog.alert("Import Td Faktur Berhasil");
                                myApp.preloader.hide();
                            } else {
                                myApp.dialog.alert("Gagal Mengimport Database, Silahkan Hubungi Admin");
                                myApp.preloader.hide();
                            }
                        },
                        function(xhr,status){
                            PreloaderHide(status);
                        })
                }
            });
        } else {
            var params = {
                case:"IMPORT_TD_FAKTUR",
                data:loadTdFakturData
            }
            myApp.request.post(ipTujuan,params,
                function(data){
                    var response = JSON.parse(data);
                    if(response.hasil == "berhasil"){
                        myApp.dialog.alert("Import Td Faktur Berhasil");
                        myApp.preloader.hide();
                    } else {
                        myApp.preloader.hide();
                        myApp.dialog.alert("Terjadi Kesalahan, Silahkan Hubungi Admin");
                    }
                },
                function(xhr,status){
                    PreloaderHide(status);
                });
        }
    } else {
        myApp.dialog.alert("Pilih File XLS / XLSX Terlebih Dahulu");
    }
}

function loadFileTdFaktur(event) {
    alasql('SELECT * FROM FILE(?,{headers:true})',[event],function(data){
        loadTdFakturData = data;
    });
}


function ExcelDateToJSDate(serial,jenis) {
   var utc_days  = Math.floor(serial - 25569);
   var utc_value = utc_days * 86400;                                        
   var date_info = new Date(utc_value * 1000);

   var fractional_day = serial - Math.floor(serial) + 0.0000001;

   var total_seconds = Math.floor(86400 * fractional_day);

   var seconds = total_seconds % 60;

   total_seconds -= seconds;

   var hours = Math.floor(total_seconds / (60 * 60));
   var minutes = Math.floor(total_seconds / 60) % 60;
   var date = new Date(date_info.getFullYear(), date_info.getMonth(), date_info.getDate(), hours, minutes, seconds);
   return ConvertDateTimeToTextPhp(date,jenis);

}

function ConvertDateTimeToTextPhp(waktu,jenis){
    var namaBulan = [
    "01", "02", "03",
    "04", "05", "06", "07",
    "08", "09", "10",
    "11", "12"
    ];

    var today = new Date(waktu);
    var day = today.getDate();
    var monthIndex = today.getMonth();
    var year = today.getFullYear();
    var hours = today.getHours();
    hours = ("0" + hours).slice(-2);
    var minutes = today.getMinutes();
    minutes = ("0" + minutes).slice(-2);
    var seconds = today.getSeconds();
    seconds1 = ("0" + seconds).slice(-2);

    if(jenis == "datetime"){
        return day + '-' + namaBulan[monthIndex] + '-' + year+ ' ' +hours+':'+minutes+':'+seconds;
    } else if(jenis == "time"){
        return hours+':'+minutes+':'+seconds;
    } else if(jenis == "date"){
        return day + '-' + namaBulan[monthIndex] + '-' + year;
    } else if(jenis == "datetimeserver"){
        return  year+ '-' + namaBulan[monthIndex] + '-' +day + ' ' +hours+':'+minutes+':'+seconds;
    }
}


var tampungNomorBuktiRealisasiKunjungan;
function DetailIsiRealisasiKunjungan(nomorbukti){
    tampungNomorBuktiRealisasiKunjungan = nomorbukti;
    PindahHalaman("/detail_isi_realisasi_kunjungan/");
}

function HideTombolExport(){
    if(USERID != "SUMBER"){
       $$("#tombol-export").remove(); 
   }   
}

function ambilFoto(counter,statustambah){
    navigator.camera.getPicture(onSuccess,onFail,{
        quality:30,
        destinationType : Camera.DestinationType.FILE_URI,
        
        correctOrientation: true,
        sourceType : Camera.PictureSourceType.CAMERA,
        cameraDirection: Camera.Direction.BACK
    });

    function onSuccess(imageData) {
        var image = document.getElementById('foto-'+counter);
        image.src = imageData;
    }

    function onFail(message){
        myApp.alert('Failed because: ' +message);
    }
}

function ambilFotoGlobal(counter,statustambah,attr_id){
    navigator.camera.getPicture(onSuccess,onFail,{
        quality:30,
        destinationType : Camera.DestinationType.FILE_URI,
        
        correctOrientation: true,
        sourceType : Camera.PictureSourceType.CAMERA,
        cameraDirection: Camera.Direction.BACK
    });

    function onSuccess(imageData) {
        var image = document.getElementById(attr_id);
        image.src = imageData;
        if(statustambah != "tidak"){
            counter++;
            var element = `
            <div class="card">
            <div class="card-header row" style="background-color:#2196F3;color:white">
            <a href="#" onClick="ambilFotoGlobal('${counter}','${statustambah}','foto-nota-${counter}')" class="ambilFoto col padding5">
            <i class="fa fa-camera  middleWhite"> Nota</i>
            </a>
            </div>
            <div class="card-content card-content-padding">
            <img id="foto-nota-${counter}" name="foto-biaya-pengeluaran" class="${counter}" height="150" width="100%" >
            </div>
            </div>`;
            $$(statustambah).append(element);

        }
    }

    function onFail(message){
        myApp.alert('Failed because: ' +message);
    }
}

function SimpanPengeluaran(){
    var total_pengeluaran = $$('.total_pengeluaran').val().replace(/,/g, '');
    var odometer = $$('.odometer').val().replace(/,/g, '');

    var foto_biaya_pengeluaran = [];
    var nama_foto_biaya_pengeluaran = [];
    var foto_nomor_plat;
    if($$('#foto-plat-1').attr("src") !=null){
        foto_nomor_plat = $$('#foto-plat-1').attr("src");
    }
    
    var foto_odometer;
    if($$('#foto-odometer-1').attr("src") !=null){
        foto_odometer = $$('#foto-odometer-1').attr("src");
    }

    $$('img[name^="foto-biaya-pengeluaran"]').each(function() {
        if($$(this).attr("src") !=null){
            foto_biaya_pengeluaran.push($$(this).attr("src"));
            nama_foto_biaya_pengeluaran.push(this.className);
        }
    });




    var params = {
        case:"SIMPAN_PENGELUARAN",
        nomor_plat_unit:$$(".value_nomor_plat_unit").val(),
        odometer:odometer,
        total_pengeluaran:total_pengeluaran,
        lokasi_spbu:$$(".lokasi_spbu").val(),
        latitude:latGlobal,
        longitude:lngGlobal,
        jenis_pengeluaran:$$('.jenis_pengeluaran').val(),
        jumlah_liter:$$(".jumlah_liter").val(),
        kodesalesman:USERID,
        foto_nomor_plat:foto_nomor_plat,
        foto_odometer:foto_odometer,
        nama_foto_biaya_pengeluaran:nama_foto_biaya_pengeluaran
    }

    myApp.request.post(ipTujuan,params,
        function(data){
            var response = JSON.parse(data);
            if(response.hasil == "berhasil"){
                var fileUp = new FileUploadOptions();
                fileUp.fileKey = "photo";
                fileUp.fileName = foto_nomor_plat.substr(foto_nomor_plat.lastIndexOf('/') + 1);
                fileUp.mimeType = "image/jpeg";
                fileUp.chunkedMode = false;
                fileUp.headers = {
                    Connection: "close"
                };
                fileUp.params = {
                    namaFile:response.nama_foto_nomor_plat,
                }
                var ft = new FileTransfer();
                ft.upload(foto_nomor_plat, 
                    encodeURI(ipUploadFotoNomorPlat),
                    win,
                    fail,
                    fileUp);

                var fileUp = new FileUploadOptions();
                fileUp.fileKey = "photo";
                fileUp.fileName = foto_odometer.substr(foto_odometer.lastIndexOf('/') + 1);
                fileUp.mimeType = "image/jpeg";
                fileUp.chunkedMode = false;
                fileUp.headers = {
                    Connection: "close"
                };
                fileUp.params = {
                    namaFile:response.nama_foto_odometer,
                }
                var ft = new FileTransfer();
                ft.upload(foto_odometer, 
                    encodeURI(ipUploadFotoOdometer),
                    win,
                    fail,
                    fileUp);

                for(var i = 0; i<foto_biaya_pengeluaran.length;i++){
                    var fileUp = new FileUploadOptions();
                    fileUp.fileKey = "photo";
                    fileUp.fileName = foto_biaya_pengeluaran[i].substr(foto_biaya_pengeluaran[i].lastIndexOf('/') + 1);
                    fileUp.mimeType = "image/jpeg";
                    fileUp.chunkedMode = false;
                    fileUp.headers = {
                        Connection: "close"
                    };
                    fileUp.params = {
                        namaFile:response.nama_foto_nota[i],
                    }
                    var ft = new FileTransfer();
                    ft.upload(foto_biaya_pengeluaran[i], 
                        encodeURI(ipUploadFotoNotaPengeluaran),
                        win,
                        fail,
                        fileUp);
                }


                var win = function(r) {
                    console.log("Should not be called.");
                }

                var fail = function(error) {
                    alert("An error has occurred: Code = " + error.code);
                    myApp.dialog.alert("upload error source " + error.source);
                    myApp.dialog.alert("upload error target " + error.target);
                }

                myApp.dialog.alert(response.message);
                mainView.router.back({force:true});
            } else {
                myApp.dialog.alert(response.message);
            }

        },
        function(xhr,status){

        })
}

function InputAbsensi(status){
    console.log(latGlobal);
    /*myApp.preloader.show();*/
    var foto = [];
    var namaFoto = [];
    console.log(status);

    $$('img[name^="fotoUpload"]').each(function() {
        if($$(this).attr("src") !=null){
            foto.push($$(this).attr("src"));
            namaFoto.push(this.className);
        }
    });
    if(!latGlobal || !lngGlobal){
        myApp.dialog.alert("Silahkan Menghubungi Admin. (112)");
        myApp.preloader.hide();
    } else if(foto.length == 0){
        myApp.dialog.alert("Silahkan Mengambil Foto Terlebih Dahulu");
        myApp.preloader.hide();
    } else {
        var stat = "";
        if(status == "LOGIN"){
            stat = "Masuk";    
        } else {
            stat = "Pulang";
        }
        var params = {
            case:"INPUT_ABSENSI",
            id_absensi:$$("#idInputAbsensi").val(),
            /*jenis:$$("#jenisInputAbsensi").val(),*/
            jenis:status,
            foto:foto,
            namaFoto:namaFoto,
            USERID:USERID,
            latitude:latGlobal,
            longitude:lngGlobal
        }

        myApp.request.post(ipTujuan,params,
            function(data){
                var response = JSON.parse(data);
                if(response.hasil == "berhasil"){
                    try {
                        for(var i =0; i<foto.length;i++){
                            if(status == "LOGIN"){
                                kode = 'IN_'+response.lastid +'_'+namaFoto[i];
                                kodehistory = response.lastidhistory + '_' + namaFoto[i];
                            } else {
                                kode = 'OUT_'+response.lastid +'_'+namaFoto[i];
                                kodehistory = response.lastidhistory + '_' + namaFoto[i];
                            }
                            var fileUp = new FileUploadOptions();
                            fileUp.fileKey = "photo";
                            fileUp.fileName = foto[i].substr(foto[i].lastIndexOf('/') + 1);
                            fileUp.mimeType = "image/jpeg";
                            fileUp.chunkedMode = false;
                            fileUp.headers = {
                                Connection: "close"
                            };
                            fileUp.params = {
                                namaFile:kode,
                                namaFileHistory:kodehistory
                            }
                            var ft = new FileTransfer();
                            ft.upload(foto[i], 
                                encodeURI(ipUploadAbsensi),
                                win,
                                fail,
                                fileUp);

                            var win = function(r) {
                                console.log("Should not be called.");
                            }

                            var fail = function(error) {
                                alert("An error has occurred: Code = " + error.code);
                                console.log("upload error source " + error.source);
                                console.log("upload error target " + error.target);
                            }
                        }
                        myApp.dialog.alert("Berhasil Absen " + stat);
                        myApp.preloader.hide();
                        mainView.router.back({force:true});
                    } catch (err){
                        myApp.dialog.alert("Silahkan Menghubungi Admin. "+err);
                        myApp.preloader.hide();
                    }

                } else {
                    myApp.preloader.hide();
                    myApp.dialog.alert(response.hasil);
                }
            },
            function(xhr,status){
                PreloaderHide(status);
            })
    }
}

function LiveClockFromServer(jamServer) {
    var id = 1;
    interval = setInterval(function(){
        id++;
        var d;
        d = new Date(jamServer);
        d.setSeconds(d.getSeconds() + id);
        d = ConvertDateTimeToTextPhp(d,'datetimeserver');
        var today = new Date(d .replace(/-/g, '/'));
        var hours = today.getHours();
        hours = ("0" + hours).slice(-2);
        var minutes = today.getMinutes();
        minutes = ("0" + minutes).slice(-2);
        var seconds = today.getSeconds();
        seconds = ("0" + seconds).slice(-2);
        $$("#jamServer").html(hours+':'+minutes+':'+seconds);
    },1000);

    $$('.back').on('click',function(){
        clearInterval(interval);
    });
}

function export_point_excel() {
    window.open('https://'+ip+'/bond/export_point_kunjungan.php?sales=' + $$(".kodeDariSalesmanLaporan").val() + '&dari=' + $$(".dariTanggalLaporan").val() + '&sampai=' + $$(".sampaiTanggalLaporan").val(), '_system', 'location=yes');
    return false;
}


function HasilLaporanPointKunjungan() {
    $$(".namaDariSalesmanLaporan").val($$(".namaDariSalesmanLaporan").val());
    $$("#dariTanggalLaporan").val($$(".dariTanggalLaporan").val());
    $$("#sampaiTanggalLaporan").val($$(".sampaiTanggalLaporan").val());
    var params = {
        case: 'LAPORAN_POINT_KUNJUNGAN',
        KODESALESMAN: $$(".kodeDariSalesmanLaporan").val(),
        DARITANGGAL: $$(".dariTanggalLaporan").val(),
        SAMPAITANGGAL: $$(".sampaiTanggalLaporan").val(),
        USERID: USERID,
        KODEJABATAN: KODEJABATAN,
        KODECABANG: KODECABANG
    }

    myApp.request.post(ipTujuan, params,
        function(data) {
            var response = JSON.parse(data);
            var element = "";
            if (response.hasil_point_rencana_vs_kunjungan == "ada") {
                element = `<div class="row" style="margin-top:10px;">
                <div class="card" style="width:100%">
                <div class="card-content card-content-padding">
                <label style="color:#2196f3; font-weight:bold;">TOTAL POINT KUNJUNGAN </label><label style="font-weight:bold; margin-left:10px;">${response.TOTAL_POINT.toFixed(2)}</label>
                </div>
                </div>
                </div>
                <div class="data-table card">
                <table>
                <thead>
                <tr style="background-color:#2196f3;">
                <th class="label-cell" style="color:white;font-weight: bold;">NO. BUKTI</th>
                <th class="label-cell" style="color:white;font-weight: bold;">PELANGGAN (KATEGORI)</th>
                <th class="label-cell" style="color:white;font-weight: bold;">KUNJUNGAN</th>
                <th class="label-cell" style="color:white;font-weight: bold;">RENCANA</th>
                <th class="label-cell" style="color:white;font-weight: bold;">PEMBUATAN RK</th>
                <th class="label-cell" style="color:white;font-weight: bold;">POINT</th>
                </tr>
                </thead>
                <tbody>`;
                response.laporan_point_kunjungan.forEach(function(obj, x) {
                    element += `
                    <tr>
                    <td>${obj.NOMORBUKTI_KUNJUNGAN}</td>
                    <td>${obj.KODEPELANGGAN} (${obj.KATEGORIPELANGGAN})</td>
                    <td class="label-cell">${ConvertDateTimeToText(obj.DATETRANSACTION_KUNJUNGAN,'datetime')}</td>
                    <td class="label-cell">`;
                    if (obj.DATETRANSACTION_RENCANA) {
                        element += `${ConvertDateTimeToText(obj.DATETRANSACTION_RENCANA,'date')}`;
                    } else {
                        element += `-`;
                    }
                    element += `</td>
                    <td class="label-cell">`;
                    if (obj.CREATED_AT) {
                        element += `${ConvertDateTimeToText(obj.CREATED_AT,'datetime')}`;
                    } else {
                        element += `-`
                    }
                    element += `</td>
                    <td class="label-cell">${obj.POINT}</td>
                    </tr>`;
                });

                element += `
                </tbody>
                </table>
                </div>`;

            } else if (response.hasil_point_rencana_vs_kunjungan == "tidakada") {
                element = "Tidak Ada Kunjungan";
            } else {
                myApp.dialog.alert(response.hasil_point_rencana_vs_kunjungan);
                myApp.preloader.hide();
            }
            $$("#hasilLaporanPointKunjungan").html(element);
        },
        function(xhr, status) {
            PreloaderHide(status);
        })
}


function HasilLaporanAbsensi(){
    $$(".namaDariSalesmanLaporan").val($$(".namaDariSalesmanLaporan").val());
    $$("#dariTanggalLaporan").val($$(".dariTanggalLaporan").val());
    $$("#sampaiTanggalLaporan").val($$(".sampaiTanggalLaporan").val());
    var params = {
        case:'LAPORAN_ABSENSI',
        KODESALESMAN:$$(".kodeDariSalesmanLaporan").val(),
        DARITANGGAL:$$(".dariTanggalLaporan").val(),
        SAMPAITANGGAL:$$(".sampaiTanggalLaporan").val(),
        USERID:USERID,
        KODEJABATAN:KODEJABATAN,
        KODECABANG:KODECABANG
    }

    myApp.request.post(ipTujuan,params,
        function(data){
            var response = JSON.parse(data);
            var element = "";
            if(response.hasil == "berhasil"){
                element = `
                <div class="data-table card">
                <table>
                <thead>
                <tr>
                <th class="label-cell">TANGGAL</th>
                <th class="label-cell">HARI</th>
                <th class="label-cell">WAKTU MASUK</th>
                <th class="label-cell">WAKTU PULANG</th>
                <th class="label-cell">JAM KERJA</th>
                </tr>
                </thead>
                <tbody>`;
                response.ABSENSI.forEach(function(obj,x){
                    element += `
                    <tr>
                    <td class="label-cell">${ConvertDateTimeToText(obj.tanggal,'date')}</td>
                    <td class="label-cell">${ConvertDateTimeToText(obj.tanggal,'day')}</td>
                    <td class="label-cell">`;
                    if(obj.waktu_login){
                        element += `${ConvertDateTimeToText(obj.waktu_login,'time')}  
                        <a onClick="PemantauanLokasi(${obj.latitude_login},${obj.longitude_login})"><i class="fas fa-map-marker-alt"></i></a>`;
                        if(response.gambar_login[obj.id] != null){
                            element +=`<a onClick="zoomInOutGambarAbsensi('${response.gambar_login[obj.id].nama}')"><i class="far fa-image"></i></a>`;
                        }
                    } else {
                        element += `-`;
                    }
                    element += `</td>
                    <td class="label-cell">`;
                    if(obj.waktu_logout){
                        element += `${ConvertDateTimeToText(obj.waktu_logout,'time')} 
                        <a onClick="PemantauanLokasi(${obj.latitude_logout},${obj.longitude_logout})"><i class="fas fa-map-marker-alt"></i></a>`;
                        if(response.gambar_logout[obj.id] != null){
                            element += `<a onClick="zoomInOutGambarAbsensi('${response.gambar_logout[obj.id].nama}')"><i class="far fa-image"></i></a>`;
                        }
                    } else {
                        element += `-`;
                    }
                    element+=`</td>
                    <td class="label-cell">${obj.userid}</td>
                    </tr>`;
                });

                element += `
                </tbody>
                </table>
                </div>`;

            } else if(response.hasil == "kosong"){
                element = "Tidak Ada Daftar Absensi";
            } else {
                myApp.dialog.alert(response.hasil);
                myApp.preloader.hide();
            }
            $$("#hasilLaporanAbsensi").html(element);
        },
        function(xhr,status){
            PreloaderHide(status);
        })
}

function UbahTanggalBerdasarClass(propClass,e){
    console.log(halamanGlobal);

    $$("."+propClass).val($$(e).val());
    if(halamanGlobal == "LAPORAN_ABSENSI"){
        HasilLaporanAbsensi();
    } else if(halamanGlobal == "LAPORAN_POINT_KUNJUNGAN"){
        HasilLaporanPointKunjungan();
    }
}

var latitudePemantauanLokasi;
var longitudePemantauanLokasi;
function PemantauanLokasi(lat,long){
    latitudePemantauanLokasi = lat;
    longitudePemantauanLokasi = long;
    mainView.router.navigate('/pemantauan_lokasi/',{preloadPreviousPage:false});
}

function ClosePopup(){
    myApp.popup.close();
}

var detailIdInbox;
function OpenInbox(id,e){
    detailIdInbox = id;
    myApp.preloader.show();
    var params = {
        case:"OPEN_INBOX",
        id:id,
        USERID:USERID,
        KODECABANG:KODECABANG,
        KODEJABATAN:KODEJABATAN
    }

    myApp.request.post(ipTujuan,params,
        function(data){
            var response = JSON.parse(data);
            if(response.hasil == "berhasil"){
                $$(e).attr('class','inboxBackground');
                $$(e).find('i').attr('class','far fa-envelope-open');
                mainView.router.navigate("/detail_inbox/");
            } else {
                myApp.preloader.hide();
                myApp.dialog.alert(response.hasil);
            }
        },
        function(xhr,status){
            if(status == 4 || status == 0){
                myApp.preloader.hide();
                myApp.dialog.alert("Internet Anda Bermasalah");
            }
        })
}

function OpenPopupTujuanInbox(){
    var tipe = $$("input[name='inbox-radio']:checked").val();
    console.log(tipe);
    if(tipe == "KODEJABATAN"){
        myApp.popup.open('.popup-jabatan');
    } else {
        myApp.popup.open('.popup-karyawan');
    }
}

function PopupClose(namaClass){
    myApp.popup.close(namaClass);
}

function SimpanPilihTujuanInbox(namaClass){
    var tipe = $$("input[name='inbox-radio']:checked").val();
    var arrKode = [];
    if(tipe == "KODEJABATAN"){
        $$('input[name^="jabatan-checkbox"]:checked').each(function() {
            arrKode.push($$(this).val());
        });
    } else {
        $$('input[name^="karyawan-checkbox"]:checked').each(function() {
            arrKode.push($$(this).val());
        });
    }
    PopupClose(namaClass);
}

function PilihTipeTujuanMessage(){
    var params = {
        case:"POPUP_INBOX_KODEJABATAN_KODEKARYAWAN",
        USERID:USERID,
        KODEJABATAN:KODEJABATAN,
        KODECABANG:KODECABANG   
    }

    myApp.request.post(ipTujuan,params,
        function(data){
            var response = JSON.parse(data);
            if(response.hasil_jabatan == "ada" && response.hasil_karyawan == "ada"){
                var element = "";
                response.JABATAN.forEach(function(obj,x){
                    element += `
                    <li>
                    <label class="item-checkbox item-content">
                    <input type="checkbox" name="jabatan-checkbox" value="${obj.KODEJABATAN}" />
                    <i class="icon icon-checkbox"></i>
                    <div class="item-inner">
                    <div class="item-title namaJabatan">${obj.NAMA}</div>
                    </div>
                    </label>
                    </li>`;
                });
                $$("#kodejabatanPopup").html(element);

                var element = "";
                response.KARYAWAN.forEach(function(obj,x){
                    element += `<li>
                    <label class="item-checkbox item-content">
                    <input type="checkbox" name="karyawan-checkbox" value="${obj.KODEKARYAWAN}" />
                    <i class="icon icon-checkbox"></i>
                    <div class="item-inner">
                    <div class="item-title namaKaryawan">${obj.NAMA}</div>
                    </div>
                    </label>
                    </li>`;
                })

                $$("#kodekaryawanPopup").html(element);

                var searchbarKaryawan = myApp.searchbar.create({
                    el: '.searchbarKaryawan',
                    searchContainer: '#kodekaryawanPopup',
                    searchIn: '.namaKaryawan',
                    on: {
                        search(sb, query, previousQuery) {
                            console.log(query, previousQuery);
                        }
                    }
                });

                var searchbarJabatan = myApp.searchbar.create({
                    el: '.searchbarJabatan',
                    searchContainer: '#kodejabatanPopup',
                    searchIn: '.namaJabatan',
                    on: {
                        search(sb, query, previousQuery) {
                            console.log(query, previousQuery);
                        }
                    }
                });
            } else {
                myApp.dialog.alert("Silahkan Menghubungi Admin");
            }
        },
        function(xhr,status){
            PreloaderHide(status);
        })
}

function KirimMessage(){
    var judul = $$("#judulMessage").val();
    var isi = $$("#isiMessage").val();
    var tipe = $$("input[name='inbox-radio']:checked").val();
    var arrKode = [];
    if(tipe == "KODEJABATAN"){
        $$('input[name^="jabatan-checkbox"]:checked').each(function() {
            arrKode.push($$(this).val());
        });
    } else {
        $$('input[name^="karyawan-checkbox"]:checked').each(function() {
            arrKode.push($$(this).val());
        });
    }

    var params = {
        case:"KIRIM_MESSAGE",
        judul:judul,
        isi:isi,
        tipe:tipe,
        arrKode:arrKode,
        USERID:USERID,
        KODECABANG:KODECABANG,
        KODEJABATAN:KODEJABATAN
    }

    myApp.request.post(ipTujuan,params,
        function(data){
            var response = JSON.parse(data);
            if(response.hasil == "berhasil"){
                myApp.dialog.alert("Berhasil Mengirim Pesan");
                mainView.router.back({force:true});
            } else {
                myApp.dialog.alert(response.hasil);
                myApp.preloader.hide();
            }
        },
        function(xhr,status){
            PreloaderHide(status);
        })

}

function SearhInputDari(namaClassForm,namaClassContainer,namaClassSearchIn){
    var searchbar3 = myApp.searchbar.create({
        el: '.'+namaClassForm,
        searchContainer: '.'+namaClassContainer,
        searchIn: '.'+namaClassSearchIn,
        on: {
            search(sb, query, previousQuery) {
                console.log(query, previousQuery);
            }
        }
    });
}

function SearhInputSampai(namaClassForm,namaClassContainer,namaClassSearchIn){
    var searchbar3 = myApp.searchbar.create({
        el: '.'+namaClassForm,
        searchContainer: '.'+namaClassContainer,
        searchIn: '.'+namaClassSearchIn,
        on: {
            search(sb, query, previousQuery) {
                console.log(query, previousQuery);
            }
        }
    });
}

function HapusInbox(){

    var CheckedInbox = [];
    $$('input[name^="CheckHapusInbox"]:checked').each(function() {
        CheckedInbox.push($$(this).val());
    });

    myApp.dialog.confirm("Hapus Inbox ?","Konfirmasi",
        function(){
            var params = {
                case:"HAPUS_INBOX",
                CheckedInbox:CheckedInbox
            };

            myApp.request.post(ipTujuan,params,
                function(data){
                    var response = JSON.parse(data);
                    if(response.hasil == "berhasil"){
                        myApp.dialog.alert("Inbox Telah Dihapus");
                        mainView.router.back({force:true});
                    } else {
                        myApp.dialog.alert(response.hasil);
                        myApp.preloader.hide();
                    }
                },
                function(xhr,status){
                    PreloaderHide(status);
                })
        })
    
}

function BarcodeScanner(){
    window.plugins.GMVBarcodeScanner.scan({}, function(err, result) { 

    //Handle Errors
    if(err) return;
    
    //Do something with the data.
    alert(result);
    
});
}

var kodeKategoriPemetaanVerifikasiPelanggan;
var verifikasiKategoriPemetaanVerifikasiPelanggan;
function PemetaanPelangganVerifikasiByKategori(kategoripelanggan,verifikasi = 'F'){
    kodeKategoriPemetaanVerifikasiPelanggan = kategoripelanggan;
    verifikasiKategoriPemetaanVerifikasiPelanggan = verifikasi;
    mainView.router.navigate("/detail_pemetaan_by_pelanggan_verifikasi_by_kategori/");
}


var userIdPemetaanVerifikasiPelanggan;
function PemetaanPelangganVerifikasiByKategoriBySalesman(userid,status){

    if(status == "awal"){
        kodeKategoriPemetaanVerifikasiPelanggan = null;
    }
    userIdPemetaanVerifikasiPelanggan = userid;
    mainView.router.navigate("/detail_pemetaan_by_pelanggan_verifikasi_by_kategori_by_salesman/");
}


function PemetaanPelangganVerifikasiBySalesmanEnd(kodekategori){
    kodeKategoriPemetaanVerifikasiPelanggan = kodekategori;
    console.log(halamanGlobal);
    if(halamanGlobal == "PEMETAAN_BY_PELANGGAN"){
        verifikasiKategoriPemetaanVerifikasiPelanggan = "F";
    } else {
        verifikasiKategoriPemetaanVerifikasiPelanggan = "T";
    }
    mainView.router.navigate("/detail_pemetaan_by_pelanggan_verifikasi_by_kategori_by_salesman_end/");
}

function CopyToClipboard(namaClass,namaId){
    if(namaId){
        var copyText = document.querySelector(`#${namaId}`);
        copyText.select();
        copyText.setSelectionRange(0, 99999)
        document.execCommand("copy",false,null);
        var toastWithButton = myApp.toast.create({
            text: 'Laporan Sudah Tercopy',
            closeButton: true,
        });
        toastWithButton.open();
    }
}

var arrTampungSearchNamaPelangganVerifikasi;
function SearchPelangganVerifikasi(e){
    var searchNama = $$(e).closest('.item-content').find('input').val();
    var tampung = [];
    var result = arrTampungSearchNamaPelangganVerifikasi.find( function(element,index){
        if(element.indexOf(searchNama) > -1){
            tampung.push(`${index+1} - ${element}`);
        }
    });
    if(tampung.length > 0){
        var element = `Hasil Pencarian : <br>`;
        for(var i = 0;i<tampung.length;i++){
            element += `${tampung[i]} <br>`;
        }
        myApp.dialog.alert(element);
    } else {
        myApp.dialog.alert("Tidak Ada Hasil Pencarian")
    }
}

var tanggalLaporanBulananKunjungan;
var kodeSalesmanLaporanBulananKunjungan;
function LihatLaporanBulananKunjungan(){
    tanggalLaporanBulananKunjungan = $$("#dariTanggal").val();
    kodeSalesmanLaporanBulananKunjungan = $$(".kodeDariSalesmanLaporan").val();
    PindahHalaman('/hasil_laporan_bulanan_kunjungan/');
}

function SimpanUnitKendaraan(){
    var params = {
        case:"SIMPAN_UNIT_KENDARAAN",
        nomor_plat:$$(".nomor_plat").val(),
        id_jenis_kendaraan:$$(".jenis_kendaraan").val(),
        kodesalesman:$$('.kodeDariSalesmanLaporan').val()
    }

    myApp.request.post(ipTujuan,params,
        function(data){
            var response = JSON.parse(data);
            if(response.hasil == "berhasil"){
                mainView.router.back({force:true});
                myApp.dialog.alert("Berhasil Menginput Unit Kendaraan");
            } else {
                myApp.dialog.alert(response.message);
            }
        },
        function(xhr,status){

        })
}

function SimpanEditUnitKendaraan(){
    var params = {
        case:"EDIT_UNIT_KENDARAAN",
        nomor_plat:$$(".nomor_plat").val(),
        id_jenis_kendaraan:$$(".jenis_kendaraan").val(),
        kodesalesman:$$('.kodeDariSalesmanLaporan').val(),
        nomor_plat_lama:nomor_plat_unit_kendaraan
    }

    myApp.request.post(ipTujuan,params,
        function(data){
            var response = JSON.parse(data);
            if(response.hasil == "berhasil"){
                mainView.router.back({force:true});
                myApp.dialog.alert("Berhasil Menginput Unit Kendaraan");
            } else {
                myApp.dialog.alert(response.message);
            }
        },
        function(xhr,status){

        })
}

function pilihUnit(nomor_plat){
    myApp.popup.close('.popup-unit');
    $$('.value_nomor_plat_unit').val(nomor_plat);
    $$('.text_nomor_plat_unit').val(nomor_plat)
}

var nomor_bukti_detail_pengeluaran;
function DetailPengeluaran(nomorbukti){
    nomor_bukti_detail_pengeluaran = nomorbukti;
    PindahHalaman('/detail_pengeluaran/');
}

var nomor_plat_unit_kendaraan;
function DetailUnitKendaraan(nomor_plat){
    nomor_plat_unit_kendaraan = nomor_plat;
    PindahHalaman('/detail_unit_kendaraan/')
}

function LoadMenu(level,screen,halaman,status,halaman_global){
    if(halaman_global){
        halamanGlobal = halaman_global;
    }
    
    if(status == "naik"){
        level = parseInt(level) + 1;
        screen = screen;
    } else {
        if(level != 1){
            level = parseInt(level) - 1;
            screen = screen;
        }
    }

    if(halaman_global == "MASTER_RENCANA_KUNJUNGAN"){
        tampungHalamanFollowDanCollector = "RENCANA_KUNJUNGAN";
    } else if(halaman_global == "MASTER_FOLLOWUP"){
        tampungHalamanFollowDanCollector = "FOLLOWUP";
    } else if(halaman_global == "MASTER_COLLECTOR"){
        tampungHalamanFollowDanCollector = "COLLECTOR";
    } else if(halaman_global == "MASTER_KIRIMAN"){
        tampungHalamanFollowDanCollector = "KIRIMAN";
    }

    if(halaman == null || halaman == "null" || halaman == ""){
        $$(".undo-menu-button").remove();
        var params = {
            case:"LOAD_MENU",
            level:level,
            screen:screen,
            USERID:USERID,
            status:status
        }
        myApp.request.post(ipTujuan,params,
            function(data){
                var response = JSON.parse(data);
                console.log(response);

                tampungCardHome = `<ul>`;
                response.usermenu.forEach(function(obj,x){
                    userMenuArrayGlobal[x] = obj.MENU;
                    userIconArrayGlobal[x] = obj.ICON;
                    userTagArrayGlobal[x] = obj.TAG;
                    userHakAksesArrayGlobal[obj.TAG] = new Array();

                    userHakAksesArrayGlobal[obj.TAG]['TAMBAH'] = obj.TAMBAH;
                    userHakAksesArrayGlobal[obj.TAG]['UBAH'] = obj.UBAH;
                    userHakAksesArrayGlobal[obj.TAG]['HAPUS'] = obj.HAPUS;
                    userHakAksesArrayGlobal[obj.TAG]['CETAK'] = obj.CETAK;
                    userHakAksesArrayGlobal[obj.TAG]['POSTING'] = obj.POSTING;
                    userHakAksesArrayGlobal[obj.TAG]['CARI'] = obj.CARI;

                    /*tampungCardHome += `
                    <li onClick="LoadMenu('${obj.SCREEN.length}','${obj.SCREEN}','${obj.HALAMAN}','naik','${obj.HALAMAN_GLOBAL}')">
                    <a href="#" class="item-link item-content ${obj.TAG}">
                    <div class="item-inner">
                    <div class="item-title">`;
                    if(obj.ICON_GAMBAR == ""){
                        tampungCardHome += `<i class="${obj.ICON} fontAwesomeBiru"></i>`;
                    } else {
                        console.log("a");
                        tampungCardHome += `<div class="item-media"><img width="44" src="${ipIconGambar}${obj.ICON_GAMBAR}?`+ new Date().getTime();`"></div>`;
                    }
                    tampungCardHome+=`  ${obj.MENU}</div>
                    </div>
                    </a>
                    </li>`;*/
                    tampungCardHome += `
                    <li onClick="LoadMenu('${obj.SCREEN.length}','${obj.SCREEN}','${obj.HALAMAN}','naik','${obj.HALAMAN_GLOBAL}')">
                    <div class="item-content">
                    <div class="item-media">`;
                    if(obj.ICON_GAMBAR != "" || obj.ICON_GAMBAR != null || obj.ICON_GAMBAR){
                        tampungCardHome += `<img width="44" src="${ipIconGambar}${obj.ICON_GAMBAR}?`+ new Date().getTime();
                        tampungCardHome +=`"/>`;
                    } else {
                        tampungCardHome+=`<i class="${obj.ICON} fontAwesomeBiru"></i>`;
                    }
                    
                    tampungCardHome+=` </div>
                    <div class="item-inner">
                    <div class="item-title-row">
                    <div class="item-title">${obj.MENU}</div>
                    </div>
                    </div>
                    </div>
                    </li>
                    `;
                })
                tampungCardHome += `</ul>`;
                $$('.cardMaster').html(tampungCardHome);
                if(level != 1 && status == "turun"){
                    var element = `<div class="block undo-menu-button" >
                    <p class="row  justify-content-center" > 
                    <button class="col-30 button color-red  button-fill" onClick="LoadMenu('${level}','${screen.substring(0,screen.length-1)}',null,'turun')"><i class="fas fa-undo-alt"></i></button>
                    </p>
                    </div>`;
                    $$('.cardMaster').closest('#tab-menu').append(element);
                } else if(level != 1 && status == "naik") {
                    var element = `<div class="block undo-menu-button" >
                    <p class="row  justify-content-center" > 
                    <button class="col-30 button color-red  button-fill" onClick="LoadMenu('${level}','${screen}',null,'turun')"><i class="fas fa-undo-alt"></i></button>
                    </p>
                    </div>`;
                    $$('.cardMaster').closest('#tab-menu').append(element);
                }
                myApp.preloader.hide();
            },
            function(xhr,status){

            })
    } else {
        mainView.router.navigate(halaman);
        myApp.preloader.hide();

    }
}

var response_edit_ganti_screen;
function EditGantiScreen(nomor,screen){
    var params = {
        case:"EDIT_GANTI_SCREEN",
        nomor:nomor,
        screen:screen
    }

    myApp.request.post(ipTujuan,params,
        function(data){
            var response = JSON.parse(data);
            response_edit_ganti_screen = response;
            PindahHalaman("/edit_ganti_screen/");
        },
        function(xhr,status){

        })
}

function EditGantiScreenPost(){
    var params = {
        case:"EDIT_GANTI_SCREEN_POST",
        data:myApp.form.convertToData('#form-edit-ganti-screen'),
    }

    myApp.request.post(ipTujuan,params,
        function(data){
            var response = JSON.parse(data);
            if(response.hasil == "berhasil"){
                mainView.router.back({force:true});
                myApp.dialog.alert("Berhasil Mengganti Screen");
            } else {
                myApp.dialog.alert(response.message);
            }
        },
        function(xhr,status){

        })
}

function kirimOtorisasi(id,kodesalesman, kodepelanggan, datetransaction)
{
    var params = {
        case:"KODE_OTORISASI",
        ID:id,
        KODESALESMAN:kodesalesman,
        KODEPELANGGAN:kodepelanggan,
        DATETRANSACTION:datetransaction
    }
    myApp.request.post(ipTujuan,params,function(data){
        console.log(data);
        var response = JSON.parse(data);
        $$("p[name='cetak_kode']").append("Authentication code : " + response.kode);
        $$("button[name='buttonKode']").attr('class','col-30 button button-fill disabled');
    });
}